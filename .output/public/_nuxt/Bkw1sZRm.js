import{c as F,r as N,u as ne}from"./B-v5H7Nw.js";import"./BNkWLV-v.js";import{L as re,M as ue,u as me,m as C,r as T,n as ce,D as pe,p as fe,s as _e,o as $,c as z,v as a,x as A,P as ve,t as Ve,y as R,w as i,b as t,V as n,A as P,E as q,d as O,F as be,z as ge}from"./CHtJlntj.js";import{$ as V,f as U}from"./Dt58fxFJ.js";import{f as L,a as j}from"./B0IxRygJ.js";import{u as ye}from"./DnOoK0PG.js";import{V as f}from"./BnCCggCK.js";import{V as d}from"./Cqv_TlUC.js";import{V as x}from"./DPJYL_69.js";import{V as Ce}from"./Bg_KqTYf.js";import{V as $e}from"./DyqGBBZP.js";const Pe={key:1},Te={__name:"DadosEstrangeira",props:{isModal:{type:Boolean,default:!1}},emits:["saved","close-modal"],async setup(G,{emit:W}){let b,E;const w=G,k=W,M=re(),H=ue(),{$toast:p}=me(),u=ge(),J=`${u.public.auth}/service/gerencia/getPessoaById`,K=`${u.public.auth}/service/gerencia/createPessoa`,Q=`${u.public.auth}/service/gerencia/updatePessoa`,X=`${u.public.auth}/service/gerencia/listarEstadoCivil`,Y=`${u.public.auth}/service/gerencia/listarCapacidadeCivil`,Z=`${u.public.auth}/service/gerencia/listarCidades`,h=`${u.public.auth}/service/gerencia/listarSexo`,ee=`${u.public.auth}/service/gerencia/listarPais`,{id:g}=H.params,ae={nome:null,nome_pai:null,nome_mae:null,profissao:null,local_trabalho:null,data_nascimento:null,doc_identificacao:null,fone_celular:null,cpf_pai:null,cpf_mae:null,tipo_pessoa:"ESTRANGEIRA",tabvalores_estadocivil_id:null,tabvalores_capacidadecivil_id:null,tabvalores_nacionalidade_id:null,tabvalores_sexo_id:null,cidade_nascimento_estrangeiro:null,cartorio_id:C("user-data").value.cartorio_id,user_id:C("user-data").value.usuario_id},I=T(!1),B=T(g||C("pessoa-id").value),e=ce({...ae});function _(s){if(s)return s.replace(/[.\-]/g,"");s=null}const oe=async()=>{const{data:s,error:o}=await U(`${J}/${g}`,{method:"GET"});s.value&&(s.value.data_nascimento=s.value.data_nascimento?L(s.value.data_nascimento,"dd/mm/yyyy"):null,s.value.created=s.value.created?L(s.value.created,"dd/mm/yyyy"):null),Object.assign(e,s.value)},{data:y,status:ke,pending:S,error:D}=([b,E]=pe(async()=>ye("cliente-dados",async()=>{const[s,o,r,l,v]=await Promise.all([V(X),V(Y),V(Z),V(h),V(ee)]);return{estadoCivilItems:s,capacidadeCivilItems:o,cidadeNascimentoItems:r,sexoItems:l,paisItems:v}})),b=await b,E(),b),le={nome:{required:F.withMessage("O campo é obrigatorio",N)},nome_mae:{required:F.withMessage("O campo é obrigatorio",N)}},m=ne(le,e);async function te(){if(await m.value.$validate()){const s={...e};for(const c in s)s[c]===""&&(s[c]=null);const o={...s,doc_identificacao:_(e.doc_identificacao),cpf_pai:_(e.cpf_pai),cpf_mae:_(e.cpf_mae),data_nascimento:j(e.data_nascimento),fone_celular:e.fone_celular?e.fone_celular.replace(/[^0-9]/g,""):null},{data:r,error:l,status:v}=await U(K,{method:"POST",body:o});if(v.value==="error"&&l.value.statusCode===500)p.error("Erro ao cadastrar pessoa,o CPF já está cadastrado.");else{p.success("Pessoa cadastrada com sucesso!");const c=r.value.id;B.value=c;const de=C("pessoa_token");de.value=r.value.token,I.value=!0,k("saved")}}else p.error("Erro ao cadastrar pessoa, preencha os campos obrigatorios.")}async function se(){const s={...e};for(const c in s)s[c]===""&&(s[c]=null);const o={...s,doc_identificacao:_(e.doc_identificacao),cpf_mae:_(e.cpf_mae),fone_celular:e.fone_celular?e.fone_celular.replace(/[^0-9]/g,""):"",data_nascimento:j(e.data_nascimento)},{data:r,error:l,status:v}=await U(`${Q}/${B.value}`,{method:"PUT",body:o});if(v.value==="success"){if(w.isModal===!0){p.success("Pessoa atualizada com sucesso!"),k("close-modal");return}p.success("Pessoa atualizada com sucesso!"),M.push("/pessoas/lista")}else p.error("Erro ao atualizar Pessoa Estrangeira")}const ie=()=>{if(w.isModal===!0){k("close-modal");return}M.push("/pessoas/lista")};return fe(()=>{g&&(oe(),I.value=!0)}),(s,o)=>{const r=_e("mask");return $(),z(be,null,[a(S)?($(),A(ve,{key:0,class:"loading-spinner",indeterminate:"",size:"64"})):a(D)?($(),z("div",Pe,Ve(a(D).message),1)):R("",!0),a(S)?R("",!0):($(),A($e,{key:2},{default:i(()=>[t(f,null,{default:i(()=>[t(d,{md:"3"},{default:i(()=>[t(x,{label:"País",modelValue:a(e).tabvalores_nacionalidade_id,"onUpdate:modelValue":o[0]||(o[0]=l=>a(e).tabvalores_nacionalidade_id=l),items:a(y).paisItems,"item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1}),t(d,{md:"4"},{default:i(()=>[t(n,{modelValue:a(e).nome,"onUpdate:modelValue":o[1]||(o[1]=l=>a(e).nome=l),"error-messages":a(m).nome.$errors.map(l=>l.$message),label:"Nome",required:"",onBlur:a(m).nome.$touch,onInput:a(m).nome.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1}),t(d,{md:"3"},{default:i(()=>[t(n,{modelValue:a(e).doc_identificacao,"onUpdate:modelValue":o[2]||(o[2]=l=>a(e).doc_identificacao=l),label:"Documento"},null,8,["modelValue"])]),_:1}),t(d,{md:"2"},{default:i(()=>[t(Ce,{label:"Sexo",modelValue:a(e).tabvalores_sexo_id,"onUpdate:modelValue":o[3]||(o[3]=l=>a(e).tabvalores_sexo_id=l),items:a(y).sexoItems,"item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1})]),_:1}),t(f,null,{default:i(()=>[t(d,{md:"4"},{default:i(()=>[t(x,{modelValue:a(e).tabvalores_estadocivil_id,"onUpdate:modelValue":o[4]||(o[4]=l=>a(e).tabvalores_estadocivil_id=l),items:a(y).estadoCivilItems,"item-title":"descricao","item-value":"id",label:"Estado Civil"},null,8,["modelValue","items"])]),_:1}),t(d,{md:"4"},{default:i(()=>[t(n,{modelValue:a(e).profissao,"onUpdate:modelValue":o[5]||(o[5]=l=>a(e).profissao=l),label:"Profissão"},null,8,["modelValue"])]),_:1}),t(d,{md:"4"},{default:i(()=>[t(n,{modelValue:a(e).local_trabalho,"onUpdate:modelValue":o[6]||(o[6]=l=>a(e).local_trabalho=l),label:"Local de trabalho"},null,8,["modelValue"])]),_:1})]),_:1}),t(f,null,{default:i(()=>[t(d,{md:"2"},{default:i(()=>[P(t(n,{modelValue:a(e).data_nascimento,"onUpdate:modelValue":o[7]||(o[7]=l=>a(e).data_nascimento=l),label:"Data de nascimento",placeholder:"dd/mm/yyyy"},null,8,["modelValue"]),[[r,"##/##/####"]])]),_:1}),t(d,{md:"2"},{default:i(()=>[P(t(n,{modelValue:a(e).fone_celular,"onUpdate:modelValue":o[8]||(o[8]=l=>a(e).fone_celular=l),label:"Celular",placeholder:"'(99) 99999-9999'"},null,8,["modelValue"]),[[r,"(##) #####-####"]])]),_:1}),t(d,{md:"4"},{default:i(()=>[t(x,{modelValue:a(e).tabvalores_capacidadecivil_id,"onUpdate:modelValue":o[9]||(o[9]=l=>a(e).tabvalores_capacidadecivil_id=l),items:a(y).capacidadeCivilItems,label:"Capacidade Civil","item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1}),t(d,{md:"4"},{default:i(()=>[t(n,{modelValue:a(e).cidade_nascimento_estrangeiro,"onUpdate:modelValue":o[10]||(o[10]=l=>a(e).cidade_nascimento_estrangeiro=l),label:"Cidade de nascimento"},null,8,["modelValue"])]),_:1})]),_:1}),t(f,null,{default:i(()=>[t(d,{md:"4"},{default:i(()=>[P(t(n,{modelValue:a(e).cpf_pai,"onUpdate:modelValue":o[11]||(o[11]=l=>a(e).cpf_pai=l),label:"CPF do Pai"},null,8,["modelValue"]),[[r,"###.###.###-##"]])]),_:1}),t(d,{md:"4"},{default:i(()=>[t(n,{modelValue:a(e).nome_pai,"onUpdate:modelValue":o[12]||(o[12]=l=>a(e).nome_pai=l),label:"Nome do Pai"},null,8,["modelValue"])]),_:1})]),_:1}),t(f,null,{default:i(()=>[t(d,{md:"4"},{default:i(()=>[P(t(n,{modelValue:a(e).cpf_mae,"onUpdate:modelValue":o[13]||(o[13]=l=>a(e).cpf_mae=l),label:"CPF da Mãe"},null,8,["modelValue"]),[[r,"###.###.###-##"]])]),_:1}),t(d,{md:"4"},{default:i(()=>[t(n,{modelValue:a(e).nome_mae,"onUpdate:modelValue":o[14]||(o[14]=l=>a(e).nome_mae=l),modelModifiers:{date:!0},"error-messages":a(m).nome_mae.$errors.map(l=>l.$message),label:"Nome da Mãe",required:"",onBlur:a(m).nome_mae.$touch,onInput:a(m).nome_mae.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1})]),_:1}),t(f,{class:"mb-3"},{default:i(()=>[t(q,{onClick:ie,size:"large",color:"red"},{default:i(()=>o[16]||(o[16]=[O("Voltar")])),_:1}),t(q,{onClick:o[15]||(o[15]=l=>a(I)?se():te()),class:"ml-4",size:"large",color:"green"},{default:i(()=>o[17]||(o[17]=[O("Salvar")])),_:1})]),_:1})]),_:1}))],64)}}};export{Te as _};
