import{_ as P}from"./BHRjmP1O.js";import{_ as R}from"./DPFgKgjI.js";import{c as L,r as D,u as F}from"./RNUW-J5z.js";import{_ as U,L as W,M as j,r as i,m as p,n as J,D as K,x as Q,w as u,z as X,o as Z,b as a,a as h,v as t,V as G,E as $,d as x}from"./CxZkCJJO.js";import{f}from"./BibqZaSv.js";import{u as H}from"./CQnvv-2I.js";import{V as Y}from"./BQwL5JaM.js";import{V as ee}from"./DbLniB7v.js";import{V as te}from"./Dsp-y3Jd.js";import{V as oe}from"./BQ0TWYA2.js";import"./SYqJ8RP3.js";import"./C0TgggJK.js";import"./hDdAZVcF.js";import"./1arHLVoa.js";import"./BYI-Z_2T.js";import"./flODEQtC.js";import"./D43sOJMp.js";const ae={style:{width:"600px","margin-top":"10px"}},se={style:{width:"180px","margin-top":"20px"}},re={__name:"autenticacao",props:{ato_token:{type:String,required:!0}},async setup(y){let c,k;const C=y,g=W(),V=j(),m=X(),z=`${m.public.auth}/service/gerencia/listarEscrevente`,v=i(p("user-data").value.cartorio_token).value,B=i(p("user-service").value.token).value||i(p("user-service").value).value,S=p("auth_token").value,T=`${m.public.auth}/service/gerencia/atoAutentica`,A=`${m.public.auth}/service/gerencia/etiquetaAutentica`,M=`${m.public.envioDoc}/print`,_=i(!1),b=i(""),s=J({escrevente:null,quantidade:1}),q=i([]),{data:N}=([c,k]=K(()=>f(z,{method:"POST",body:{cartorio_token:v}})),c=await c,k(),c);q.value=N.value[0].func_json_escreventes;const O={escrevente:{required:L.withMessage("O campo é obrigatorio",D)}},d=F(O,s),E=async()=>{if(await d.value.$validate()){const{data:o,status:e,error:l}=await f(T,{method:"POST",body:{usuario_token:S,cartorio_token:v,quantidade:Number(s.quantidade),ordemserv_token:B,ato_tipo_token:C.ato_token}});e.value==="success"&&o.value.status==="OK"?I(o.value.token):(_.value=!0,b.value=o.value.status_mensagem||l.value.data.details)}},I=async o=>{const{data:e,status:l}=await f(A,{method:"POST",body:{escrevente_token:s.escrevente,cartorio_token:v,ato_token:o}});if(l.value==="success"){if(e.value.tipo_etiqueta==="html"){const r=window.open("","_blank");r.document.open(),r.document.write(e.value.etiqueta),r.document.close()}else if(e.value.tipo_etiqueta==="zpl"){const{status:r}=await H(`${M}`,{method:"POST",body:{zpl:atob(e.value.etiqueta)}},"$nXL9eJBhI7");if(r.value!=="success"){$toast.error("Não foi possivel fazer a impressao da etiqueta");return}}w()}},w=()=>{const o=V.query.origem||"criar",e=V.query.id;o==="atualizar"?g.push(`/os/atualizar/${e}`):g.push("/os/criar-registro")};return(o,e)=>{const l=P,r=R;return Z(),Q(Y,{class:"mt-10"},{default:u(()=>[a(oe,null,{default:u(()=>[h("div",ae,[a(ee,{label:"Tabelião/escrivão",modelValue:t(s).escrevente,"onUpdate:modelValue":e[0]||(e[0]=n=>t(s).escrevente=n),items:t(q),"item-title":"nome","item-value":"token",required:"","error-messages":t(d).escrevente.$errors.map(n=>n.$message),onBlur:t(d).escrevente.$touch,onInput:t(d).escrevente.$touch},null,8,["modelValue","items","error-messages","onBlur","onInput"])]),h("div",se,[a(G,{type:"number",label:"Quantidade",modelValue:t(s).quantidade,"onUpdate:modelValue":e[1]||(e[1]=n=>t(s).quantidade=n)},null,8,["modelValue"])]),a(te,{class:"mb-3 mt-2"},{default:u(()=>[a(l,{onClick:w},{default:u(()=>[a($,{class:"ml-4",size:"large",color:"red"},{default:u(()=>e[3]||(e[3]=[x("Voltar")])),_:1})]),_:1}),a($,{class:"ml-4",size:"large",color:"green",onClick:E},{default:u(()=>e[4]||(e[4]=[x("Salvar")])),_:1})]),_:1})]),_:1}),a(r,{show:t(_),errorMessage:t(b),onClose:e[2]||(e[2]=n=>_.value=!1)},null,8,["show","errorMessage"])]),_:1})}}},he=U(re,[["__scopeId","data-v-2546cd23"]]);export{he as default};
