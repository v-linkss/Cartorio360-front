import{r as f,e as c,y as $,A as q,c as y,a as T,b as v,i as n,j as F,w as p,p as m,F as U,k as D,o as r,H as P,h as i,s as k,V as O,d as S}from"./D6lRYQBj.js";import{u as _}from"./gzRMkMOa.js";import{V as h}from"./C_n1zCOV.js";import{V as H}from"./BiB0YWxF.js";import{V as I}from"./CDCdXqNw.js";import{V as Q}from"./DnTmIxDG.js";import"./BQ0dw81K.js";import"./CRudSRcp.js";import"./QO9EYXzn.js";import"./zLh3jXCh.js";import"./ljGWtH7P.js";import"./CZ5EwHZn.js";import"./DoLUSq4B.js";import"./Dd-ZuqGt.js";const j={key:0},se={__name:"lista",async setup(G){let d,R;const b=D(),w=`${b.public.managemant}/getRelatorios`,B=`${b.public.managemant}/gerarRelatorioPessoa`,C=`${b.public.managemant}/listaQuery`,V=f([]),s=f(null),u=f([]),g={user_token:c("auth_token").value,cartorio_token:c("user-data").value.cartorio_token,user_name:c("user-data").value.nome},{data:A}=([d,R]=$(()=>_(w,{method:"POST",body:g},"$53NFRNGH7x")),d=await d,R(),d);V.value=Array.isArray(A.value)?A.value:[];const E=q(()=>V.value.every(l=>!l.codigo&&!l.value&&!l.parametros)?[]:V.value.map(l=>({label:l.codigo,value:l.codigo,parametros:l.parametros}))),x=async l=>{const a=E.value.find(e=>e.value===l);if(a){u.value=a.parametros.map(e=>({...e,value:null,showDatePicker:!1,items:[]}));for(const e of u.value)if(e.tipo==="TABLE"&&e.dominio)try{const{data:t}=await _(C,{method:"POST",body:{cartorio_token:g.cartorio_token,parametros:e.dominio}},"$c4psqRQWRs");e.items=Array.isArray(t.value)?t.value.map(o=>({label:o.nome,value:o.token})):[]}catch(t){console.error("Erro ao buscar dados para TABLE:",t)}}else u.value=[]},L=async l=>{const a=u.value.reduce((e,t)=>(e[t.parametro]=t.value,e),{});try{const e={...a,cartorio_token:c("user-data").value.cartorio_token,consulta:s.value},{data:t}=await _(B,{method:"POST",body:e},"$6CLQJHdzNf"),o=new Blob([t.value],{type:"text/html"}),N=URL.createObjectURL(o);window.open(N,"_blank"),u.value=[],s.value=null}catch(e){console.error("Erro ao criar o relatório:",e)}};return(l,a)=>(r(),y(U,null,[a[3]||(a[3]=T("h1",null,"Relatórios",-1)),T("div",null,[v(h,{modelValue:n(s),"onUpdate:modelValue":a[0]||(a[0]=e=>F(s)?s.value=e:null),items:n(E),class:"mb-5","item-title":"label","item-value":"value",label:"Selecione o relatório",required:"","onUpdate:search":x},null,8,["modelValue","items"])]),n(s)?(r(),y("div",j,[v(H,null,{default:p(()=>[(r(!0),y(U,null,P(n(u),(e,t)=>(r(),i(Q,{key:t},{default:p(()=>[v(I,{cols:"4"},{default:p(()=>[e.tipo!=="DATE"&&e.tipo!=="TABLE"?(r(),i(k,{key:0,modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,label:e.label,required:e.obrigatorio},null,8,["modelValue","onUpdate:modelValue","label","required"])):m("",!0),e.tipo==="INTEGER"?(r(),i(k,{key:1,modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,label:e.label,type:"number",outlined:""},null,8,["modelValue","onUpdate:modelValue","label"])):m("",!0),e.tipo==="DATE"?(r(),i(k,{key:2,label:e.label,modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,type:"date"},null,8,["label","modelValue","onUpdate:modelValue"])):m("",!0),e.tipo==="TABLE"?(r(),i(h,{key:3,modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,items:e.items,"item-title":"label","item-value":"value",label:e.label,required:e.obrigatorio},null,8,["modelValue","onUpdate:modelValue","items","label","required"])):m("",!0)]),_:2},1024)]),_:2},1024))),128)),v(O,{color:"green",class:"mt-4",onClick:a[1]||(a[1]=e=>L(n(s)))},{default:p(()=>a[2]||(a[2]=[S("Enviar")])),_:1})]),_:1})])):m("",!0)],64))}};export{se as default};
