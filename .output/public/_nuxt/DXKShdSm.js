import{_ as re}from"./DhA_4Z1_.js";import{c as ge,r as ye,u as be}from"./9zYDfl2M.js";import{g as Oe,L as Z,M as ee,u as te,r as l,m as z,n as ne,D as se,o as A,x as Q,w as a,b as e,v as t,V as X,E as J,d as F,z as ae,H as Me,a as g,c as U,y as he,O as De,P as Re,F as Ce,Q as we,t as ie}from"./CCwrrObB.js";import{u as k}from"./TzbnKEwJ.js";import{V as D}from"./CcImuV_V.js";import{V as R}from"./DUxIWLFV.js";import{V as ue}from"./C3lioV8F.js";import{V as de}from"./Cz-IoiyO.js";import{_ as je}from"./50qE5zNG.js";import{_ as Ie,a as Be,b as Ne,T as Ue,W as Fe,D as Ve,c as Le,e as We,f as Ge,d as Je}from"./BwjTSw5M.js";import{_ as Ke,r as ze}from"./DIOgHMEu.js";import{_ as fe}from"./_7cAlNxJ.js";import{_ as ce}from"./BVz1G1IN.js";import{_ as Ye}from"./HO8mdHXo.js";import{_ as ke,a as xe}from"./DJvq3mCv.js";import{V as $e}from"./GrEE2ArJ.js";import{_ as He}from"./UH-QQNY4.js";import{V as Qe}from"./B5y_z2gg.js";import{f as Xe}from"./B0IxRygJ.js";const jt={__name:"Dados",props:{ato_token:{type:String,required:!0},ato_tipo_id:{type:Number}},emits:["saved"],async setup(L,{emit:b}){let y,_;const v=L;Oe(()=>v.ato_tipo_id,s=>{C.value={id:s}});const P=b,h=Z(),$=ee(),I=ae(),{$toast:N}=te(),W=`${I.public.managemant}/listarSituacoes`,E=`${I.public.managemant}/createAtos`;`${I.public.managemant}`;const w=l(z("user-data").value.cartorio_token),x=l(z("user-service").value.id).value||l(z("user-service").value).value,B=l([]),C=l(v.ato_tipo_id?{id:v.ato_tipo_id}:null),f=ne({dt_abertura:null,status:"EM EDIÇÃO",mne:null}),q={status:{required:ge.withMessage("O campo é obrigatorio",ye)}},V=be(q,f);async function S(){if(await V.value.$validate()){const{data:s,error:o,status:d}=await k(E,{method:"POST",body:{ato_tipo_id:C.value.id,cartorio_id:z("user-data").value.cartorio_id,ordemserv_id:x,status:f.status,dt_abertura:f.dt_abertura,mne:f.mne,user_id:z("user-data").value.usuario_id,user_alteracao_id:z("user-data").value.usuario_id}},"$9ZmTYsLk0K");d.value==="success"&&(N.success("Ato registrado com sucesso!"),P("saved",{id:s.value.id,token:s.value.token}))}else N.error("Preencha os campos obrigatorios.")}const{data:T}=([y,_]=se(()=>k(W,{method:"POST",body:{cartorio_token:w.value}},"$hyq5YcBEjF")),y=await y,_(),y);B.value=T.value;const i=()=>{const s=$.query.origem||"criar",o=$.query.id;switch(s){case"atualizar":case"vizualizar":h.push(`/os/atualizar/${o}`);break;case"atualizar-lista":case"vizualizar-lista":h.push("/atos/lista");break;default:h.push("/os/criar-registro");break}};return(s,o)=>{const d=re;return A(),Q(de,null,{default:a(()=>[e(D,{class:"mt-5"},{default:a(()=>[e(R,{cols:"3"},{default:a(()=>[e(ue,{label:"Situação",modelValue:t(f).status,"onUpdate:modelValue":o[0]||(o[0]=p=>t(f).status=p),items:t(B),"item-title":"descricao","item-value":"descricao",required:"","error-messages":t(V).status.$errors.map(p=>p.$message),onBlur:t(V).status.$touch,onInput:t(V).status.$touch},null,8,["modelValue","items","error-messages","onBlur","onInput"])]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(R,{cols:"5"},{default:a(()=>[e(X,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:t(f).mne,"onUpdate:modelValue":o[1]||(o[1]=p=>t(f).mne=p)},null,8,["modelValue"])]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(R,{cols:"2"},{default:a(()=>[e(X,{modelValue:t(f).dt_abertura,"onUpdate:modelValue":o[2]||(o[2]=p=>t(f).dt_abertura=p),type:"date",label:"Data Lavratura",disabled:"",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(D,{class:"mb-3"},{default:a(()=>[e(d,{onClick:i},{default:a(()=>[e(J,{size:"large",color:"red"},{default:a(()=>o[3]||(o[3]=[F("Voltar")])),_:1})]),_:1}),e(J,{class:"ml-10",onClick:S,size:"large",color:"green"},{default:a(()=>o[4]||(o[4]=[F("Salvar")])),_:1})]),_:1})]),_:1})}}},Ze=["onClick"],et=["onClick"],tt=["onClick"],at={key:0,style:{width:"30px",height:"30px"},src:ke,alt:"Visualizar",title:"Reativar"},ot={key:1,src:xe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},st=["onClick"],It={__name:"Partes",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},async setup(L){let b,y;const _=L,v=Z(),P=ee(),h=ae(),{$toast:$}=te(),I=`${h.public.managemant}/pesquisarPessoas`,N=`${h.public.managemant}/listarPapeis`,W=`${h.public.managemant}/download`,E=`${h.public.managemant}/createAtosPessoa`,w=`${h.public.managemant}/getAtosPessoaById`,x=`${h.public.managemant}/updateAtosPessoa`,B=l(z("user-data").value.cartorio_token),C=l([]),f=l({}),q=l([]),V=l([]),S=l(!1),T=l(!1),i=l(!1),s=l(!1),o=l(null),d=l(null),p=l(null),n=l(null);l(null);const m=l(null),K=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"400px"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome"},{value:"actions"}],c=ne({papeis:null,nome:null,pessoa:null,documento:null});Me(()=>{var u;return((u=c.pessoa)==null?void 0:u.link_ficha)||!1});const{data:Y}=([b,y]=se(()=>k(N,{method:"POST",body:{tipo_ato_token:_.ato_token}},"$fFKndZhA4W")),b=await b,y(),b);V.value=Y.value;async function G(){try{const{data:u,error:r}=await k(I,{method:"POST",body:{cartorio_token:B.value,documento:c.documento,nome:c.nome}},"$o3ZL1rvYrY");u.value.length>0?(C.value=u.value,c.pessoa=C.value[0]):C.value=[]}catch(u){console.error("Erro na requisição",u)}}const j=()=>{T.value=!0},oe=u=>{q.value=q.value.map(r=>r.id===p.value?{...r,papel:{...r.papel,descricao:u}}:r)},H=u=>{const r=q.value.find(O=>O.pessoa.id===n.value);r.representante.nome=u},le=async()=>{const u={pessoa:c.pessoa,papel:V.value.find(O=>O.id===c.papeis),representante:{nome:null}},r=await k(`${w}/${_.ato_id}`,{method:"GET"},"$kXSxUa4grs");for(const O of r.data.value)if(O.pessoa_id===c.pessoa.id&&O.ato_id===_.ato_id&&O.tipo_parte_id===c.papeis){$.error("Pessoa Já Registrada Com Esse Papel!");return}try{const{data:O,error:me,status:_e}=await k(E,{method:"POST",body:{ato_id:Number(_.ato_id),pessoa_id:c.pessoa.id,tipo_parte_id:c.papeis,user_id:Number(z("user-data").value.usuario_id)}},"$So3qnQu7ek");_e.value==="success"?(u.id=O.value.id,$.success("Pessoa Registrada com Sucesso!"),q.value.push(u)):$.error(me.value.message)}catch{$.error("Erro no servidor. Tente novamente.")}},pe=async u=>{i.value=!0;const{data:r}=await k(W,{method:"POST",body:{bucket:z("user-data").value.cartorio_token,path:u.pessoa.link_ficha}},"$Q3kbIwtd9t");m.value=r.value,f.value=u.pessoa},Pe=u=>{const r=q.value.filter(O=>O.pessoa.id!==u.pessoa.id).map(O=>({id:O.pessoa.id,nome:O.pessoa.nome}));p.value=u.id,o.value=r,S.value=!0,d.value=u.pessoa.nome,n.value=u.pessoa.id},Ee=u=>{p.value=u.id,s.value=!0,d.value=u.pessoa.nome};async function Ae(u){u.excluido=!u.excluido;try{await k(`${x}/${p.value}`,{method:"PUT",body:JSON.stringify({excluido:u.excluido})},"$9xStKwGd7o")}catch(r){console.error("Erro ao excluir pessoa:",r)}}const Se=()=>{const u=P.query.origem||"criar",r=P.query.id;switch(u){case"atualizar":case"vizualizar":v.push(`/os/atualizar/${r}`);break;case"atualizar-lista":case"vizualizar-lista":v.push("/atos/lista");break;default:v.push("/os/criar-registro");break}};return(u,r)=>{const O=je,me=Be,_e=Ne,qe=Ke,Te=re;return A(),Q(de,null,{default:a(()=>[e(D,{class:"mt-5"},{default:a(()=>[e(R,{cols:"3"},{default:a(()=>[e(X,{label:"Documento",modelValue:t(c).documento,"onUpdate:modelValue":r[0]||(r[0]=M=>t(c).documento=M)},null,8,["modelValue"])]),_:1}),e(R,{cols:"4"},{default:a(()=>[e(X,{label:"Pessoa",modelValue:t(c).nome,"onUpdate:modelValue":r[1]||(r[1]=M=>t(c).nome=M)},null,8,["modelValue"])]),_:1}),g("div",null,[g("img",{class:"mt-3",src:fe,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:G})]),g("div",null,[g("img",{class:"mt-3 ml-2",src:ce,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:j})])]),_:1}),e(D,null,{default:a(()=>[e(R,{cols:"4"},{default:a(()=>[e(ue,{label:"Selecione a Pessoa",modelValue:t(c).pessoa,"onUpdate:modelValue":r[2]||(r[2]=M=>t(c).pessoa=M),items:t(C),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),e(R,{cols:"3"},{default:a(()=>[e(ue,{label:"Papel",modelValue:t(c).papeis,"onUpdate:modelValue":r[3]||(r[3]=M=>t(c).papeis=M),items:t(V),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),g("div",null,[g("img",{class:"mt-3",src:ce,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:le})])]),_:1}),e(D,null,{default:a(()=>[e(R,null,{default:a(()=>[e($e,{style:{height:"465px"},headers:K,items:t(q)},{"item.actions":a(({item:M})=>[e(D,null,{default:a(()=>[g("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ve=>pe(M),title:"Visualizar Ficha"},r[8]||(r[8]=[g("img",{style:{width:"30px",height:"30px"},src:fe,alt:"Visualizar"},null,-1)]),8,Ze),g("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ve=>Ee(M),class:"mr-2",title:"Alterar Papel"},r[9]||(r[9]=[g("img",{style:{width:"30px",height:"30px"},src:Ye,alt:"Visualizar"},null,-1)]),8,et),g("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ve=>Ae(M),title:"Deletar Pessoa"},[M.excluido?(A(),U("img",at)):(A(),U("img",ot))],8,tt),g("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ve=>Pe(M),title:"Selecionar Representante"},r[10]||(r[10]=[g("img",{style:{width:"30px",height:"30px"},src:Ie,alt:"Visualizar"},null,-1)]),8,st)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),e(O,{show:t(T),onClose:r[4]||(r[4]=M=>T.value=!1)},null,8,["show"]),e(me,{representante_nome:t(d),representantes:t(o),ato_id:t(p),show:t(S),onClose:r[5]||(r[5]=M=>S.value=!1),onUpdateRepresentante:H},null,8,["representante_nome","representantes","ato_id","show"]),e(_e,{representante_nome:t(d),ato_token:_.ato_token,ato_id:t(p),show:t(s),onClose:r[6]||(r[6]=M=>s.value=!1),onUpdatePapel:oe},null,8,["representante_nome","ato_token","ato_id","show"]),t(i)?(A(),Q(qe,{key:0,show:t(i),"link-view":t(m),"pessoa-obj":t(f),"is-view":!0,onClose:r[7]||(r[7]=M=>i.value=!1)},null,8,["show","link-view","pessoa-obj"])):he("",!0),e(D,null,{default:a(()=>[e(Te,{onClick:Se},{default:a(()=>[e(J,{size:"large",color:"red"},{default:a(()=>r[11]||(r[11]=[F("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},rt={key:0,class:"loading-overlay"},nt="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",Bt={__name:"Minuta",props:{ato_token:{type:String,required:!0}},emits:["page","doc"],setup(L,{emit:b}){const y=L;De("DocumentEditorContainer",[Ue,Fe]);const _=ae(),{$toast:v}=te(),P=Z(),h=ee(),$=b;ze(`${_.public.docEditor}`);const I=`${_.public.managemant}/upload`,N=`${_.public.managemant}/subitituirModelo`,W=`${_.public.managemant}/download`,E=l(null),w=l(!1),x=async i=>{try{const s=await fetch(i);if(!s.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await s.blob()}catch(s){return console.error(s),null}},B=async()=>{const s=await E.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),o=new FileReader;o.onload=()=>{const d=o.result;$("doc",d)},o.readAsText(s)},C=async()=>{w.value=!0;try{const s=await E.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),o=new FormData;o.append("file",s,"anexo.docx"),o.append("cartorio_token",z("user-data").value.cartorio_token),o.append("token",y.ato_token),o.append("tipo","ato_minuta");const{data:d,status:p}=await k(I,{method:"POST",body:o},"$071xxdqs20");if(p.value==="success"){v.success("Documento enviado!");const m=E.value.ej2Instances.documentEditor.pageCount;B(),$("page",m)}else v.error("Erro ao enviar documento para o sistema.")}catch(i){v.error("Erro ao salvar documento."),console.error(i)}finally{w.value=!1}},f=async()=>{S(!0);try{await q(),S(!0);const{data:i,status:s}=await k(N,{method:"POST",body:{ato_token:y.ato_token}},"$0ktpWliD4l");i.value&&V(i.value)}catch(i){console.error("Erro ao gerar a minuta:",i),v.error("Ocorreu um erro ao gerar a minuta.")}finally{S(!1)}},q=async()=>{try{const{data:i}=await k(W,{method:"POST",body:{bucket:z("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$jXVvQjEE6u"),s=await x(i.value);if(s){const o=new FileReader;o.onload=()=>{const d=o.result;E.value.ej2Instances.documentEditor.open(d),$("doc",d)},o.readAsText(s)}}catch(i){console.error("Erro ao carregar o modelo de minuta:",i),v.error("Falha ao carregar o modelo de minuta.")}},V=i=>{const s=E.value.ej2Instances.documentEditor,o=d=>{for(const[p,n]of Object.entries(d))if(/^<<.+>>$/.test(p))try{s.search.findAll(p),s.search.searchResults.length>0&&s.search.searchResults.replaceAll(n)}catch(m){console.error(`Erro ao substituir o marcador ${p}:`,m)}else if(p==="partes"&&Array.isArray(n)&&n.length>0)for(const m of n)typeof m=="object"&&o(m)};o(i)},S=i=>{w.value=i},T=()=>{const i=h.query.origem||"criar",s=h.query.id;switch(i){case"atualizar":case"vizualizar":P.push(`/os/atualizar/${s}`);break;case"atualizar-lista":case"vizualizar-lista":P.push("/atos/lista");break;default:P.push("/os/criar-registro");break}};return(i,s)=>{const o=re;return A(),U(Ce,null,[e(t(Ve),{height:"900px",ref_key:"documentEditorContainer",ref:E,serviceUrl:nt,enableToolbar:!0,enableWordExport:!0},null,512),t(w)?(A(),U("div",rt,[e(Re,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):he("",!0),e(D,{class:"ml-4 mt-4 mb-4"},{default:a(()=>[e(o,{class:"mr-4"},{default:a(()=>[e(J,{size:"large",onClick:T,color:"red"},{default:a(()=>s[0]||(s[0]=[F("Voltar")])),_:1})]),_:1}),e(J,{size:"large",color:"green",onClick:C,disabled:t(w)},{default:a(()=>s[1]||(s[1]=[F("Salvar")])),_:1},8,["disabled"]),e(J,{class:"ml-4",size:"large",color:"blue",onClick:f},{default:a(()=>s[2]||(s[2]=[F("Gerar Minuta")])),_:1})]),_:1})],64)}}},lt=["innerHTML"],Nt={__name:"Livro",props:{ato_token:{type:String,required:!0},pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(L){let b,y;const _=L,v=ae();ze(`${v.public.docEditor}`);const{$toast:P}=te(),h=Z(),$=ee(),I=`${v.public.managemant}/listarEscrevente`,N=`${v.public.managemant}/lavrarAto`,W=`${v.public.managemant}/valida_lavratura`,E=l("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),w=l(!1),x=l(null),B=l(null),C=l(null),f=l(z("user-data").value.cartorio_token),q=z("auth_token").value,V=l([]),S=l({}),T=l(null),i=l(""),s=ne({escrevente:null}),o=async(G=!1)=>{if(!G){const{data:H}=await k(W,{method:"POST",body:{ato_token:_.ato_token}},"$ZKnVBNYxp9"),le=H.value[0].status,pe=H.value[0].status_mensagem;if(le!=="OK"){T.value=le,i.value=pe,S.value=null,w.value=!0,E.value="O ato apresenta inconsistências, deseja prosseguir?";return}}const{data:j,status:oe}=await k(N,{method:"POST",body:{ato_token:_.ato_token,qtd_paginas:_.pages,escrevente_token:s.escrevente,usuario_token:q,cartorio_token:f}},"$XouuxOFIWh");oe.value==="success"?(x.value=j.value,B.value=j.value[0].selo,P.success("Ato lavrado com sucesso!")):P.error("Falha ao lavrar o ato.")},d=()=>{w.value=!1,T.value=null,i.value="",S.value={}},p=async()=>{const{data:G,status:j}=await k(calculaAto,{method:"POST",body:{ato_token:$.query.ato_token_edit,cartorio_token:f,quantidade:1,usuario_token:q,escrevente_token:s.escrevente,qtd_paginas:_.pages}},"$R51FaaSzOI");j.value==="success"?S.value=G.value[0]:P.error("Falha ao calcular o ato.")},n=async()=>{w.value=!1,T.value&&T.value!=="OK"?(await o(!0),T.value=null,i.value=""):await o()},m=async()=>{w.value=!0,await p()},{data:K}=([b,y]=se(()=>k(I,{method:"POST",body:{cartorio_token:f}},"$JCPnpnnRzP")),b=await b,y(),b);V.value=K.value[0].func_json_escreventes;const c=function(){C.value.ej2Instances.documentEditor.open(_.document)},Y=()=>{const G=$.query.origem||"criar",j=$.query.id;switch(G){case"atualizar":case"vizualizar":h.push(`/os/atualizar/${j}`);break;case"atualizar-lista":case"vizualizar-lista":h.push("/atos/lista");break;default:h.push("/os/criar-registro");break}};return(G,j)=>{const oe=He;return A(),U(Ce,null,[e(D,null,{default:a(()=>[e(R,null,{default:a(()=>[(A(),Q(t(Ve),{restrictEditing:!0,enableToolbar:!1,created:_.document?c:null,ref_key:"documentEditorContainer",ref:C,height:"850px",width:"850px",key:_.document},null,8,["created"]))]),_:1}),e(R,null,{default:a(()=>[e(ue,{class:"mt-15",label:"Tabelião/escrevente",modelValue:t(s).escrevente,"onUpdate:modelValue":j[0]||(j[0]=H=>t(s).escrevente=H),items:t(V),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),g("div",null,[g("div",null,[g("img",{onClick:j[1]||(j[1]=H=>m()),class:"ml-2",style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:Le}),t(x)?(A(),Q(Qe,{key:0,class:"mr-16"},{default:a(()=>[e(D,{"no-gutters":""},{default:a(()=>[e(R,null,{default:a(()=>[e(we,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:a(()=>[e(R,null,{default:a(()=>[F(" Livro: "+ie(t(x)[0].livro_numero),1)]),_:1}),e(R,null,{default:a(()=>[F(" Protocolo: "+ie(t(x)[0].protocolo?t(x)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),e(R,null,{default:a(()=>[e(we,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:a(()=>[F(" Folhas : "+ie(t(x)[0].pagina_inicial)+" A "+ie(t(x)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),g("div",{innerHTML:t(B)},null,8,lt)]),_:1})):he("",!0)])])]),_:1})]),_:1}),e(J,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:Y},{default:a(()=>j[2]||(j[2]=[F("Voltar")])),_:1}),e(oe,{show:t(w),condMessage:t(E),valor:t(S),description:t(i),onClose:d,onConfirm:n},null,8,["show","condMessage","valor","description"])],64)}}},it=["onClick"],ut={key:0,style:{width:"30px",height:"30px"},src:ke,alt:"Visualizar",title:"Reativar"},ct={key:1,src:xe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Ut={__name:"Observacao",props:{ato_id:{type:Number,required:!0}},async setup(L){let b,y;const _=L,v=Z(),P=ee(),h=ae(),{$toast:$}=te(),I=`${h.public.managemant}/listarEscrevente`,N=`${h.public.managemant}/getAtosTiposByToken`,W=`${h.public.managemant}/atos_observacao`,E=`${h.public.managemant}/atos_observacao`,w=l(z("user-data").value.cartorio_token),x=l([]),B=l([]),C=[{title:"Data",align:"start",key:"data"},{title:"Escrevente",align:"start",key:"escrevente"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}],f=ne({observacao:null}),q={observacao:{required:ge.withMessage("O campo é obrigatorio",ye)}},V=be(q,f);[b,y]=se(()=>k(`${N}/${_.ato_token}`,{method:"GET"},"$aJM1TL1buW")),b=await b,y();async function S(){if(await V.value.$validate()){const{data:o,error:d,status:p}=await k(W,{method:"POST",body:{ato_id:_.ato_id,observacao:f.observacao,user_id:z("user-data").value.usuario_id}},"$dMg99jeUNP");p.value==="success"&&(x.value.push({data:Xe(o.value.created,"dd/mm/yyyy hh:mm"),observacao:o.value.observacao,id:o.value.id,escrevente:z("user-data").value.nome}),$.success("Observação registrada com sucesso"))}else $.error("Preencha os campos obrigatorios.")}async function T(o){o.excluido=!o.excluido;try{await k(`${E}/${o.id}`,{method:"PUT",body:JSON.stringify({excluido:o.excluido})},"$B6PdRx8Gp4")}catch(d){console.error("Erro ao excluir observacao:",d)}}const{data:i}=([b,y]=se(()=>k(I,{method:"POST",body:{cartorio_token:w}},"$xFHPGua26S")),b=await b,y(),b);B.value=i.value[0].func_json_escreventes;const s=()=>{const o=P.query.origem||"criar",d=P.query.id;switch(o){case"atualizar":case"vizualizar":v.push(`/os/atualizar/${d}`);break;case"atualizar-lista":case"vizualizar-lista":v.push("/atos/lista");break;default:v.push("/os/criar-registro");break}};return(o,d)=>{const p=re;return A(),Q(de,null,{default:a(()=>[e(D,{class:"mt-5"},{default:a(()=>[e(X,{label:"Observação",modelValue:t(f).observacao,"onUpdate:modelValue":d[0]||(d[0]=n=>t(f).observacao=n),required:"","error-messages":t(V).observacao.$errors.map(n=>n.$message),onBlur:t(V).observacao.$touch,onInput:t(V).observacao.$touch},null,8,["modelValue","error-messages","onBlur","onInput"]),g("div",null,[g("img",{class:"btn-pointer ml-2",src:ce,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:S})])]),_:1}),e(D,null,{default:a(()=>[e(R,null,{default:a(()=>[e($e,{style:{height:"465px"},headers:C,items:t(x)},{"item.actions":a(({item:n})=>[g("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:m=>T(n),title:"Deletar Observação"},[n.excluido?(A(),U("img",ut)):(A(),U("img",ct))],8,it)]),_:1},8,["items"])]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(p,{onClick:s},{default:a(()=>[e(J,{size:"large",color:"red"},{default:a(()=>d[1]||(d[1]=[F("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},dt={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:We,alt:"Criar"},pt={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ge,alt:"Criar"},mt={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Je,alt:"Criar"},_t=["onClick"],vt=["onClick"],ft=["onClick"],gt={key:0,style:{width:"30px",height:"30px"},src:ke,alt:"Visualizar",title:"Reativar"},yt={key:1,src:xe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Ft={__name:"Anexos",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},setup(L){const b=L,y=ae(),{$toast:_}=te(),v=Z(),P=ee(),h=`${y.public.biometria}/run-scanner`,$=`${y.public.managemant}/atos_anexos`,I=`${y.public.managemant}/atos_anexos`,N=`${y.public.managemant}/download`;`${y.public.managemant}`,`${y.public.managemant}`;const W=l(!1),E=l(null),w=l([]);z("pessoa_token");const x=ne({descricao:"",fileEvent:null}),B={descricao:{required:ge.withMessage("O campo é obrigatório",ye)}},C=be(B,x,{$autoDirty:!0}),f=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}];async function q(){try{await V(),await S()}catch(n){console.error("Erro ao executar scanner ou listar arquivos:",n)}}async function V(){try{const{data:n}=await k(h,{method:"GET"},"$WazoKp68Tw")}catch(n){_.error("Erro ao acionar o scanner:",n)}}async function S(){try{const{data:n,status:m}=await k("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:P.query.ato_token_edit,cartorio_token:z("user-data").value.cartorio_token}},"$03Wxiia3aI")}catch(n){console.error("Erro ao enviar o arquivo:",n)}}const T=async()=>{W.value=!0};function i(n){return n?!0:(console.error("Erro: Nenhum arquivo foi selecionado!"),E.value=!1,!1)}const s=async()=>{if(C.value.$touch(),!C.value.$invalid&&i(x.fileEvent)){const{data:n,error:m,status:K}=await k($,{method:"POST",body:{ato_id:b.ato_id,descricao:x.descricao,user_id:z("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$WyW0hasRPI");K.value==="success"&&(_.success("Anexo registrado com sucesso!"),w.value.push(n.value))}};async function o(n){n.excluido=!n.excluido;try{await k(`${I}/${n.id}`,{method:"PUT",body:JSON.stringify({excluido:n.excluido})},"$Y3y6TjqbSV")}catch(m){console.error("Erro ao excluir pessoa:",m)}}async function d(n){try{const m=await k(`${N}`,{method:"POST",body:{bucket:z("user-data").value.cartorio_token,path:n.link}},"$bkXJSi7s76"),c=await(await fetch(m.data.value)).blob(),Y=URL.createObjectURL(c);window.open(Y,"_blank")}catch(m){console.error("Erro ao excluir pessoa:",m)}}const p=()=>{const n=P.query.origem||"criar",m=P.query.id;switch(n){case"atualizar":case"vizualizar":v.push(`/os/atualizar/${m}`);break;case"atualizar-lista":case"vizualizar-lista":v.push("/atos/lista");break;default:v.push("/os/criar-registro");break}};return(n,m)=>{const K=re;return A(),Q(de,null,{default:a(()=>[e(D,null,{default:a(()=>[e(R,{cols:"5",class:"mt-2"},{default:a(()=>[e(X,{modelValue:t(x).descricao,"onUpdate:modelValue":[m[0]||(m[0]=c=>t(x).descricao=c),t(C).descricao.$touch],"error-messages":t(C).descricao.$errors.map(c=>c.$message),onBlur:t(C).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"])]),_:1}),g("div",{onClick:q,title:"Criar",style:{"padding-right":"10px"}},[t(E)===!1?(A(),U("img",dt)):t(E)===!0?(A(),U("img",pt)):(A(),U("img",mt))]),g("div",{onClick:s,title:"Criar"},m[1]||(m[1]=[g("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:ce,alt:"Escanear"},null,-1)]))]),_:1}),e($e,{headers:f,items:t(w),style:{height:"465px","max-width":"600px"}},{"item.actions":a(({item:c})=>[e(D,null,{default:a(()=>[g("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:Y=>T(c),title:"Visualizar Anexo"},[g("img",{style:{width:"30px",height:"30px"},onClick:Y=>d(c),src:fe,alt:"Visualizar"},null,8,vt)],8,_t),g("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:Y=>o(c),title:"Deletar Pessoa"},[c.excluido?(A(),U("img",gt)):(A(),U("img",yt))],8,ft)]),_:2},1024)]),_:1},8,["items"]),e(K,{onClick:p},{default:a(()=>[e(J,{size:"large",color:"red"},{default:a(()=>m[2]||(m[2]=[F("Voltar")])),_:1})]),_:1})]),_:1})}}};export{jt as _,It as a,Bt as b,Nt as c,Ut as d,Ft as e};
