import{_ as ye}from"./Cuj_sjs5.js";import{_ as ge}from"./B2aMyqzO.js";import{_ as he}from"./CCrLuRUK.js";import{_ as Ve,r as l,g as we,o as w,h as oe,w as s,b as o,a as d,t as G,i as t,s as N,j as X,H as be,c as O,p as te,V as z,d as D,D as xe,J as Ce,u as $e,e as q,f as qe,y as Pe,F as Ae,k as Me}from"./CGqu_hMC.js";import{V as Te,a as Ee,c as Fe}from"./B1Di-POT.js";import{V as Re}from"./I6mIB4Fr.js";import{_ as Se}from"./DkICq3Cz.js";import{_ as ae}from"./CaPajMv5.js";import{_ as Ne}from"./BVz1G1IN.js";import{_ as Oe}from"./Doi5GY13.js";import{a as ze}from"./DJvq3mCv.js";import{u as h}from"./BvWZRHvX.js";import{V as S}from"./B-nbm78G.js";import{V}from"./C8q0BiU6.js";import{V as De}from"./BGw49XQ0.js";import{V as ee}from"./CnIhYSJD.js";import"./Bozdmm9g.js";import"./NsCSSfai.js";import"./p7x4koOx.js";import"./qkMiWZOr.js";import"./B0IxRygJ.js";import"./CQ2DV9sM.js";import"./9XLQsDMa.js";import"./DgeZ5T2_.js";import"./C0duY7jA.js";import"./BzEDWrND.js";import"./BRzMkp1r.js";import"./w7mxzwGk.js";import"./BhxTBAGC.js";import"./DQxeJVxw.js";const je={class:"random-numbers"},Be={key:0,class:"error-message"},Ue={__name:"ValidadorAutencidade",props:{show:Boolean},emits:["close","confirm"],setup(j,{emit:B}){const y=j,b=B,m=l(y.show),g=l([]),p=l(""),v=l("");function f(){g.value=[];for(let _=0;_<4;_++)g.value.push(Math.floor(Math.random()*10))}we(()=>y.show,_=>{m.value=_,_&&(f(),p.value="",v.value="")});const P=()=>{m.value=!1,b("close")},A=()=>{p.value===g.value.join("")?(v.value="",m.value=!1,b("confirm")):v.value="Números digitados incorretos. Tente novamente."};return(_,u)=>(w(),oe(Re,{persistent:"",modelValue:t(m),"onUpdate:modelValue":u[1]||(u[1]=x=>X(m)?m.value=x:null),"max-width":"500"},{default:s(()=>[o(Te,null,{default:s(()=>[o(Ee,null,{default:s(()=>[d("div",null,[u[2]||(u[2]=d("p",null," Digite o código de validação para confirmar o ato de reconhecimento por autenticidade: ",-1)),d("div",je,[d("span",null,G(t(g).join(" ")),1)]),o(N,{modelValue:t(p),"onUpdate:modelValue":u[0]||(u[0]=x=>X(p)?p.value=x:null),label:"Digite os números",maxlength:"4",outlined:"",dense:"",onKeyup:be(A,["enter"])},null,8,["modelValue"]),t(v)?(w(),O("div",Be,G(t(v)),1)):te("",!0)])]),_:1}),o(Fe,null,{default:s(()=>[o(z,{style:{"background-color":"red",color:"white"},onClick:P},{default:s(()=>u[3]||(u[3]=[D("Cancelar")])),_:1}),o(z,{style:{"background-color":"green",color:"white"},onClick:A},{default:s(()=>u[4]||(u[4]=[D("Validar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ie=Ve(Ue,[["__scopeId","data-v-c978e7cc"]]),Ke=["onClick"],He={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:ae,alt:"Possui Ficha",title:"Possui Ficha"},Le={key:1,style:{width:"30px",height:"30px",cursor:"pointer"},src:Oe,alt:"Visualizar",title:"Não Possui Ficha"},Ze=["onClick"],Co={__name:"autencidade",props:{ato_token:{type:String,required:!0}},emits:["ato-created"],async setup(j,{emit:B}){var Y;let y,b;const m=j,g=B,p=xe(),v=Ce(),f=Me(),{$toast:P}=$e(),A=`${f.public.managemant}/listarEscrevente`,_=`${f.public.managemant}/pesquisarPessoas`,u=`${f.public.managemant}/atoReconhecimento`,x=`${f.public.managemant}/etiquetaAutenticidade`,se=`${f.public.managemant}/download`,ne=`${f.public.envioDoc}/print`,M=l(q("user-data").value.cartorio_token),le=l(q("user-service").value.token).value||l(q("user-service").value).value,re=q("auth_token").value,U=l([]),L=l([]),C=l([]),T=l(!1),I=l(!1),E=l(!1),F=l(null),Z=l(null),K=l(""),R=l(!1),W=[{title:"Documento",align:"start",key:"documento"},{title:"Pessoa",align:"start",key:"nome"},{value:"actions"}],i=qe({quantidade:1,escrevente:null,nome:null,documento:null}),{data:Q}=([y,b]=Pe(()=>h(A,{method:"POST",body:{cartorio_token:M}},"$qpB20nOlUE")),y=await y,b(),y);L.value=Array.isArray(Q.value)&&((Y=Q.value[0])==null?void 0:Y.func_json_escreventes)||[];async function ie(){try{const{data:n,error:e}=await h(_,{method:"POST",body:{cartorio_token:M.value,documento:i.documento,nome:i.nome}},"$CfpM9wZnUE");n.value.length>0?(g("ato-created"),U.value=n.value):U.value=[]}catch(n){console.error("Erro na requisição",n)}}const ue=()=>{I.value=!0};function ce(n){C.value.push(n)}const de=async n=>{F.value=n,E.value=!0;const{data:e}=await h(se,{method:"POST",body:{bucket:q("user-data").value.cartorio_token,path:n.link_ficha}},"$LrKAtpxZwH");Z.value=e.value};function me(n){C.value=C.value.filter(e=>e.token!==n.token)}function pe(){R.value=!0}function ve(){R.value=!1,fe()}async function fe(){var n,e,$;if(!i.escrevente){P.error("Por favor selecione um Escrevente");return}try{const k=C.value.map(a=>({pessoa_token:a.token})),{data:r,error:c,status:H}=await h(u,{method:"POST",body:{pessoas:k,cartorio_token:M.value,ordemserv_token:le,quantidade:i.quantidade,usuario_token:re,ato_tipo_token:m.ato_token}},"$EE94jKo1pQ");if(H.value==="success"&&r.value[0].status==="OK"){if(r.value[0].livro&&r.value[0].livro!==null){const a=window.open("","_blank");a.document.open(),a.document.write(r.value[0].livro),a.document.close()}console.log("Mostrando Livro"),_e(r.value[0].token),J()}else T.value=!0,K.value=Array.isArray(r.value)&&((n=r.value[0])==null?void 0:n.status_mensagem)||(($=(e=c==null?void 0:c.value)==null?void 0:e.data)==null?void 0:$.details)||"Não foi possível concluir o reconhecimento"}catch(k){T.value=!0,K.value=k,console.error("Erro na requisição",k)}}async function _e(n){try{console.log("Reconhecimento de Etiqueta");const{data:e,error:$,status:k}=await h(x,{method:"POST",body:{ato_token:n,cartorio_token:M.value,escrevente_token:i.escrevente}},"$KyoIzBxZyr");if(k.value==="success"){const r=Array.isArray(e.value)?e.value[0]:null;if(!r)return;if(r.tipo_etiqueta==="html"){console.log("Abrindo Etiqueta HTML");const c=window.open("","_blank");c.document.open(),c.document.write(r.etiqueta),c.document.close()}else if(r.tipo_etiqueta==="zpl"){const{status:c}=await h(`${ne}`,{method:"POST",body:{zpl:atob(r.etiqueta)}},"$Vem9mHWYqw");if(c.value!=="success"){P.error("Não foi possivel fazer a impressao da etiqueta");return}}}}catch(e){console.error("Erro na requisição",e)}}const J=()=>{const n=v.query.origem||"criar",e=v.query.id;n==="atualizar"?p.push(`/os/atualizar/${e}`):p.push("/os/criar-registro")};return(n,e)=>{const $=ye,k=ge,r=he,c=Ie,H=Se;return w(),O(Ae,null,[o(S,{class:"mt-5"},{default:s(()=>[o(V,{cols:"5"},{default:s(()=>[o(De,{label:"Tabelião/escrevente",modelValue:t(i).escrevente,"onUpdate:modelValue":e[0]||(e[0]=a=>t(i).escrevente=a),items:t(L),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"])]),_:1}),o(V,{cols:"2"},{default:s(()=>[o(N,{label:"Quantidade",type:"number",modelValue:t(i).quantidade,"onUpdate:modelValue":e[1]||(e[1]=a=>t(i).quantidade=a)},null,8,["modelValue"])]),_:1})]),_:1}),o(S,null,{default:s(()=>[o(V,{cols:"3"},{default:s(()=>[o(N,{label:"Documento",modelValue:t(i).documento,"onUpdate:modelValue":e[2]||(e[2]=a=>t(i).documento=a)},null,8,["modelValue"])]),_:1}),o(V,{cols:"4"},{default:s(()=>[o(N,{label:"Pessoa",modelValue:t(i).nome,"onUpdate:modelValue":e[3]||(e[3]=a=>t(i).nome=a)},null,8,["modelValue"])]),_:1}),d("div",null,[d("img",{class:"btn-pointer mt-1",src:ae,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:ie})]),d("div",null,[d("img",{class:"btn-pointer mt-1 ml-2",src:Ne,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:ue})])]),_:1}),o(S,null,{default:s(()=>[o(V,{class:"mr-10"},{default:s(()=>[o(ee,{style:{height:"465px"},headers:W,items:t(U)},{"item.actions":s(({item:a})=>[d("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ke=>de(a),title:"Visualizar Ficha"},[a.link_ficha?(w(),O("img",He)):(w(),O("img",Le))],8,Ke)]),_:1},8,["items"])]),_:1}),o(V,null,{default:s(()=>[o(ee,{headers:W,items:t(C),style:{height:"465px"},"item-key":"id"},{"item.actions":s(({item:a})=>[d("div",{style:{display:"flex","justify-content":"flex-end"},onClick:ke=>me(a),title:"Remover"},e[9]||(e[9]=[d("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ze,alt:"Remover"},null,-1)]),8,Ze)]),_:1},8,["items"])]),_:1})]),_:1}),o($,{show:t(I),onClose:e[4]||(e[4]=a=>I.value=!1)},null,8,["show"]),t(E)?(w(),oe(k,{key:0,show:t(E),item:t(F),"pessoa-obj":t(F),"link-view":t(Z),onConfirmar:e[5]||(e[5]=a=>ce(t(F))),onClose:e[6]||(e[6]=a=>E.value=!1)},null,8,["show","item","pessoa-obj","link-view"])):te("",!0),o(r,{show:t(T),errorMessage:t(K),onClose:e[7]||(e[7]=a=>T.value=!1)},null,8,["show","errorMessage"]),o(c,{show:t(R),onClose:e[8]||(e[8]=a=>R.value=!1),onConfirm:ve},null,8,["show"]),o(S,null,{default:s(()=>[o(H,{onClick:J},{default:s(()=>[o(z,{size:"large",color:"red"},{default:s(()=>e[10]||(e[10]=[D("Voltar")])),_:1})]),_:1}),o(z,{class:"ml-5",onClick:pe,size:"large",color:"green"},{default:s(()=>e[11]||(e[11]=[D("Salvar")])),_:1})]),_:1})],64)}}};export{Co as default};
