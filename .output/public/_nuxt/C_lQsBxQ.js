import{r as _,n as me,D as S,F as ee,h as ce,G as oe,H as pe,o as E,A as J,w as l,b as o,d as _e,q as e,P as fe,c as ae,t as ve,C as Y,s as p,I as X,a as c,v as te,x as se,u as Ve,E as ge,O as be,J as Z}from"./C-Rpz3cn.js";import{a as $e,u as F}from"./xiX9sefc.js";import{_ as le}from"./ToPptOUL.js";import{c as D,r as A,u as ne,V as j,_ as re}from"./oA-G_0b7.js";import{c as ke}from"./RRmeW3lL.js";import{a as ye,b as Ce,V as he}from"./BMb1H2hJ.js";import{V as we}from"./DXHryVz-.js";import{V as f}from"./sHuQ2kto.js";import{V as m}from"./B01JkfbD.js";import{_ as Pe}from"./DY3UaihF.js";import{_ as qe}from"./24JIT-6d.js";import{_ as xe}from"./DCsXQasW.js";import{_ as Me,a as Se}from"./CrE-eFFQ.js";const Ie={key:1},Ue={__name:"RegistroPessoas",props:{show:Boolean},emits:["close"],async setup(z,{emit:C}){let k,O;const I=z,g=_(I.show),h=C,{$toast:U}=me(),w=se(),L=`${w.public.managemant}/createPessoa`,K=`${w.public.managemant}/listarEstadoCivil`,P=`${w.public.managemant}/listarCapacidadeCivil`,W=`${w.public.managemant}/listarCidades`,G={nome:"",nome_pai:"",nome_mae:"",profissao:"",local_trabalho:"",data_nascimento:"",doc_identificacao:"",cpf_pai:"",cpf_mae:"",tipo_pessoa:"FISICA",tabvalores_estadocivil_id:"",tabvalores_capacidadecivil_id:"",cidade_natural_id:"",cartorio_id:S("user-data").value.cartorio_id,user_id:S("user-data").value.usuario_id},n=ee({...G});ce(()=>I.show,d=>{g.value=d});const v=()=>{g.value=!1,h("close")};function q(d){if(d)return d.replace(/[.\-]/g,"");d=null}const{data:V,pending:R,status:x,error:B}=([k,O]=oe(async()=>$e("cliente-dados",async()=>{const[d,t,b]=await Promise.all([$fetch(K),$fetch(P),$fetch(W)]);return{estadoCivilItems:d,capacidadeCivilItems:t,cidadeNascimentoItems:b}})),k=await k,O(),k),N={nome:{required:D.withMessage("O campo é obrigatorio",A)},nome_mae:{required:D.withMessage("O campo é obrigatorio",A)},doc_identificacao:{required:D.withMessage("O campo é obrigatorio",A),cpf:ke}},r=ne(N,n);async function Q(){if(await r.value.$validate()){const d={...n};for(const T in d)d[T]===""&&(d[T]=null);const t={...d,doc_identificacao:q(n.doc_identificacao),cpf_pai:q(n.cpf_pai),cpf_mae:q(n.cpf_mae)},{data:b,error:a,status:H}=await F(L,{method:"POST",body:t},"$BiOjXVCR5N");H.value==="error"&&a.value.statusCode===500?U.error("Erro ao cadastrar pessoa,o CPF já está cadastrado."):(U.success("Pessoa cadastrada com sucesso!"),v())}else U.error("Erro ao cadastrar pessoa, preencha os campos obrigatorios.")}return(d,t)=>{const b=pe("mask");return E(),J(he,{persistent:"",modelValue:e(g),"onUpdate:modelValue":t[13]||(t[13]=a=>te(g)?g.value=a:null),"max-width":"1000"},{default:l(()=>[o(ye,null,{default:l(()=>[o(Ce,{class:"text-h5 mt-3"},{default:l(()=>[_e("Criar Pessoa")]),_:1}),e(x)==="pending"?(E(),J(fe,{key:0,class:"loading-spinner",indeterminate:"",size:"64"})):e(B)?(E(),ae("div",Ie,ve(e(B).message),1)):Y("",!0),e(x)==="success"?(E(),J(we,{key:2,class:"mt-5"},{default:l(()=>[o(f,null,{default:l(()=>[o(m,{cols:"12",md:"8"},{default:l(()=>[o(p,{modelValue:e(n).nome,"onUpdate:modelValue":t[0]||(t[0]=a=>e(n).nome=a),"error-messages":e(r).nome.$errors.map(a=>a.$message),label:"Nome",required:"",onBlur:e(r).nome.$touch,onInput:e(r).nome.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1}),o(m,{cols:"12",md:"4"},{default:l(()=>[X(o(p,{modelValue:e(n).doc_identificacao,"onUpdate:modelValue":t[1]||(t[1]=a=>e(n).doc_identificacao=a),"error-messages":e(r).doc_identificacao.$errors.map(a=>a.$message),label:"CPF",required:"",onBlur:e(r).doc_identificacao.$touch,onInput:e(r).doc_identificacao.$touch},null,8,["modelValue","error-messages","onBlur","onInput"]),[[b,"###.###.###-##"]])]),_:1})]),_:1}),o(f,null,{default:l(()=>[o(m,{cols:"12",md:"4"},{default:l(()=>[o(j,{modelValue:e(n).tabvalores_estadocivil_id,"onUpdate:modelValue":t[2]||(t[2]=a=>e(n).tabvalores_estadocivil_id=a),items:e(V).estadoCivilItems,"item-title":"descricao","item-value":"id",label:"Estado Civil"},null,8,["modelValue","items"])]),_:1}),o(m,{cols:"12",md:"4"},{default:l(()=>[o(p,{modelValue:e(n).profissao,"onUpdate:modelValue":t[3]||(t[3]=a=>e(n).profissao=a),label:"Profissão"},null,8,["modelValue"])]),_:1}),o(m,{cols:"12",md:"4"},{default:l(()=>[o(p,{modelValue:e(n).local_trabalho,"onUpdate:modelValue":t[4]||(t[4]=a=>e(n).local_trabalho=a),label:"Local de trabalho"},null,8,["modelValue"])]),_:1})]),_:1}),o(f,null,{default:l(()=>[o(m,{cols:"12",md:"4"},{default:l(()=>[o(p,{modelValue:e(n).data_nascimento,"onUpdate:modelValue":t[5]||(t[5]=a=>e(n).data_nascimento=a),type:"date","prepend-icon":"",label:"Data de nascimento"},null,8,["modelValue"])]),_:1}),o(m,{cols:"12",md:"4"},{default:l(()=>[o(j,{modelValue:e(n).tabvalores_capacidadecivil_id,"onUpdate:modelValue":t[6]||(t[6]=a=>e(n).tabvalores_capacidadecivil_id=a),items:e(V).capacidadeCivilItems,label:"Capacidade Civil","item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1}),o(m,{cols:"12",md:"4"},{default:l(()=>[o(j,{modelValue:e(n).cidade_natural_id,"onUpdate:modelValue":t[7]||(t[7]=a=>e(n).cidade_natural_id=a),items:e(V).cidadeNascimentoItems,label:"Cidade de nascimento","item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1})]),_:1}),o(f,null,{default:l(()=>[o(m,{cols:"12",md:"4"},{default:l(()=>[X(o(p,{modelValue:e(n).cpf_pai,"onUpdate:modelValue":t[8]||(t[8]=a=>e(n).cpf_pai=a),modelModifiers:{date:!0},label:"CPF do Pai"},null,8,["modelValue"]),[[b,"###.###.###-##"]])]),_:1}),o(m,{cols:"12",md:"4"},{default:l(()=>[o(p,{modelValue:e(n).nome_pai,"onUpdate:modelValue":t[9]||(t[9]=a=>e(n).nome_pai=a),modelModifiers:{date:!0},label:"Nome do Pai"},null,8,["modelValue"])]),_:1})]),_:1}),o(f,null,{default:l(()=>[o(m,{cols:"12",md:"4"},{default:l(()=>[X(o(p,{modelValue:e(n).cpf_mae,"onUpdate:modelValue":t[10]||(t[10]=a=>e(n).cpf_mae=a),modelModifiers:{date:!0},label:"CPF da Mãe"},null,8,["modelValue"]),[[b,"###.###.###-##"]])]),_:1}),o(m,{cols:"12",md:"4"},{default:l(()=>[o(p,{modelValue:e(n).nome_mae,"onUpdate:modelValue":t[11]||(t[11]=a=>e(n).nome_mae=a),modelModifiers:{date:!0},"error-messages":e(r).nome_mae.$errors.map(a=>a.$message),label:"Nome da Mãe",required:"",onBlur:e(r).nome_mae.$touch,onInput:e(r).nome_mae.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1})]),_:1}),o(f,null,{default:l(()=>[c("div",null,[c("img",{class:"ml-5",style:{cursor:"pointer"},src:le,alt:"Sair",onClick:v})]),c("div",null,[c("img",{style:{cursor:"pointer"},class:"ml-5",src:re,onClick:t[12]||(t[12]=a=>Q())})])]),_:1})]),_:1})):Y("",!0)]),_:1})]),_:1},8,["modelValue"])}}},Be=c("h1",null,"Reconhecimento por Semelhança",-1),Ee=["onClick"],Fe=c("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:Se,alt:"Remover"},null,-1),Oe=[Fe],Re=c("img",{class:"btn-pointer mt-10 mb-5",src:le,alt:"Sair",style:{cursor:"pointer"}},null,-1),Ye={__name:"semelhanca",props:{ato_token:{type:String,required:!0}},async setup(z){let C,k;const O=z,I=Ve(),g=ge(),h=se(),U=`${h.public.managemant}/listarEscrevente`,w=`${h.public.managemant}/pesquisarPessoas`,L=`${h.public.managemant}/atoReconhecimento`,K=`${h.public.managemant}/etiquetaReconhecimento`,P=_(S("user-data").value.cartorio_token),W=_(S("user-service").value.token).value||_(S("user-service").value).value,G=S("auth_token").value,n=_([]),v=_([]),q=_([]),V=_([]),R=_(!1),x=_(!1),B=_(""),N=[{title:"Documento",align:"start",key:"documento"},{title:"Pessoa",align:"start",key:"nome"},{value:"actions"}],r=ee({quantidade:1,escrevente:null,nome:null,documento:null}),Q={escrevente:{required:D.withMessage("O campo é obrigatorio",A)}},d=ne(Q,r),{data:t}=([C,k]=oe(()=>F(U,{method:"POST",body:{cartorio_token:P}},"$iEFsIjdWdW")),C=await C,k(),C);q.value=t.value[0].func_json_escreventes;async function b(){try{const{data:i,error:s}=await F(w,{method:"POST",body:{cartorio_token:P.value,documento:r.documento,nome:r.nome}},"$uzKb8LPV3v");i.value.length>0?n.value=i.value:n.value=[]}catch(i){console.error("Erro na requisição",i)}}const a=()=>{x.value=!0};function H(i){i.length>0?V.value=i.map(s=>{const[M,$,y]=s.split("-");return{nome:M,documento:$==="null"?null:$,pessoa_token:y}}):console.log("Nenhum item selecionado")}function T(i){V.value=V.value.filter(s=>s.pessoa_token!==i.pessoa_token),v.value=v.value.filter(s=>s!==`${i.nome}-${i.documento}-${i.pessoa_token}`)}async function ie(){if(await d.value.$validate()){const i=V.value.map(s=>({pessoa_token:s.pessoa_token}));try{const{data:s,error:M,status:$}=await F(L,{method:"POST",body:{pessoas:i,cartorio_token:P.value,ordemserv_token:W,quantidade:r.quantidade,usuario_token:G,ato_tipo_token:O.ato_token}},"$MulQmK1LAp");$.value==="success"&&s.value[0].status==="OK"?ue(s.value[0].token):(R.value=!0,B.value=ato_token.value.status_mensagem||M.value.data.details)}catch(s){console.error("Erro na requisição",s)}}}async function ue(i){try{const{data:s,error:M,status:$}=await F(K,{method:"POST",body:{ato_token:i,cartorio_token:P.value,escrevente_token:r.escrevente}},"$fMGlIlw995");if($.value==="success"){const y=window.open("","_blank");y.document.open(),y.document.write(s.value[0].etiqueta),y.document.close()}}catch(s){console.error("Erro na requisição",s)}}const de=()=>{const i=g.query.origem||"criar",s=g.query.id;i==="atualizar"?I.push(`/ordens-servicos/atualizar/${s}`):I.push("/ordens-servicos/criar-registro")};return(i,s)=>{const M=Ue,$=Pe,y=qe;return E(),ae(be,null,[Be,o(f,{class:"mt-5"},{default:l(()=>[o(m,{cols:"5"},{default:l(()=>[o(j,{label:"Tabelião/escrevente",modelValue:e(r).escrevente,"onUpdate:modelValue":s[0]||(s[0]=u=>e(r).escrevente=u),items:e(q),"item-title":"nome","item-value":"token",required:"","error-messages":e(d).escrevente.$errors.map(u=>u.$message),onBlur:e(d).escrevente.$touch,onInput:e(d).escrevente.$touch},null,8,["modelValue","items","error-messages","onBlur","onInput"])]),_:1}),o(m,{cols:"2"},{default:l(()=>[o(p,{label:"Quantidade",type:"number",modelValue:e(r).quantidade,"onUpdate:modelValue":s[1]||(s[1]=u=>e(r).quantidade=u)},null,8,["modelValue"])]),_:1})]),_:1}),o(f,null,{default:l(()=>[o(m,{cols:"3"},{default:l(()=>[o(p,{label:"Documento",modelValue:e(r).documento,"onUpdate:modelValue":s[2]||(s[2]=u=>e(r).documento=u)},null,8,["modelValue"])]),_:1}),o(m,{cols:"4"},{default:l(()=>[o(p,{label:"Pessoa",modelValue:e(r).nome,"onUpdate:modelValue":s[3]||(s[3]=u=>e(r).nome=u)},null,8,["modelValue"])]),_:1}),c("div",null,[c("img",{class:"btn-pointer mt-3",src:xe,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:b})]),c("div",null,[c("img",{class:"btn-pointer mt-3 ml-2",src:Me,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:a})])]),_:1}),o(f,null,{default:l(()=>[o(m,{class:"mr-10"},{default:l(()=>[o(Z,{style:{height:"465px"},headers:N,items:e(n),"show-select":"",modelValue:e(v),"onUpdate:modelValue":s[4]||(s[4]=u=>te(v)?v.value=u:null),"item-value":u=>`${u.nome}-${u.documento}-${u.token}`,onchange:H(e(v))},null,8,["items","modelValue","item-value","onchange"])]),_:1}),o(m,null,{default:l(()=>[o(Z,{headers:N,items:e(V),style:{height:"465px"},"item-key":"id"},{"item.actions":l(({item:u})=>[c("div",{style:{display:"flex","justify-content":"flex-end"},onClick:Ne=>T(u),title:"Remover"},Oe,8,Ee)]),_:1},8,["items"])]),_:1})]),_:1}),o(M,{show:e(x),onClose:s[5]||(s[5]=u=>x.value=!1)},null,8,["show"]),o(f,null,{default:l(()=>[o($,{onClick:de},{default:l(()=>[Re]),_:1}),c("div",null,[c("img",{class:"mt-10 mb-5 ml-10",onClick:ie,style:{cursor:"pointer"},src:re})])]),_:1}),o(y,{show:e(R),errorMessage:e(B),onClose:s[6]||(s[6]=u=>R.value=!1)},null,8,["show","errorMessage"])],64)}}};export{Ye as default};
