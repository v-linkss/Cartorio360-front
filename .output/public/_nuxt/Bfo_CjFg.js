import{_ as we}from"./B5DA7tjD.js";import{_ as Ve}from"./Dp2zM5cU.js";import{_ as be}from"./C7l29wv2.js";import{_ as xe,r as n,g as Ce,o as x,h as ae,w as a,b as o,a as u,t as ee,i as t,s as D,j as oe,J as $e,c as N,p as se,V as H,d as j,D as Pe,K as qe,u as Ae,e as A,f as Me,y as Se,F as Te,k as Ee}from"./LE0a20Pj.js";import{V as Fe,a as Oe,c as Re}from"./PP4Pe0Q9.js";import{V as ze}from"./GBy-r3dV.js";import{_ as De}from"./BiY73WKK.js";import{_ as Ne}from"./B35t6tGs.js";import{_ as ne}from"./BRipf9vU.js";import{_ as je}from"./BVz1G1IN.js";import{_ as Be}from"./I_tpRJRS.js";import{a as Ue}from"./DJvq3mCv.js";import{u as V}from"./15nnp_Li.js";import{V as z}from"./B9O5Ruir.js";import{V as b}from"./U90pyLBS.js";import{V as Ie}from"./5GJMbiJZ.js";import{V as te}from"./Bq7DcDYD.js";import"./BG4dw6j7.js";import"./J6e1xhSC.js";import"./CumXHMvM.js";import"./CKC_pCsg.js";import"./B0IxRygJ.js";import"./Ds54zvGE.js";import"./kGqfqzKx.js";import"./llfAYgtB.js";import"./BMVlqJKO.js";import"./_aMdnNjg.js";import"./JKpCmkkq.js";import"./wIx7qESN.js";import"./Mcoq2Atb.js";import"./BkoMhmkN.js";import"./40Mu4Pbg.js";import"./BJGEiU5i.js";const Ke={class:"random-numbers"},Ze={key:0,class:"error-message"},We={__name:"ValidadorAutencidade",props:{show:Boolean},emits:["close","confirm"],setup(B,{emit:U}){const k=B,C=U,d=n(k.show),g=n([]),p=n(""),v=n("");function f(){g.value=[];for(let _=0;_<4;_++)g.value.push(Math.floor(Math.random()*10))}Ce(()=>k.show,_=>{d.value=_,_&&(f(),p.value="",v.value="")});const I=()=>{d.value=!1,C("close")},M=()=>{p.value===g.value.join("")?(v.value="",d.value=!1,C("confirm")):v.value="Números digitados incorretos. Tente novamente."};return(_,i)=>(x(),ae(ze,{persistent:"",modelValue:t(d),"onUpdate:modelValue":i[1]||(i[1]=$=>oe(d)?d.value=$:null),"max-width":"500"},{default:a(()=>[o(Fe,null,{default:a(()=>[o(Oe,null,{default:a(()=>[u("div",null,[i[2]||(i[2]=u("p",null," Digite o código de validação para confirmar o ato de reconhecimento por autenticidade: ",-1)),u("div",Ke,[u("span",null,ee(t(g).join(" ")),1)]),o(D,{modelValue:t(p),"onUpdate:modelValue":i[0]||(i[0]=$=>oe(p)?p.value=$:null),label:"Digite os números",maxlength:"4",outlined:"",dense:"",onKeyup:$e(M,["enter"])},null,8,["modelValue"]),t(v)?(x(),N("div",Ze,ee(t(v)),1)):se("",!0)])]),_:1}),o(Re,null,{default:a(()=>[o(H,{style:{"background-color":"red",color:"white"},onClick:I},{default:a(()=>i[3]||(i[3]=[j("Cancelar")])),_:1}),o(H,{style:{"background-color":"green",color:"white"},onClick:M},{default:a(()=>i[4]||(i[4]=[j("Validar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},He=xe(We,[["__scopeId","data-v-c978e7cc"]]),Le=["onClick"],Qe={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:ne,alt:"Possui Ficha",title:"Possui Ficha"},Je={key:1,style:{width:"30px",height:"30px",cursor:"pointer"},src:Be,alt:"Visualizar",title:"Não Possui Ficha"},Ye=["onClick"],To={__name:"autencidade",props:{ato_token:{type:String,required:!0}},emits:["ato-created"],async setup(B,{emit:U}){var X;let k,C;const d=B,g=U,p=Pe(),v=qe(),f=Ee(),{$toast:I}=Ae(),M=`${f.public.managemant}/listarEscrevente`,_=`${f.public.managemant}/pesquisarPessoas`,i=`${f.public.managemant}/atoReconhecimento`,$=`${f.public.managemant}/etiquetaAutenticidade`,le=`${f.public.managemant}/download`,re=`${f.public.envioDoc}/print`,S=n(A("user-data").value.cartorio_token),ie=n(A("user-service").value.token).value||n(A("user-service").value).value,ue=A("auth_token").value,K=n([]),L=n([]),P=n([]),T=n(!1),Z=n(!1),E=n(!1),F=n(null),Q=n(null),W=n(""),O=n(null),R=n(!1),J=[{title:"Documento",align:"start",key:"documento"},{title:"Pessoa",align:"start",key:"nome"},{value:"actions"}],r=Me({quantidade:1,escrevente:null,nome:null,documento:null}),{data:Y}=([k,C]=Se(()=>V(M,{method:"POST",body:{cartorio_token:S}},"$qpB20nOlUE")),k=await k,C(),k);L.value=Array.isArray(Y.value)&&((X=Y.value[0])==null?void 0:X.func_json_escreventes)||[];async function ce(){try{const{data:s,error:e}=await V(_,{method:"POST",body:{cartorio_token:S.value,documento:r.documento,nome:r.nome}},"$CfpM9wZnUE");s.value.length>0?(g("ato-created"),K.value=s.value):K.value=[]}catch(s){console.error("Erro na requisição",s)}}const me=()=>{Z.value=!0};function de(s){P.value.push(s)}const pe=async s=>{F.value=s,E.value=!0;const{data:e}=await V(le,{method:"POST",body:{bucket:A("user-data").value.cartorio_token,path:s.link_ficha}},"$LrKAtpxZwH");Q.value=e.value};function ve(s){P.value=P.value.filter(e=>e.token!==s.token)}function fe(){return new Promise(s=>{O.value=s,R.value=!0})}async function _e(){R.value=!1;try{await ke()}finally{O.value&&(O.value(),O.value=null)}}async function ke(){var c,m,w;if(!r.escrevente)throw I.error("Por favor selecione um Escrevente"),new Error("Escrevente não selecionado");const s=P.value.map(y=>({pessoa_token:y.token})),{data:e,error:h,status:q}=await V(i,{method:"POST",body:{pessoas:s,cartorio_token:S.value,ordemserv_token:ie,quantidade:r.quantidade,usuario_token:ue,ato_tipo_token:d.ato_token}},"$EE94jKo1pQ");if(q.value==="success"&&e.value[0].status==="OK"){if(e.value[0].livro&&e.value[0].livro!==null){const y=window.open("","_blank");y.document.open(),y.document.write(e.value[0].livro),y.document.close()}ye(e.value[0].token)}else T.value=!0,W.value=Array.isArray(e.value)&&((c=e.value[0])==null?void 0:c.status_mensagem)||((w=(m=h==null?void 0:h.value)==null?void 0:m.data)==null?void 0:w.details)||"Não foi possível concluir o reconhecimento"}async function ye(s){const{data:e,error:h,status:q}=await V($,{method:"POST",body:{ato_token:s,cartorio_token:S.value,escrevente_token:r.escrevente}},"$KyoIzBxZyr");if(q.value==="success"){const c=Array.isArray(e.value)?e.value[0]:null;if(!c)return;if(c.tipo_etiqueta==="html"){const m=window.open("","_blank");m.document.open(),m.document.write(c.etiqueta),m.document.close()}else if(c.tipo_etiqueta==="zpl"){const{status:m,error:w}=await V(`${re}`,{method:"POST",body:{zpl:atob(c.etiqueta)}},"$Vem9mHWYqw");if(m.value!=="success"){T.value=!0,W.value=w.value.data.message;return}}}}const ge=()=>{T.value=!1,G()},G=()=>{const s=v.query.origem||"criar",e=v.query.id;s==="atualizar"?p.push(`/os/atualizar/${e}`):p.push("/os/criar-registro")};return(s,e)=>{const h=we,q=Ve,c=be,m=He,w=De,y=Ne;return x(),N(Te,null,[o(z,{class:"mt-5"},{default:a(()=>[o(b,{cols:"5"},{default:a(()=>[o(Ie,{label:"Tabelião/escrevente",modelValue:t(r).escrevente,"onUpdate:modelValue":e[0]||(e[0]=l=>t(r).escrevente=l),items:t(L),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"])]),_:1}),o(b,{cols:"2"},{default:a(()=>[o(D,{label:"Quantidade",type:"number",modelValue:t(r).quantidade,"onUpdate:modelValue":e[1]||(e[1]=l=>t(r).quantidade=l)},null,8,["modelValue"])]),_:1})]),_:1}),o(z,null,{default:a(()=>[o(b,{cols:"3"},{default:a(()=>[o(D,{label:"Documento",modelValue:t(r).documento,"onUpdate:modelValue":e[2]||(e[2]=l=>t(r).documento=l)},null,8,["modelValue"])]),_:1}),o(b,{cols:"4"},{default:a(()=>[o(D,{label:"Pessoa",modelValue:t(r).nome,"onUpdate:modelValue":e[3]||(e[3]=l=>t(r).nome=l)},null,8,["modelValue"])]),_:1}),u("div",null,[u("img",{class:"btn-pointer mt-1",src:ne,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:ce})]),u("div",null,[u("img",{class:"btn-pointer mt-1 ml-2",src:je,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:me})])]),_:1}),o(z,null,{default:a(()=>[o(b,{class:"mr-10"},{default:a(()=>[o(te,{style:{height:"465px"},headers:J,items:t(K)},{"item.actions":a(({item:l})=>[u("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:he=>pe(l),title:"Visualizar Ficha"},[l.link_ficha?(x(),N("img",Qe)):(x(),N("img",Je))],8,Le)]),_:1},8,["items"])]),_:1}),o(b,null,{default:a(()=>[o(te,{headers:J,items:t(P),style:{height:"465px"},"item-key":"id"},{"item.actions":a(({item:l})=>[u("div",{style:{display:"flex","justify-content":"flex-end"},onClick:he=>ve(l),title:"Remover"},e[8]||(e[8]=[u("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:Ue,alt:"Remover"},null,-1)]),8,Ye)]),_:1},8,["items"])]),_:1})]),_:1}),o(h,{show:t(Z),onClose:e[4]||(e[4]=l=>Z.value=!1)},null,8,["show"]),t(E)?(x(),ae(q,{key:0,show:t(E),item:t(F),"pessoa-obj":t(F),"link-view":t(Q),onConfirmar:e[5]||(e[5]=l=>de(t(F))),onClose:e[6]||(e[6]=l=>E.value=!1)},null,8,["show","item","pessoa-obj","link-view"])):se("",!0),o(c,{show:t(T),errorMessage:t(W),onClose:ge},null,8,["show","errorMessage"]),o(m,{show:t(R),onClose:e[7]||(e[7]=l=>R.value=!1),onConfirm:_e},null,8,["show"]),o(z,null,{default:a(()=>[o(w,{onClick:G},{default:a(()=>[o(H,{size:"large",color:"red"},{default:a(()=>e[9]||(e[9]=[j("Voltar")])),_:1})]),_:1}),o(y,{onSave:fe,class:"ml-5",size:"large",color:"green"},{default:a(()=>e[10]||(e[10]=[j("Salvar")])),_:1})]),_:1})],64)}}};export{To as default};
