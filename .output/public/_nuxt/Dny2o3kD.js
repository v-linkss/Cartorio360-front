import{r as f,p as i,s as q,P as F,c as y,a as E,b as c,x as v,y as L,w as p,C as m,F as T,A as $,o as t,bh as D,z as P,d as S,v as n,B as _}from"./CNAiVaQm.js";import{u as k}from"./-ksdFIuP.js";import{V as C}from"./CVYrSSd-.js";import{V as I}from"./B863JINC.js";import{V as O}from"./4QjTaRBk.js";import{V as Q}from"./nC4QlDlf.js";import"./geStYpxQ.js";import"./BU2JxnnE.js";import"./JdEJ36-T.js";import"./Br3bdj8I.js";const z={key:0},ae={__name:"lista",async setup(G){let d,g;const V=$(),w=`${V.public.managemant}/getRelatorios`,B=`${V.public.managemant}/createRelatorio`,U=`${V.public.managemant}/listaQuery`,b=f([]),u=f(null),r=f([]),R={user_token:i("auth_token").value,cartorio_token:i("user-data").value.cartorio_token,user_name:i("user-data").value.nome},{data:A}=([d,g]=q(()=>k(w,{method:"POST",body:R},"$53NFRNGH7x")),d=await d,g(),d);b.value=Array.isArray(A.value)?A.value:[];const h=F(()=>b.value.every(o=>!o.codigo&&!o.value&&!o.parametros)?[]:b.value.map(o=>({label:o.codigo,value:o.codigo,parametros:o.parametros}))),x=async o=>{const a=h.value.find(e=>e.value===o);if(a){r.value=a.parametros.map(e=>({...e,value:null,showDatePicker:!1,items:[]}));for(const e of r.value)if(e.tipo==="TABLE"&&e.dominio)try{const{data:s}=await k(U,{method:"POST",body:{cartorio_token:R.cartorio_token,parametros:e.dominio}},"$c4psqRQWRs");e.items=Array.isArray(s.value)?s.value.map(l=>({label:l.nome,value:l.token})):[]}catch(s){console.error("Erro ao buscar dados para TABLE:",s)}}else r.value=[]},N=async()=>{const o=r.value.reduce((a,e)=>(a[e.parametro]=e.value,a),{});try{const a={...o,user_id:i("user-data").value.usuario_id},{data:e}=await k(B,{method:"POST",body:a},"$6CLQJHdzNf");window.open(e.value,"_blank"),r.value=[],u.value=null}catch(a){console.error("Erro ao criar o relatório:",a)}};return(o,a)=>(t(),y(T,null,[a[2]||(a[2]=E("h1",null,"Relatórios",-1)),E("div",null,[c(C,{modelValue:v(u),"onUpdate:modelValue":a[0]||(a[0]=e=>L(u)?u.value=e:null),items:v(h),class:"mb-5","item-title":"label","item-value":"value",label:"Selecione o relatório",required:"","onUpdate:search":x},null,8,["modelValue","items"])]),v(u)?(t(),y("div",z,[c(I,null,{default:p(()=>[(t(!0),y(T,null,D(v(r),(e,s)=>(t(),n(O,{key:s},{default:p(()=>[c(Q,{cols:"4"},{default:p(()=>[e.tipo!=="DATE"&&e.tipo!=="TABLE"?(t(),n(_,{key:0,modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,label:e.label,required:e.obrigatorio},null,8,["modelValue","onUpdate:modelValue","label","required"])):m("",!0),e.tipo==="INTEGER"?(t(),n(_,{key:1,modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,type:"number",outlined:""},null,8,["modelValue","onUpdate:modelValue"])):m("",!0),e.tipo==="DATE"?(t(),n(_,{key:2,modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,type:"date"},null,8,["modelValue","onUpdate:modelValue"])):m("",!0),e.tipo==="TABLE"?(t(),n(C,{key:3,modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,items:e.items,"item-title":"label","item-value":"value",label:e.label,required:e.obrigatorio},null,8,["modelValue","onUpdate:modelValue","items","label","required"])):m("",!0)]),_:2},1024)]),_:2},1024))),128)),c(P,{color:"green",class:"mt-4",onClick:N},{default:p(()=>a[1]||(a[1]=[S("Enviar")])),_:1})]),_:1})])):m("",!0)],64))}};export{ae as default};
