import{_ as de}from"./CqfQc6g9.js";import{a as me,_ as pe}from"./Wh4KhUSB.js";import{u as ce,r as u,m as r,n as ve,G as fe,z as _e,p as _,w as l,v as ge,o as g,b as n,a as i,t as be,q as t,B as Ve,C as T,A as M,E as D,D as Ce,V as ke,d as ye}from"./DP3qcOMz.js";import{_ as xe}from"./BwpqbDcb.js";import{_ as $e}from"./BVz1G1IN.js";import{_ as we}from"./BHSGMGOy.js";import{_ as he}from"./D9PM0Nbz.js";import{_ as Oe}from"./CB6iyBXU.js";import{c as G,r as H,u as Se}from"./D8tBkyop.js";import{u as A}from"./CtJXq5EX.js";import"./DX4VL7_W.js";import{f as Te}from"./C2XSGdQM.js";import{V as De}from"./cXFZDrSw.js";import{V as y}from"./0oLPtT-r.js";import{V as x}from"./tkLs4TKj.js";import{V as Ae}from"./D8SSUY1X.js";import{V as Ne}from"./Ds7CA34Q.js";import"./Ca0IpsuN.js";import"./bhuJpQuo.js";import"./ChQBZ17x.js";import"./Q7fyLs9I.js";import"./BUlLaMYO.js";import"./CV8HQgQO.js";import"./qs1__QEg.js";import"./BUXXOQvW.js";const Be={style:{color:"red","margin-left":"30px"}},Ee=["onClick"],Re=["onClick","title"],qe=["onClick"],ze=["title"],da={__name:"criar-registro",async setup(Fe){var q,z,F,P,I,U,L;let b,N;const{$toast:c}=ce(),V=ge(),J=`${V.public.managemant}/createOrdensServico`,W=`${V.public.managemant}/validarCpf`,j=`${V.public.managemant}/listarAtos`,X=`${V.public.managemant}/updateAtos`,K=u(r("user-data").value.cartorio_id),Q=u(r("user-data").value.usuario_id),Y=u((q=r("user-service").value)==null?void 0:q.token).value||null,Z=u(r("user-data").value.cartorio_token).value,C=u((z=r("user-service").value)==null?void 0:z.numero),k=u((F=r("user-service").value)==null?void 0:F.isDisabled);let B=u(!!((P=r("user-service").value)!=null&&P.numero)),$=u(r("ordem-button").value),w=!1;const h=u(!1),O=u([]),s=ve({nacionalidade:((I=r("user-service").value)==null?void 0:I.estrangeiro)||!1,apresentante_nome:(U=r("user-service").value)==null?void 0:U.apresentante_nome,apresentante_cpf:(L=r("user-service").value)==null?void 0:L.apresentante_cpf}),v=u(!1),ee=[{title:"ID",value:"id"},{title:"Protocolo",value:"protocolo"},{title:"Usuario",value:"usuario_nome"},{title:"Situação",value:"situacao"},{title:"Valor",value:"valor"},{title:"Tipo",value:"tipo"},{value:"actions"}],ae=[{title:"BRASILEIRO",value:!1},{title:"ESTRANGEIRO",value:!0}],te={apresentante_nome:{required:G.withMessage("O campo é obrigatorio",H)},apresentante_cpf:{required:G.withMessage("O campo é obrigatorio",H)}},m=Se(te,s);function E(o){if(o)return o.replace(/[.\-]/g,"");o=null}const oe=o=>{redirectTo({item:o,id:r("user-service").value.id,numeroOs:C.value,origem:"vizualizar"})},re=o=>{redirectTo({item:o,id:r("user-service").value.id,numeroOs:C.value,origem:"atualizar"})};function se(){const o=r("user-service"),e=r("ordem-button");o.value=null,e.value=null}const ie=()=>{h.value=!0};async function le(){const o={apresentante_cpf:E(s.apresentante_cpf),apresentante_nome:s.apresentante_nome,user_id:Q.value,cartorio_id:K.value,estrangeiro:s.nacionalidade};if(await m.value.$validate()){const{data:e,error:p,status:d}=await A(J,{method:"POST",body:o},"$HqnOwnLBio");if(d.value==="error"&&p.value.statusCode===500)c.error("Erro ao cadastrar ordem,erro no sistema.");else{c.success("Ordem registrada com sucesso!"),B.value=!0,$.value=!1,C.value=e.value.numero;const f=r("ordem-button");f.value=$.value;const a=r("user-service");a.value=a.value=JSON.stringify({numero:e.value.numero,id:e.value.id,apresentante_cpf:e.value.apresentante_cpf,apresentante_nome:e.value.apresentante_nome,estrangeiro:e.value.estrangeiro,token:e.value.token,isDisabled:!0}),v.value=!0}}}async function ne(o){const e=E(o);if(e.length===11&&!w){w=!0;const p={cpf:e};try{const{data:d,error:f,status:a}=await A(W,{method:"POST",body:p},"$DfuVr7OuaN");a.value==="error"&&f.value.statusCode===500?c.error("Erro ao cadastrar pessoa, o CPF já está cadastrado."):d.value.cpfValidation===!0?(s.apresentante_nome=d.value.nome,c.success("Cpf autenticado com sucesso!")):d.value.cpfValidation===!1&&c.error("Cpf não cadastrado!")}catch(d){console.error("Erro ao validar CPF:",d)}finally{w=!1}}}async function ue(o){o.excluido=!o.excluido;try{await Te(`${X}/${o.id}`,{method:"PUT",body:{excluido:o.excluido}})}catch(e){console.error("Erro ao excluir pessoa:",e)}}const{data:R}=([b,N]=fe(()=>A(j,{method:"POST",body:{cartorio_token:Z,ordemserv_token:Y}},"$bJ1XcDsWLH")),b=await b,N(),b);return R.value.length>0?O.value=R.value:O.value=[],(o,e)=>{const p=de,d=pe,f=_e("mask");return g(),_(De,{class:"mt-5"},{default:l(()=>[n(y,{class:"mb-5"},{default:l(()=>{var a;return[e[8]||(e[8]=i("h1",null,"Ordem de Serviço nº",-1)),i("h1",Be,be(t(C)||((a=("useCookie"in o?o.useCookie:t(r))("user-service").value)==null?void 0:a.numero)),1)]}),_:1}),n(y,null,{default:l(()=>[n(x,{md:"3"},{default:l(()=>[n(Ae,{label:"Nacionalidade",items:ae,modelValue:t(s).nacionalidade,"onUpdate:modelValue":e[0]||(e[0]=a=>t(s).nacionalidade=a),disabled:t(k)||t(v)},null,8,["modelValue","disabled"])]),_:1}),n(x,{md:"2"},{default:l(()=>[t(s).nacionalidade===!1?Ve((g(),_(T,{key:0,autofocus:"",modelValue:t(s).apresentante_cpf,"onUpdate:modelValue":e[1]||(e[1]=a=>t(s).apresentante_cpf=a),label:"CPF",required:"","error-messages":t(m).apresentante_cpf.$errors.map(a=>a.$message),onBlur:t(m).apresentante_cpf.$touch,onInput:e[2]||(e[2]=a=>ne(t(s).apresentante_cpf)),disabled:t(k)||t(v)},null,8,["modelValue","error-messages","onBlur","disabled"])),[[f,"###.###.###-##"]]):(g(),_(T,{key:1,autofocus:"",modelValue:t(s).apresentante_cpf,"onUpdate:modelValue":e[3]||(e[3]=a=>t(s).apresentante_cpf=a),label:"Documento",required:"","error-messages":t(m).apresentante_cpf.$errors.map(a=>a.$message),onBlur:t(m).apresentante_cpf.$touch,disabled:t(k)||t(v)},null,8,["modelValue","error-messages","onBlur","disabled"]))]),_:1}),n(x,{md:"4"},{default:l(()=>[n(T,{modelValue:t(s).apresentante_nome,"onUpdate:modelValue":e[4]||(e[4]=a=>t(s).apresentante_nome=a),label:"Nome Apresentante",required:"","error-messages":t(m).apresentante_nome.$errors.map(a=>a.$message),onInput:t(m).apresentante_nome.$touch,disabled:t(k)||t(v)},null,8,["modelValue","error-messages","onInput","disabled"])]),_:1}),t($)?(g(),_(x,{key:0},{default:l(()=>[i("div",null,[i("img",{style:{width:"40px",height:"40px",cursor:"pointer"},src:xe,alt:"Salvar",onClick:e[5]||(e[5]=a=>le())})])]),_:1})):M("",!0)]),_:1}),t(B)?(g(),_(y,{key:0,style:{display:"flex","margin-bottom":"10px",gap:"2rem"}},{default:l(()=>[e[12]||(e[12]=i("h1",{class:"ml-5"},"Atos",-1)),n(p,{to:{path:"/os/criar-ato",query:{origem:"criar"}}},{default:l(()=>e[9]||(e[9]=[i("img",{style:{width:"45px",height:"45px",cursor:"pointer"},src:$e,alt:"novo"},null,-1)])),_:1}),n(Ne,{headers:ee,items:t(O),"item-key":"id"},{"item.actions":l(({item:a})=>[n(y,{style:{display:"flex",gap:"2px","margin-top":"-5px"}},{default:l(()=>[i("div",{onClick:S=>oe(a),title:"Visualizar"},e[10]||(e[10]=[i("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:we,alt:"Visualizar"},null,-1)]),8,Ee),i("div",{onClick:e[6]||(e[6]=S=>ie()),title:"Reimprimir"},e[11]||(e[11]=[i("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:me,alt:"Reimprimir"},null,-1)])),i("div",{class:Ce({disabled:!a.btn_editar}),onClick:S=>a.btn_editar?re({id:a.id,tipo:a.tipo,token:a.token,tipo_token:a.tipo_token,usa_imoveis:a.usa_imoveis}):null,title:a.btn_editar?"Editar":"Desabilitado"},[i("img",{style:D({cursor:a.btn_editar?"pointer":"default",width:"30px",height:"30px"}),src:he,alt:"Editar"},null,4)],10,Re),i("div",{onClick:S=>a.btn_cancelar?ue(a):null,title:"Excluir",style:D({cursor:a.btn_cancelar?"pointer":"not-allowed"})},[i("img",{style:D({width:"30px",height:"30px",cursor:a.btn_cancelar?"pointer":"not-allowed",opacity:a.btn_cancelar?"1":"0.5"}),src:Oe,alt:"Cancelar",title:a.btn_cancelar?"Cancelar":"Não permitido"},null,12,ze)],12,qe)]),_:2},1024)]),_:1},8,["items"]),n(d,{show:t(h),onClose:e[7]||(e[7]=a=>h.value=!1)},null,8,["show"])]),_:1})):M("",!0),n(p,{to:"/os/lista"},{default:l(()=>[n(ke,{size:"large",color:"red",onClick:se},{default:l(()=>e[13]||(e[13]=[ye("Voltar")])),_:1})]),_:1})]),_:1})}}};export{da as default};
