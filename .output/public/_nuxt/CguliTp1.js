import{_ as R}from"./sTbs4YzT.js";import{_ as D}from"./D4VE6rzS.js";import{_ as F}from"./BsiqYdVA.js";import{c as K,r as L,u as U}from"./D15pP43p.js";import{_ as W,D as j,K as J,u as Q,r as i,e as p,f as X,y as Z,h as G,w as u,k as H,o as Y,b as a,a as $,i as t,s as ee,V as te,d as y}from"./DocoAQKL.js";import{f as k}from"./Beg2b42J.js";import{u as oe}from"./Cvx8zdu2.js";import{V as ae}from"./BozcXUgZ.js";import{V as se}from"./Cx7c1Ztz.js";import{V as re}from"./B9iCPK4m.js";import{V as ne}from"./DcknbuxL.js";import"./BsdO4JMn.js";import"./DTe9xx4m.js";import"./COd1z7Ka.js";import"./CXFWiv6o.js";import"./CfnjFqkD.js";import"./DKETEyTG.js";import"./D9fOi_Mf.js";import"./BiBQLpS5.js";import"./CqZJ2IID.js";const ie={style:{width:"600px","margin-top":"10px"}},ue={style:{width:"180px","margin-top":"20px"}},ce={__name:"autenticacao",props:{ato_token:{type:String,required:!0}},async setup(x){let l,g;const S=x,V=j(),b=J(),m=H(),A=`${m.public.auth}/service/gerencia/listarEscrevente`,{$toast:w}=Q(),v=i(p("user-data").value.cartorio_token).value,B=i(p("user-service").value.token).value||i(p("user-service").value).value,C=p("auth_token").value,z=`${m.public.auth}/service/gerencia/atoAutentica`,T=`${m.public.auth}/service/gerencia/etiquetaAutentica`,N=`${m.public.envioDoc}/print`,_=i(!1),q=i(""),s=X({escrevente:null,quantidade:1}),h=i([]),{data:M}=([l,g]=Z(()=>k(A,{method:"POST",body:{cartorio_token:v}})),l=await l,g(),l);h.value=M.value[0].func_json_escreventes;const O={escrevente:{required:K.withMessage("O campo é obrigatorio",L)}},d=U(O,s),I=async()=>{if(await d.value.$validate()){const{data:o,status:e,error:c}=await k(z,{method:"POST",body:{usuario_token:C,cartorio_token:v,quantidade:Number(s.quantidade),ordemserv_token:B,ato_tipo_token:S.ato_token}});e.value==="success"&&o.value.status==="OK"?await E(o.value.token):(_.value=!0,q.value=o.value.status_mensagem||c.value.data.details)}},E=async o=>{const{data:e,status:c}=await k(T,{method:"POST",body:{escrevente_token:s.escrevente,cartorio_token:v,ato_token:o}});if(c.value==="success"){if(w.success("Ato autenticado com sucesso!"),e.value.tipo_etiqueta==="html"){const r=window.open("","_blank");r.document.open(),r.document.write(e.value.etiqueta),r.document.close()}else if(e.value.tipo_etiqueta==="zpl"){const{status:r}=await oe(`${N}`,{method:"POST",body:{zpl:atob(e.value.etiqueta)}},"$nXL9eJBhI7");if(r.value!=="success"){f(),w.error("Não foi possivel fazer a impressao da etiqueta");return}}f()}},f=()=>{const o=b.query.origem||"criar",e=b.query.id;o==="atualizar"?V.push(`/os/atualizar/${e}`):V.push("/os/criar-registro")};return(o,e)=>{const c=R,r=D,P=F;return Y(),G(ae,{class:"mt-10"},{default:u(()=>[a(ne,null,{default:u(()=>[$("div",ie,[a(se,{label:"Tabelião/escrivão",modelValue:t(s).escrevente,"onUpdate:modelValue":e[0]||(e[0]=n=>t(s).escrevente=n),items:t(h),"item-title":"nome","item-value":"token",required:"","error-messages":t(d).escrevente.$errors.map(n=>n.$message),onBlur:t(d).escrevente.$touch,onInput:t(d).escrevente.$touch},null,8,["modelValue","items","error-messages","onBlur","onInput"])]),$("div",ue,[a(ee,{type:"number",label:"Quantidade",modelValue:t(s).quantidade,"onUpdate:modelValue":e[1]||(e[1]=n=>t(s).quantidade=n)},null,8,["modelValue"])]),a(re,{class:"mb-3 mt-2"},{default:u(()=>[a(c,{onClick:f},{default:u(()=>[a(te,{class:"ml-4",size:"large",color:"red"},{default:u(()=>e[3]||(e[3]=[y("Voltar")])),_:1})]),_:1}),a(r,{class:"ml-4",size:"large",color:"green",onSave:I},{default:u(()=>e[4]||(e[4]=[y("Salvar")])),_:1})]),_:1})]),_:1}),a(P,{show:t(_),errorMessage:t(q),onClose:e[2]||(e[2]=n=>_.value=!1)},null,8,["show","errorMessage"])]),_:1})}}},Ce=W(ce,[["__scopeId","data-v-3c4ebcf2"]]);export{Ce as default};
