import{r as K,u as X,A as M,s as G,h as H,B as J,K as Q,o as _,v as g,w as s,b as o,d as C,x as e,bR as W,c as Y,t as Z,I as N,V as m,L as $,y as q,D as ee,z as ae}from"./DzzstydT.js";import{b as oe,u as le}from"./Bftbo3xK.js";import{c as w,r as y,u as te}from"./aGVAPUeD.js";import{c as se}from"./zRqxYRKE.js";import{a as ie,d as de,V as re}from"./9HXe_a2c.js";import{V as me}from"./jnWAYyfk.js";import{V as u}from"./C4PLOs_7.js";import{V as d}from"./D1UnOdqG.js";import{V as I}from"./DLJolKcC.js";const ne={key:1},$e={__name:"RegistroPessoas",props:{show:Boolean},emits:["close"],async setup(D,{emit:A}){let p,P;const B=D,c=K(B.show),R=A,{$toast:V}=X(),f=ae(),S=`${f.public.managemant}/createPessoa`,z=`${f.public.managemant}/listarEstadoCivil`,E=`${f.public.managemant}/listarCapacidadeCivil`,O=`${f.public.managemant}/listarCidades`,h={nome:"",nome_pai:"",nome_mae:"",profissao:"",local_trabalho:"",data_nascimento:"",doc_identificacao:"",cpf_pai:"",cpf_mae:"",tipo_pessoa:"FISICA",tabvalores_estadocivil_id:"",tabvalores_capacidadecivil_id:"",cidade_natural_id:"",cartorio_id:M("user-data").value.cartorio_id,user_id:M("user-data").value.usuario_id},t=G({...h});H(()=>B.show,i=>{c.value=i});const U=()=>{c.value=!1,R("close")};function v(i){if(i)return i.replace(/[.\-]/g,"");i=null}const{data:b,pending:ue,status:k,error:x}=([p,P]=J(async()=>oe("cliente-dados",async()=>{const[i,l,n]=await Promise.all([$fetch(z),$fetch(E),$fetch(O)]);return{estadoCivilItems:i,capacidadeCivilItems:l,cidadeNascimentoItems:n}})),p=await p,P(),p),T={nome:{required:w.withMessage("O campo é obrigatorio",y)},nome_mae:{required:w.withMessage("O campo é obrigatorio",y)},doc_identificacao:{required:w.withMessage("O campo é obrigatorio",y),cpf:se}},r=te(T,t);async function L(){if(await r.value.$validate()){const i={...t};for(const F in i)i[F]===""&&(i[F]=null);const l={...i,doc_identificacao:v(t.doc_identificacao),cpf_pai:v(t.cpf_pai),cpf_mae:v(t.cpf_mae)},{data:n,error:a,status:j}=await le(S,{method:"POST",body:l},"$BiOjXVCR5N");j.value==="error"&&a.value.statusCode===500?V.error("Erro ao cadastrar pessoa,o CPF já está cadastrado."):(V.success("Pessoa cadastrada com sucesso!"),U())}else V.error("Erro ao cadastrar pessoa, preencha os campos obrigatorios.")}return(i,l)=>{const n=Q("mask");return _(),g(re,{persistent:"",modelValue:e(c),"onUpdate:modelValue":l[13]||(l[13]=a=>ee(c)?c.value=a:null),"max-width":"1000"},{default:s(()=>[o(ie,null,{default:s(()=>[o(de,{class:"text-h5 mt-3"},{default:s(()=>[C("Criar Pessoa")]),_:1}),e(k)==="pending"?(_(),g(W,{key:0,class:"loading-spinner",indeterminate:"",size:"64"})):e(x)?(_(),Y("div",ne,Z(e(x).message),1)):N("",!0),e(k)==="success"?(_(),g(me,{key:2,class:"mt-5"},{default:s(()=>[o(u,null,{default:s(()=>[o(d,{cols:"12",md:"8"},{default:s(()=>[o(m,{modelValue:e(t).nome,"onUpdate:modelValue":l[0]||(l[0]=a=>e(t).nome=a),"error-messages":e(r).nome.$errors.map(a=>a.$message),label:"Nome",required:"",onBlur:e(r).nome.$touch,onInput:e(r).nome.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1}),o(d,{cols:"12",md:"4"},{default:s(()=>[$(o(m,{modelValue:e(t).doc_identificacao,"onUpdate:modelValue":l[1]||(l[1]=a=>e(t).doc_identificacao=a),"error-messages":e(r).doc_identificacao.$errors.map(a=>a.$message),label:"CPF",required:"",onBlur:e(r).doc_identificacao.$touch,onInput:e(r).doc_identificacao.$touch},null,8,["modelValue","error-messages","onBlur","onInput"]),[[n,"###.###.###-##"]])]),_:1})]),_:1}),o(u,null,{default:s(()=>[o(d,{cols:"12",md:"4"},{default:s(()=>[o(I,{modelValue:e(t).tabvalores_estadocivil_id,"onUpdate:modelValue":l[2]||(l[2]=a=>e(t).tabvalores_estadocivil_id=a),items:e(b).estadoCivilItems,"item-title":"descricao","item-value":"id",label:"Estado Civil"},null,8,["modelValue","items"])]),_:1}),o(d,{cols:"12",md:"4"},{default:s(()=>[o(m,{modelValue:e(t).profissao,"onUpdate:modelValue":l[3]||(l[3]=a=>e(t).profissao=a),label:"Profissão"},null,8,["modelValue"])]),_:1}),o(d,{cols:"12",md:"4"},{default:s(()=>[o(m,{modelValue:e(t).local_trabalho,"onUpdate:modelValue":l[4]||(l[4]=a=>e(t).local_trabalho=a),label:"Local de trabalho"},null,8,["modelValue"])]),_:1})]),_:1}),o(u,null,{default:s(()=>[o(d,{cols:"12",md:"4"},{default:s(()=>[o(m,{modelValue:e(t).data_nascimento,"onUpdate:modelValue":l[5]||(l[5]=a=>e(t).data_nascimento=a),type:"date","prepend-icon":"",label:"Data de nascimento"},null,8,["modelValue"])]),_:1}),o(d,{cols:"12",md:"4"},{default:s(()=>[o(I,{modelValue:e(t).tabvalores_capacidadecivil_id,"onUpdate:modelValue":l[6]||(l[6]=a=>e(t).tabvalores_capacidadecivil_id=a),items:e(b).capacidadeCivilItems,label:"Capacidade Civil","item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1}),o(d,{cols:"12",md:"4"},{default:s(()=>[o(I,{modelValue:e(t).cidade_natural_id,"onUpdate:modelValue":l[7]||(l[7]=a=>e(t).cidade_natural_id=a),items:e(b).cidadeNascimentoItems,label:"Cidade de nascimento","item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1})]),_:1}),o(u,null,{default:s(()=>[o(d,{cols:"12",md:"4"},{default:s(()=>[$(o(m,{modelValue:e(t).cpf_pai,"onUpdate:modelValue":l[8]||(l[8]=a=>e(t).cpf_pai=a),modelModifiers:{date:!0},label:"CPF do Pai"},null,8,["modelValue"]),[[n,"###.###.###-##"]])]),_:1}),o(d,{cols:"12",md:"4"},{default:s(()=>[o(m,{modelValue:e(t).nome_pai,"onUpdate:modelValue":l[9]||(l[9]=a=>e(t).nome_pai=a),modelModifiers:{date:!0},label:"Nome do Pai"},null,8,["modelValue"])]),_:1})]),_:1}),o(u,null,{default:s(()=>[o(d,{cols:"12",md:"4"},{default:s(()=>[$(o(m,{modelValue:e(t).cpf_mae,"onUpdate:modelValue":l[10]||(l[10]=a=>e(t).cpf_mae=a),modelModifiers:{date:!0},label:"CPF da Mãe"},null,8,["modelValue"]),[[n,"###.###.###-##"]])]),_:1}),o(d,{cols:"12",md:"4"},{default:s(()=>[o(m,{modelValue:e(t).nome_mae,"onUpdate:modelValue":l[11]||(l[11]=a=>e(t).nome_mae=a),modelModifiers:{date:!0},"error-messages":e(r).nome_mae.$errors.map(a=>a.$message),label:"Nome da Mãe",required:"",onBlur:e(r).nome_mae.$touch,onInput:e(r).nome_mae.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1})]),_:1}),o(u,null,{default:s(()=>[o(q,{class:"ml-5",color:"red",size:"large",onClick:U},{default:s(()=>[C("Fechar")]),_:1}),o(q,{class:"ml-5",color:"green",size:"large",onClick:l[12]||(l[12]=a=>L())},{default:s(()=>[C("Salvar")]),_:1})]),_:1})]),_:1})):N("",!0)]),_:1})]),_:1},8,["modelValue"])}}};export{$e as _};
