import{_ as pe}from"./BGe95753.js";import{_ as _e}from"./C-Xmr2Db.js";import{c as ve,r as fe,u as be}from"./Dq_N2V3P.js";import{r as u,e as k,f as ee,g as ye,o as P,h as te,w as n,b as a,a as i,t as X,d as J,i as o,V as Z,j as Ve,k as ae,u as ke,D as ge,l as he,n as xe,m as we,s as v,q,x as E,v as F,c as H}from"./CyqTGDD6.js";import{u as w}from"./Bj-2FKWl.js";import{V as Q,a as $e}from"./B2Xl8e45.js";import{V as K}from"./BWG-R2YI.js";import{V as A}from"./D8o37Hsx.js";import{V as Ce}from"./DFEr3SEp.js";import{V as Se}from"./DkUuQiU9.js";import{_ as Oe}from"./BVz1G1IN.js";import{_ as De}from"./N4ztoqAr.js";import{_ as Ue}from"./BVgZkkqd.js";import{_ as Ae}from"./DcQSwM0f.js";import{_ as Te}from"./B16moC2y.js";import{_ as Re,a as Ne}from"./DJvq3mCv.js";import{f as B}from"./B0IxRygJ.js";import{V as m}from"./ChZdYnYu.js";import{V as j}from"./KFLJOwjW.js";import{V as qe}from"./dVLXcY02.js";import"./BL7VAyP8.js";import"./BRwqhO8g.js";import"./BqKfKras.js";import"./CXZNUCN-.js";import"./C823Fyto.js";import"./DqQ5MEt4.js";import"./BRDUiMuf.js";import"./BXOpNuad.js";import"./Cxqkqjv8.js";const Ee={style:{color:"red","margin-left":"18px"}},Be={class:"mb-5",style:{display:"flex","justify-content":"flex-start"}},Pe={class:"ml-6"},Ie={class:"ml-6"},Me={__name:"Ordem",props:{show:Boolean,numero_os:Number,ordemserv_token:String},emits:["close"],setup(W,{emit:$}){const b=W,g=u(b.show),S=ae();u(k("user-data").value.cartorio_token).value;const I=k("auth_token").value,M=`${S.public.managemant}/analisaCancelamento`,z=`${S.public.managemant}/cancelaOs`,y=ee({motivo:null}),h=u(null),V=$,T={motivo:{required:ve.withMessage("O campo é obrigatorio",fe)}},x=be(T,y);ye(()=>b.show,f=>{g.value=f});const R=()=>{g.value=!1,V("close")};(async()=>{const{data:f,error:d}=await w(`${M}`,{method:"POST",body:{ordemserv_token:b.ordemserv_token}},"$1fnrIk2fgs");h.value=f.value.mensagem})();const O=async()=>{if(await x.value.$validate()){const{status:f}=await w(`${z}`,{method:"POST",body:{usuario_token:I,motivo:y.motivo,ordemserv_token:b.ordemserv_token}},"$21WlhUNXeM");f.value==="success"&&(window.location.reload(),R())}};return(f,d)=>(P(),te(Se,{persistent:"",modelValue:o(g),"onUpdate:modelValue":d[1]||(d[1]=_=>Ve(g)?g.value=_:null),"max-width":"650"},{default:n(()=>[a(Q,null,{default:n(()=>[a(K,null,{default:n(()=>[a(A,{class:"mb-5 mt-1 ml-2"},{default:n(()=>[d[2]||(d[2]=i("h1",null,"Cancelamento da OS nº",-1)),i("h1",Ee,X(b.numero_os),1)]),_:1}),a(K,null,{default:n(()=>[a(Q,{variant:"outlined",class:"mb-5"},{default:n(()=>[a($e,null,{default:n(()=>[J(X(o(h)),1)]),_:1})]),_:1}),a(Ce,{label:"Motivo",modelValue:o(y).motivo,"onUpdate:modelValue":d[0]||(d[0]=_=>o(y).motivo=_),required:"","error-messages":o(x).motivo.$errors.map(_=>_.$message),onBlur:o(x).motivo.$touch,onInput:o(x).motivo.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1})]),_:1}),i("div",Be,[i("div",Pe,[a(Z,{size:"large",color:"red",onClick:R},{default:n(()=>d[3]||(d[3]=[J("Fechar")])),_:1})]),i("div",Ie,[a(Z,{size:"large",color:"green",onClick:O},{default:n(()=>d[4]||(d[4]=[J("Salvar")])),_:1})])])]),_:1})]),_:1},8,["modelValue"]))}},ze=["title","onClick"],Le=["onClick","title"],Je=["onClick","title"],Fe=["disabled","onClick"],je={key:0,style:{width:"30px",height:"30px"},src:Re,alt:"Visualizar",title:"Reativar"},Ke={key:1,src:Ne,alt:"Cancelamento",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},ht={__name:"index",setup(W){const $=ae(),{$toast:b}=ke(),g=`${$.public.managemant}/listarUsuarios`,S=`${$.public.managemant}/listarOrdensServico`,I=`${$.public.managemant}/tipoAtos`,M=`${$.public.auth}/service/gerencia/emitir_recibo`,z=ge(),y=u(k("auth_token").value)||null,h=u(k("user-data").value.cartorio_token)||null,V=u([]),T=u([]),x=u([]),R=u(["PENDENTE","EM ANDAMENTO","CONCLUÍDA","LAVRADA"]),N=u(!1),O=u(!1),f=u(null),d=u(null),_=u(null),Y=u({}),oe=k("auth_token"),l=ee({numero:null,data_inicio:L(),data_fim:L(),data_lavratura_inicio:null,data_lavratura_fim:null,protocolo:null,livro:null,folha:null,situacao:null,usuario_token:y.value,selo:null,ato_tipo_token:null,apresentante:null}),le=[{title:"Data Abertura",value:"dt_abertura",width:"100px"},{title:"Data Recebimento",value:"data",width:"100px"},{title:"Número",value:"numero",width:"10px"},{title:"Situação",value:"situacao",width:"115px"},{title:"CPF",value:"apresentante_cpf",width:"100px"},{title:"Apresentante",value:"apresentante_nome",width:"228px"},{title:"Usuario",value:"usuario_nome",width:"30px"},{title:"Valor",value:"valor",width:"50px"},{title:"A Receber",value:"valor_a_receber",width:"50px"},{value:"actions"}];function L(){const r=new Date,e=r.getFullYear(),s=String(r.getMonth()+1).padStart(2,"0");return`${String(r.getDate()).padStart(2,"0")}-${s}-${e}`}function C(r){if(!r)return null;const[e,s,c]=r.split("/");return`${c}-${s}-${e}`}async function re(){const{data:r}=await w(g,{method:"POST",body:{cartorio_token:h.value}},"$pAAptWJdb1");T.value=r.value}async function ne(){try{sessionStorage.setItem("pesquisaOS",JSON.stringify(l));const{data:r,error:e}=await w(S,{method:"POST",body:{cartorio_token:h.value,numero:l.numero||null,data_inicio:C(l.data_inicio)||null,data_fim:C(l.data_fim)||null,data_lavratura_inicio:C(l.data_lavratura_inicio)||null,data_lavratura_fim:C(l.data_lavratura_fim)||null,protocolo:l.protocolo||null,livro:l.livro||null,folha:l.folha||null,situacao:l.situacao||null,usuario_token:l.usuario_token,selo:l.selo||null,ato_tipo_token:l.ato_tipo_token,apresentante:l.apresentante||null}},"$IO02J210Z9");r.value.length>0?V.value=r.value.map(s=>({...s,data:s.data?B(s.data,"dd/mm/yyyy"):null,dt_abertura:s.dt_abertura?B(s.dt_abertura,"dd/mm/yyyy"):null})):(V.value=[],b.error("Não existe Ordem de Serviço Registrada!"))}catch(r){console.error("Erro na requisição",r)}}async function se(){const{data:r,error:e}=await w(I,{method:"POST",body:{cartorio_token:h.value,usuario_token:y.value}},"$YgUhKRJlsV");x.value=r.value}const G=async()=>{try{const r=L(),e=sessionStorage.getItem("pesquisaOS"),s=JSON.parse(e),{data:c,error:D}=await w(S,{method:"POST",body:{cartorio_token:h.value,usuario_token:s.usuario_token||y.value,data_fim:C(s==null?void 0:s.data_fim)||r,data_inicio:C(s==null?void 0:s.data_inicio)||r}},"$xKnfARCL4G");c.value.length>0?V.value=c.value.map(p=>({...p,data:B(p.data,"dd/mm/yyyy"),dt_abertura:B(p.dt_abertura,"dd/mm/yyyy")})):V.value=[]}catch(r){console.error("Erro ao buscar serviços",r)}};function ie(r){_.value=r.numero,d.value=r.token,O.value=!0}function ue(r){const e=k("user-service"),s=V.value.find(c=>c.id===r);e.value=e.value=JSON.stringify({id:s.id,token:s.token}),z.push({path:`/os/atualizar/${r}`})}function de(r,e){_.value=r,Y.value={token:e.token,numero:e.numero,valor:e.valor,valor_pago:e.valor_pago},N.value=!0}async function me(r){var D,p;const{data:e,pending:s,error:c}=await w(M,{method:"POST",body:{os_token:r},headers:{Authorization:`Bearer ${oe.value}`}},"$u0iMyzSv4b");if(e.value){const t=new Blob([e.value],{type:"text/html"}),U=URL.createObjectURL(t);window.open(U,"_blank")}else b.error(((p=(D=c==null?void 0:c.value)==null?void 0:D.data)==null?void 0:p.details)||"Erro ao emitir recibo")}const ce=()=>{const r=k("user-service"),e=k("ordem-button");r.value=null,f.value=!0,e.value=f.value};return he(()=>{xe(async()=>{const r=sessionStorage.getItem("pesquisaOS");if(r){const e=JSON.parse(r);Object.assign(l,e)}await G()})}),re(),se(),(r,e)=>{const s=pe,c=_e,D=Me,p=we("mask");return P(),te(K,{class:"mt-5",style:{width:"100%"}},{default:n(()=>[a(A,{class:"mb-5"},{default:n(()=>[e[16]||(e[16]=i("h1",null,"Ordens de Serviço",-1)),a(s,{to:"/os/criar-registro"},{default:n(()=>[i("img",{style:{width:"60px",height:"60px",cursor:"pointer","margin-left":"70px"},src:Oe,alt:"novo",onClick:ce})]),_:1})]),_:1}),a(A,{style:{"margin-bottom":"-35px"}},{default:n(()=>[a(m,null,{default:n(()=>[a(v,{modelValue:o(l).numero,"onUpdate:modelValue":e[0]||(e[0]=t=>o(l).numero=t),label:"Número"},null,8,["modelValue"])]),_:1}),a(m,null,{default:n(()=>[q(a(v,{modelValue:o(l).data_inicio,"onUpdate:modelValue":e[1]||(e[1]=t=>o(l).data_inicio=t),label:"Abertura de",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[p,"##/##/####"]])]),_:1}),a(m,null,{default:n(()=>[q(a(v,{modelValue:o(l).data_fim,"onUpdate:modelValue":e[2]||(e[2]=t=>o(l).data_fim=t),label:"Abertura até",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[p,"##/##/####"]])]),_:1}),a(m,null,{default:n(()=>[q(a(v,{modelValue:o(l).data_lavratura_inicio,"onUpdate:modelValue":e[3]||(e[3]=t=>o(l).data_lavratura_inicio=t),label:"Lavratura de",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[p,"##/##/####"]])]),_:1}),a(m,null,{default:n(()=>[q(a(v,{modelValue:o(l).data_lavratura_fim,"onUpdate:modelValue":e[4]||(e[4]=t=>o(l).data_lavratura_fim=t),label:"Lavratura até",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[p,"##/##/####"]])]),_:1}),a(m,null,{default:n(()=>[a(v,{modelValue:o(l).protocolo,"onUpdate:modelValue":e[5]||(e[5]=t=>o(l).protocolo=t),label:"Protocolo"},null,8,["modelValue"])]),_:1}),a(m,{md:"1"},{default:n(()=>[a(v,{modelValue:o(l).livro,"onUpdate:modelValue":e[6]||(e[6]=t=>o(l).livro=t),label:"Livro"},null,8,["modelValue"])]),_:1}),a(m,{md:"1"},{default:n(()=>[a(v,{modelValue:o(l).folha,"onUpdate:modelValue":e[7]||(e[7]=t=>o(l).folha=t),label:"Folha"},null,8,["modelValue"])]),_:1})]),_:1}),a(A,null,{default:n(()=>[a(m,{md:"3"},{default:n(()=>[a(j,{modelValue:o(l).situacao,"onUpdate:modelValue":e[8]||(e[8]=t=>o(l).situacao=t),items:o(R),label:"Situação"},null,8,["modelValue","items"])]),_:1}),a(m,{md:"2"},{default:n(()=>[a(j,{items:o(T),modelValue:o(l).usuario_token,"onUpdate:modelValue":e[9]||(e[9]=t=>o(l).usuario_token=t),"item-title":"user_nome","item-value":"user_token",label:"Usuario"},null,8,["items","modelValue"])]),_:1}),a(m,{md:"1"},{default:n(()=>[a(v,{modelValue:o(l).selo,"onUpdate:modelValue":e[10]||(e[10]=t=>o(l).selo=t),label:"Selo"},null,8,["modelValue"])]),_:1}),a(m,{md:"3"},{default:n(()=>[a(j,{modelValue:o(l).ato_tipo_token,"onUpdate:modelValue":e[11]||(e[11]=t=>o(l).ato_tipo_token=t),items:o(x),"item-title":"descricao","item-value":"token",label:"Serviço"},null,8,["modelValue","items"])]),_:1}),a(m,{md:"2"},{default:n(()=>[a(v,{modelValue:o(l).apresentante,"onUpdate:modelValue":e[12]||(e[12]=t=>o(l).apresentante=t),label:"Apresentante"},null,8,["modelValue"])]),_:1}),a(m,null,{default:n(()=>[i("div",null,[i("img",{onClick:ne,style:{width:"40px",height:"40px",cursor:"pointer"},src:De,alt:"Pesquisar"})])]),_:1})]),_:1}),e[17]||(e[17]=i("hr",{class:"mt-5 mb-5"},null,-1)),a(qe,{headers:le,style:{"min-width":"1230px","font-size":"12px"},items:o(V),"item-key":"id"},{"item.actions":n(({item:t})=>[a(A,{style:{display:"flex",gap:"2px","margin-top":"-5px"}},{default:n(()=>[i("div",{class:F({disabled:!t.btn_receber}),title:t.btn_receber?"Receber":"Bloqueado",onClick:U=>t.btn_receber?de(t.numero,t):null},[i("img",{style:E({cursor:t.btn_receber?"pointer":"default",width:"30px",height:"30px"}),src:Ue,alt:"Receber"},null,4)],10,ze),i("div",{class:F({disabled:!t.btn_editar}),onClick:U=>t.btn_editar?ue(t.id):null,title:t.btn_editar?"Editar":"Bloqueado"},[i("img",{style:E({cursor:t.btn_editar?"pointer":"default",width:"30px",height:"30px"}),src:Ae,alt:"Editar"},null,4)],10,Le),i("div",{class:F({disabled:!t.btn_recibo}),onClick:U=>t.btn_recibo?me(t.token):null,title:t.btn_recibo?"Emitir Recibo":"Bloqueado"},[i("img",{style:E({cursor:t.btn_recibo?"pointer":"default",width:"30px",height:"30px"}),src:Te,alt:"Emitir Recibo"},null,4)],10,Je),i("div",{disabled:!t.btn_cancelar,onClick:U=>t.btn_cancelar?ie(t):null,title:"Cancelamento",style:E({opacity:t.btn_cancelar?1:.5,cursor:t.btn_cancelar?"pointer":"not-allowed"})},[t.excluido?(P(),H("img",je)):(P(),H("img",Ke))],12,Fe)]),_:2},1024)]),_:1},8,["items"]),a(c,{show:o(N),numero_os:o(_),ordem:o(Y),onClose:e[13]||(e[13]=t=>N.value=!1),onRefreshValue:e[14]||(e[14]=t=>G())},null,8,["show","numero_os","ordem"]),a(D,{show:o(O),numero_os:o(_),ordemserv_token:o(d),onClose:e[15]||(e[15]=t=>O.value=!1)},null,8,["show","numero_os","ordemserv_token"])]),_:1})}}};export{ht as default};
