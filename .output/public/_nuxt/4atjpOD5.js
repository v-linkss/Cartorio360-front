import{n as K,u as Q,A as v,r as ee,s as ae,B as oe,O as te,o as b,c as q,x as e,v as z,H as se,t as le,I as S,w as l,b as s,V as m,P as y,y as A,d as D,J as ie,z as de}from"./BdsXM0rV.js";import{b as re,u as E}from"./D4jIaOYQ.js";import{c as P,r as I,u as ne}from"./Bk4MamAz.js";import{c as me}from"./D6kuDPDP.js";import{V as c}from"./CELWtY7F.js";import{V as d}from"./CLSph13w.js";import{V as k}from"./BI7QHU8P.js";import{V as ue}from"./CdGSzGMv.js";const ce={key:1},ye={__name:"Dados",props:{isModal:{type:Boolean,default:!1}},emits:["saved","close-modal"],async setup(O,{emit:R}){let V,U;const w=O,g=R,M=K(),{$toast:p}=Q(),f=de(),T=`${f.public.managemant}/createPessoa`,H=`${f.public.managemant}/updatePessoa`,L=`${f.public.managemant}/listarEstadoCivil`,h=`${f.public.managemant}/listarCapacidadeCivil`,j=`${f.public.managemant}/listarCidades`,J={nome:"",nome_pai:"",nome_mae:"",profissao:"",local_trabalho:"",data_nascimento:"",doc_identificacao:"",cpf_pai:"",cpf_mae:"",tipo_pessoa:"FISICA",tabvalores_estadocivil_id:"",tabvalores_capacidadecivil_id:"",cidade_natural_id:"",cartorio_id:v("user-data").value.cartorio_id,user_id:v("user-data").value.usuario_id},B=ee(!1),F=v("pessoa-id"),o=ae({...J});function _(i){if(i)return i.replace(/[.\-]/g,"");i=null}const{data:C,status:pe,pending:x,error:N}=([V,U]=oe(async()=>re("cliente-dados",async()=>{const[i,t,n]=await Promise.all([$fetch(L),$fetch(h),$fetch(j)]);return{estadoCivilItems:i,capacidadeCivilItems:t,cidadeNascimentoItems:n}})),V=await V,U(),V),W={nome:{required:P.withMessage("O campo é obrigatorio",I)},nome_mae:{required:P.withMessage("O campo é obrigatorio",I)},doc_identificacao:{required:P.withMessage("O campo é obrigatorio",I),cpf:me}},r=ne(W,o);async function X(){if(await r.value.$validate()){const i={...o};for(const u in i)i[u]===""&&(i[u]=null);const t={...i,doc_identificacao:_(o.doc_identificacao),cpf_pai:_(o.cpf_pai),cpf_mae:_(o.cpf_mae)},{data:n,error:a,status:$}=await E(T,{method:"POST",body:t},"$fcbWHpl5XR");if($.value==="error"&&a.value.statusCode===500)p.error("Erro ao cadastrar pessoa,o CPF já está cadastrado.");else{p.success("Pessoa cadastrada com sucesso!");const u=n.value.id;F.value=u;const G=v("pessoa_token");G.value=n.value.token,B.value=!0,g("saved")}}else p.error("Erro ao cadastrar pessoa, preencha os campos obrigatorios.")}async function Y(){const i={...o};for(const u in i)i[u]===""&&(i[u]=null);const t={...i,doc_identificacao:_(o.doc_identificacao),cpf_mae:_(o.cpf_mae)},{data:n,error:a,status:$}=await E(`${H}/${F.value}`,{method:"PUT",body:t},"$S30ZRYxneo");if($.value==="success"){if(w.isModal===!0){p.success("Pessoa atualizada com sucesso!"),g("close-modal");return}p.success("Pessoa atualizada com sucesso!"),M.push("/pessoas/lista")}}const Z=()=>{if(w.isModal===!0){g("close-modal");return}M.push("/pessoas/lista")};return(i,t)=>{const n=te("mask");return b(),q(ie,null,[e(x)?(b(),z(se,{key:0,class:"loading-spinner",indeterminate:"",size:"64"})):e(N)?(b(),q("div",ce,le(e(N).message),1)):S("",!0),e(x)?S("",!0):(b(),z(ue,{key:2},{default:l(()=>[s(c,null,{default:l(()=>[s(d,{md:"8"},{default:l(()=>[s(m,{modelValue:e(o).nome,"onUpdate:modelValue":t[0]||(t[0]=a=>e(o).nome=a),"error-messages":e(r).nome.$errors.map(a=>a.$message),label:"Nome",required:"",onBlur:e(r).nome.$touch,onInput:e(r).nome.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1}),s(d,{md:"4"},{default:l(()=>[y(s(m,{modelValue:e(o).doc_identificacao,"onUpdate:modelValue":t[1]||(t[1]=a=>e(o).doc_identificacao=a),"error-messages":e(r).doc_identificacao.$errors.map(a=>a.$message),label:"CPF",required:"",onBlur:e(r).doc_identificacao.$touch,onInput:e(r).doc_identificacao.$touch},null,8,["modelValue","error-messages","onBlur","onInput"]),[[n,"###.###.###-##"]])]),_:1})]),_:1}),s(c,null,{default:l(()=>[s(d,{md:"4"},{default:l(()=>[s(k,{modelValue:e(o).tabvalores_estadocivil_id,"onUpdate:modelValue":t[2]||(t[2]=a=>e(o).tabvalores_estadocivil_id=a),items:e(C).estadoCivilItems,"item-title":"descricao","item-value":"id",label:"Estado Civil"},null,8,["modelValue","items"])]),_:1}),s(d,{md:"4"},{default:l(()=>[s(m,{modelValue:e(o).profissao,"onUpdate:modelValue":t[3]||(t[3]=a=>e(o).profissao=a),label:"Profissão"},null,8,["modelValue"])]),_:1}),s(d,{md:"4"},{default:l(()=>[s(m,{modelValue:e(o).local_trabalho,"onUpdate:modelValue":t[4]||(t[4]=a=>e(o).local_trabalho=a),label:"Local de trabalho"},null,8,["modelValue"])]),_:1})]),_:1}),s(c,null,{default:l(()=>[s(d,{md:"4"},{default:l(()=>[s(m,{modelValue:e(o).data_nascimento,"onUpdate:modelValue":t[5]||(t[5]=a=>e(o).data_nascimento=a),type:"date","prepend-icon":"",label:"Data de nascimento"},null,8,["modelValue"])]),_:1}),s(d,{md:"4"},{default:l(()=>[s(k,{modelValue:e(o).tabvalores_capacidadecivil_id,"onUpdate:modelValue":t[6]||(t[6]=a=>e(o).tabvalores_capacidadecivil_id=a),items:e(C).capacidadeCivilItems,label:"Capacidade Civil","item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1}),s(d,{md:"4"},{default:l(()=>[s(k,{modelValue:e(o).cidade_natural_id,"onUpdate:modelValue":t[7]||(t[7]=a=>e(o).cidade_natural_id=a),items:e(C).cidadeNascimentoItems,label:"Cidade de nascimento","item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1})]),_:1}),s(c,null,{default:l(()=>[s(d,{md:"4"},{default:l(()=>[y(s(m,{modelValue:e(o).cpf_pai,"onUpdate:modelValue":t[8]||(t[8]=a=>e(o).cpf_pai=a),modelModifiers:{date:!0},label:"CPF do Pai"},null,8,["modelValue"]),[[n,"###.###.###-##"]])]),_:1}),s(d,{md:"4"},{default:l(()=>[s(m,{modelValue:e(o).nome_pai,"onUpdate:modelValue":t[9]||(t[9]=a=>e(o).nome_pai=a),modelModifiers:{date:!0},label:"Nome do Pai"},null,8,["modelValue"])]),_:1})]),_:1}),s(c,null,{default:l(()=>[s(d,{md:"4"},{default:l(()=>[y(s(m,{modelValue:e(o).cpf_mae,"onUpdate:modelValue":t[10]||(t[10]=a=>e(o).cpf_mae=a),modelModifiers:{date:!0},label:"CPF da Mãe"},null,8,["modelValue"]),[[n,"###.###.###-##"]])]),_:1}),s(d,{md:"4"},{default:l(()=>[s(m,{modelValue:e(o).nome_mae,"onUpdate:modelValue":t[11]||(t[11]=a=>e(o).nome_mae=a),modelModifiers:{date:!0},"error-messages":e(r).nome_mae.$errors.map(a=>a.$message),label:"Nome da Mãe",required:"",onBlur:e(r).nome_mae.$touch,onInput:e(r).nome_mae.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1})]),_:1}),s(c,{class:"mb-3"},{default:l(()=>[s(A,{onClick:Z,size:"large",color:"red"},{default:l(()=>[D("Voltar")]),_:1}),s(A,{onClick:t[12]||(t[12]=a=>e(B)?Y():X()),class:"ml-4",size:"large",color:"green"},{default:l(()=>[D("Salvar")]),_:1})]),_:1})]),_:1}))],64)}}};export{ye as _};
