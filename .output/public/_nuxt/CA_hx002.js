import{_ as ye}from"./DFk8q-ed.js";import{_ as he}from"./CJsaZUPN.js";import{_ as Ve}from"./D64PPtok.js";import{_ as ge,r as l,g as we,o as w,h as oe,w as s,b as o,a as m,t as G,i as t,s as O,j as X,H as be,c as R,p as te,V as z,d as D,D as xe,J as Ce,u as $e,e as q,f as qe,y as Pe,F as Ae,k as Me}from"./BZTclJb_.js";import{V as Te,a as Fe,c as Ee}from"./BbhQUv3T.js";import{V as Se}from"./P7giLpGY.js";import{_ as Ne}from"./BS6dDNxh.js";import{_ as ae}from"./CCt5G1nV.js";import{_ as Oe}from"./BVz1G1IN.js";import{_ as Re}from"./Dc0HOzaK.js";import{a as ze}from"./DJvq3mCv.js";import{u as V}from"./C9ebrkvE.js";import{V as N}from"./DtsFxz_M.js";import{V as g}from"./CaF9n5dG.js";import{V as De}from"./BhsWa34n.js";import{V as ee}from"./7A7nJpbM.js";import"./vVYenxr7.js";import"./rOetZX8l.js";import"./D-aitGgy.js";import"./Cu6b8Ug_.js";import"./B0IxRygJ.js";import"./7CP29JCH.js";import"./BMAdM1Mt.js";import"./CntSlUwr.js";import"./CjKRLbzV.js";import"./C2bYHPI9.js";import"./Czey38Ht.js";import"./C7BdYCS9.js";import"./DXmBznUb.js";import"./Bt59RBeI.js";const je={class:"random-numbers"},Be={key:0,class:"error-message"},Ue={__name:"ValidadorAutencidade",props:{show:Boolean},emits:["close","confirm"],setup(j,{emit:B}){const y=j,b=B,d=l(y.show),h=l([]),p=l(""),v=l("");function f(){h.value=[];for(let _=0;_<4;_++)h.value.push(Math.floor(Math.random()*10))}we(()=>y.show,_=>{d.value=_,_&&(f(),p.value="",v.value="")});const P=()=>{d.value=!1,b("close")},A=()=>{p.value===h.value.join("")?(v.value="",d.value=!1,b("confirm")):v.value="Números digitados incorretos. Tente novamente."};return(_,u)=>(w(),oe(Se,{persistent:"",modelValue:t(d),"onUpdate:modelValue":u[1]||(u[1]=x=>X(d)?d.value=x:null),"max-width":"500"},{default:s(()=>[o(Te,null,{default:s(()=>[o(Fe,null,{default:s(()=>[m("div",null,[u[2]||(u[2]=m("p",null," Digite o código de validação para confirmar o ato de reconhecimento por autenticidade: ",-1)),m("div",je,[m("span",null,G(t(h).join(" ")),1)]),o(O,{modelValue:t(p),"onUpdate:modelValue":u[0]||(u[0]=x=>X(p)?p.value=x:null),label:"Digite os números",maxlength:"4",outlined:"",dense:"",onKeyup:be(A,["enter"])},null,8,["modelValue"]),t(v)?(w(),R("div",Be,G(t(v)),1)):te("",!0)])]),_:1}),o(Ee,null,{default:s(()=>[o(z,{style:{"background-color":"red",color:"white"},onClick:P},{default:s(()=>u[3]||(u[3]=[D("Cancelar")])),_:1}),o(z,{style:{"background-color":"green",color:"white"},onClick:A},{default:s(()=>u[4]||(u[4]=[D("Validar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ie=ge(Ue,[["__scopeId","data-v-ca5b7e48"]]),Ke=["onClick"],Ze={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:ae,alt:"Possui Ficha",title:"Possui Ficha"},He={key:1,style:{width:"30px",height:"30px",cursor:"pointer"},src:Re,alt:"Visualizar",title:"Não Possui Ficha"},We=["onClick"],Co={__name:"autencidade",props:{ato_token:{type:String,required:!0}},emits:["ato-created"],async setup(j,{emit:B}){var Y;let y,b;const d=j,h=B,p=xe(),v=Ce(),f=Me(),{$toast:P}=$e(),A=`${f.public.managemant}/listarEscrevente`,_=`${f.public.managemant}/pesquisarPessoas`,u=`${f.public.managemant}/atoReconhecimento`,x=`${f.public.managemant}/etiquetaAutenticidade`,se=`${f.public.managemant}/download`,ne=`${f.public.envioDoc}/print`,M=l(q("user-data").value.cartorio_token),le=l(q("user-service").value.token).value||l(q("user-service").value).value,re=q("auth_token").value,U=l([]),H=l([]),C=l([]),T=l(!1),I=l(!1),F=l(!1),E=l(null),W=l(null),K=l(""),S=l(!1),L=[{title:"Documento",align:"start",key:"documento"},{title:"Pessoa",align:"start",key:"nome"},{value:"actions"}],i=qe({quantidade:1,escrevente:null,nome:null,documento:null}),{data:Q}=([y,b]=Pe(()=>V(A,{method:"POST",body:{cartorio_token:M}},"$qpB20nOlUE")),y=await y,b(),y);H.value=Array.isArray(Q.value)&&((Y=Q.value[0])==null?void 0:Y.func_json_escreventes)||[];async function ie(){try{const{data:n,error:e}=await V(_,{method:"POST",body:{cartorio_token:M.value,documento:i.documento,nome:i.nome}},"$CfpM9wZnUE");n.value.length>0?(h("ato-created"),U.value=n.value):U.value=[]}catch(n){console.error("Erro na requisição",n)}}const ue=()=>{I.value=!0};function ce(n){C.value.push(n)}const me=async n=>{E.value=n,F.value=!0;const{data:e}=await V(se,{method:"POST",body:{bucket:q("user-data").value.cartorio_token,path:n.link_ficha}},"$LrKAtpxZwH");W.value=e.value};function de(n){C.value=C.value.filter(e=>e.token!==n.token)}function pe(){S.value=!0}function ve(){S.value=!1,fe()}async function fe(){var n,e,$;if(!i.escrevente){P.error("Por favor selecione um Escrevente");return}try{const k=C.value.map(a=>({pessoa_token:a.token})),{data:r,error:c,status:Z}=await V(u,{method:"POST",body:{pessoas:k,cartorio_token:M.value,ordemserv_token:le,quantidade:i.quantidade,usuario_token:re,ato_tipo_token:d.ato_token}},"$EE94jKo1pQ");if(Z.value==="success"&&r.value[0].status==="OK"){if(r.value[0].livro&&r.value[0].livro!==null){const a=window.open("","_blank");a.document.open(),a.document.write(r.value[0].livro),a.document.close()}_e(r.value[0].token),J()}else T.value=!0,K.value=Array.isArray(r.value)&&((n=r.value[0])==null?void 0:n.status_mensagem)||(($=(e=c==null?void 0:c.value)==null?void 0:e.data)==null?void 0:$.details)||"Não foi possível concluir o reconhecimento"}catch(k){T.value=!0,K.value=k,console.error("Erro na requisição",k)}}async function _e(n){try{const{data:e,error:$,status:k}=await V(x,{method:"POST",body:{ato_token:n,cartorio_token:M.value,escrevente_token:i.escrevente}},"$KyoIzBxZyr");if(k.value==="success"){const r=Array.isArray(e.value)?e.value[0]:null;if(!r)return;if(r.tipo_etiqueta==="html"){const c=window.open("","_blank");c.document.open(),c.document.write(r.etiqueta),c.document.close()}else if(r.tipo_etiqueta==="zpl"){const{status:c}=await V(`${ne}`,{method:"POST",body:{zpl:atob(r.etiqueta)}},"$Vem9mHWYqw");if(c.value!=="success"){P.error("Não foi possivel fazer a impressao da etiqueta");return}}}}catch(e){console.error("Erro na requisição",e)}}const J=()=>{const n=v.query.origem||"criar",e=v.query.id;n==="atualizar"?p.push(`/os/atualizar/${e}`):p.push("/os/criar-registro")};return(n,e)=>{const $=ye,k=he,r=Ve,c=Ie,Z=Ne;return w(),R(Ae,null,[o(N,{class:"mt-5"},{default:s(()=>[o(g,{cols:"5"},{default:s(()=>[o(De,{label:"Tabelião/escrevente",modelValue:t(i).escrevente,"onUpdate:modelValue":e[0]||(e[0]=a=>t(i).escrevente=a),items:t(H),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"])]),_:1}),o(g,{cols:"2"},{default:s(()=>[o(O,{label:"Quantidade",type:"number",modelValue:t(i).quantidade,"onUpdate:modelValue":e[1]||(e[1]=a=>t(i).quantidade=a)},null,8,["modelValue"])]),_:1})]),_:1}),o(N,null,{default:s(()=>[o(g,{cols:"3"},{default:s(()=>[o(O,{label:"Documento",modelValue:t(i).documento,"onUpdate:modelValue":e[2]||(e[2]=a=>t(i).documento=a)},null,8,["modelValue"])]),_:1}),o(g,{cols:"4"},{default:s(()=>[o(O,{label:"Pessoa",modelValue:t(i).nome,"onUpdate:modelValue":e[3]||(e[3]=a=>t(i).nome=a)},null,8,["modelValue"])]),_:1}),m("div",null,[m("img",{class:"btn-pointer mt-1",src:ae,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:ie})]),m("div",null,[m("img",{class:"btn-pointer mt-1 ml-2",src:Oe,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:ue})])]),_:1}),o(N,null,{default:s(()=>[o(g,{class:"mr-10"},{default:s(()=>[o(ee,{style:{height:"465px"},headers:L,items:t(U)},{"item.actions":s(({item:a})=>[m("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ke=>me(a),title:"Visualizar Ficha"},[a.link_ficha?(w(),R("img",Ze)):(w(),R("img",He))],8,Ke)]),_:1},8,["items"])]),_:1}),o(g,null,{default:s(()=>[o(ee,{headers:L,items:t(C),style:{height:"465px"},"item-key":"id"},{"item.actions":s(({item:a})=>[m("div",{style:{display:"flex","justify-content":"flex-end"},onClick:ke=>de(a),title:"Remover"},e[9]||(e[9]=[m("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ze,alt:"Remover"},null,-1)]),8,We)]),_:1},8,["items"])]),_:1})]),_:1}),o($,{show:t(I),onClose:e[4]||(e[4]=a=>I.value=!1)},null,8,["show"]),t(F)?(w(),oe(k,{key:0,show:t(F),item:t(E),"pessoa-obj":t(E),"link-view":t(W),onConfirmar:e[5]||(e[5]=a=>ce(t(E))),onClose:e[6]||(e[6]=a=>F.value=!1)},null,8,["show","item","pessoa-obj","link-view"])):te("",!0),o(r,{show:t(T),errorMessage:t(K),onClose:e[7]||(e[7]=a=>T.value=!1)},null,8,["show","errorMessage"]),o(c,{show:t(S),onClose:e[8]||(e[8]=a=>S.value=!1),onConfirm:ve},null,8,["show"]),o(N,null,{default:s(()=>[o(Z,{onClick:J},{default:s(()=>[o(z,{size:"large",color:"red"},{default:s(()=>e[10]||(e[10]=[D("Voltar")])),_:1})]),_:1}),o(z,{class:"ml-5",onClick:pe,size:"large",color:"green"},{default:s(()=>e[11]||(e[11]=[D("Salvar")])),_:1})]),_:1})],64)}}};export{Co as default};
