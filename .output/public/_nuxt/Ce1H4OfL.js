import{_ as ye}from"./CveRzgwu.js";import{_ as he}from"./LlrEGSt_.js";import{_ as Ve}from"./CLNckwQV.js";import{_ as ge,r,g as we,o as w,h as te,w as a,b as o,a as m,t as X,i as t,s as R,j as ee,H as be,c as z,p as ae,V as D,d as j,D as xe,J as Ce,u as $e,e as P,f as qe,y as Pe,F as Ae,k as Me}from"./CE_Z_Q1m.js";import{V as Te,a as Fe,c as Ee}from"./RhijkCjD.js";import{V as Se}from"./BbdB_SlY.js";import{_ as Ne}from"./CnnVmrZ3.js";import{_ as se}from"./CkNF_X04.js";import{_ as Oe}from"./BVz1G1IN.js";import{_ as Re}from"./7som2ZMc.js";import{a as ze}from"./DJvq3mCv.js";import{u as V}from"./C-fuW29Y.js";import{V as O}from"./CObd9iKH.js";import{V as g}from"./L1BjcEvj.js";import{V as De}from"./BUhdsDRD.js";import{V as oe}from"./Cjizio9i.js";import"./edE1qQJg.js";import"./BSU5Y4W3.js";import"./khlhitt8.js";import"./BXxAu5_5.js";import"./B0IxRygJ.js";import"./41_X6XI1.js";import"./FhZXU7Xg.js";import"./ezJXA2xo.js";import"./Ch3Qs312.js";import"./Cd5ieBGQ.js";import"./BSFnJPeC.js";import"./BVCDJCWx.js";import"./HC5r4VER.js";import"./Bi3YZu2a.js";const je={class:"random-numbers"},Be={key:0,class:"error-message"},Ue={__name:"ValidadorAutencidade",props:{show:Boolean},emits:["close","confirm"],setup(B,{emit:U}){const k=B,b=U,d=r(k.show),y=r([]),p=r(""),v=r("");function f(){y.value=[];for(let _=0;_<4;_++)y.value.push(Math.floor(Math.random()*10))}we(()=>k.show,_=>{d.value=_,_&&(f(),p.value="",v.value="")});const A=()=>{d.value=!1,b("close")},M=()=>{p.value===y.value.join("")?(v.value="",d.value=!1,b("confirm")):v.value="Números digitados incorretos. Tente novamente."};return(_,u)=>(w(),te(Se,{persistent:"",modelValue:t(d),"onUpdate:modelValue":u[1]||(u[1]=x=>ee(d)?d.value=x:null),"max-width":"500"},{default:a(()=>[o(Te,null,{default:a(()=>[o(Fe,null,{default:a(()=>[m("div",null,[u[2]||(u[2]=m("p",null," Digite o código de validação para confirmar o ato de reconhecimento por autenticidade: ",-1)),m("div",je,[m("span",null,X(t(y).join(" ")),1)]),o(R,{modelValue:t(p),"onUpdate:modelValue":u[0]||(u[0]=x=>ee(p)?p.value=x:null),label:"Digite os números",maxlength:"4",outlined:"",dense:"",onKeyup:be(M,["enter"])},null,8,["modelValue"]),t(v)?(w(),z("div",Be,X(t(v)),1)):ae("",!0)])]),_:1}),o(Ee,null,{default:a(()=>[o(D,{style:{"background-color":"red",color:"white"},onClick:A},{default:a(()=>u[3]||(u[3]=[j("Cancelar")])),_:1}),o(D,{style:{"background-color":"green",color:"white"},onClick:M},{default:a(()=>u[4]||(u[4]=[j("Validar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ie=ge(Ue,[["__scopeId","data-v-ca5b7e48"]]),Ke=["onClick"],Ze={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:se,alt:"Possui Ficha",title:"Possui Ficha"},He={key:1,style:{width:"30px",height:"30px",cursor:"pointer"},src:Re,alt:"Visualizar",title:"Não Possui Ficha"},Le=["onClick"],Co={__name:"autencidade",props:{ato_token:{type:String,required:!0}},emits:["ato-created"],async setup(B,{emit:U}){var G;let k,b;const d=B,y=U,p=xe(),v=Ce(),f=Me(),{$toast:A}=$e(),M=`${f.public.managemant}/listarEscrevente`,_=`${f.public.managemant}/pesquisarPessoas`,u=`${f.public.managemant}/atoReconhecimento`,x=`${f.public.managemant}/etiquetaAutenticidade`,ne=`${f.public.managemant}/download`,re=`${f.public.envioDoc}/print`,T=r(P("user-data").value.cartorio_token),le=r(P("user-service").value.token).value||r(P("user-service").value).value,ie=P("auth_token").value,I=r([]),L=r([]),C=r([]),F=r(!1),K=r(!1),E=r(!1),S=r(null),Q=r(null),Z=r(""),N=r(!1),W=[{title:"Documento",align:"start",key:"documento"},{title:"Pessoa",align:"start",key:"nome"},{value:"actions"}],l=qe({quantidade:1,escrevente:null,nome:null,documento:null}),{data:J}=([k,b]=Pe(()=>V(M,{method:"POST",body:{cartorio_token:T}},"$qpB20nOlUE")),k=await k,b(),k);L.value=Array.isArray(J.value)&&((G=J.value[0])==null?void 0:G.func_json_escreventes)||[];async function ue(){try{const{data:s,error:e}=await V(_,{method:"POST",body:{cartorio_token:T.value,documento:l.documento,nome:l.nome}},"$CfpM9wZnUE");s.value.length>0?(y("ato-created"),I.value=s.value):I.value=[]}catch(s){console.error("Erro na requisição",s)}}const ce=()=>{K.value=!0};function me(s){C.value.push(s)}const de=async s=>{S.value=s,E.value=!0;const{data:e}=await V(ne,{method:"POST",body:{bucket:P("user-data").value.cartorio_token,path:s.link_ficha}},"$LrKAtpxZwH");Q.value=e.value};function pe(s){C.value=C.value.filter(e=>e.token!==s.token)}function ve(){N.value=!0}function fe(){N.value=!1,_e()}async function _e(){var s,e,$,h;if(!l.escrevente){A.error("Por favor selecione um Escrevente");return}try{const c=C.value.map(H=>({pessoa_token:H.token})),{data:i,error:q,status:n}=await V(u,{method:"POST",body:{pessoas:c,cartorio_token:T.value,ordemserv_token:le,quantidade:l.quantidade,usuario_token:ie,ato_tipo_token:d.ato_token}},"$EE94jKo1pQ");n.value==="success"&&Array.isArray(i.value)&&((s=i.value[0])==null?void 0:s.status)==="OK"?(ke(i.value[0].token),Y()):(F.value=!0,Z.value=Array.isArray(i.value)&&((e=i.value[0])==null?void 0:e.status_mensagem)||((h=($=q==null?void 0:q.value)==null?void 0:$.data)==null?void 0:h.details)||"Não foi possível concluir o reconhecimento")}catch(c){F.value=!0,Z.value=c,console.error("Erro na requisição",c)}}async function ke(s){try{const{data:e,error:$,status:h}=await V(x,{method:"POST",body:{ato_token:s,cartorio_token:T.value,escrevente_token:l.escrevente}},"$KyoIzBxZyr");if(h.value==="success"){const c=Array.isArray(e.value)?e.value[0]:null;if(!c)return;if(c.tipo_etiqueta==="html"){const i=window.open("","_blank");i.document.open(),i.document.write(c.etiqueta),i.document.close()}else if(c.tipo_etiqueta==="zpl"){const{status:i}=await V(`${re}`,{method:"POST",body:{zpl:atob(c.etiqueta)}},"$Vem9mHWYqw");if(i.value!=="success"){A.error("Não foi possivel fazer a impressao da etiqueta");return}}}}catch(e){console.error("Erro na requisição",e)}}const Y=()=>{const s=v.query.origem||"criar",e=v.query.id;s==="atualizar"?p.push(`/os/atualizar/${e}`):p.push("/os/criar-registro")};return(s,e)=>{const $=ye,h=he,c=Ve,i=Ie,q=Ne;return w(),z(Ae,null,[o(O,{class:"mt-5"},{default:a(()=>[o(g,{cols:"5"},{default:a(()=>[o(De,{label:"Tabelião/escrevente",modelValue:t(l).escrevente,"onUpdate:modelValue":e[0]||(e[0]=n=>t(l).escrevente=n),items:t(L),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"])]),_:1}),o(g,{cols:"2"},{default:a(()=>[o(R,{label:"Quantidade",type:"number",modelValue:t(l).quantidade,"onUpdate:modelValue":e[1]||(e[1]=n=>t(l).quantidade=n)},null,8,["modelValue"])]),_:1})]),_:1}),o(O,null,{default:a(()=>[o(g,{cols:"3"},{default:a(()=>[o(R,{label:"Documento",modelValue:t(l).documento,"onUpdate:modelValue":e[2]||(e[2]=n=>t(l).documento=n)},null,8,["modelValue"])]),_:1}),o(g,{cols:"4"},{default:a(()=>[o(R,{label:"Pessoa",modelValue:t(l).nome,"onUpdate:modelValue":e[3]||(e[3]=n=>t(l).nome=n)},null,8,["modelValue"])]),_:1}),m("div",null,[m("img",{class:"btn-pointer mt-1",src:se,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:ue})]),m("div",null,[m("img",{class:"btn-pointer mt-1 ml-2",src:Oe,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:ce})])]),_:1}),o(O,null,{default:a(()=>[o(g,{class:"mr-10"},{default:a(()=>[o(oe,{style:{height:"465px"},headers:W,items:t(I)},{"item.actions":a(({item:n})=>[m("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:H=>de(n),title:"Visualizar Ficha"},[n.link_ficha?(w(),z("img",Ze)):(w(),z("img",He))],8,Ke)]),_:1},8,["items"])]),_:1}),o(g,null,{default:a(()=>[o(oe,{headers:W,items:t(C),style:{height:"465px"},"item-key":"id"},{"item.actions":a(({item:n})=>[m("div",{style:{display:"flex","justify-content":"flex-end"},onClick:H=>pe(n),title:"Remover"},e[9]||(e[9]=[m("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ze,alt:"Remover"},null,-1)]),8,Le)]),_:1},8,["items"])]),_:1})]),_:1}),o($,{show:t(K),onClose:e[4]||(e[4]=n=>K.value=!1)},null,8,["show"]),t(E)?(w(),te(h,{key:0,show:t(E),item:t(S),"pessoa-obj":t(S),"link-view":t(Q),onConfirmar:e[5]||(e[5]=n=>me(t(S))),onClose:e[6]||(e[6]=n=>E.value=!1)},null,8,["show","item","pessoa-obj","link-view"])):ae("",!0),o(c,{show:t(F),errorMessage:t(Z),onClose:e[7]||(e[7]=n=>F.value=!1)},null,8,["show","errorMessage"]),o(i,{show:t(N),onClose:e[8]||(e[8]=n=>N.value=!1),onConfirm:fe},null,8,["show"]),o(O,null,{default:a(()=>[o(q,{onClick:Y},{default:a(()=>[o(D,{size:"large",color:"red"},{default:a(()=>e[10]||(e[10]=[j("Voltar")])),_:1})]),_:1}),o(D,{class:"ml-5",onClick:ve,size:"large",color:"green"},{default:a(()=>e[11]||(e[11]=[j("Salvar")])),_:1})]),_:1})],64)}}};export{Co as default};
