import{c as N,r as T,u as ie}from"./R9AiVlHe.js";import"./1-XPrqeL.js";import{L as de,M as ne,u as re,m as C,r as D,n as ue,D as me,p as ce,s as pe,o as y,c as z,v as e,x as A,P as fe,t as _e,y as R,w as t,b as s,V as n,A as $,E as q,d as O,F as ve,z as Ve}from"./Dg-eFJyq.js";import{$ as V,f as U}from"./pa1sK5kZ.js";import{u as be}from"./6IJ0kgvk.js";import{a as ge}from"./B0IxRygJ.js";import{V as p}from"./Cz8yEchp.js";import{V as d}from"./B-FCuE96.js";import{V as x}from"./DKdoBUSy.js";import{V as Ce}from"./Bs6MLVTE.js";import{V as ye}from"./DKNva2nt.js";const $e={key:1},Te={__name:"DadosEstrangeira",props:{isModal:{type:Boolean,default:!1}},emits:["saved","close-modal"],async setup(L,{emit:j}){let b,w;const E=L,P=j,M=de(),G=ne(),{$toast:f}=re(),u=Ve(),W=`${u.public.auth}/service/gerencia/getPessoaById`,H=`${u.public.auth}/service/gerencia/createPessoa`,J=`${u.public.auth}/service/gerencia/updatePessoa`,K=`${u.public.auth}/service/gerencia/listarEstadoCivil`,Q=`${u.public.auth}/service/gerencia/listarCapacidadeCivil`,X=`${u.public.auth}/service/gerencia/listarCidades`,Y=`${u.public.auth}/service/gerencia/listarSexo`,Z=`${u.public.auth}/service/gerencia/listarPais`,{id:k}=G.params,h={nome:null,nome_pai:null,nome_mae:null,profissao:null,local_trabalho:null,data_nascimento:null,doc_identificacao:null,fone_celular:null,cpf_pai:null,cpf_mae:null,tipo_pessoa:"ESTRANGEIRA",tabvalores_estadocivil_id:null,tabvalores_capacidadecivil_id:null,tabvalores_nacionalidade_id:null,tabvalores_sexo_id:null,cidade_nascimento_estrangeiro:null,cartorio_id:C("user-data").value.cartorio_id,user_id:C("user-data").value.usuario_id},I=D(!1),B=D(k||C("pessoa-id").value),a=ue({...h});function _(i){if(i)return i.replace(/[.\-]/g,"");i=null}const ee=async()=>{const{data:i,error:o}=await U(`${W}/${k}`,{method:"GET"});Object.assign(a,i.value)},{data:g,status:Pe,pending:S,error:F}=([b,w]=me(async()=>be("cliente-dados",async()=>{const[i,o,r,l,v]=await Promise.all([V(K),V(Q),V(X),V(Y),V(Z)]);return{estadoCivilItems:i,capacidadeCivilItems:o,cidadeNascimentoItems:r,sexoItems:l,paisItems:v}})),b=await b,w(),b),ae={nome:{required:N.withMessage("O campo é obrigatorio",T)},nome_mae:{required:N.withMessage("O campo é obrigatorio",T)}},m=ie(ae,a);async function oe(){if(await m.value.$validate()){const i={...a};for(const c in i)i[c]===""&&(i[c]=null);const o={...i,doc_identificacao:_(a.doc_identificacao),cpf_pai:_(a.cpf_pai),cpf_mae:_(a.cpf_mae),data_nascimento:ge(a.data_nascimento),fone_celular:a.fone_celular?a.fone_celular.replace(/[^0-9]/g,""):null},{data:r,error:l,status:v}=await U(H,{method:"POST",body:o});if(v.value==="error"&&l.value.statusCode===500)f.error("Erro ao cadastrar pessoa,o CPF já está cadastrado.");else{f.success("Pessoa cadastrada com sucesso!");const c=r.value.id;B.value=c;const te=C("pessoa_token");te.value=r.value.token,I.value=!0,P("saved")}}else f.error("Erro ao cadastrar pessoa, preencha os campos obrigatorios.")}async function le(){const i={...a};for(const c in i)i[c]===""&&(i[c]=null);const o={...i,doc_identificacao:_(a.doc_identificacao),cpf_mae:_(a.cpf_mae),fone_celular:a.fone_celular?a.fone_celular.replace(/[^0-9]/g,""):""},{data:r,error:l,status:v}=await U(`${J}/${B.value}`,{method:"PUT",body:o});if(v.value==="success"){if(E.isModal===!0){f.success("Pessoa atualizada com sucesso!"),P("close-modal");return}f.success("Pessoa atualizada com sucesso!"),M.push("/pessoas/lista")}}const se=()=>{if(E.isModal===!0){P("close-modal");return}M.push("/pessoas/lista")};return ce(()=>{k&&(ee(),I.value=!0)}),(i,o)=>{const r=pe("mask");return y(),z(ve,null,[e(S)?(y(),A(fe,{key:0,class:"loading-spinner",indeterminate:"",size:"64"})):e(F)?(y(),z("div",$e,_e(e(F).message),1)):R("",!0),e(S)?R("",!0):(y(),A(ye,{key:2},{default:t(()=>[s(p,null,{default:t(()=>[s(d,{md:"3"},{default:t(()=>[s(x,{label:"País",modelValue:e(a).tabvalores_nacionalidade_id,"onUpdate:modelValue":o[0]||(o[0]=l=>e(a).tabvalores_nacionalidade_id=l),items:e(g).paisItems,"item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1}),s(d,{md:"4"},{default:t(()=>[s(n,{modelValue:e(a).nome,"onUpdate:modelValue":o[1]||(o[1]=l=>e(a).nome=l),"error-messages":e(m).nome.$errors.map(l=>l.$message),label:"Nome",required:"",onBlur:e(m).nome.$touch,onInput:e(m).nome.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1}),s(d,{md:"3"},{default:t(()=>[s(n,{modelValue:e(a).doc_identificacao,"onUpdate:modelValue":o[2]||(o[2]=l=>e(a).doc_identificacao=l),label:"Documento"},null,8,["modelValue"])]),_:1}),s(d,{md:"2"},{default:t(()=>[s(Ce,{label:"Sexo",modelValue:e(a).tabvalores_sexo_id,"onUpdate:modelValue":o[3]||(o[3]=l=>e(a).tabvalores_sexo_id=l),items:e(g).sexoItems,"item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1})]),_:1}),s(p,null,{default:t(()=>[s(d,{md:"4"},{default:t(()=>[s(x,{modelValue:e(a).tabvalores_estadocivil_id,"onUpdate:modelValue":o[4]||(o[4]=l=>e(a).tabvalores_estadocivil_id=l),items:e(g).estadoCivilItems,"item-title":"descricao","item-value":"id",label:"Estado Civil"},null,8,["modelValue","items"])]),_:1}),s(d,{md:"4"},{default:t(()=>[s(n,{modelValue:e(a).profissao,"onUpdate:modelValue":o[5]||(o[5]=l=>e(a).profissao=l),label:"Profissão"},null,8,["modelValue"])]),_:1}),s(d,{md:"4"},{default:t(()=>[s(n,{modelValue:e(a).local_trabalho,"onUpdate:modelValue":o[6]||(o[6]=l=>e(a).local_trabalho=l),label:"Local de trabalho"},null,8,["modelValue"])]),_:1})]),_:1}),s(p,null,{default:t(()=>[s(d,{md:"2"},{default:t(()=>[$(s(n,{modelValue:e(a).data_nascimento,"onUpdate:modelValue":o[7]||(o[7]=l=>e(a).data_nascimento=l),label:"Data de nascimento",placeholder:"dd/mm/yyyy"},null,8,["modelValue"]),[[r,"##/##/####"]])]),_:1}),s(d,{md:"2"},{default:t(()=>[$(s(n,{modelValue:e(a).fone_celular,"onUpdate:modelValue":o[8]||(o[8]=l=>e(a).fone_celular=l),label:"Celular",placeholder:"'(99) 99999-9999'"},null,8,["modelValue"]),[[r,"(##) #####-####"]])]),_:1}),s(d,{md:"4"},{default:t(()=>[s(x,{modelValue:e(a).tabvalores_capacidadecivil_id,"onUpdate:modelValue":o[9]||(o[9]=l=>e(a).tabvalores_capacidadecivil_id=l),items:e(g).capacidadeCivilItems,label:"Capacidade Civil","item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1}),s(d,{md:"4"},{default:t(()=>[s(n,{modelValue:e(a).cidade_nascimento_estrangeiro,"onUpdate:modelValue":o[10]||(o[10]=l=>e(a).cidade_nascimento_estrangeiro=l),label:"Cidade de nascimento"},null,8,["modelValue"])]),_:1})]),_:1}),s(p,null,{default:t(()=>[s(d,{md:"4"},{default:t(()=>[$(s(n,{modelValue:e(a).cpf_pai,"onUpdate:modelValue":o[11]||(o[11]=l=>e(a).cpf_pai=l),label:"CPF do Pai"},null,8,["modelValue"]),[[r,"###.###.###-##"]])]),_:1}),s(d,{md:"4"},{default:t(()=>[s(n,{modelValue:e(a).nome_pai,"onUpdate:modelValue":o[12]||(o[12]=l=>e(a).nome_pai=l),label:"Nome do Pai"},null,8,["modelValue"])]),_:1})]),_:1}),s(p,null,{default:t(()=>[s(d,{md:"4"},{default:t(()=>[$(s(n,{modelValue:e(a).cpf_mae,"onUpdate:modelValue":o[13]||(o[13]=l=>e(a).cpf_mae=l),label:"CPF da Mãe"},null,8,["modelValue"]),[[r,"###.###.###-##"]])]),_:1}),s(d,{md:"4"},{default:t(()=>[s(n,{modelValue:e(a).nome_mae,"onUpdate:modelValue":o[14]||(o[14]=l=>e(a).nome_mae=l),modelModifiers:{date:!0},"error-messages":e(m).nome_mae.$errors.map(l=>l.$message),label:"Nome da Mãe",required:"",onBlur:e(m).nome_mae.$touch,onInput:e(m).nome_mae.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1})]),_:1}),s(p,{class:"mb-3"},{default:t(()=>[s(q,{onClick:se,size:"large",color:"red"},{default:t(()=>o[16]||(o[16]=[O("Voltar")])),_:1}),s(q,{onClick:o[15]||(o[15]=l=>e(I)?le():oe()),class:"ml-4",size:"large",color:"green"},{default:t(()=>o[17]||(o[17]=[O("Salvar")])),_:1})]),_:1})]),_:1}))],64)}}};export{Te as _};
