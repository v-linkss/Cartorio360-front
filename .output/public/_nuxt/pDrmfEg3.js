import{_ as x,D as C,r as i,E,c as d,a as t,t as w,F as M,G as L,p as S,H,I as N,o as m,q as T,m as B,n as D}from"./Dc3bVwLU.js";const O={class:"chat-app"},R={class:"sidebar"},$={class:"user-info"},F={class:"chat-window"},I={class:"chat-header"},J=["innerHTML"],U={class:"chat-input-area"},q={__name:"index copy",setup(K){const p=B(),g=C(),c=i(""),v=i([{from:"server",text:"Por favor, me informe seu nome"}]),l=i(),u=i(null),h=i();let a=null;const b=g.query.cartorio_token;function n(e,o){v.value.push({from:e,text:o}),D(()=>{u.value&&(u.value.scrollTop=u.value.scrollHeight)})}function f(){if(l.value||(l.value=c.value,_()),!c.value.trim())return;const e=y(c.value);n("user",e);const o={type:"chat_bot_message",message:e,cartorio_token:b};c.value="",a.send(JSON.stringify(o))}function _(){a=new WebSocket(`${p.public.chat_bot}?user_name=${l.value}`),a.addEventListener("open",()=>{console.log("âœ… Conectado ao servidor")}),a.addEventListener("message",e=>{var o;try{const s=JSON.parse(e.data),r=(o=s==null?void 0:s.message)==null?void 0:o.state;switch(r){case"ExibirResposta":console.log("ðŸ“¥ ExibirResposta"),h.value=s.message,n("button",s.message);break;case"Fim":console.log("ðŸ“´ Chat encerrado pelo servidor"),a.close(1e3,"Chat encerrado pelo servidor");break;case void 0:s.type==="connection_info"?console.log("ðŸ”— InformaÃ§Ãµes de conexÃ£o recebidas"):(console.log("ðŸ“© Mensagem desconhecida:",s),n("server",JSON.stringify(s)));break;default:console.log(`ðŸ“¨ Mensagem com estado "${r}"`),n("server",s.message);break}}catch(s){console.error("âŒ Erro ao processar mensagem:",s),n("server",e.data)}}),a.addEventListener("close",()=>{console.log("âŒ ConexÃ£o encerrada"),n("system","âš ï¸ Chat encerrado")}),a.addEventListener("error",e=>{console.error("âš ï¸ Erro na conexÃ£o:",e),n("system","âš ï¸ Erro na conexÃ£o")})}function y(e){const o=typeof e=="object"?e.message:e,s=/(https?:\/\/[^\s]+)/g;return o.replace(s,r=>`<a href="${r}" target="_blank" class="chat-link">${r}</a>`)}function k(e){return{"from-user":e==="user","from-server":e==="server","from-system":e==="system","from-button":e==="button"}}return E(()=>{a&&a.readyState===WebSocket.OPEN&&a.close()}),(e,o)=>(m(),d("div",O,[t("aside",R,[o[2]||(o[2]=t("div",{class:"sidebar-header"},"CartÃ³rio 360",-1)),t("div",$,"ðŸ‘¤ "+w(l.value||"UsuÃ¡rio"),1)]),t("main",F,[t("header",I,[o[3]||(o[3]=t("div",{class:"chat-title"},"Atendimento Online",-1)),t("button",{class:"chat-close",onClick:o[0]||(o[0]=(...s)=>e.closeChat&&e.closeChat(...s))},"âœ–")]),t("section",{ref_key:"chatHistory",ref:u,class:"chat-history"},[(m(!0),d(M,null,L(v.value,(s,r)=>(m(),d("div",{key:r,class:T(["chat-bubble",k(s.from)]),innerHTML:s.text.message||s.text},null,10,J))),128))],512),t("footer",U,[S(t("input",{"onUpdate:modelValue":o[1]||(o[1]=s=>c.value=s),class:"chat-input",placeholder:"Digite sua mensagem...",onKeyup:N(f,["enter"])},null,544),[[H,c.value]]),t("button",{onClick:f,class:"chat-send-button"},"ðŸ“¤")])])]))}},V=x(q,[["__scopeId","data-v-523cd452"]]);export{V as default};
