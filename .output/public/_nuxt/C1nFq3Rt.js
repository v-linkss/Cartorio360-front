import{_ as we}from"./ViBG4SqG.js";import{_ as Ve}from"./BypR8L4A.js";import{_ as be}from"./40_iMjYg.js";import{_ as xe,r as n,g as Ce,o as x,h as ae,w as s,b as o,a as m,t as ee,i as t,s as j,j as oe,J as $e,c as z,p as se,V as L,d as B,D as qe,K as Pe,u as Ae,e as A,f as Ee,y as Me,F as Se,k as Te}from"./B3qHAfY2.js";import{V as Fe,a as Re,c as Oe}from"./M6uHpD5D.js";import{V as De}from"./BB_xEO0D.js";import{_ as Ne}from"./BRvIf8n8.js";import{_ as je}from"./G649sGvS.js";import{_ as ne}from"./DK2wQyjF.js";import{_ as ze}from"./BVz1G1IN.js";import{_ as Be}from"./BiC0xr9W.js";import{a as Ue}from"./DJvq3mCv.js";import{u as V}from"./AbqtXxaM.js";import{V as N}from"./C-gLg2rw.js";import{V as b}from"./CztrV56-.js";import{V as Ie}from"./CP6hhYYs.js";import{V as te}from"./CksH81Bl.js";import"./Bkxv2Vrw.js";import"./lnLrcPWe.js";import"./CVDpgRqx.js";import"./BTdgIE5n.js";import"./B0IxRygJ.js";import"./BRhLhDx8.js";import"./yElaiGuO.js";import"./C4qHYQYW.js";import"./Cl68E8m0.js";import"./DeW-NlDP.js";import"./BWhwLF6L.js";import"./vWFD-yVi.js";import"./BDkFPGjG.js";import"./DspjLGNf.js";import"./BP1X5Ijr.js";import"./dvwuH5U4.js";const Ke={class:"random-numbers"},Ze={key:0,class:"error-message"},We={__name:"ValidadorAutencidade",props:{show:Boolean},emits:["close","confirm"],setup(U,{emit:I}){const y=U,C=I,d=n(y.show),g=n([]),p=n(""),v=n("");function f(){g.value=[];for(let _=0;_<4;_++)g.value.push(Math.floor(Math.random()*10))}Ce(()=>y.show,_=>{d.value=_,_&&(f(),p.value="",v.value="")});const E=()=>{d.value=!1,C("close")},M=()=>{p.value===g.value.join("")?(v.value="",d.value=!1,C("confirm")):v.value="Números digitados incorretos. Tente novamente."};return(_,u)=>(x(),ae(De,{persistent:"",modelValue:t(d),"onUpdate:modelValue":u[1]||(u[1]=$=>oe(d)?d.value=$:null),"max-width":"500"},{default:s(()=>[o(Fe,null,{default:s(()=>[o(Re,null,{default:s(()=>[m("div",null,[u[2]||(u[2]=m("p",null," Digite o código de validação para confirmar o ato de reconhecimento por autenticidade: ",-1)),m("div",Ke,[m("span",null,ee(t(g).join(" ")),1)]),o(j,{modelValue:t(p),"onUpdate:modelValue":u[0]||(u[0]=$=>oe(p)?p.value=$:null),label:"Digite os números",maxlength:"4",outlined:"",dense:"",onKeyup:$e(M,["enter"])},null,8,["modelValue"]),t(v)?(x(),z("div",Ze,ee(t(v)),1)):se("",!0)])]),_:1}),o(Oe,null,{default:s(()=>[o(L,{style:{"background-color":"red",color:"white"},onClick:E},{default:s(()=>u[3]||(u[3]=[B("Cancelar")])),_:1}),o(L,{style:{"background-color":"green",color:"white"},onClick:M},{default:s(()=>u[4]||(u[4]=[B("Validar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},He=xe(We,[["__scopeId","data-v-c978e7cc"]]),Le=["onClick"],Qe={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:ne,alt:"Possui Ficha",title:"Possui Ficha"},Je={key:1,style:{width:"30px",height:"30px",cursor:"pointer"},src:Be,alt:"Visualizar",title:"Não Possui Ficha"},Ye=["onClick"],So={__name:"autencidade",props:{ato_token:{type:String,required:!0}},emits:["ato-created"],async setup(U,{emit:I}){var X;let y,C;const d=U,g=I,p=qe(),v=Pe(),f=Te(),{$toast:E}=Ae(),M=`${f.public.managemant}/listarEscrevente`,_=`${f.public.managemant}/pesquisarPessoas`,u=`${f.public.managemant}/atoReconhecimento`,$=`${f.public.managemant}/etiquetaAutenticidade`,le=`${f.public.managemant}/download`,re=`${f.public.envioDoc}/print`,S=n(A("user-data").value.cartorio_token),ie=n(A("user-service").value.token).value||n(A("user-service").value).value,ue=A("auth_token").value,K=n([]),Q=n([]),q=n([]),P=n(!1),Z=n(!1),T=n(!1),F=n(null),J=n(null),R=n(""),O=n(null),D=n(!1),Y=[{title:"Documento",align:"start",key:"documento"},{title:"Pessoa",align:"start",key:"nome"},{value:"actions"}],i=Ee({quantidade:1,escrevente:null,nome:null,documento:null}),{data:G}=([y,C]=Me(()=>V(M,{method:"POST",body:{cartorio_token:S}},"$qpB20nOlUE")),y=await y,C(),y);Q.value=Array.isArray(G.value)&&((X=G.value[0])==null?void 0:X.func_json_escreventes)||[];async function ce(){try{const{data:a,error:e}=await V(_,{method:"POST",body:{cartorio_token:S.value,documento:i.documento,nome:i.nome}},"$CfpM9wZnUE");a.value.length>0?(g("ato-created"),K.value=a.value):K.value=[]}catch(a){console.error("Erro na requisição",a)}}const me=()=>{Z.value=!0};function de(a){q.value.push(a)}const pe=async a=>{F.value=a,T.value=!0;const{data:e}=await V(le,{method:"POST",body:{bucket:A("user-data").value.cartorio_token,path:a.link_ficha}},"$LrKAtpxZwH");J.value=e.value};function ve(a){q.value=q.value.filter(e=>e.token!==a.token)}function fe(){return new Promise(a=>{O.value=a,D.value=!0})}async function _e(){D.value=!1;try{await ke()}finally{O.value&&(O.value(),O.value=null)}}async function ke(){var a,e,w;if(!i.escrevente)throw E.error("Por favor selecione um Escrevente"),new Error("Escrevente não selecionado");try{const k=q.value.map(h=>({pessoa_token:h.token})),{data:r,error:c,status:H}=await V(u,{method:"POST",body:{pessoas:k,cartorio_token:S.value,ordemserv_token:ie,quantidade:i.quantidade,usuario_token:ue,ato_tipo_token:d.ato_token}},"$EE94jKo1pQ");if(H.value==="success"&&r.value[0].status==="OK"){if(r.value[0].livro&&r.value[0].livro!==null){const h=window.open("","_blank");h.document.open(),h.document.write(r.value[0].livro),h.document.close()}ye(r.value[0].token)}else W(),P.value=!0,R.value=Array.isArray(r.value)&&((a=r.value[0])==null?void 0:a.status_mensagem)||((w=(e=c==null?void 0:c.value)==null?void 0:e.data)==null?void 0:w.details)||"Não foi possível concluir o reconhecimento"}catch(k){P.value=!0,R.value=k,console.error("Erro na requisição",k)}}async function ye(a){try{console.log("Reconhecimento de Etiqueta");const{data:e,error:w,status:k}=await V($,{method:"POST",body:{ato_token:a,cartorio_token:S.value,escrevente_token:i.escrevente}},"$KyoIzBxZyr");if(k.value==="success"){const r=Array.isArray(e.value)?e.value[0]:null;if(!r)return;if(r.tipo_etiqueta==="html"){const c=window.open("","_blank");c.document.open(),c.document.write(r.etiqueta),c.document.close()}else if(r.tipo_etiqueta==="zpl"){const{status:c}=await V(`${re}`,{method:"POST",body:{zpl:atob(r.etiqueta)}},"$Vem9mHWYqw");if(c.value!=="success"){P.value=!0,R.value=w.value.data.message;return}}}}catch(e){E.error("Erro ao reconhecer a etiqueta"),console.error("Erro na requisição",e)}}const he=()=>{P.value=!1,W()},W=()=>{const a=v.query.origem||"criar",e=v.query.id;a==="atualizar"?p.push(`/os/atualizar/${e}`):p.push("/os/criar-registro")};return(a,e)=>{const w=we,k=Ve,r=be,c=He,H=Ne,h=je;return x(),z(Se,null,[o(N,{class:"mt-5"},{default:s(()=>[o(b,{cols:"5"},{default:s(()=>[o(Ie,{label:"Tabelião/escrevente",modelValue:t(i).escrevente,"onUpdate:modelValue":e[0]||(e[0]=l=>t(i).escrevente=l),items:t(Q),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"])]),_:1}),o(b,{cols:"2"},{default:s(()=>[o(j,{label:"Quantidade",type:"number",modelValue:t(i).quantidade,"onUpdate:modelValue":e[1]||(e[1]=l=>t(i).quantidade=l)},null,8,["modelValue"])]),_:1})]),_:1}),o(N,null,{default:s(()=>[o(b,{cols:"3"},{default:s(()=>[o(j,{label:"Documento",modelValue:t(i).documento,"onUpdate:modelValue":e[2]||(e[2]=l=>t(i).documento=l)},null,8,["modelValue"])]),_:1}),o(b,{cols:"4"},{default:s(()=>[o(j,{label:"Pessoa",modelValue:t(i).nome,"onUpdate:modelValue":e[3]||(e[3]=l=>t(i).nome=l)},null,8,["modelValue"])]),_:1}),m("div",null,[m("img",{class:"btn-pointer mt-1",src:ne,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:ce})]),m("div",null,[m("img",{class:"btn-pointer mt-1 ml-2",src:ze,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:me})])]),_:1}),o(N,null,{default:s(()=>[o(b,{class:"mr-10"},{default:s(()=>[o(te,{style:{height:"465px"},headers:Y,items:t(K)},{"item.actions":s(({item:l})=>[m("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ge=>pe(l),title:"Visualizar Ficha"},[l.link_ficha?(x(),z("img",Qe)):(x(),z("img",Je))],8,Le)]),_:1},8,["items"])]),_:1}),o(b,null,{default:s(()=>[o(te,{headers:Y,items:t(q),style:{height:"465px"},"item-key":"id"},{"item.actions":s(({item:l})=>[m("div",{style:{display:"flex","justify-content":"flex-end"},onClick:ge=>ve(l),title:"Remover"},e[8]||(e[8]=[m("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:Ue,alt:"Remover"},null,-1)]),8,Ye)]),_:1},8,["items"])]),_:1})]),_:1}),o(w,{show:t(Z),onClose:e[4]||(e[4]=l=>Z.value=!1)},null,8,["show"]),t(T)?(x(),ae(k,{key:0,show:t(T),item:t(F),"pessoa-obj":t(F),"link-view":t(J),onConfirmar:e[5]||(e[5]=l=>de(t(F))),onClose:e[6]||(e[6]=l=>T.value=!1)},null,8,["show","item","pessoa-obj","link-view"])):se("",!0),o(r,{show:t(P),errorMessage:t(R),onClose:he},null,8,["show","errorMessage"]),o(c,{show:t(D),onClose:e[7]||(e[7]=l=>D.value=!1),onConfirm:_e},null,8,["show"]),o(N,null,{default:s(()=>[o(H,{onClick:W},{default:s(()=>[o(L,{size:"large",color:"red"},{default:s(()=>e[9]||(e[9]=[B("Voltar")])),_:1})]),_:1}),o(h,{onSave:fe,class:"ml-5",size:"large",color:"green"},{default:s(()=>e[10]||(e[10]=[B("Salvar")])),_:1})]),_:1})],64)}}};export{So as default};
