import{n as K,u as Q,A as v,r as ee,s as ae,B as oe,O as se,o as b,c as q,x as e,v as z,H as le,t as te,I as S,w as t,b as l,V as m,P as y,y as A,d as D,J as ie,z as de}from"./UejYr6cC.js";import{b as re,u as E}from"./BjnJ0BPK.js";import{c as P,r as I,u as ne}from"./C5LfM9WH.js";import{c as me}from"./DvBlBUkO.js";import{V as c}from"./B9ktu_du.js";import{V as d}from"./Cz-aldi_.js";import{V as k}from"./B9oGmQdH.js";import{V as ue}from"./5vY_Pn2d.js";const ce={key:1},ye={__name:"Dados",props:{isModal:{type:Boolean,default:!1}},emits:["saved","close-modal"],async setup(O,{emit:R}){let V,U;const w=O,g=R,M=K(),{$toast:p}=Q(),f=de(),T=`${f.public.managemant}/createPessoa`,H=`${f.public.managemant}/updatePessoa`,L=`${f.public.managemant}/listarEstadoCivil`,h=`${f.public.managemant}/listarCapacidadeCivil`,j=`${f.public.managemant}/listarCidades`,J={nome:"",nome_pai:"",nome_mae:"",profissao:"",local_trabalho:"",data_nascimento:"",doc_identificacao:"",cpf_pai:"",cpf_mae:"",tipo_pessoa:"FISICA",tabvalores_estadocivil_id:"",tabvalores_capacidadecivil_id:"",cidade_natural_id:"",cartorio_id:v("user-data").value.cartorio_id,user_id:v("user-data").value.usuario_id},B=ee(!1),F=v("pessoa-id"),o=ae({...J});function _(i){if(i)return i.replace(/[.\-]/g,"");i=null}const{data:C,status:pe,pending:x,error:N}=([V,U]=oe(async()=>re("cliente-dados",async()=>{const[i,s,n]=await Promise.all([$fetch(L),$fetch(h),$fetch(j)]);return{estadoCivilItems:i,capacidadeCivilItems:s,cidadeNascimentoItems:n}})),V=await V,U(),V),W={nome:{required:P.withMessage("O campo é obrigatorio",I)},nome_mae:{required:P.withMessage("O campo é obrigatorio",I)},doc_identificacao:{required:P.withMessage("O campo é obrigatorio",I),cpf:me}},r=ne(W,o);async function X(){if(await r.value.$validate()){const i={...o};for(const u in i)i[u]===""&&(i[u]=null);const s={...i,doc_identificacao:_(o.doc_identificacao),cpf_pai:_(o.cpf_pai),cpf_mae:_(o.cpf_mae)},{data:n,error:a,status:$}=await E(T,{method:"POST",body:s},"$fcbWHpl5XR");if($.value==="error"&&a.value.statusCode===500)p.error("Erro ao cadastrar pessoa,o CPF já está cadastrado.");else{p.success("Pessoa cadastrada com sucesso!");const u=n.value.id;F.value=u;const G=v("pessoa_token");G.value=n.value.token,B.value=!0,g("saved")}}else p.error("Erro ao cadastrar pessoa, preencha os campos obrigatorios.")}async function Y(){const i={...o};for(const u in i)i[u]===""&&(i[u]=null);const s={...i,doc_identificacao:_(o.doc_identificacao),cpf_mae:_(o.cpf_mae)},{data:n,error:a,status:$}=await E(`${H}/${F.value}`,{method:"PUT",body:s},"$S30ZRYxneo");if($.value==="success"){if(w.isModal===!0){p.success("Pessoa atualizada com sucesso!"),g("close-modal");return}p.success("Pessoa atualizada com sucesso!"),M.push("/pessoas/lista")}}const Z=()=>{if(w.isModal===!0){g("close-modal");return}M.push("/pessoas/lista")};return(i,s)=>{const n=se("mask");return b(),q(ie,null,[e(x)?(b(),z(le,{key:0,class:"loading-spinner",indeterminate:"",size:"64"})):e(N)?(b(),q("div",ce,te(e(N).message),1)):S("",!0),e(x)?S("",!0):(b(),z(ue,{key:2},{default:t(()=>[l(c,null,{default:t(()=>[l(d,{cols:"12",md:"8"},{default:t(()=>[l(m,{modelValue:e(o).nome,"onUpdate:modelValue":s[0]||(s[0]=a=>e(o).nome=a),"error-messages":e(r).nome.$errors.map(a=>a.$message),label:"Nome",required:"",onBlur:e(r).nome.$touch,onInput:e(r).nome.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1}),l(d,{cols:"12",md:"4"},{default:t(()=>[y(l(m,{modelValue:e(o).doc_identificacao,"onUpdate:modelValue":s[1]||(s[1]=a=>e(o).doc_identificacao=a),"error-messages":e(r).doc_identificacao.$errors.map(a=>a.$message),label:"CPF",required:"",onBlur:e(r).doc_identificacao.$touch,onInput:e(r).doc_identificacao.$touch},null,8,["modelValue","error-messages","onBlur","onInput"]),[[n,"###.###.###-##"]])]),_:1})]),_:1}),l(c,null,{default:t(()=>[l(d,{cols:"12",md:"4"},{default:t(()=>[l(k,{modelValue:e(o).tabvalores_estadocivil_id,"onUpdate:modelValue":s[2]||(s[2]=a=>e(o).tabvalores_estadocivil_id=a),items:e(C).estadoCivilItems,"item-title":"descricao","item-value":"id",label:"Estado Civil"},null,8,["modelValue","items"])]),_:1}),l(d,{cols:"12",md:"4"},{default:t(()=>[l(m,{modelValue:e(o).profissao,"onUpdate:modelValue":s[3]||(s[3]=a=>e(o).profissao=a),label:"Profissão"},null,8,["modelValue"])]),_:1}),l(d,{cols:"12",md:"4"},{default:t(()=>[l(m,{modelValue:e(o).local_trabalho,"onUpdate:modelValue":s[4]||(s[4]=a=>e(o).local_trabalho=a),label:"Local de trabalho"},null,8,["modelValue"])]),_:1})]),_:1}),l(c,null,{default:t(()=>[l(d,{cols:"12",md:"4"},{default:t(()=>[l(m,{modelValue:e(o).data_nascimento,"onUpdate:modelValue":s[5]||(s[5]=a=>e(o).data_nascimento=a),type:"date","prepend-icon":"",label:"Data de nascimento"},null,8,["modelValue"])]),_:1}),l(d,{cols:"12",md:"4"},{default:t(()=>[l(k,{modelValue:e(o).tabvalores_capacidadecivil_id,"onUpdate:modelValue":s[6]||(s[6]=a=>e(o).tabvalores_capacidadecivil_id=a),items:e(C).capacidadeCivilItems,label:"Capacidade Civil","item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1}),l(d,{cols:"12",md:"4"},{default:t(()=>[l(k,{modelValue:e(o).cidade_natural_id,"onUpdate:modelValue":s[7]||(s[7]=a=>e(o).cidade_natural_id=a),items:e(C).cidadeNascimentoItems,label:"Cidade de nascimento","item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1})]),_:1}),l(c,null,{default:t(()=>[l(d,{cols:"12",md:"4"},{default:t(()=>[y(l(m,{modelValue:e(o).cpf_pai,"onUpdate:modelValue":s[8]||(s[8]=a=>e(o).cpf_pai=a),modelModifiers:{date:!0},label:"CPF do Pai"},null,8,["modelValue"]),[[n,"###.###.###-##"]])]),_:1}),l(d,{cols:"12",md:"4"},{default:t(()=>[l(m,{modelValue:e(o).nome_pai,"onUpdate:modelValue":s[9]||(s[9]=a=>e(o).nome_pai=a),modelModifiers:{date:!0},label:"Nome do Pai"},null,8,["modelValue"])]),_:1})]),_:1}),l(c,null,{default:t(()=>[l(d,{cols:"12",md:"4"},{default:t(()=>[y(l(m,{modelValue:e(o).cpf_mae,"onUpdate:modelValue":s[10]||(s[10]=a=>e(o).cpf_mae=a),modelModifiers:{date:!0},label:"CPF da Mãe"},null,8,["modelValue"]),[[n,"###.###.###-##"]])]),_:1}),l(d,{cols:"12",md:"4"},{default:t(()=>[l(m,{modelValue:e(o).nome_mae,"onUpdate:modelValue":s[11]||(s[11]=a=>e(o).nome_mae=a),modelModifiers:{date:!0},"error-messages":e(r).nome_mae.$errors.map(a=>a.$message),label:"Nome da Mãe",required:"",onBlur:e(r).nome_mae.$touch,onInput:e(r).nome_mae.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1})]),_:1}),l(c,{class:"mb-3"},{default:t(()=>[l(A,{onClick:Z,size:"large",color:"red"},{default:t(()=>[D("Voltar")]),_:1}),l(A,{onClick:s[12]||(s[12]=a=>e(B)?Y():X()),class:"ml-4",size:"large",color:"green"},{default:t(()=>[D("Salvar")]),_:1})]),_:1})]),_:1}))],64)}}};export{ye as _};
