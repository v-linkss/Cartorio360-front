import{_ as H,L as S,r as l,z as N,I as A,h as B,c as m,d as D,t as f,a as t,F as g,D as b,p as I,E as O,G as F,n as k,o as v,q as y,m as P}from"./BssRuRd5.js";const R={class:"chat-app"},V={class:"sidebar"},q={class:"chat-list"},z=["onClick"],J={class:"chat-name"},K={class:"chat-preview"},U={class:"chat-window"},W={class:"chat-header"},j=["innerHTML"],G={class:"chat-input-area"},Q={__name:"atendimento",setup(X){const C=P(),E=S(),d=l(""),u=l([]),$=l([{id:1,name:"Atendimento Cartório",preview:"Última mensagem…"},{id:2,name:"Suporte Técnico",preview:"Estamos analisando…"}]),h=l(1);N(()=>$.value.find(s=>s.id===h.value));const r=l(),c=l(null);l();let o=null;const w=E.query.cartorio_token;function i(s,a){s!==r.value&&u.value.push({from:s,text:a}),k(()=>{c.value&&(c.value.scrollTop=c.value.scrollHeight)})}function _(){if(!d.value.trim())return;const s=p(d.value);i("user",s);const a={type:"chat_message",message:s,cartorio_token:w};d.value="",console.log(`$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
`,a),o.send(JSON.stringify(a))}function x(){r.value||(r.value="Camila"),o=new WebSocket(`${C.public.chat_bot}?user_name=${r.value}&room_id=1750948570391Ewerton`),o.addEventListener("open",()=>{console.log("✅ Conectado ao servidor")}),o.addEventListener("message",s=>{var a;try{const e=JSON.parse(s.data),n=(a=e==null?void 0:e.message)==null?void 0:a.state;switch(console.log("###############################".data),n){case"Fim":console.log("📴 Chat encerrado pelo servidor"),o.close(1e3,"Chat encerrado pelo servidor");break;case void 0:e.type==="connection_info"?console.log("🔗 Informações de conexão recebidas"):e.username&&e.username!=r.value?i("server",e.message):i(r.value,e.message);break;case"MenuPrincipal":if(n==="MenuPrincipal"&&Array.isArray(e.history)){console.log("📜 Carregando histórico..."),u.value=[],M(e.history);return}break;default:console.log(`📨 Mensagem com estado "${n}"`),i("server",e.message);break}}catch(e){console.error("❌ Erro ao processar mensagem:",e),i("server",s.data)}}),o.addEventListener("close",()=>{console.log("❌ Conexão encerrada"),i("system","⚠️ Chat encerrado")}),o.addEventListener("error",s=>{console.error("⚠️ Erro na conexão:",s),i("system","⚠️ Erro na conexão")})}function M(s){s.forEach(a=>{if(a.type==="chat_message"){const e=a.username===r.value?"user":"server";u.value.push({from:e,text:p(a.message)})}else a.type==="bot_message"&&u.value.push({from:"server",text:p(a.message.message||a.message)})}),k(()=>{c.value&&(c.value.scrollTop=c.value.scrollHeight)})}function p(s){const a=typeof s=="object"?s.message:s,e=/(https?:\/\/[^\s]+)/g;return a.replace(e,n=>`<a href="${n}" target="_blank" class="chat-link">${n}</a>`)}function L(s){return{"from-user":s==="user","from-server":s==="server","from-system":s==="system","from-button":s==="button"}}A(()=>{o&&o.readyState===WebSocket.OPEN&&o.close()});function T(s){h.value=s}return B(()=>{x()}),(s,a)=>(v(),m(g,null,[D(f(u.value)+" ",1),t("div",R,[t("aside",V,[a[2]||(a[2]=t("div",{class:"sidebar-header"},"Cartório 360",-1)),t("div",q,[(v(!0),m(g,null,b($.value,e=>(v(),m("div",{key:e.id,class:y(["chat-item",{active:e.id===h.value}]),onClick:n=>T(e.id)},[t("div",J,f(e.name),1),t("div",K,f(e.preview),1)],10,z))),128))])]),t("main",U,[t("header",W,[a[3]||(a[3]=t("div",{class:"chat-title"},"Atendimento Online",-1)),t("button",{class:"chat-close",onClick:a[0]||(a[0]=(...e)=>s.closeChat&&s.closeChat(...e))},"✖")]),t("section",{ref_key:"chatHistory",ref:c,class:"chat-history"},[(v(!0),m(g,null,b(u.value,(e,n)=>(v(),m("div",{key:n,class:y(["chat-bubble",L(e.from)]),innerHTML:e.text.message||e.text},null,10,j))),128))],512),t("footer",G,[I(t("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>d.value=e),class:"chat-input",placeholder:"Digite sua mensagem...",onKeyup:F(_,["enter"])},null,544),[[O,d.value]]),t("button",{onClick:_,class:"chat-send-button"},"📤")])])])],64))}},Z=H(Q,[["__scopeId","data-v-52774488"]]);export{Z as default};
