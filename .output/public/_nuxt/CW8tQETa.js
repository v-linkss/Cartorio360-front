import{_ as de}from"./DroXbRr1.js";import{a as me,_ as pe}from"./B8i0HG0u.js";import{u as ce,r as u,e as r,f as ve,s as fe,h as _e,j as g,w as i,l as ge,o as p,b as l,a as n,t as be,i as a,m as ke,V as T,k as L,q as Ve,p as ye,c as M,v as xe,d as Ce}from"./Tfn9NuBr.js";import{_ as $e}from"./DGa4wxo3.js";import{_ as he}from"./BVz1G1IN.js";import{_ as we}from"./CTbcy8ju.js";import{_ as Oe}from"./w8h0yJMR.js";import{_ as Se,a as Te}from"./DJvq3mCv.js";import{c as j,r as H,u as De}from"./B4Jdw7dY.js";import{u as D}from"./bzj915e5.js";import"./IQCalDVu.js";import{f as Ae}from"./CtG9K-HS.js";import{V as Ee}from"./DHv-h4Tv.js";import{V as x}from"./LjC4bRoU.js";import{V as C}from"./BJ8W2r7g.js";import{V as Ne}from"./BUTAiPy7.js";import{V as Re}from"./09XaBDXp.js";import"./CQ7No_Yn.js";import"./ALudXniF.js";import"./ZiUTAKdp.js";import"./Csyma-kO.js";import"./A4ors0Xu.js";import"./NGOnBb3f.js";import"./CWJ8MV6a.js";import"./B-7euU_K.js";const Be={style:{color:"red","margin-left":"30px"}},qe=["onClick"],ze=["onClick","title"],Fe=["disabled","onClick"],Pe={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:Se,alt:"Visualizar",title:"Reativar"},Ie={key:1,src:Te,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px",cursor:"pointer"},title:"Excluir"},ct={__name:"criar-registro",async setup(Ue){var B,q,z,F,P,I,U;let b,A;const{$toast:v}=ce(),k=ge(),J=`${k.public.managemant}/createOrdensServico`,W=`${k.public.managemant}/validarCpf`,G=`${k.public.managemant}/listarAtos`,X=`${k.public.managemant}/updateAtos`,K=u(r("user-data").value.cartorio_id),Q=u(r("user-data").value.usuario_id),Y=u((B=r("user-service").value)==null?void 0:B.token).value||null,Z=u(r("user-data").value.cartorio_token).value,V=u((q=r("user-service").value)==null?void 0:q.numero),y=u((z=r("user-service").value)==null?void 0:z.isDisabled);let E=u(!!((F=r("user-service").value)!=null&&F.numero)),$=u(r("ordem-button").value),h=!1;const w=u(!1),O=u([]),s=ve({nacionalidade:((P=r("user-service").value)==null?void 0:P.estrangeiro)||!1,apresentante_nome:(I=r("user-service").value)==null?void 0:I.apresentante_nome,apresentante_cpf:(U=r("user-service").value)==null?void 0:U.apresentante_cpf}),f=u(!1),ee=[{title:"ID",value:"id"},{title:"Protocolo",value:"protocolo"},{title:"Usuario",value:"usuario_nome"},{title:"Situação",value:"situacao"},{title:"Valor",value:"valor"},{title:"Tipo",value:"tipo"},{value:"actions"}],te=[{title:"BRASILEIRO",value:!1},{title:"ESTRANGEIRO",value:!0}],ae={apresentante_nome:{required:j.withMessage("O campo é obrigatorio",H)},apresentante_cpf:{required:j.withMessage("O campo é obrigatorio",H)}},m=De(ae,s);function N(o){if(o)return o.replace(/[.\-]/g,"");o=null}const oe=o=>{redirectTo({item:o,id:r("user-service").value.id,numeroOs:V.value,origem:"vizualizar"})},re=o=>{redirectTo({item:o,id:r("user-service").value.id,numeroOs:V.value,origem:"atualizar"})};function se(){const o=r("user-service"),e=r("ordem-button");o.value=null,e.value=null}const ie=()=>{w.value=!0};async function le(){const o={apresentante_cpf:N(s.apresentante_cpf),apresentante_nome:s.apresentante_nome,user_id:Q.value,cartorio_id:K.value,estrangeiro:s.nacionalidade};if(await m.value.$validate()){const{data:e,error:c,status:d}=await D(J,{method:"POST",body:o},"$HqnOwnLBio");if(d.value==="error"&&c.value.statusCode===500)v.error("Erro ao cadastrar ordem,erro no sistema.");else{v.success("Ordem registrada com sucesso!"),E.value=!0,$.value=!1,V.value=e.value.numero;const _=r("ordem-button");_.value=$.value;const t=r("user-service");t.value=t.value=JSON.stringify({numero:e.value.numero,id:e.value.id,apresentante_cpf:e.value.apresentante_cpf,apresentante_nome:e.value.apresentante_nome,estrangeiro:e.value.estrangeiro,token:e.value.token,isDisabled:!0}),f.value=!0}}}async function ne(o){const e=N(o);if(e.length===11&&!h){h=!0;const c={cpf:e};try{const{data:d,error:_,status:t}=await D(W,{method:"POST",body:c},"$DfuVr7OuaN");t.value==="error"&&_.value.statusCode===500?v.error("Erro ao cadastrar pessoa, o CPF já está cadastrado."):d.value.cpfValidation===!0?(s.apresentante_nome=d.value.nome,v.success("Cpf autenticado com sucesso!")):d.value.cpfValidation===!1&&v.error("Cpf não cadastrado!")}catch(d){console.error("Erro ao validar CPF:",d)}finally{h=!1}}}async function ue(o){o.excluido=!o.excluido;try{await Ae(`${X}/${o.id}`,{method:"PUT",body:{excluido:o.excluido}})}catch(e){console.error("Erro ao excluir pessoa:",e)}}const{data:R}=([b,A]=fe(()=>D(G,{method:"POST",body:{cartorio_token:Z,ordemserv_token:Y}},"$bJ1XcDsWLH")),b=await b,A(),b);return R.value.length>0?O.value=R.value:O.value=[],(o,e)=>{const c=de,d=pe,_=_e("mask");return p(),g(Ee,{class:"mt-5"},{default:i(()=>[l(x,{class:"mb-5"},{default:i(()=>{var t;return[e[8]||(e[8]=n("h1",null,"Ordem de Serviço nº",-1)),n("h1",Be,be(a(V)||((t=("useCookie"in o?o.useCookie:a(r))("user-service").value)==null?void 0:t.numero)),1)]}),_:1}),l(x,null,{default:i(()=>[l(C,{md:"3"},{default:i(()=>[l(Ne,{label:"Nacionalidade",items:te,modelValue:a(s).nacionalidade,"onUpdate:modelValue":e[0]||(e[0]=t=>a(s).nacionalidade=t),disabled:a(y)||a(f)},null,8,["modelValue","disabled"])]),_:1}),l(C,{md:"2"},{default:i(()=>[a(s).nacionalidade===!1?ke((p(),g(T,{key:0,autofocus:"",modelValue:a(s).apresentante_cpf,"onUpdate:modelValue":e[1]||(e[1]=t=>a(s).apresentante_cpf=t),label:"CPF",required:"","error-messages":a(m).apresentante_cpf.$errors.map(t=>t.$message),onBlur:a(m).apresentante_cpf.$touch,onInput:e[2]||(e[2]=t=>ne(a(s).apresentante_cpf)),disabled:a(y)||a(f)},null,8,["modelValue","error-messages","onBlur","disabled"])),[[_,"###.###.###-##"]]):(p(),g(T,{key:1,autofocus:"",modelValue:a(s).apresentante_cpf,"onUpdate:modelValue":e[3]||(e[3]=t=>a(s).apresentante_cpf=t),label:"Documento",required:"","error-messages":a(m).apresentante_cpf.$errors.map(t=>t.$message),onBlur:a(m).apresentante_cpf.$touch,disabled:a(y)||a(f)},null,8,["modelValue","error-messages","onBlur","disabled"]))]),_:1}),l(C,{md:"4"},{default:i(()=>[l(T,{modelValue:a(s).apresentante_nome,"onUpdate:modelValue":e[4]||(e[4]=t=>a(s).apresentante_nome=t),label:"Nome Apresentante",required:"","error-messages":a(m).apresentante_nome.$errors.map(t=>t.$message),onInput:a(m).apresentante_nome.$touch,disabled:a(y)||a(f)},null,8,["modelValue","error-messages","onInput","disabled"])]),_:1}),a($)?(p(),g(C,{key:0},{default:i(()=>[n("div",null,[n("img",{style:{width:"40px",height:"40px",cursor:"pointer"},src:$e,alt:"Salvar",onClick:e[5]||(e[5]=t=>le())})])]),_:1})):L("",!0)]),_:1}),a(E)?(p(),g(x,{key:0,style:{display:"flex","margin-bottom":"10px",gap:"2rem"}},{default:i(()=>[e[12]||(e[12]=n("h1",{class:"ml-5"},"Atos",-1)),l(c,{to:{path:"/os/criar-ato",query:{origem:"criar"}}},{default:i(()=>e[9]||(e[9]=[n("img",{style:{width:"45px",height:"45px",cursor:"pointer"},src:he,alt:"novo"},null,-1)])),_:1}),l(Re,{headers:ee,items:a(O),"item-key":"id"},{"item.actions":i(({item:t})=>[l(x,{style:{display:"flex",gap:"2px","margin-top":"-5px"}},{default:i(()=>[n("div",{onClick:S=>oe(t),title:"Visualizar"},e[10]||(e[10]=[n("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:we,alt:"Visualizar"},null,-1)]),8,qe),n("div",{onClick:e[6]||(e[6]=S=>ie()),title:"Reimprimir"},e[11]||(e[11]=[n("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:me,alt:"Reimprimir"},null,-1)])),n("div",{class:ye({disabled:!t.btn_editar}),onClick:S=>t.btn_editar?re({id:t.id,tipo:t.tipo,token:t.token,tipo_token:t.tipo_token,rota:t.rota}):null,title:t.btn_editar?"Editar":"Desabilitado"},[n("img",{style:Ve({cursor:t.btn_editar?"pointer":"default",width:"30px",height:"30px"}),src:Oe,alt:"Editar"},null,4)],10,ze),n("div",{disabled:!t.btn_cancelar,onClick:S=>t.btn_cancelar?ue(t):null,title:"Excluir"},[t.excluido?(p(),M("img",Pe)):(p(),M("img",Ie))],8,Fe)]),_:2},1024)]),_:1},8,["items"]),l(d,{show:a(w),onClose:e[7]||(e[7]=t=>w.value=!1)},null,8,["show"])]),_:1})):L("",!0),l(c,{to:"/os/lista"},{default:i(()=>[l(xe,{size:"large",color:"red",onClick:se},{default:i(()=>e[13]||(e[13]=[Ce("Voltar")])),_:1})]),_:1})]),_:1})}}};export{ct as default};
