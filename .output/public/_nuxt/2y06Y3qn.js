import{_ as pe}from"./CDzdn2o0.js";import{a as ce,_ as me}from"./DJp90Clp.js";import{u as _e,e as ve,r as u,f as r,g as fe,v as ge,i as ke,k,w as i,m as be,o as c,b as n,a as l,t as ye,j as a,p as Ve,V as D,l as M,s as xe,q as he,c as j,x as Ce,d as $e}from"./CzDanfoI.js";import{_ as we}from"./B_AUx6Im.js";import{_ as Oe}from"./BVz1G1IN.js";import{_ as Se}from"./CB5i2jWc.js";import{_ as Te}from"./DP4swgi8.js";import{_ as De,a as Ae}from"./DJvq3mCv.js";import{c as H,r as J,u as Ee}from"./Ctxm1Wvz.js";import{u as A}from"./BhWQ7l0t.js";import"./6A6wE5Mt.js";import{f as Re}from"./CKpqsDsL.js";import{V as qe}from"./DUomP5SO.js";import{V as x}from"./CldAZo_R.js";import{V as h}from"./CFmFdcZ8.js";import{V as ze}from"./MsWs58Cu.js";import{V as Ne}from"./BGiapAtV.js";import"./CBdV3vEQ.js";import"./T7DRvoPG.js";import"./9d_rBNcR.js";import"./CCaDXtWG.js";import"./B_kYmmY4.js";import"./LCpjsag7.js";import"./yOFoLqX9.js";const Be={style:{color:"red","margin-left":"30px"}},Fe=["onClick"],Pe=["onClick","title"],Ie=["disabled","onClick"],Ue={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:De,alt:"Visualizar",title:"Reativar"},Le={key:1,src:Ae,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px",cursor:"pointer"},title:"Excluir"},vo={__name:"criar-registro",async setup(Me){var N,B,F,P,I,U,L;let b,E;const{$toast:_}=_e(),C=ve(),y=be(),W=`${y.public.managemant}/createOrdensServico`,G=`${y.public.managemant}/validarCpf`,X=`${y.public.managemant}/listarAtos`,K=`${y.public.managemant}/updateAtos`,Q=u(r("user-data").value.cartorio_id),Y=u(r("user-data").value.usuario_id),Z=u((N=r("user-service").value)==null?void 0:N.token).value||null,ee=u(r("user-data").value.cartorio_token).value,v=u((B=r("user-service").value)==null?void 0:B.numero),V=u((F=r("user-service").value)==null?void 0:F.isDisabled);let R=u(!!((P=r("user-service").value)!=null&&P.numero)),$=u(r("ordem-button").value),w=!1;const O=u(!1),S=u([]),s=fe({nacionalidade:((I=r("user-service").value)==null?void 0:I.estrangeiro)||!1,apresentante_nome:(U=r("user-service").value)==null?void 0:U.apresentante_nome,apresentante_cpf:(L=r("user-service").value)==null?void 0:L.apresentante_cpf}),f=u(!1),oe=[{title:"ID",value:"id"},{title:"Protocolo",value:"protocolo"},{title:"Usuario",value:"usuario_nome"},{title:"Situação",value:"situacao"},{title:"Valor",value:"valor"},{title:"Tipo",value:"tipo"},{value:"actions"}],te=[{title:"BRASILEIRO",value:!1},{title:"ESTRANGEIRO",value:!0}],ae={apresentante_nome:{required:H.withMessage("O campo é obrigatorio",J)},apresentante_cpf:{required:H.withMessage("O campo é obrigatorio",J)}},p=Ee(ae,s);function q(o){if(o)return o.replace(/[.\-]/g,"");o=null}const re=o=>{(o.rota==="/fontes/atos/ato-com-bem/geral"||o.rota==="/fontes/atos/ato-sem-bem/geral")&&C.push({path:`/fontes/atos/atos-com-bem/atualizar/${o.id}`,query:{origem:"atualizar",id:r("user-service").value.id,ato_id:o.id,tipo_ato:o.tipo,tipo_ato_token:o.tipo_token,ato_token_edit:o.token,numero_os:v}})},se=o=>{o.rota==="/fontes/atos/ato-com-bem/geral"||o.rota==="/fontes/atos/ato-sem-bem/geral"?C.push({path:`/fontes/atos/atos-com-bem/atualizar/${o.id}`,query:{origem:"atualizar",id:r("user-service").value.id,ato_id:o.id,tipo_ato:o.tipo,tipo_ato_token:o.tipo_token,ato_token_edit:o.token,numero_os:v.value}}):o.rota==="/fontes/atos/divorcio/geral"&&C.push({path:`/fontes/atos/divorcio/atualizar/${o.id}`,query:{origem:"atualizar",id:r("user-service").value.id,ato_id:o.id,tipo_ato:o.tipo,tipo_ato_token:o.tipo_token,ato_token_edit:o.token,numero_os:v.value}})};function ie(){const o=r("user-service"),e=r("ordem-button");o.value=null,e.value=null}const ne=()=>{O.value=!0};async function le(){const o={apresentante_cpf:q(s.apresentante_cpf),apresentante_nome:s.apresentante_nome,user_id:Y.value,cartorio_id:Q.value,estrangeiro:s.nacionalidade};if(await p.value.$validate()){const{data:e,error:m,status:d}=await A(W,{method:"POST",body:o},"$HqnOwnLBio");if(d.value==="error"&&m.value.statusCode===500)_.error("Erro ao cadastrar ordem,erro no sistema.");else{_.success("Ordem registrada com sucesso!"),R.value=!0,$.value=!1,v.value=e.value.numero;const g=r("ordem-button");g.value=$.value;const t=r("user-service");t.value=t.value=JSON.stringify({numero:e.value.numero,id:e.value.id,apresentante_cpf:e.value.apresentante_cpf,apresentante_nome:e.value.apresentante_nome,estrangeiro:e.value.estrangeiro,token:e.value.token,isDisabled:!0}),f.value=!0}}}async function ue(o){const e=q(o);if(e.length===11&&!w){w=!0;const m={cpf:e};try{const{data:d,error:g,status:t}=await A(G,{method:"POST",body:m},"$DfuVr7OuaN");t.value==="error"&&g.value.statusCode===500?_.error("Erro ao cadastrar pessoa, o CPF já está cadastrado."):d.value.cpfValidation===!0?(s.apresentante_nome=d.value.nome,_.success("Cpf autenticado com sucesso!")):d.value.cpfValidation===!1&&_.error("Cpf não cadastrado!")}catch(d){console.error("Erro ao validar CPF:",d)}finally{w=!1}}}async function de(o){o.excluido=!o.excluido;try{await Re(`${K}/${o.id}`,{method:"PUT",body:{excluido:o.excluido}})}catch(e){console.error("Erro ao excluir pessoa:",e)}}const{data:z}=([b,E]=ge(()=>A(X,{method:"POST",body:{cartorio_token:ee,ordemserv_token:Z}},"$bJ1XcDsWLH")),b=await b,E(),b);return z.value.length>0?S.value=z.value:S.value=[],(o,e)=>{const m=pe,d=me,g=ke("mask");return c(),k(qe,{class:"mt-5"},{default:i(()=>[n(x,{class:"mb-5"},{default:i(()=>{var t;return[e[8]||(e[8]=l("h1",null,"Ordem de Serviço nº",-1)),l("h1",Be,ye(a(v)||((t=("useCookie"in o?o.useCookie:a(r))("user-service").value)==null?void 0:t.numero)),1)]}),_:1}),n(x,null,{default:i(()=>[n(h,{md:"3"},{default:i(()=>[n(ze,{label:"Nacionalidade",items:te,modelValue:a(s).nacionalidade,"onUpdate:modelValue":e[0]||(e[0]=t=>a(s).nacionalidade=t),disabled:a(V)||a(f)},null,8,["modelValue","disabled"])]),_:1}),n(h,{md:"2"},{default:i(()=>[a(s).nacionalidade===!1?Ve((c(),k(D,{key:0,autofocus:"",modelValue:a(s).apresentante_cpf,"onUpdate:modelValue":e[1]||(e[1]=t=>a(s).apresentante_cpf=t),label:"CPF",required:"","error-messages":a(p).apresentante_cpf.$errors.map(t=>t.$message),onBlur:a(p).apresentante_cpf.$touch,onInput:e[2]||(e[2]=t=>ue(a(s).apresentante_cpf)),disabled:a(V)||a(f)},null,8,["modelValue","error-messages","onBlur","disabled"])),[[g,"###.###.###-##"]]):(c(),k(D,{key:1,autofocus:"",modelValue:a(s).apresentante_cpf,"onUpdate:modelValue":e[3]||(e[3]=t=>a(s).apresentante_cpf=t),label:"Documento",required:"","error-messages":a(p).apresentante_cpf.$errors.map(t=>t.$message),onBlur:a(p).apresentante_cpf.$touch,disabled:a(V)||a(f)},null,8,["modelValue","error-messages","onBlur","disabled"]))]),_:1}),n(h,{md:"4"},{default:i(()=>[n(D,{modelValue:a(s).apresentante_nome,"onUpdate:modelValue":e[4]||(e[4]=t=>a(s).apresentante_nome=t),label:"Nome Apresentante",required:"","error-messages":a(p).apresentante_nome.$errors.map(t=>t.$message),onInput:a(p).apresentante_nome.$touch,disabled:a(V)||a(f)},null,8,["modelValue","error-messages","onInput","disabled"])]),_:1}),a($)?(c(),k(h,{key:0},{default:i(()=>[l("div",null,[l("img",{style:{width:"40px",height:"40px",cursor:"pointer"},src:we,alt:"Salvar",onClick:e[5]||(e[5]=t=>le())})])]),_:1})):M("",!0)]),_:1}),a(R)?(c(),k(x,{key:0,style:{display:"flex","margin-bottom":"10px",gap:"2rem"}},{default:i(()=>[e[12]||(e[12]=l("h1",{class:"ml-5"},"Atos",-1)),n(m,{to:{path:"/os/criar-ato",query:{origem:"criar"}}},{default:i(()=>e[9]||(e[9]=[l("img",{style:{width:"45px",height:"45px",cursor:"pointer"},src:Oe,alt:"novo"},null,-1)])),_:1}),n(Ne,{headers:oe,items:a(S),"item-key":"id"},{"item.actions":i(({item:t})=>[n(x,{style:{display:"flex",gap:"2px","margin-top":"-5px"}},{default:i(()=>[l("div",{onClick:T=>re(t),title:"Visualizar"},e[10]||(e[10]=[l("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:Se,alt:"Visualizar"},null,-1)]),8,Fe),l("div",{onClick:e[6]||(e[6]=T=>ne()),title:"Reimprimir"},e[11]||(e[11]=[l("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ce,alt:"Reimprimir"},null,-1)])),l("div",{class:he({disabled:!t.btn_editar}),onClick:T=>t.btn_editar?se({id:t.id,tipo:t.tipo,token:t.token,tipo_token:t.tipo_token,rota:t.rota}):null,title:t.btn_editar?"Editar":"Desabilitado"},[l("img",{style:xe({cursor:t.btn_editar?"pointer":"default",width:"30px",height:"30px"}),src:Te,alt:"Editar"},null,4)],10,Pe),l("div",{disabled:!t.btn_cancelar,onClick:T=>t.btn_cancelar?de(t):null,title:"Excluir"},[t.excluido?(c(),j("img",Ue)):(c(),j("img",Le))],8,Ie)]),_:2},1024)]),_:1},8,["items"]),n(d,{show:a(O),onClose:e[7]||(e[7]=t=>O.value=!1)},null,8,["show"])]),_:1})):M("",!0),n(m,{to:"/os/lista"},{default:i(()=>[n(Ce,{size:"large",color:"red",onClick:ie},{default:i(()=>e[13]||(e[13]=[$e("Voltar")])),_:1})]),_:1})]),_:1})}}};export{vo as default};
