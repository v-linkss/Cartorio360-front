import{_ as ge}from"./D4gjJ9of.js";import{u as me,C as pe,J as ve,r as s,f as he,o as m,j as W,w as t,b as a,i as e,V as de,v as se,d as Q,k as G,l as _e,e as I,y as Re,s as ye,a as q,c as j,M as Ie,g as Fe,N as Ne,F as Ae,H as Be,O as Pe,t as be}from"./BW5HGLCA.js";import{u as v}from"./BFH9Peh9.js";import{V as F}from"./CafMK_aO.js";import{V as L}from"./CFwDmXSa.js";import{V as ke}from"./9gfQT1hF.js";import{V as $e}from"./DFJKrlAb.js";import{_ as Le,a as Ge,b as He,c as Je}from"./C93RBrBK.js";import{_ as Ke,a as We,b as Xe,T as Ye,W as Qe,S as Ze,D as Oe,c as ea}from"./CtNDvqBe.js";import{_ as aa,r as Te}from"./BzghFu55.js";import{_ as Ce}from"./Jd9P4Rdr.js";import{_ as xe}from"./BVz1G1IN.js";import{_ as ta}from"./C5HMd1CL.js";import{_ as oa}from"./CL9H7gqW.js";import{_ as Ee,a as Ve}from"./DJvq3mCv.js";import{V as qe}from"./BO5iD1E3.js";import{_ as Me}from"./CYipB22z.js";import{V as sa}from"./USAmhd1w.js";import{c as De,r as Se,u as je}from"./Cem0PZaX.js";import{f as ze}from"./B0IxRygJ.js";import{_ as ra}from"./-zgYk4Vu.js";const Xa={__name:"Dados",props:{item_dados:{type:Array,required:!0},item_situacoes:{type:Array,required:!0}},setup(ie){const p=ie,{$toast:E}=me(),x=_e(),i=pe(),u=ve(),g=`${x.public.managemant}/updateAtos`,V=s(p.item_situacoes),Z=s(u.query.origem==="vizualizar"),A=he({dt_abertura:p.item_dados[0].dt_abertura||null,status:p.item_dados[0].status||null,mne:p.item_dados[0].mne||null});async function ee(){const{data:N,error:h,status:T}=await v(`${g}/${u.query.ato_id}`,{method:"PUT",body:{status:A.status,mne:A.mne,dt_abertura:A.dt_abertura}},"$EIT5jtTUdX");T.value==="success"&&E.success("Ato Atualizado com sucesso")}const O=()=>{const N=u.query.origem||"criar",h=u.query.id;switch(N){case"atualizar":case"vizualizar":i.push(`/os/atualizar/${h}`);break;case"atualizar-lista":case"vizualizar-lista":i.push("/atos/lista");break;default:i.push("/os/criar-registro");break}};return(N,h)=>{const T=ge;return m(),W($e,null,{default:t(()=>[a(F,{class:"mt-5"},{default:t(()=>[a(L,{cols:"3"},{default:t(()=>[a(ke,{label:"Situação",modelValue:e(A).status,"onUpdate:modelValue":h[0]||(h[0]=_=>e(A).status=_),items:e(V),"item-title":"descricao","item-value":"descricao",required:""},null,8,["modelValue","items"])]),_:1})]),_:1}),a(F,null,{default:t(()=>[a(L,{cols:"5"},{default:t(()=>[a(de,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:e(A).mne,"onUpdate:modelValue":h[1]||(h[1]=_=>e(A).mne=_)},null,8,["modelValue"])]),_:1})]),_:1}),a(F,null,{default:t(()=>[a(L,{cols:"2"},{default:t(()=>[a(de,{modelValue:e(A).dt_abertura,"onUpdate:modelValue":h[2]||(h[2]=_=>e(A).dt_abertura=_),type:"date",label:"Data Lavratura",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),a(F,{class:"mb-3"},{default:t(()=>[a(T,{onClick:O},{default:t(()=>[a(se,{size:"large",color:"red"},{default:t(()=>h[3]||(h[3]=[Q("Voltar")])),_:1})]),_:1}),e(Z)?G("",!0):(m(),W(se,{key:0,class:"ml-10",onClick:ee,size:"large",color:"green"},{default:t(()=>h[4]||(h[4]=[Q("Atualizar")])),_:1}))]),_:1})]),_:1})}}},na={key:0},la=["onClick"],ia={key:0,style:{width:"30px",height:"30px"},src:Ce,alt:"Visualizar"},ca={key:1,style:{width:"30px",height:"30px"},src:ta,alt:"Visualizar"},ua=["onClick"],da=["onClick"],ma={key:0,style:{width:"30px",height:"30px"},src:Ee,alt:"Visualizar",title:"Reativar"},pa={key:1,src:Ve,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},va=["onClick"],Ya={__name:"Partes",async setup(ie){let p,E;const x=pe(),i=ve(),u=_e(),{$toast:g}=me(),V=`${u.public.managemant}/pesquisarPessoas`,Z=`${u.public.managemant}/listarPapeis`,A=`${u.public.managemant}/createAtosPessoa`,ee=`${u.public.managemant}/updateAtosPessoa`,O=`${u.public.managemant}/getAtosPessoaById`,N=`${u.public.managemant}/download`,h=s(I("user-data").value.cartorio_token),T=s(i.query.origem==="vizualizar"),_=s([]),P=s({}),$=s([]),M=s([]),k=s(!1),U=s(!1),X=s(!1),ae=s(!1),Y=s(null),b=s(null),z=s(null),H=s(null),r=s(null),l=s(i.query.tipo_ato_token),y=s(null),D=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"320px"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome",width:"320px"},{value:"actions"}],c=he({papeis:null,nome:null,pessoa:null,documento:null});Re(()=>{var d;return((d=c.pessoa)==null?void 0:d.link_ficha)||!1});const{data:R}=([p,E]=ye(()=>v(Z,{method:"POST",body:{tipo_ato_token:i.query.tipo_ato_token}},"$acoiTIUp00")),p=await p,E(),p);M.value=R.value;const o=async()=>{const{data:d}=await v(`${O}/${i.query.ato_id}`,{method:"GET"},"$ypnU9hCpVn"),K=(fe=>fe.map(le=>({...le,pessoa:{...le.pessoa,documento:le.pessoa.doc_identificacao},papel:{...le.partes_tipos}})))(d.value);$.value=K};o();async function f(){try{const{data:d,error:n}=await v(V,{method:"POST",body:{cartorio_token:h.value,documento:c.documento,nome:c.nome}},"$pr30MyPXfY");d.value.length>0?(_.value=d.value,c.pessoa=_.value[0]):_.value=[]}catch(d){console.error("Erro na requisição",d)}}const J=()=>{U.value=!0},B=async()=>{await o()},w=async()=>{await o()},C=async()=>{const d={pessoa:c.pessoa,papel:M.value.find(ce=>ce.id===c.papeis),representante:{nome:null}},n=await v(`${O}/${i.query.ato_id}`,{method:"GET"},"$scHdIvxj2D");for(const ce of n.data.value)if(ce.pessoa_id===c.pessoa.id&&ce.ato_id===Number(i.query.ato_id)&&ce.tipo_parte_id===c.papeis){g.error("Pessoa Já Registrada Com Esse Papel!");return}const{data:K,error:fe,status:le}=await v(A,{method:"POST",body:{ato_id:Number(i.query.ato_id),pessoa_id:c.pessoa.id,tipo_parte_id:c.papeis,user_id:I("user-data").value.usuario_id}},"$18isAgOJxG");le.value==="success"?(d.id=K.value.id,g.success("Pessoa Registrada com Sucesso!"),$.value.push(d)):g.error(fe.value.message)},te=async d=>{X.value=!0;const{data:n}=await v(N,{method:"POST",body:{bucket:I("user-data").value.cartorio_token,path:d.pessoa.link_ficha}},"$hmDzSF3F61");y.value=n.value,P.value=d.pessoa},re=d=>{const n=$.value.filter(K=>K.pessoa.id!==d.pessoa.id&&!K.excluido).map(K=>({id:K.pessoa.id,nome:K.pessoa.nome}));z.value=d.id,Y.value=n,k.value=!0,b.value=d.pessoa.nome,r.value=d.pessoa.id},ue=d=>{ae.value=!0,H.value=d.id,b.value=d.pessoa.nome};async function oe(d){d.excluido=!d.excluido;try{await v(`${ee}/${d.id}`,{method:"PUT",body:JSON.stringify({excluido:d.excluido})},"$l09I6nLRfk")}catch(n){console.error("Erro ao excluir pessoa:",n)}}const ne=()=>{const d=i.query.origem||"criar",n=i.query.id;switch(d){case"atualizar":case"vizualizar":x.push(`/os/atualizar/${n}`);break;case"atualizar-lista":case"vizualizar-lista":x.push("/atos/lista");break;default:x.push("/os/criar-registro");break}};return(d,n)=>{const K=Le,fe=We,le=Xe,ce=aa,Ue=ge;return m(),W($e,null,{default:t(()=>[e(T)?G("",!0):(m(),W(F,{key:0,class:"mt-5"},{default:t(()=>[a(L,{cols:"3"},{default:t(()=>[a(de,{label:"Documento",modelValue:e(c).documento,"onUpdate:modelValue":n[0]||(n[0]=S=>e(c).documento=S)},null,8,["modelValue"])]),_:1}),a(L,{cols:"4"},{default:t(()=>[a(de,{label:"Pessoa",modelValue:e(c).nome,"onUpdate:modelValue":n[1]||(n[1]=S=>e(c).nome=S)},null,8,["modelValue"])]),_:1}),q("div",null,[q("img",{class:"mt-1",src:Ce,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:f})]),q("div",null,[q("img",{class:"mt-1 ml-2",src:xe,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:J})])]),_:1})),e(T)?G("",!0):(m(),W(F,{key:1},{default:t(()=>[a(L,{cols:"4"},{default:t(()=>[a(ke,{label:"Selecione a Pessoa",modelValue:e(c).pessoa,"onUpdate:modelValue":n[2]||(n[2]=S=>e(c).pessoa=S),items:e(_),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),a(L,{cols:"3"},{default:t(()=>[a(ke,{label:"Papel",modelValue:e(c).papeis,"onUpdate:modelValue":n[3]||(n[3]=S=>e(c).papeis=S),items:e(M),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),e(T)?G("",!0):(m(),j("div",na,[q("img",{class:"mt-1",src:xe,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:C})]))]),_:1})),a(F,null,{default:t(()=>[a(L,null,{default:t(()=>[a(qe,{style:{height:"465px"},headers:D,items:e($)},{"item.actions":t(({item:S})=>[e(T)?G("",!0):(m(),W(F,{key:0},{default:t(()=>[q("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-1",onClick:we=>te(S),title:"Visualizar Ficha"},[S.pessoa.link_ficha?(m(),j("img",ia)):(m(),j("img",ca))],8,la),q("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:we=>ue(S),class:"mr-1",title:"Alterar Papel"},n[8]||(n[8]=[q("img",{style:{width:"30px",height:"30px"},src:oa,alt:"Visualizar"},null,-1)]),8,ua),q("div",{class:"mr-1",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:we=>oe(S),title:"Deletar Pessoa"},[S.excluido?(m(),j("img",ma)):(m(),j("img",pa))],8,da),q("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-1",onClick:we=>re(S),title:"Selecionar Representante"},n[9]||(n[9]=[q("img",{style:{width:"30px",height:"30px"},src:Ke,alt:"Visualizar"},null,-1)]),8,va)]),_:2},1024))]),_:1},8,["items"])]),_:1})]),_:1}),a(K,{show:e(U),onClose:n[4]||(n[4]=S=>U.value=!1)},null,8,["show"]),a(fe,{representante_nome:e(b),representantes:e(Y),ato_id:e(z),show:e(k),onClose:n[5]||(n[5]=S=>k.value=!1),onUpdateRepresentante:w},null,8,["representante_nome","representantes","ato_id","show"]),a(le,{representante_nome:e(b),ato_token:e(l),ato_id:e(H),show:e(ae),onClose:n[6]||(n[6]=S=>ae.value=!1),onUpdatePapel:B},null,8,["representante_nome","ato_token","ato_id","show"]),e(X)?(m(),W(ce,{key:2,show:e(X),"link-view":e(y),"pessoa-obj":e(P),"is-view":!0,onClose:n[7]||(n[7]=S=>X.value=!1)},null,8,["show","link-view","pessoa-obj"])):G("",!0),a(F,null,{default:t(()=>[a(Ue,{onClick:ne},{default:t(()=>[a(se,{size:"large",color:"red"},{default:t(()=>n[10]||(n[10]=[Q("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},_a={key:0,class:"loading-overlay"},fa="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",Qa={__name:"Minuta",emits:["page","doc"],setup(ie,{emit:p}){Ie("DocumentEditorContainer",[Ye,Qe,Ze]);const E=_e(),{$toast:x}=me(),i=pe(),u=ve(),g=p;Te(`${E.public.docEditor}`);const V=`${E.public.managemant}/download`,Z=`${E.public.managemant}/atos/files`,A=`${E.public.managemant}/subitituirModelo`,ee=`${E.public.managemant}/upload`,O=s(null),N=s(!1),h=s("Ao executar a geração, a minuta atual será substituída e não poderá ser recuperada.Confirma ?"),T=s(u.query.origem==="vizualizar"),_=s(!1),P=async r=>{try{const l=await fetch(r);if(!l.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await l.blob()}catch(l){return console.error(l),null}},$=async()=>{try{const{data:r}=await v(`${Z}/${u.query.ato_token_edit}`,{method:"GET"},"$5jxI4TvFse");return r.value.link_ato}catch(r){console.error("Erro ao carregar o documento:",r),x.error(r)}},M=async()=>{_.value=!0;try{const r=await $(),{data:l,status:y}=await v(V,{method:"POST",body:{bucket:I("user-data").value.cartorio_token,path:r}},"$dvNFfvmIJC"),D=l.value,c=await P(D);if(c){const R=new FileReader;R.onload=()=>{const o=R.result;O.value.ej2Instances.documentEditor.open(o),g("doc",o)},R.readAsText(c)}}catch{console.error("Erro ao carregar o documento.")}finally{_.value=!1}},k=async()=>{const l=await O.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),y=new FileReader;y.onload=()=>{const D=y.result,R=O.value.ej2Instances.documentEditor.pageCount;g("page",R),g("doc",D)},y.readAsText(l)},U=async()=>{_.value=!0;try{const l=await O.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),y=new FormData;y.append("file",l,"anexo.sfdt"),y.append("cartorio_token",I("user-data").value.cartorio_token),y.append("token",u.query.ato_token_edit),y.append("tipo","ato_minuta");const{data:D,status:c}=await v(ee,{method:"POST",body:y},"$xv11VtUdMy");if(c.value==="success"){x.success("Documento enviado!");const o=O.value.ej2Instances.documentEditor.pageCount;k(),g("page",o)}else x.error("Erro ao enviar documento para o sistema.")}catch(r){x.error("Erro ao salvar documento."),console.error(r)}finally{_.value=!1}},X=()=>{N.value=!1,ae()},ae=async()=>{z(!0);try{await Y(),z(!0);const{data:r,status:l}=await v(A,{method:"POST",body:{ato_token:u.query.ato_token_edit}},"$zyzWHTXTBW");r.value&&b(r.value)}catch(r){console.error("Erro ao gerar a minuta:",r),x.error("Ocorreu um erro ao gerar a minuta.")}finally{z(!1)}},Y=async()=>{try{const{data:r}=await v(V,{method:"POST",body:{bucket:I("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$KreLE0Ys81"),l=await P(r.value);if(l){const y=new FileReader;y.onload=()=>{const D=y.result;O.value.ej2Instances.documentEditor.open(D),g("doc",D)},y.readAsText(l)}}catch(r){console.error("Erro ao carregar o modelo de minuta:",r)}},b=r=>{const l=O.value.ej2Instances.documentEditor,y=D=>{for(const[c,R]of Object.entries(D))if(/^<<.+>>$/.test(c))try{l.search.findAll(c),l.search.searchResults.length>0&&l.search.searchResults.replaceAll(R)}catch(o){console.error(`Erro ao substituir o marcador ${c}:`,o)}else if(c==="partes"&&Array.isArray(R)&&R.length>0)for(const o of R)typeof o=="object"&&y(o)};y(r)},z=r=>{_.value=r},H=()=>{const r=u.query.origem||"criar",l=u.query.id;switch(r){case"atualizar":case"vizualizar":i.push(`/os/atualizar/${l}`);break;case"atualizar-lista":case"vizualizar-lista":i.push("/atos/lista");break;default:i.push("/os/criar-registro");break}};return Fe(async()=>{await M(),k()}),(r,l)=>{const y=ge,D=Me;return m(),j(Ae,null,[a(e(Oe),{height:"900px",ref_key:"documentEditorContainer",ref:O,serviceUrl:fa,enableToolbar:!0,enableWordExport:!0},null,512),e(_)?(m(),j("div",_a,[a(Ne,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):G("",!0),a(F,{class:"ml-4 mt-4 mb-4"},{default:t(()=>[a(y,{class:"mr-4"},{default:t(()=>[a(se,{size:"large",onClick:H,color:"red"},{default:t(()=>l[2]||(l[2]=[Q("Voltar")])),_:1})]),_:1}),e(T)?G("",!0):(m(),W(se,{key:0,size:"large",color:"green",onClick:U,disabled:e(_)},{default:t(()=>l[3]||(l[3]=[Q("Atualizar")])),_:1},8,["disabled"])),e(T)?G("",!0):(m(),W(se,{key:1,class:"ml-4",size:"large",color:"blue",onClick:l[0]||(l[0]=c=>N.value=!0)},{default:t(()=>l[4]||(l[4]=[Q("Gerar Minuta")])),_:1}))]),_:1}),a(D,{onConfirm:X,condMessage:e(h),show:e(N),onClose:l[1]||(l[1]=c=>N.value=!1)},null,8,["condMessage","show"])],64)}}},ya=["innerHTML"],Za={__name:"Livro",props:{pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(ie){let p,E;const x=ie,i=_e();Te(`${i.public.docEditor}`);const{$toast:u}=me(),g=pe(),V=ve(),Z=`${i.public.managemant}/download`,A=`${i.public.managemant}/atos/files`,ee=`${i.public.managemant}/lavrarAto`,O=`${i.public.managemant}/valida_lavratura`,N=`${i.public.managemant}/listarEscrevente`,h=`${i.public.managemant}/ato_calcular`,T=s(I("user-data").value.cartorio_token),_=I("auth_token").value,P=s("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),$=s(null),M=s(""),k=s(!1),U=s(null),X=s(null),ae=s(V.query.origem==="vizualizar"),Y=s(null),b=s([]),z=s({}),H=he({escrevente:null}),r=async w=>{try{const C=await fetch(w);if(!C.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await C.blob()}catch(C){return console.error(C),null}},l=async()=>{try{const{data:w}=await v(`${A}/${V.query.ato_token_edit}`,{method:"GET"},"$FnEbAJEARP");return w.value.link_ato}catch(w){console.error("Erro ao carregar o documento:",w),u.error(w)}},y=async()=>{try{const w=await l(),{data:C,status:te}=await v(Z,{method:"POST",body:{bucket:I("user-data").value.cartorio_token,path:w}},"$7ljqltMqa0"),re=C.value,ue=await r(re);if(ue){const oe=new FileReader;oe.onload=()=>{const ne=oe.result;Y.value.ej2Instances.documentEditor.open(ne)},oe.readAsText(ue)}}catch{u.error("Erro ao carregar o documento.")}};y();const D=async(w=!1)=>{const C=Y.value.ej2Instances.documentEditor.pageCount;if(!w){const{data:oe,error:ne,status:d}=await v(O,{method:"POST",body:{ato_token:V.query.ato_token_edit}},"$OWxZSQkyX8");let n,K;if(d.value==="success"&&oe.value?(n=oe.value[0].status,K=oe.value[0].status_mensagem):ne.value&&ne.value.data&&(n=ne.value.data[0].status,K=ne.value.data[0].status_mensagem),n!=="OK"){$.value=n,M.value=K,z.value=null,k.value=!0,P.value=" O ato apresenta inconsistências, deseja prosseguir?";return}}const{data:te,status:re,error:ue}=await v(ee,{method:"POST",body:{ato_token:V.query.ato_token_edit,qtd_paginas:C,escrevente_token:H.escrevente,usuario_token:_,cartorio_token:T}},"$sMqfUUQcBM");re.value==="success"?(U.value=te.value,X.value=te.value[0].selo,u.success("Ato lavrado com sucesso!")):u.error(ue.value.data[0].status_mensagem||"Falha ao lavrar o ato.")},c=()=>{k.value=!1,$.value=null,M.value="",z.value={}},R=async()=>{const w=Y.value.ej2Instances.documentEditor.pageCount,{data:C,status:te}=await v(h,{method:"POST",body:{ato_token:V.query.ato_token_edit,cartorio_token:T,quantidade:1,usuario_token:_,escrevente_token:H.escrevente,qtd_paginas:w}},"$OVwiKSwcOE");te.value==="success"?z.value=C.value[0]:u.error("Falha ao calcular o ato.")},o=async()=>{k.value=!1,$.value&&$.value!=="OK"?(await D(!0),$.value=null,M.value=""):await D()},f=async()=>{k.value=!0,P.value="Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?",await R()},{data:J}=([p,E]=ye(()=>v(N,{method:"POST",body:{cartorio_token:T}},"$iv1N3XD6We")),p=await p,E(),p);b.value=J.value[0].func_json_escreventes;const B=()=>{const w=V.query.origem||"criar",C=V.query.id;switch(w){case"atualizar":case"vizualizar":g.push(`/os/atualizar/${C}`);break;case"atualizar-lista":case"vizualizar-lista":g.push("/atos/lista");break;default:g.push("/os/criar-registro");break}};return Be(()=>x.document,(w,C)=>{y()}),(w,C)=>{const te=Me;return m(),j(Ae,null,[a(F,null,{default:t(()=>[a(L,null,{default:t(()=>[a(e(Oe),{restrictEditing:!0,enableToolbar:!1,ref_key:"documentEditorContainer",ref:Y,height:"850px",width:"850px"},null,512)]),_:1}),e(ae)?G("",!0):(m(),W(L,{key:0},{default:t(()=>[a(ke,{class:"mt-15",label:"Tabelião/escrevente",modelValue:e(H).escrevente,"onUpdate:modelValue":C[0]||(C[0]=re=>e(H).escrevente=re),items:e(b),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),q("img",{onClick:C[1]||(C[1]=re=>f()),style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:ea}),e(U)?(m(),W(sa,{key:0,width:"360"},{default:t(()=>[a(F,null,{default:t(()=>[a(L,null,{default:t(()=>[a(Pe,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:t(()=>[a(L,null,{default:t(()=>[Q(" Livro: "+be(e(U)[0].livro_numero),1)]),_:1}),a(L,null,{default:t(()=>[Q(" Protocolo: "+be(e(U)[0].protocolo?e(U)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),a(L,null,{default:t(()=>[a(Pe,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:t(()=>[Q(" Folhas : "+be(e(U)[0].pagina_inicial)+" A "+be(e(U)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),q("div",{style:{"margin-left":"10px","padding-bottom":"20px","margin-top":"-10px"},innerHTML:e(X)},null,8,ya)]),_:1})):G("",!0)]),_:1}))]),_:1}),a(se,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:B},{default:t(()=>C[2]||(C[2]=[Q("Voltar")])),_:1}),a(te,{show:e(k),condMessage:e(P),description:e(M),valor:e(z),onClose:c,onConfirm:o},null,8,["show","condMessage","description","valor"])],64)}}},ga=["onClick"],ha={key:0,style:{width:"30px",height:"30px"},src:Ee,alt:"Visualizar",title:"Reativar"},ba={key:1,src:Ve,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},et={__name:"Observacao",props:{ato_id:{type:Number,required:!0}},async setup(ie){let p,E;const x=pe(),i=ve(),u=_e(),{$toast:g}=me(),V=`${u.public.managemant}/listarEscrevente`;`${u.public.managemant}`;const Z=`${u.public.managemant}/atos_observacao`,A=`${u.public.managemant}/atos_observacao`,ee=`${u.public.managemant}/atos_observacao`,O=s(I("user-data").value.cartorio_token),N=s(i.query.origem==="vizualizar"),h=s([]),T=s([]),_=[{title:"Data",align:"start",key:"created"},{title:"Escrevente",align:"start",key:"users.nome"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}],P=he({observacao:""}),$={observacao:{required:De.withMessage("O campo é obrigatório",Se)}},M=je($,P),{data:k}=([p,E]=ye(()=>v(`${ee}/${i.query.ato_id}`,{method:"GET"},"$HyzoO40swN")),p=await p,E(),p);Array.isArray(k.value)?h.value=k.value.map(b=>({...b,created:ze(b.created,"dd/mm/yyyy hh:mm")})):k.value&&typeof k.value=="object"&&(h.value=[{...k.value,created:ze(k.value.created,"dd/mm/yyyy hh:mm")}]);async function U(){if(P.observacao.trim()===""){g.error("O campo de observação está vazio.");return}if(await M.value.$validate()){const{data:b,error:z,status:H}=await v(Z,{method:"POST",body:{ato_id:Number(i.query.ato_id),observacao:P.observacao,user_id:I("user-data").value.usuario_id}},"$gnHMo4uCXD");H.value==="success"&&(h.value.push({created:ze(b.value.created,"dd/mm/yyyy hh:mm"),observacao:b.value.observacao,id:b.value.id,escrevente:I("user-data").value.nome}),P.observacao="",g.success("Observação registrada com sucesso"))}else g.error("Preencha os campos obrigatórios.")}async function X(b){b.excluido=!b.excluido;try{await v(`${A}/${b.id}`,{method:"PUT",body:JSON.stringify({excluido:b.excluido})},"$sP9AKdd3Ky")}catch(z){console.error("Erro ao excluir observação:",z)}}const{data:ae}=([p,E]=ye(()=>v(V,{method:"POST",body:{cartorio_token:O}},"$HL9pndqGh0")),p=await p,E(),p);T.value=ae.value[0].func_json_escreventes;const Y=()=>{const b=i.query.origem||"criar",z=i.query.id;switch(b){case"atualizar":case"vizualizar":x.push(`/os/atualizar/${z}`);break;case"atualizar-lista":case"vizualizar-lista":x.push("/atos/lista");break;default:x.push("/os/criar-registro");break}};return(b,z)=>{const H=ge;return m(),W($e,null,{default:t(()=>[N.value?G("",!0):(m(),W(F,{key:0,class:"mt-5"},{default:t(()=>[a(de,{label:"Observação",modelValue:P.observacao,"onUpdate:modelValue":z[0]||(z[0]=r=>P.observacao=r),required:"","error-messages":e(M).observacao.$errors.length>0?e(M).observacao.$errors.map(r=>r.$message):[],onBlur:e(M).observacao.$touch,onInput:e(M).observacao.$touch},null,8,["modelValue","error-messages","onBlur","onInput"]),q("div",null,[q("img",{class:"btn-pointer ml-2",src:xe,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:U})])]),_:1})),a(F,null,{default:t(()=>[a(L,null,{default:t(()=>[a(qe,{style:{height:"465px"},headers:_,items:h.value},{"item.actions":t(({item:r})=>[q("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:l=>X(r),title:"Deletar Observação"},[r.excluido?(m(),j("img",ha)):(m(),j("img",ba))],8,ga)]),_:1},8,["items"])]),_:1})]),_:1}),a(F,null,{default:t(()=>[a(H,{onClick:Y},{default:t(()=>[a(se,{size:"large",color:"red"},{default:t(()=>z[1]||(z[1]=[Q("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},ka={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:He,alt:"Criar"},xa={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Je,alt:"Criar"},$a={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:ra,alt:"Criar"},wa=["onClick"],za=["onClick"],Ca=["onClick"],Ea={key:0,style:{width:"30px",height:"30px"},src:Ee,alt:"Visualizar",title:"Reativar"},Va={key:1,src:Ve,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},at={__name:"Anexos",async setup(ie){let p,E;const x=_e(),{$toast:i}=me(),u=pe(),g=ve(),V=s(g.query.origem==="vizualizar"),Z=`${x.public.biometria}/run-scanner`,A=`${x.public.managemant}/atos_anexos`,ee=`${x.public.managemant}/atos_anexos`,O=`${x.public.managemant}/download`,N=`${x.public.managemant}/atos_anexos`,h=`${x.public.managemant}/upload`,T=s(!1),_=s(null),P=s([]);I("pessoa_token");const $=he({descricao:"",fileEvent:null}),M={descricao:{required:De.withMessage("O campo é obrigatório",Se)}},k=je(M,$,{$autoDirty:!0}),U=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}],{data:X}=([p,E]=ye(()=>v(`${N}/${g.query.ato_id}`,{method:"GET"},"$AOZpbz65MA")),p=await p,E(),p);P.value=X.value;async function ae(){try{await Y(),await b()}catch(o){console.error("Erro ao executar scanner ou listar arquivos:",o)}}async function Y(){try{const{data:o}=await v(Z,{method:"GET"},"$KttjFhHivJ")}catch(o){i.error("Erro ao acionar o scanner:",o)}}async function b(){try{const{data:o,status:f}=await v("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:g.query.ato_token_edit,cartorio_token:I("user-data").value.cartorio_token}},"$TqQrsgxUkd")}catch(o){console.error("Erro ao enviar o arquivo:",o)}}async function z(){try{const o=document.createElement("input");o.type="file",o.accept="*/*",o.onchange=async f=>{$.fileEvent=f,f.target.files[0]&&(_.value=!0)},o.click()}catch(o){console.error("Erro ao abrir o explorador de arquivos:",o)}}const H=async()=>{T.value=!0};function r(o){return o?!0:(_.value=!1,!1)}const l=async o=>{if(!$.fileEvent||!$.fileEvent.target.files.length){i.error("Nenhum arquivo selecionado.");return}const f=$.fileEvent.target.files[0],J=new FormData;J.append("file",f),J.append("cartorio_token",I("user-data").value.cartorio_token),J.append("token",o),J.append("tipo","ato_anexo");try{const B=await v(h,{method:"POST",body:J},"$KDhIYzGKzM");i.success("Anexo registrado com sucesso!")}catch{i.error("Erro ao enviar o arquivo.")}},y=async()=>{if(k.value.$touch(),!k.value.$invalid&&r($.fileEvent)){const{data:o,error:f,status:J}=await v(A,{method:"POST",body:{ato_id:g.query.ato_id,descricao:$.descricao,user_id:I("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$cdoFBGO0Ti");J.value==="success"&&(i.success("Anexo registrado com sucesso!"),P.value.push(o.value),l(o.value.token))}};async function D(o){o.excluido=!o.excluido;try{await v(`${ee}/${o.id}`,{method:"PUT",body:JSON.stringify({excluido:o.excluido})},"$WLSrgYRoHq")}catch(f){console.error("Erro ao excluir pessoa:",f)}}async function c(o){try{const f=await v(`${O}`,{method:"POST",body:{bucket:I("user-data").value.cartorio_token,path:o.link}},"$NdgRjioizH"),B=await(await fetch(f.data.value)).blob(),w=URL.createObjectURL(B);window.open(w,"_blank")}catch(f){console.error("Erro ao excluir pessoa:",f)}}const R=()=>{const o=g.query.origem||"criar",f=g.query.id;switch(o){case"atualizar":case"vizualizar":u.push(`/os/atualizar/${f}`);break;case"atualizar-lista":case"vizualizar-lista":u.push("/atos/lista");break;default:u.push("/os/criar-registro");break}};return(o,f)=>{const J=ge;return m(),W($e,null,{default:t(()=>[a(F,null,{default:t(()=>[a(L,{cols:"5",class:"mt-2"},{default:t(()=>[e(V)?G("",!0):(m(),W(de,{key:0,modelValue:e($).descricao,"onUpdate:modelValue":[f[0]||(f[0]=B=>e($).descricao=B),e(k).descricao.$touch],"error-messages":e(k).descricao.$errors.map(B=>B.$message),onBlur:e(k).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"]))]),_:1}),e(V)?G("",!0):(m(),j("div",{key:0,onClick:ae,title:"Escanear"},f[1]||(f[1]=[q("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ge,alt:"Escanear"},null,-1)]))),e(V)?G("",!0):(m(),j("div",{key:1,onClick:z,title:"Criar"},[e(_)===!1?(m(),j("img",ka)):e(_)===!0?(m(),j("img",xa)):(m(),j("img",$a))])),e(V)?G("",!0):(m(),j("div",{key:2,onClick:y,title:"Criar"},f[2]||(f[2]=[q("img",{class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:xe,alt:"Criar"},null,-1)])))]),_:1}),a(qe,{headers:U,items:e(P),style:{height:"465px","max-width":"600px"}},{"item.actions":t(({item:B})=>[a(F,null,{default:t(()=>[q("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:w=>H(B),title:"Visualizar Anexo"},[q("img",{style:{width:"30px",height:"30px"},onClick:w=>c(B),src:Ce,alt:"Visualizar"},null,8,za)],8,wa),q("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:w=>D(B),title:"Deletar Pessoa"},[B.excluido?(m(),j("img",Ea)):(m(),j("img",Va))],8,Ca)]),_:2},1024)]),_:1},8,["items"]),a(J,{onClick:R},{default:t(()=>[a(se,{size:"large",color:"red"},{default:t(()=>f[3]||(f[3]=[Q("Voltar")])),_:1})]),_:1})]),_:1})}}};export{Xa as _,Ya as a,Qa as b,Za as c,et as d,at as e};
