import{_ as pe}from"./BJ2YU6Nn.js";import{u as ne,m as le,O as ie,r as n,p as _e,o as p,y as G,w as a,b as t,x as e,V as re,I as te,d as W,z as B,A as ce,n as j,K as je,H as me,a as V,c as F,Q as Re,q as Ie,R as Ne,F as qe,g as Be,S as Ve,t as fe}from"./BPizYgB5.js";import{u as f}from"./Dqk3rEyG.js";import{V as R}from"./DGRZkbeD.js";import{V as N}from"./DVpiqkg3.js";import{V as ye}from"./Dg4DipYH.js";import{V as he}from"./BDeleqxk.js";import{_ as Le}from"./CGgmw5dx.js";import{_ as Ge,a as He,b as Je,T as Ke,W as We,S as Xe,D as Ae,c as Qe,d as Ye,e as Ze,f as et}from"./wzpUnhmx.js";import{_ as tt,r as Pe}from"./DNDcqs-6.js";import{_ as xe}from"./DLadyE2z.js";import{_ as ge}from"./BVz1G1IN.js";import{_ as at}from"./5Wt2_eTF.js";import{_ as ot}from"./BNBCRI8U.js";import{_ as we,a as ze}from"./DJvq3mCv.js";import{V as Ce}from"./pQhNd3Ul.js";import{_ as Oe}from"./DpfF6lBN.js";import{V as st}from"./C3JYGKVl.js";import{c as Te,r as De,u as Se}from"./Vtb-KpiN.js";import{f as $e}from"./B0IxRygJ.js";import{_ as rt}from"./-zgYk4Vu.js";const Xt={__name:"Dados",props:{item_dados:{type:Array,required:!0},item_situacoes:{type:Array,required:!0}},setup(oe){const v=oe,{$toast:z}=ne(),$=ce(),c=le(),d=ie(),h=`${$.public.managemant}/updateAtos`,q=n(v.item_situacoes),X=n(d.query.origem==="vizualizar"),P=_e({dt_abertura:v.item_dados[0].dt_abertura||null,status:v.item_dados[0].status||null,mne:v.item_dados[0].mne||null});async function Q(){const{data:I,error:b,status:T}=await f(`${h}/${d.query.ato_id}`,{method:"PUT",body:{status:P.status,mne:P.mne,dt_abertura:P.dt_abertura}},"$EIT5jtTUdX");T.value==="success"&&z.success("Ato Atualizado com sucesso")}const O=()=>{const I=d.query.origem||"criar",b=d.query.id;switch(I){case"atualizar":case"vizualizar":c.push(`/os/atualizar/${b}`);break;case"atualizar-lista":case"vizualizar-lista":c.push("/atos/lista");break;default:c.push("/os/criar-registro");break}};return(I,b)=>{const T=pe;return p(),G(he,null,{default:a(()=>[t(R,{class:"mt-5"},{default:a(()=>[t(N,{cols:"3"},{default:a(()=>[t(ye,{label:"Situação",modelValue:e(P).status,"onUpdate:modelValue":b[0]||(b[0]=y=>e(P).status=y),items:e(q),"item-title":"descricao","item-value":"descricao",required:""},null,8,["modelValue","items"])]),_:1})]),_:1}),t(R,null,{default:a(()=>[t(N,{cols:"5"},{default:a(()=>[t(re,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:e(P).mne,"onUpdate:modelValue":b[1]||(b[1]=y=>e(P).mne=y)},null,8,["modelValue"])]),_:1})]),_:1}),t(R,null,{default:a(()=>[t(N,{cols:"2"},{default:a(()=>[t(re,{modelValue:e(P).dt_abertura,"onUpdate:modelValue":b[2]||(b[2]=y=>e(P).dt_abertura=y),type:"date",label:"Data Lavratura",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),t(R,{class:"mb-3"},{default:a(()=>[t(T,{onClick:O},{default:a(()=>[t(te,{size:"large",color:"red"},{default:a(()=>b[3]||(b[3]=[W("Voltar")])),_:1})]),_:1}),e(X)?B("",!0):(p(),G(te,{key:0,class:"ml-10",onClick:Q,size:"large",color:"green"},{default:a(()=>b[4]||(b[4]=[W("Atualizar")])),_:1}))]),_:1})]),_:1})}}},nt={key:0},lt=["onClick"],it={key:0,style:{width:"30px",height:"30px"},src:xe,alt:"Visualizar"},ct={key:1,style:{width:"30px",height:"30px"},src:at,alt:"Visualizar"},ut=["onClick"],dt=["onClick"],mt={key:0,style:{width:"30px",height:"30px"},src:we,alt:"Visualizar",title:"Reativar"},pt={key:1,src:ze,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},_t=["onClick"],Qt={__name:"Partes",async setup(oe){let v,z;const $=le(),c=ie(),d=ce(),{$toast:h}=ne(),q=`${d.public.managemant}/pesquisarPessoas`,X=`${d.public.managemant}/listarPapeis`,P=`${d.public.managemant}/createAtosPessoa`,Q=`${d.public.managemant}/updateAtosPessoa`,O=`${d.public.managemant}/getAtosPessoaById`,I=`${d.public.managemant}/download`,b=n(j("user-data").value.cartorio_token),T=n(c.query.origem==="vizualizar"),y=n([]),D=n({}),x=n([]),C=n([]),w=n(!1),Y=n(!1),L=n(!1),J=n(!1),Z=n(null),g=n(null),A=n(null),K=n(null),r=n(null),i=n(c.query.tipo_ato_token),k=n(null),M=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"30%"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome",width:"25%"},{value:"actions"}],u=_e({papeis:null,nome:null,pessoa:null,documento:null});je(()=>{var _;return((_=u.pessoa)==null?void 0:_.link_ficha)||!1});const{data:U}=([v,z]=me(()=>f(X,{method:"POST",body:{tipo_ato_token:c.query.tipo_ato_token}},"$acoiTIUp00")),v=await v,z(),v);C.value=U.value;const o=async()=>{const{data:_}=await f(`${O}/${c.query.ato_id}`,{method:"GET"},"$ypnU9hCpVn"),ee=(de=>de.map(ae=>({...ae,pessoa:{...ae.pessoa,documento:ae.pessoa.doc_identificacao},papel:{...ae.partes_tipos}})))(_.value);x.value=ee};o();async function s(){try{const{data:_,error:m}=await f(q,{method:"POST",body:{cartorio_token:b.value,documento:u.documento,nome:u.nome}},"$pr30MyPXfY");_.value.length>0?(y.value=_.value,u.pessoa=y.value[0]):y.value=[]}catch(_){console.error("Erro na requisição",_)}}const l=()=>{Y.value=!0},E=async()=>{await o()},H=async()=>{await o()},ve=async()=>{const _={pessoa:u.pessoa,papel:C.value.find(se=>se.id===u.papeis),representante:{nome:null}},m=await f(`${O}/${c.query.ato_id}`,{method:"GET"},"$scHdIvxj2D");for(const se of m.data.value)if(se.pessoa_id===u.pessoa.id&&se.ato_id===Number(c.query.ato_id)&&se.tipo_parte_id===u.papeis){h.error("Pessoa Já Registrada Com Esse Papel!");return}const{data:ee,error:de,status:ae}=await f(P,{method:"POST",body:{ato_id:Number(c.query.ato_id),pessoa_id:u.pessoa.id,tipo_parte_id:u.papeis,user_id:j("user-data").value.usuario_id}},"$18isAgOJxG");ae.value==="success"?(_.id=ee.value.id,h.success("Pessoa Registrada com Sucesso!"),x.value.push(_)):h.error(de.value.message)},ue=async _=>{L.value=!0;const{data:m}=await f(I,{method:"POST",body:{bucket:j("user-data").value.cartorio_token,path:_.pessoa.link_ficha}},"$hmDzSF3F61");k.value=m.value,D.value=_.pessoa},be=_=>{const m=x.value.filter(ee=>ee.pessoa.id!==_.pessoa.id&&!ee.excluido).map(ee=>({id:ee.pessoa.id,nome:ee.pessoa.nome}));A.value=_.id,Z.value=m,w.value=!0,g.value=_.pessoa.nome,r.value=_.pessoa.id},Ee=_=>{J.value=!0,K.value=_.id,g.value=_.pessoa.nome};async function Fe(_){_.excluido=!_.excluido;try{await f(`${Q}/${_.id}`,{method:"PUT",body:JSON.stringify({excluido:_.excluido})},"$l09I6nLRfk")}catch(m){console.error("Erro ao excluir pessoa:",m)}}const Me=()=>{const _=c.query.origem||"criar",m=c.query.id;switch(_){case"atualizar":case"vizualizar":$.push(`/os/atualizar/${m}`);break;case"atualizar-lista":case"vizualizar-lista":$.push("/atos/lista");break;default:$.push("/os/criar-registro");break}};return(_,m)=>{const ee=Le,de=He,ae=Je,se=tt,Ue=pe;return p(),G(he,null,{default:a(()=>[e(T)?B("",!0):(p(),G(R,{key:0,class:"mt-5"},{default:a(()=>[t(N,{cols:"3"},{default:a(()=>[t(re,{label:"Documento",modelValue:e(u).documento,"onUpdate:modelValue":m[0]||(m[0]=S=>e(u).documento=S)},null,8,["modelValue"])]),_:1}),t(N,{cols:"4"},{default:a(()=>[t(re,{label:"Pessoa",modelValue:e(u).nome,"onUpdate:modelValue":m[1]||(m[1]=S=>e(u).nome=S)},null,8,["modelValue"])]),_:1}),V("div",null,[V("img",{class:"mt-1",src:xe,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:s})]),V("div",null,[V("img",{class:"mt-1 ml-2",src:ge,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:l})])]),_:1})),e(T)?B("",!0):(p(),G(R,{key:1},{default:a(()=>[t(N,{cols:"4"},{default:a(()=>[t(ye,{label:"Selecione a Pessoa",modelValue:e(u).pessoa,"onUpdate:modelValue":m[2]||(m[2]=S=>e(u).pessoa=S),items:e(y),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),t(N,{cols:"3"},{default:a(()=>[t(ye,{label:"Papel",modelValue:e(u).papeis,"onUpdate:modelValue":m[3]||(m[3]=S=>e(u).papeis=S),items:e(C),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),e(T)?B("",!0):(p(),F("div",nt,[V("img",{class:"mt-1",src:ge,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:ve})]))]),_:1})),t(R,null,{default:a(()=>[t(N,null,{default:a(()=>[t(Ce,{style:{height:"465px"},headers:M,items:e(x)},{"item.actions":a(({item:S})=>[e(T)?B("",!0):(p(),G(R,{key:0},{default:a(()=>[V("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-1",onClick:ke=>ue(S),title:"Visualizar Ficha"},[S.pessoa.link_ficha?(p(),F("img",it)):(p(),F("img",ct))],8,lt),V("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ke=>Ee(S),class:"mr-1",title:"Alterar Papel"},m[8]||(m[8]=[V("img",{style:{width:"30px",height:"30px"},src:ot,alt:"Visualizar"},null,-1)]),8,ut),V("div",{class:"mr-1",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ke=>Fe(S),title:"Deletar Pessoa"},[S.excluido?(p(),F("img",mt)):(p(),F("img",pt))],8,dt),V("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-1",onClick:ke=>be(S),title:"Selecionar Representante"},m[9]||(m[9]=[V("img",{style:{width:"30px",height:"30px"},src:Ge,alt:"Visualizar"},null,-1)]),8,_t)]),_:2},1024))]),_:1},8,["items"])]),_:1})]),_:1}),t(ee,{show:e(Y),onClose:m[4]||(m[4]=S=>Y.value=!1)},null,8,["show"]),t(de,{representante_nome:e(g),representantes:e(Z),ato_id:e(A),show:e(w),onClose:m[5]||(m[5]=S=>w.value=!1),onUpdateRepresentante:H},null,8,["representante_nome","representantes","ato_id","show"]),t(ae,{representante_nome:e(g),ato_token:e(i),ato_id:e(K),show:e(J),onClose:m[6]||(m[6]=S=>J.value=!1),onUpdatePapel:E},null,8,["representante_nome","ato_token","ato_id","show"]),e(L)?(p(),G(se,{key:2,show:e(L),"link-view":e(k),"pessoa-obj":e(D),"is-view":!0,onClose:m[7]||(m[7]=S=>L.value=!1)},null,8,["show","link-view","pessoa-obj"])):B("",!0),t(R,null,{default:a(()=>[t(Ue,{onClick:Me},{default:a(()=>[t(te,{size:"large",color:"red"},{default:a(()=>m[10]||(m[10]=[W("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},vt={key:0,class:"loading-overlay"},ft="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",Yt={__name:"Minuta",emits:["page","doc"],setup(oe,{emit:v}){Re("DocumentEditorContainer",[Ke,We,Xe]);const z=ce(),{$toast:$}=ne(),c=le(),d=ie(),h=v;Pe(`${z.public.docEditor}`);const q=`${z.public.managemant}/download`,X=`${z.public.managemant}/atos/files`,P=`${z.public.managemant}/subitituirModelo`,Q=`${z.public.managemant}/upload`,O=n(null),I=n(!1),b=n("Ao executar a geração, a minuta atual será substituída e não poderá ser recuperada.Confirma ?"),T=n(d.query.origem==="vizualizar"),y=n(!1),D=async r=>{try{const i=await fetch(r);if(!i.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await i.blob()}catch(i){return console.error(i),null}},x=async()=>{try{const{data:r}=await f(`${X}/${d.query.ato_token_edit}`,{method:"GET"},"$5jxI4TvFse");return r.value.link_ato}catch(r){console.error("Erro ao carregar o documento:",r),$.error(r)}},C=async()=>{y.value=!0;try{const r=await x(),{data:i,status:k}=await f(q,{method:"POST",body:{bucket:j("user-data").value.cartorio_token,path:r}},"$dvNFfvmIJC"),M=i.value,u=await D(M);if(u){const U=new FileReader;U.onload=()=>{const o=U.result;O.value.ej2Instances.documentEditor.open(o),h("doc",o)},U.readAsText(u)}}catch{console.error("Erro ao carregar o documento.")}finally{y.value=!1}},w=async()=>{const i=await O.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),k=new FileReader;k.onload=()=>{const M=k.result,U=O.value.ej2Instances.documentEditor.pageCount;h("page",U),h("doc",M)},k.readAsText(i)},Y=async()=>{y.value=!0;try{const i=await O.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),k=new FormData;k.append("file",i,"anexo.sfdt"),k.append("cartorio_token",j("user-data").value.cartorio_token),k.append("token",d.query.ato_token_edit),k.append("tipo","ato_minuta");const{data:M,status:u}=await f(Q,{method:"POST",body:k},"$xv11VtUdMy");if(u.value==="success"){$.success("Documento enviado!");const o=O.value.ej2Instances.documentEditor.pageCount;w(),h("page",o)}else $.error("Erro ao enviar documento para o sistema.")}catch(r){$.error("Erro ao salvar documento."),console.error(r)}finally{y.value=!1}},L=()=>{I.value=!1,J()},J=async()=>{A(!0);try{await Z(),A(!0);const{data:r,status:i}=await f(P,{method:"POST",body:{ato_token:d.query.ato_token_edit}},"$zyzWHTXTBW");r.value&&g(r.value)}catch(r){console.error("Erro ao gerar a minuta:",r),$.error("Ocorreu um erro ao gerar a minuta.")}finally{A(!1)}},Z=async()=>{try{const{data:r}=await f(q,{method:"POST",body:{bucket:j("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$KreLE0Ys81"),i=await D(r.value);if(i){const k=new FileReader;k.onload=()=>{const M=k.result;O.value.ej2Instances.documentEditor.open(M),h("doc",M)},k.readAsText(i)}}catch(r){console.error("Erro ao carregar o modelo de minuta:",r)}},g=r=>{const i=O.value.ej2Instances.documentEditor,k=M=>{for(const[u,U]of Object.entries(M))if(/^<<.+>>$/.test(u))try{i.search.findAll(u),i.search.searchResults.length>0&&i.search.searchResults.replaceAll(U)}catch(o){console.error(`Erro ao substituir o marcador ${u}:`,o)}else if(u==="partes"&&Array.isArray(U)&&U.length>0)for(const o of U)typeof o=="object"&&k(o)};k(r)},A=r=>{y.value=r},K=()=>{const r=d.query.origem||"criar",i=d.query.id;switch(r){case"atualizar":case"vizualizar":c.push(`/os/atualizar/${i}`);break;case"atualizar-lista":case"vizualizar-lista":c.push("/atos/lista");break;default:c.push("/os/criar-registro");break}};return Ie(async()=>{await C(),w()}),(r,i)=>{const k=pe,M=Oe;return p(),F(qe,null,[t(e(Ae),{height:"900px",ref_key:"documentEditorContainer",ref:O,serviceUrl:ft,enableToolbar:!0,enableWordExport:!0},null,512),e(y)?(p(),F("div",vt,[t(Ne,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):B("",!0),t(R,{class:"ml-4 mt-4 mb-4"},{default:a(()=>[t(k,{class:"mr-4"},{default:a(()=>[t(te,{size:"large",onClick:K,color:"red"},{default:a(()=>i[2]||(i[2]=[W("Voltar")])),_:1})]),_:1}),e(T)?B("",!0):(p(),G(te,{key:0,size:"large",color:"green",onClick:Y,disabled:e(y)},{default:a(()=>i[3]||(i[3]=[W("Atualizar")])),_:1},8,["disabled"])),e(T)?B("",!0):(p(),G(te,{key:1,class:"ml-4",size:"large",color:"blue",onClick:i[0]||(i[0]=u=>I.value=!0)},{default:a(()=>i[4]||(i[4]=[W("Gerar Minuta")])),_:1}))]),_:1}),t(M,{onConfirm:L,condMessage:e(b),show:e(I),onClose:i[1]||(i[1]=u=>I.value=!1)},null,8,["condMessage","show"])],64)}}},yt=["innerHTML"],Zt={__name:"Livro",props:{pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(oe){let v,z;const $=oe,c=ce();Pe(`${c.public.docEditor}`);const{$toast:d}=ne(),h=le(),q=ie(),X=`${c.public.managemant}/download`,P=`${c.public.managemant}/atos/files`,Q=`${c.public.managemant}/lavrarAto`,O=`${c.public.managemant}/listarEscrevente`,I=`${c.public.managemant}/ato_calcular`,b=`${c.public.envioDoc}/print`,T=n(j("user-data").value.cartorio_token),y=j("auth_token").value,D=n("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),x=n(!1),C=n(null),w=n(null),Y=n(q.query.origem==="vizualizar"),L=n(null),J=n([]),Z=n({}),g=_e({escrevente:null}),A=async s=>{try{const l=await fetch(s);if(!l.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await l.blob()}catch(l){return console.error(l),null}},K=async()=>{try{const{data:s}=await f(`${P}/${q.query.ato_token_edit}`,{method:"GET"},"$FnEbAJEARP");return s.value.link_ato}catch(s){console.error("Erro ao carregar o documento:",s),d.error(s)}},r=async()=>{try{const s=await K(),{data:l,status:E}=await f(X,{method:"POST",body:{bucket:j("user-data").value.cartorio_token,path:s}},"$7ljqltMqa0"),H=l.value,ve=await A(H);if(ve){const ue=new FileReader;ue.onload=()=>{const be=ue.result;L.value.ej2Instances.documentEditor.open(be)},ue.readAsText(ve)}}catch{d.error("Erro ao carregar o documento.")}};r();const i=async()=>{const s=L.value.ej2Instances.documentEditor.pageCount,{data:l,status:E}=await f(Q,{method:"POST",body:{ato_token:q.query.ato_token_edit,qtd_paginas:s,escrevente_token:g.escrevente,usuario_token:y,cartorio_token:T}},"$OWxZSQkyX8");if(E.value==="success"){if(l.value[0].tipo_etiqueta==="html")C.value=l.value,w.value=l.value[0].selo;else if(l.value[0].tipo_etiqueta==="zpl"){const{status:H}=await f(`${b}`,{method:"POST",body:{zpl:`^XA
^CF0,40
^FO50,30^FDCartório 360^FS
^CF0,30
^FO50,80^FDDocumento: 123456^FS
^FO50,120^FDData: 21/06/2025^FS
^FO50,160^FDAssinatura:___________________^FS
^FO50,210^GB700,3,3^FS
^CF0,25
^FO50,230^FDEste documento foi autenticado eletronicamente.^FS
^XZ`}},"$sMqfUUQcBM");if(H.value!=="success"){d.error("Não foi possivel fazer a impressao da etiqueta");return}}d.success("Ato lavrado com sucesso!")}else d.error("Falha ao lavrar o ato.")},k=async()=>{const s=L.value.ej2Instances.documentEditor.pageCount,{data:l,status:E}=await f(I,{method:"POST",body:{ato_token:q.query.ato_token_edit,cartorio_token:T,quantidade:1,usuario_token:y,escrevente_token:g.escrevente,qtd_paginas:s}},"$OVwiKSwcOE");E.value==="success"?Z.value=l.value[0]:d.error("Falha ao calcular o ato.")},M=async()=>{x.value=!1,i()},u=async()=>{x.value=!0,await k()},{data:U}=([v,z]=me(()=>f(O,{method:"POST",body:{cartorio_token:T}},"$iv1N3XD6We")),v=await v,z(),v);J.value=U.value[0].func_json_escreventes;const o=()=>{const s=q.query.origem||"criar",l=q.query.id;switch(s){case"atualizar":case"vizualizar":h.push(`/os/atualizar/${l}`);break;case"atualizar-lista":case"vizualizar-lista":h.push("/atos/lista");break;default:h.push("/os/criar-registro");break}};return Be(()=>$.document,(s,l)=>{r()}),(s,l)=>{const E=Oe;return p(),F(qe,null,[t(R,null,{default:a(()=>[t(N,null,{default:a(()=>[t(e(Ae),{restrictEditing:!0,enableToolbar:!1,ref_key:"documentEditorContainer",ref:L,height:"850px",width:"850px"},null,512)]),_:1}),e(Y)?B("",!0):(p(),G(N,{key:0},{default:a(()=>[t(ye,{class:"mt-15",label:"Tabelião/escrevente",modelValue:e(g).escrevente,"onUpdate:modelValue":l[0]||(l[0]=H=>e(g).escrevente=H),items:e(J),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),V("img",{onClick:l[1]||(l[1]=H=>u()),style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:Qe}),e(C)?(p(),G(st,{key:0,width:"360"},{default:a(()=>[t(R,null,{default:a(()=>[t(N,null,{default:a(()=>[t(Ve,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:a(()=>[t(N,null,{default:a(()=>[W(" Livro: "+fe(e(C)[0].livro_numero),1)]),_:1}),t(N,null,{default:a(()=>[W(" Protocolo: "+fe(e(C)[0].protocolo?e(C)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),t(N,null,{default:a(()=>[t(Ve,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:a(()=>[W(" Folhas : "+fe(e(C)[0].pagina_inicial)+" A "+fe(e(C)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),V("div",{style:{"margin-left":"10px","padding-bottom":"20px","margin-top":"-10px"},innerHTML:e(w)},null,8,yt)]),_:1})):B("",!0)]),_:1}))]),_:1}),t(te,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:o},{default:a(()=>l[3]||(l[3]=[W("Voltar")])),_:1}),t(E,{show:e(x),condMessage:e(D),valor:e(Z),onClose:l[2]||(l[2]=H=>x.value=!1),onConfirm:M},null,8,["show","condMessage","valor"])],64)}}},gt=["onClick"],ht={key:0,style:{width:"30px",height:"30px"},src:we,alt:"Visualizar",title:"Reativar"},bt={key:1,src:ze,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},ea={__name:"Observacao",props:{ato_id:{type:Number,required:!0}},async setup(oe){let v,z;const $=le(),c=ie(),d=ce(),{$toast:h}=ne(),q=`${d.public.managemant}/listarEscrevente`;`${d.public.managemant}`;const X=`${d.public.managemant}/atos_observacao`,P=`${d.public.managemant}/atos_observacao`,Q=`${d.public.managemant}/atos_observacao`,O=n(j("user-data").value.cartorio_token),I=n(c.query.origem==="vizualizar"),b=n([]),T=n([]),y=[{title:"Data",align:"start",key:"created"},{title:"Escrevente",align:"start",key:"users.nome"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}],D=_e({observacao:""}),x={observacao:{required:Te.withMessage("O campo é obrigatório",De)}},C=Se(x,D),{data:w}=([v,z]=me(()=>f(`${Q}/${c.query.ato_id}`,{method:"GET"},"$HyzoO40swN")),v=await v,z(),v);Array.isArray(w.value)?b.value=w.value.map(g=>({...g,created:$e(g.created,"dd/mm/yyyy hh:mm")})):w.value&&typeof w.value=="object"&&(b.value=[{...w.value,created:$e(w.value.created,"dd/mm/yyyy hh:mm")}]);async function Y(){if(D.observacao.trim()===""){h.error("O campo de observação está vazio.");return}if(await C.value.$validate()){const{data:g,error:A,status:K}=await f(X,{method:"POST",body:{ato_id:Number(c.query.ato_id),observacao:D.observacao,user_id:j("user-data").value.usuario_id}},"$gnHMo4uCXD");K.value==="success"&&(b.value.push({created:$e(g.value.created,"dd/mm/yyyy hh:mm"),observacao:g.value.observacao,id:g.value.id,escrevente:j("user-data").value.nome}),D.observacao="",h.success("Observação registrada com sucesso"))}else h.error("Preencha os campos obrigatórios.")}async function L(g){g.excluido=!g.excluido;try{await f(`${P}/${g.id}`,{method:"PUT",body:JSON.stringify({excluido:g.excluido})},"$sP9AKdd3Ky")}catch(A){console.error("Erro ao excluir observação:",A)}}const{data:J}=([v,z]=me(()=>f(q,{method:"POST",body:{cartorio_token:O}},"$HL9pndqGh0")),v=await v,z(),v);T.value=J.value[0].func_json_escreventes;const Z=()=>{const g=c.query.origem||"criar",A=c.query.id;switch(g){case"atualizar":case"vizualizar":$.push(`/os/atualizar/${A}`);break;case"atualizar-lista":case"vizualizar-lista":$.push("/atos/lista");break;default:$.push("/os/criar-registro");break}};return(g,A)=>{const K=pe;return p(),G(he,null,{default:a(()=>[I.value?B("",!0):(p(),G(R,{key:0,class:"mt-5"},{default:a(()=>[t(re,{label:"Observação",modelValue:D.observacao,"onUpdate:modelValue":A[0]||(A[0]=r=>D.observacao=r),required:"","error-messages":e(C).observacao.$errors.length>0?e(C).observacao.$errors.map(r=>r.$message):[],onBlur:e(C).observacao.$touch,onInput:e(C).observacao.$touch},null,8,["modelValue","error-messages","onBlur","onInput"]),V("div",null,[V("img",{class:"btn-pointer ml-2",src:ge,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:Y})])]),_:1})),t(R,null,{default:a(()=>[t(N,null,{default:a(()=>[t(Ce,{style:{height:"465px"},headers:y,items:b.value},{"item.actions":a(({item:r})=>[V("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:i=>L(r),title:"Deletar Observação"},[r.excluido?(p(),F("img",ht)):(p(),F("img",bt))],8,gt)]),_:1},8,["items"])]),_:1})]),_:1}),t(R,null,{default:a(()=>[t(K,{onClick:Z},{default:a(()=>[t(te,{size:"large",color:"red"},{default:a(()=>A[1]||(A[1]=[W("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},kt={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ze,alt:"Criar"},$t={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:et,alt:"Criar"},xt={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:rt,alt:"Criar"},wt=["onClick"],zt=["onClick"],Ct=["onClick"],Et={key:0,style:{width:"30px",height:"30px"},src:we,alt:"Visualizar",title:"Reativar"},Vt={key:1,src:ze,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},ta={__name:"Anexos",async setup(oe){let v,z;const $=ce(),{$toast:c}=ne(),d=le(),h=ie(),q=n(h.query.origem==="vizualizar"),X=`${$.public.biometria}/run-scanner`,P=`${$.public.managemant}/atos_anexos`,Q=`${$.public.managemant}/atos_anexos`,O=`${$.public.managemant}/download`,I=`${$.public.managemant}/atos_anexos`,b=`${$.public.managemant}/upload`,T=n(!1),y=n(null),D=n([]);j("pessoa_token");const x=_e({descricao:"",fileEvent:null}),C={descricao:{required:Te.withMessage("O campo é obrigatório",De)}},w=Se(C,x,{$autoDirty:!0}),Y=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}],{data:L}=([v,z]=me(()=>f(`${I}/${h.query.ato_id}`,{method:"GET"},"$AOZpbz65MA")),v=await v,z(),v);D.value=L.value;async function J(){try{await Z(),await g()}catch(o){console.error("Erro ao executar scanner ou listar arquivos:",o)}}async function Z(){try{const{data:o}=await f(X,{method:"GET"},"$KttjFhHivJ")}catch(o){c.error("Erro ao acionar o scanner:",o)}}async function g(){try{const{data:o,status:s}=await f("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:h.query.ato_token_edit,cartorio_token:j("user-data").value.cartorio_token}},"$TqQrsgxUkd")}catch(o){console.error("Erro ao enviar o arquivo:",o)}}async function A(){try{const o=document.createElement("input");o.type="file",o.accept="*/*",o.onchange=async s=>{x.fileEvent=s,s.target.files[0]&&(y.value=!0)},o.click()}catch(o){console.error("Erro ao abrir o explorador de arquivos:",o)}}const K=async()=>{T.value=!0};function r(o){return o?!0:(y.value=!1,!1)}const i=async o=>{if(!x.fileEvent||!x.fileEvent.target.files.length){c.error("Nenhum arquivo selecionado.");return}const s=x.fileEvent.target.files[0],l=new FormData;l.append("file",s),l.append("cartorio_token",j("user-data").value.cartorio_token),l.append("token",o),l.append("tipo","ato_anexo");try{const E=await f(b,{method:"POST",body:l},"$KDhIYzGKzM");c.success("Anexo registrado com sucesso!")}catch{c.error("Erro ao enviar o arquivo.")}},k=async()=>{if(w.value.$touch(),!w.value.$invalid&&r(x.fileEvent)){const{data:o,error:s,status:l}=await f(P,{method:"POST",body:{ato_id:h.query.ato_id,descricao:x.descricao,user_id:j("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$cdoFBGO0Ti");l.value==="success"&&(c.success("Anexo registrado com sucesso!"),D.value.push(o.value),i(o.value.token))}};async function M(o){o.excluido=!o.excluido;try{await f(`${Q}/${o.id}`,{method:"PUT",body:JSON.stringify({excluido:o.excluido})},"$WLSrgYRoHq")}catch(s){console.error("Erro ao excluir pessoa:",s)}}async function u(o){try{const s=await f(`${O}`,{method:"POST",body:{bucket:j("user-data").value.cartorio_token,path:o.link}},"$NdgRjioizH"),E=await(await fetch(s.data.value)).blob(),H=URL.createObjectURL(E);window.open(H,"_blank")}catch(s){console.error("Erro ao excluir pessoa:",s)}}const U=()=>{const o=h.query.origem||"criar",s=h.query.id;switch(o){case"atualizar":case"vizualizar":d.push(`/os/atualizar/${s}`);break;case"atualizar-lista":case"vizualizar-lista":d.push("/atos/lista");break;default:d.push("/os/criar-registro");break}};return(o,s)=>{const l=pe;return p(),G(he,null,{default:a(()=>[t(R,null,{default:a(()=>[t(N,{cols:"5",class:"mt-2"},{default:a(()=>[e(q)?B("",!0):(p(),G(re,{key:0,modelValue:e(x).descricao,"onUpdate:modelValue":[s[0]||(s[0]=E=>e(x).descricao=E),e(w).descricao.$touch],"error-messages":e(w).descricao.$errors.map(E=>E.$message),onBlur:e(w).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"]))]),_:1}),e(q)?B("",!0):(p(),F("div",{key:0,onClick:J,title:"Escanear"},s[1]||(s[1]=[V("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ye,alt:"Escanear"},null,-1)]))),e(q)?B("",!0):(p(),F("div",{key:1,onClick:A,title:"Criar"},[e(y)===!1?(p(),F("img",kt)):e(y)===!0?(p(),F("img",$t)):(p(),F("img",xt))])),e(q)?B("",!0):(p(),F("div",{key:2,onClick:k,title:"Criar"},s[2]||(s[2]=[V("img",{class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:ge,alt:"Criar"},null,-1)])))]),_:1}),t(Ce,{headers:Y,items:e(D),style:{height:"465px","max-width":"600px"}},{"item.actions":a(({item:E})=>[t(R,null,{default:a(()=>[V("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:H=>K(E),title:"Visualizar Anexo"},[V("img",{style:{width:"30px",height:"30px"},onClick:H=>u(E),src:xe,alt:"Visualizar"},null,8,zt)],8,wt),V("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:H=>M(E),title:"Deletar Pessoa"},[E.excluido?(p(),F("img",Et)):(p(),F("img",Vt))],8,Ct)]),_:2},1024)]),_:1},8,["items"]),t(l,{onClick:U},{default:a(()=>[t(te,{size:"large",color:"red"},{default:a(()=>s[3]||(s[3]=[W("Voltar")])),_:1})]),_:1})]),_:1})}}};export{Xt as _,Qt as a,Yt as b,Zt as c,ea as d,ta as e};
