import{_,D as E,r as l,E as w,c as i,a as n,F as f,G as C,p as L,H as R,y as S,o as u,q as M,d as N,t as B,n as D}from"./BuU6GUza.js";const O={class:"chat-container"},U=["onClick"],$={__name:"index",setup(T){const v=E(),c=l(""),b=l([{from:"server",text:"Por favor, me informe seu nome"}]),m=l(),d=l(null),p=l();let a=null;const h=v.query.cartorio_token;function r(o,t){b.value.push({from:o,text:t}),D(()=>{d.value&&(d.value.scrollTop=d.value.scrollHeight)})}function g(){if(m.value||(m.value=c.value,k()),!c.value.trim())return;const o=x(c.value);r("user",o);const t={type:"chat_bot_message",message:o,cartorio_token:h};c.value="",a.send(JSON.stringify(t))}function k(){a=new WebSocket(`${config.public.chat_bot}?user_name=${m.value}`),a.addEventListener("open",()=>{console.log("âœ… Conectado ao servidor")}),a.addEventListener("message",o=>{var t;try{const e=JSON.parse(o.data),s=(t=e==null?void 0:e.message)==null?void 0:t.state;switch(s){case"ExibirResposta":console.log("ðŸ“¥ ExibirResposta"),p.value=e.message,r("button",e.message);break;case"Fim":console.log("ðŸ“´ Chat encerrado pelo servidor"),a.close(1e3,"Chat encerrado pelo servidor");break;case void 0:e.type==="connection_info"?console.log("ðŸ”— InformaÃ§Ãµes de conexÃ£o recebidas"):(console.log("ðŸ“© Mensagem desconhecida:",e),r("server",JSON.stringify(e)));break;default:console.log(`ðŸ“¨ Mensagem com estado "${s}"`),r("server",e.message);break}}catch(e){console.error("âŒ Erro ao processar mensagem:",e),r("server",o.data)}}),a.addEventListener("close",()=>{console.log("âŒ ConexÃ£o encerrada"),r("system","âš ï¸ Chat encerrado")}),a.addEventListener("error",o=>{console.error("âš ï¸ Erro na conexÃ£o:",o),r("system","âš ï¸ Erro na conexÃ£o")})}function y(o){fetch(o).then(t=>{if(!t.ok)throw new Error("Erro ao baixar o arquivo");return t.blob()}).then(t=>{const e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download="documento.pdf",s.click(),URL.revokeObjectURL(e)})}function x(o){const t=typeof o=="object"?o.message:o,e=/(https?:\/\/[^\s]+)/g;return t.replace(e,s=>`<a href="${s}" target="_blank" class="chat-link">${s}</a>`)}return w(()=>{a&&a.readyState===WebSocket.OPEN&&a.close()}),(o,t)=>(u(),i("div",O,[t[2]||(t[2]=n("div",{class:"chat-header"},[n("span",{class:"chat-title"},"Chat"),n("button",{class:"chat-close"},"Ã—")],-1)),n("div",{ref_key:"chatHistory",ref:d,class:"chat-history"},[(u(!0),i(f,null,C(b.value,(e,s)=>(u(),i("div",{key:s,class:M(["chat-bubble",e.from==="user"?"user-bubble":e.from==="system"?"system-bubble":"server-bubble"])},[e.from==="button"?(u(),i("button",{key:0,class:"chat-button",onClick:H=>y(e.text.message)}," ðŸ“Ž Baixar documento ",8,U)):(u(),i(f,{key:1},[N(B(e.text.message||e.text),1)],64))],2))),128))],512),n("form",{onSubmit:S(g,["prevent"]),class:"chat-input-area"},[L(n("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),type:"text",placeholder:"Digite sua mensagem...",class:"chat-input"},null,512),[[R,c.value]]),t[1]||(t[1]=n("button",{type:"submit",class:"chat-send-button"},"âž¤",-1))],32)]))}},q=_($,[["__scopeId","data-v-05fc3364"]]);export{q as default};
