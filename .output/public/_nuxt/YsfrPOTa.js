import{_ as le}from"./Cd9hfy-f.js";import{_ as Y}from"./BXtY8gQz.js";import{_ as ce}from"./orXy0y_G.js";import{_ as ue}from"./BCerEkcb.js";import{u as Z,r as l,q as X,I as ee,J as N,o as E,c as F,b as a,w as t,a as v,V as B,x as u,K as y,C as J,D as ie,G as ae,d as z,F as oe,A as te,L as G,n as V,y as de}from"./LFanaqvB.js";import{u as re}from"./CKWaKVTu.js";import{V as C}from"./Cxn7b9Xe.js";import{V as R}from"./BloomSmb.js";import{V as me}from"./C5aN0HXP.js";import{V as se}from"./DREe8X_D.js";import{V as j}from"./B6GgtCcs.js";import{_ as pe}from"./D-Ana3ml.js";import{_ as ve}from"./BVz1G1IN.js";import{_ as _e,a as fe}from"./DJvq3mCv.js";import{V as K,a as xe,b as Q,c as be}from"./B8wZoO2-.js";import"./CHECEXjW.js";import"./V_tnbP-q.js";import"./DAII08QC.js";import"./BW0r7Rxy.js";import"./5Bym0PMx.js";import"./CHBhxZrD.js";import"./DltzaYHc.js";const ge=["title","onClick"],Ce=["onClick"],ye={__name:"Os",setup(H){const d=te(),{$toast:i}=Z(),m=`${d.public.managemant}/listarOSCaixas`,_=`${d.public.managemant}/lista_sit_ordemserv`,P=`${d.public.managemant}/updateOrdensServico`,x=l([]),b=l([]),w=l(""),$=l(""),h=l({}),U=l(null),k=l("O encerramento de OS não poderá ser revertido. Confirma o encerramento?"),A=l(!1),S=l(!1),I=()=>{G("/caixas/lista")},O=[{title:"Número",value:"numero"},{title:"Situação",value:"situacao"},{title:"CPF",value:"apresentante_cpf"},{title:"Apresentante",value:"apresentante_nome"},{title:"Usuário",value:"usuario_nome"},{title:"Valor",value:"valor"},{title:"A Receber",value:"valor_a_receber"},{title:"Ações",value:"actions"}],g=l("");async function D(){try{const o=await $fetch(m,{method:"POST",body:{caixa_token:V("caixa-service").value.caixa_token}});o&&Array.isArray(o)?x.value=o:i.error("Erro ao buscar dados da API.")}catch(o){const e=o.message||"Erro ao buscar dados da API. Tente novamente.";i.error(e)}}function q(){const o=new Date,e=o.getFullYear(),c=String(o.getMonth()+1).padStart(2,"0"),f=String(o.getDate()).padStart(2,"0");return`${e}-${c}-${f}`}const W=o=>{h.value=o,S.value=!0};async function r(){try{const{data:o,error:e}=await re(_,{method:"GET"},"$nTZq0SR2Wg");o.value&&Array.isArray(o.value)?b.value=o.value.map(c=>({title:c.descricao,value:c.descricao})):(i.error("Erro ao buscar dados da API de situação."),e.value&&console.error("Erro detalhado:",e.value))}catch(o){const e=o.message||"Erro ao buscar dados da API. Tente novamente.";i.error(e),console.error("Erro na requisição:",o)}}r();async function s(o){try{await $fetch(`${P}/${o}`,{method:"PUT",body:{dt_pagto:q()}})?(i.success("Ordem de Serviço encerrada com sucesso!"),S.value=!1,D()):i.error("Erro ao encerrar OS. Tente novamente.")}catch(e){const c=e.message||"Erro ao buscar dados da API. Tente novamente.";i.error(c)}}X(()=>{D()});const p=ee(()=>x.value.filter(o=>{const e=o.numero?o.numero.toString().toLowerCase():"",c=o.apresentante_nome?o.apresentante_nome.toLowerCase():"",f=o.situacao?o.situacao.toUpperCase():"",T=e.includes(w.value.toLowerCase()),M=c.includes($.value.toLowerCase()),n=g.value?f===g.value:!0;return T&&M&&n}));function L(o,e){U.value=o,h.value={token:e.token,numero:e.numero,valor:e.valor,valor_pago:e.valor_pago,caixa_token:V("caixa-service").value.caixa_token},A.value=!0}return(o,e)=>{const c=le,f=Y,T=N("v-cols"),M=N("v-rows");return E(),F(oe,null,[a(j,{class:"mt-5"},{default:t(()=>[a(C,{class:"mb-5"},{default:t(()=>e[6]||(e[6]=[v("h1",null,"Recebimento de Ordens de Serviço",-1)])),_:1}),a(C,null,{default:t(()=>[a(R,{cols:"2"},{default:t(()=>[a(B,{modelValue:u(w),"onUpdate:modelValue":e[0]||(e[0]=n=>y(w)?w.value=n:null),type:"text",label:"Número"},null,8,["modelValue"])]),_:1}),a(R,{md:"3"},{default:t(()=>[a(B,{modelValue:u($),"onUpdate:modelValue":e[1]||(e[1]=n=>y($)?$.value=n:null),label:"Apresentante"},null,8,["modelValue"])]),_:1})]),_:1}),a(C,null,{default:t(()=>[a(R,{md:"3"},{default:t(()=>[a(me,{modelValue:u(g),"onUpdate:modelValue":e[2]||(e[2]=n=>y(g)?g.value=n:null),items:u(b),label:"Situação",clearable:""},null,8,["modelValue","items"])]),_:1})]),_:1}),e[8]||(e[8]=v("hr",{class:"mt-5 mb-5"},null,-1)),a(se,{headers:O,items:u(p),"item-key":"id"},{"item.actions":t(({item:n})=>[a(C,{style:{display:"flex",gap:"4px","margin-top":"-5px"}},{default:t(()=>[v("div",{class:J({disabled:!n.btn_receber}),title:n.btn_receber?"Receber":"Bloqueado",onClick:ne=>n.btn_receber?L(n.numero,n):null},[v("img",{style:ie({cursor:n.btn_receber?"pointer":"default",width:"30px",height:"30px"}),src:ce,alt:"Receber"},null,4)],10,ge),v("div",{class:J({disabled:!n.btn_encerrar}),onClick:ne=>n.btn_encerrar?W(n.id):!1,title:"Cancelamento"},e[7]||(e[7]=[v("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ue,alt:"Encerrar",title:"Encerrar"},null,-1)]),10,Ce)]),_:2},1024)]),_:1},8,["items"]),a(c,{show:u(A),numero_os:u(U),ordem:u(h),onClose:e[3]||(e[3]=n=>A.value=!1)},null,8,["show","numero_os","ordem"]),a(f,{onConfirm:e[4]||(e[4]=n=>s(u(h))),condMessage:u(k),show:u(S),onClose:e[5]||(e[5]=n=>S.value=!1)},null,8,["condMessage","show"])]),_:1}),a(M,null,{default:t(()=>[a(T,null,{default:t(()=>[a(ae,{class:"ml-8",size:"large",onClick:I,color:"red"},{default:t(()=>e[9]||(e[9]=[z("Voltar ")])),_:1})]),_:1})]),_:1})],64)}}},Ve=["onClick"],we={key:0,style:{width:"30px",height:"30px"},src:_e,alt:"Visualizar",title:"Reativar"},$e={key:1,src:fe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},he={__name:"Lançamentos",setup(H){const d=te(),{$toast:i}=Z(),m=`${d.public.managemant}/lista_lanctos_caixa`,_=`${d.public.managemant}/caixasLanctos`;V("caixa-service").value.usuario_nome,V("caixa-service").value.data;const P=l([]),x=l(""),b=l(""),w=l(""),$=l(""),h=l({});l(null);const U=l("O encerramento de OS não poderá ser revertido. Confirma o encerramento?");l(!1);const k=l(!1),A=()=>{G("/caixas/lista")},S=[{title:"Forma recebimento",value:"forma_receb"},{title:"Valor",value:"valor"},{title:"Descrição",value:"descricao"},{title:"O.S",value:"ordemserv_numero"},{title:"Apresentatante",value:"apresentante_nome"},{title:"Usuário",value:"usuario_nome"},{title:"Ações",value:"actions"}],I=l("");async function O(){try{const r=await $fetch(m,{method:"POST",body:{caixa_token:V("caixa-service").value.caixa_token}});r&&Array.isArray(r)?P.value=r:i.error("Erro ao buscar dados da API.")}catch(r){const s=r.message||"Erro ao buscar dados da API. Tente novamente.";i.error(s)}}async function g(r){try{r.excluido=!r.excluido;const{data:s,error:p}=await re(`${_}/${r.id}`,{method:"PUT",body:{excluido:r.excluido},headers:{"Content-Type":"application/json"}},"$LFu4iQCu2T");if(p.value)throw p.value;i.success("Lançamento excluído com sucesso!"),await O()}catch(s){console.error("Erro ao excluir lançamento:",s),i.error("Erro ao excluir lançamento")}}async function D(r){try{await $fetch(`${_}/${r}`,{method:"PUT",body:{excluido:!0}})?(i.success("Lançamento do caixa encerrada com sucesso!"),k.value=!1,O()):i.error("Erro ao encerrar o Lançamento do caixa. Tente novamente.")}catch(s){const p=s.message||"Erro ao buscar dados da API. Tente novamente.";i.error(p)}}X(()=>{O()});const q=ee(()=>P.value.filter(r=>{const s=r.numero?r.numero.toString().toLowerCase():"",p=r.apresentante_nome?r.apresentante_nome.toLowerCase():"",L=r.situacao?r.situacao.toUpperCase():"",o=r.descricao?r.descricao.toLowerCase():"",e=r.forma_receb?r.forma_receb.toLowerCase():"",c=s.includes(w.value.toLowerCase()),f=p.includes($.value.toLowerCase()),T=I.value?L===I.value:!0,M=o.includes(x.value.toLowerCase()),n=e.includes(b.value.toLowerCase());return c&&f&&T&&M&&n})),W=()=>{G("/caixas/cadastro")};return(r,s)=>{const p=pe,L=Y,o=N("v-cols"),e=N("v-rows");return E(),F(oe,null,[a(j,{class:"mt-5"},{default:t(()=>[a(C,{class:"mb-5"},{default:t(()=>[s[4]||(s[4]=v("h1",null,"Lançamentos do caixa",-1)),a(p,{to:"/caixas/cadastro"},{default:t(()=>[v("img",{style:{width:"60px",height:"60px",cursor:"pointer","margin-left":"70px"},src:ve,alt:"novo",onClick:W})]),_:1})]),_:1}),a(C,null,{default:t(()=>[a(R,{cols:"3"},{default:t(()=>[a(B,{modelValue:u(x),"onUpdate:modelValue":s[0]||(s[0]=c=>y(x)?x.value=c:null),label:"Descrição"},null,8,["modelValue"])]),_:1}),a(R,{cols:"3"},{default:t(()=>[a(B,{modelValue:u(b),"onUpdate:modelValue":s[1]||(s[1]=c=>y(b)?b.value=c:null),label:"Forma de Recebimento"},null,8,["modelValue"])]),_:1})]),_:1}),s[5]||(s[5]=v("hr",{class:"mt-5 mb-5"},null,-1)),a(se,{headers:S,items:u(q),"item-key":"id"},{"item.actions":t(({item:c})=>[a(C,{style:{display:"flex",gap:"4px","margin-top":"-5px"}},{default:t(()=>[v("div",{style:{cursor:"pointer"},onClick:f=>g(c),title:"Cancelamento"},[c.excluido?(E(),F("img",we)):(E(),F("img",$e))],8,Ve)]),_:2},1024)]),_:1},8,["items"]),a(L,{onConfirm:s[2]||(s[2]=c=>D(u(h))),condMessage:u(U),show:u(k),onClose:s[3]||(s[3]=c=>k.value=!1)},null,8,["condMessage","show"])]),_:1}),a(e,null,{default:t(()=>[a(o,null,{default:t(()=>[a(ae,{class:"ml-8",size:"large",onClick:A,color:"red"},{default:t(()=>s[6]||(s[6]=[z("Voltar ")])),_:1})]),_:1})]),_:1})],64)}}},Je={__name:"index",setup(H){const d=l("ordens");return V("caixa-service").value.data,V("caixa-service").value.usuario_nome,(i,m)=>(E(),de(j,{class:"mt-5"},{default:t(()=>[a(xe,{modelValue:u(d),"onUpdate:modelValue":m[0]||(m[0]=_=>y(d)?d.value=_:null)},{default:t(()=>[a(K,{value:"ordens"},{default:t(()=>m[2]||(m[2]=[z("Ordens de Serviço")])),_:1}),a(K,{value:"lancamentos"},{default:t(()=>m[3]||(m[3]=[z("Lançamentos")])),_:1})]),_:1},8,["modelValue"]),a(be,{modelValue:u(d),"onUpdate:modelValue":m[1]||(m[1]=_=>y(d)?d.value=_:null)},{default:t(()=>[a(Q,{value:"ordens"},{default:t(()=>[a(ye)]),_:1}),a(Q,{value:"lancamentos"},{default:t(()=>[a(he)]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Je as default};
