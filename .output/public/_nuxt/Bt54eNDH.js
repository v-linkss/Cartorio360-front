import{_ as Ve}from"./DyiXJ6Xc.js";import{_ as be}from"./DVh1CIB_.js";import{_ as xe}from"./BN63Hp5O.js";import{_ as Ce,r as n,g as $e,o as x,h as se,w as a,b as o,a as u,t as oe,i as t,s as D,j as te,J as Pe,c as N,p as ne,V as Q,d as j,D as qe,K as Ae,u as Se,e as A,f as Me,y as Te,F as Ee,k as Fe}from"./xjdzLEo0.js";import{V as Oe,a as Re,c as ze}from"./C2Dqb-q3.js";import{V as De}from"./C4taKET-.js";import{_ as Ne}from"./C-2gAMAc.js";import{_ as je}from"./B6AM-NvL.js";import{_ as le}from"./Ykg_augn.js";import{_ as Be}from"./BVz1G1IN.js";import{_ as Ue}from"./BiCXXEDO.js";import{a as Ie}from"./DJvq3mCv.js";import{u as V}from"./BDbODpYU.js";import{V as z}from"./Kdc6g5ZJ.js";import{V as b}from"./CESJstty.js";import{V as Ke}from"./D0W5bfvx.js";import{V as ae}from"./mn0eXDzS.js";import"./B-zX7NMv.js";import"./DZTKpCSN.js";import"./CE6Mddv5.js";import"./CQWzFWTF.js";import"./B0IxRygJ.js";import"./CiiVCFlm.js";import"./DPKj8ol6.js";import"./A8ooro0v.js";import"./D3lLDfob.js";import"./Dhr7xOBk.js";import"./BAXHBwVF.js";import"./sgesqSlH.js";import"./CC8hpuBl.js";import"./BNzn_NpJ.js";import"./Bsg143b3.js";import"./Bcgwzw6w.js";const Ze={class:"random-numbers"},We={key:0,class:"error-message"},He={__name:"ValidadorAutencidade",props:{show:Boolean},emits:["close","confirm"],setup(B,{emit:U}){const k=B,C=U,d=n(k.show),g=n([]),p=n(""),v=n("");function f(){g.value=[];for(let _=0;_<4;_++)g.value.push(Math.floor(Math.random()*10))}$e(()=>k.show,_=>{d.value=_,_&&(f(),p.value="",v.value="")});const I=()=>{d.value=!1,C("close")},S=()=>{p.value===g.value.join("")?(v.value="",d.value=!1,C("confirm")):v.value="Números digitados incorretos. Tente novamente."};return(_,i)=>(x(),se(De,{persistent:"",modelValue:t(d),"onUpdate:modelValue":i[1]||(i[1]=$=>te(d)?d.value=$:null),"max-width":"500"},{default:a(()=>[o(Oe,null,{default:a(()=>[o(Re,null,{default:a(()=>[u("div",null,[i[2]||(i[2]=u("p",null," Digite o código de validação para confirmar o ato de reconhecimento por autenticidade: ",-1)),u("div",Ze,[u("span",null,oe(t(g).join(" ")),1)]),o(D,{modelValue:t(p),"onUpdate:modelValue":i[0]||(i[0]=$=>te(p)?p.value=$:null),label:"Digite os números",maxlength:"4",outlined:"",dense:"",onKeyup:Pe(S,["enter"])},null,8,["modelValue"]),t(v)?(x(),N("div",We,oe(t(v)),1)):ne("",!0)])]),_:1}),o(ze,null,{default:a(()=>[o(Q,{style:{"background-color":"red",color:"white"},onClick:I},{default:a(()=>i[3]||(i[3]=[j("Cancelar")])),_:1}),o(Q,{style:{"background-color":"green",color:"white"},onClick:S},{default:a(()=>i[4]||(i[4]=[j("Validar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Le=Ce(He,[["__scopeId","data-v-c978e7cc"]]),Qe=["onClick"],Je={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:le,alt:"Possui Ficha",title:"Possui Ficha"},Ye={key:1,style:{width:"30px",height:"30px",cursor:"pointer"},src:Ue,alt:"Visualizar",title:"Não Possui Ficha"},Ge=["onClick"],Eo={__name:"autencidade",props:{ato_token:{type:String,required:!0}},emits:["ato-created"],async setup(B,{emit:U}){var ee;let k,C;const d=B,g=U,p=qe(),v=Ae(),f=Fe(),{$toast:I}=Se(),S=`${f.public.managemant}/listarEscrevente`,_=`${f.public.managemant}/pesquisarPessoas`,i=`${f.public.managemant}/atoReconhecimento`,$=`${f.public.managemant}/etiquetaAutenticidade`,re=`${f.public.managemant}/download`,ie=`${f.public.envioDoc}/print`,M=n(A("user-data").value.cartorio_token),ue=n(A("user-service").value.token).value||n(A("user-service").value).value,ce=A("auth_token").value,K=n(!1),Z=n([]),J=n([]),P=n([]),T=n(!1),W=n(!1),E=n(!1),F=n(null),Y=n(null),H=n(""),O=n(null),R=n(!1),G=[{title:"Documento",align:"start",key:"documento"},{title:"Pessoa",align:"start",key:"nome"},{value:"actions"}],r=Me({quantidade:1,escrevente:null,nome:null,documento:null}),{data:X}=([k,C]=Te(()=>V(S,{method:"POST",body:{cartorio_token:M}},"$qpB20nOlUE")),k=await k,C(),k);J.value=Array.isArray(X.value)&&((ee=X.value[0])==null?void 0:ee.func_json_escreventes)||[];async function me(){try{const{data:s,error:e}=await V(_,{method:"POST",body:{cartorio_token:M.value,documento:r.documento,nome:r.nome}},"$CfpM9wZnUE");s.value.length>0?(g("ato-created"),Z.value=s.value):Z.value=[]}catch(s){console.error("Erro na requisição",s)}}const de=()=>{W.value=!0};function pe(s){P.value.push(s)}const ve=async s=>{F.value=s,E.value=!0;const{data:e}=await V(re,{method:"POST",body:{bucket:A("user-data").value.cartorio_token,path:s.link_ficha}},"$LrKAtpxZwH");Y.value=e.value};function fe(s){P.value=P.value.filter(e=>e.token!==s.token)}function _e(){return new Promise(s=>{O.value=s,R.value=!0})}async function ke(){R.value=!1;try{await ye()}finally{O.value&&(O.value(),O.value=null)}}async function ye(){var c,m,w;if(!r.escrevente)throw I.error("Por favor selecione um Escrevente"),new Error("Escrevente não selecionado");if(K.value)return;K.value=!0;const s=P.value.map(y=>({pessoa_token:y.token})),{data:e,error:h,status:q}=await V(i,{method:"POST",body:{pessoas:s,cartorio_token:M.value,ordemserv_token:ue,quantidade:r.quantidade,usuario_token:ce,ato_tipo_token:d.ato_token}},"$EE94jKo1pQ");if(q.value==="success"&&e.value[0].status==="OK"){if(e.value[0].livro&&e.value[0].livro!==null){const y=window.open("","_blank");y.document.open(),y.document.write(e.value[0].livro),y.document.close()}ge(e.value[0].token)}else T.value=!0,H.value=Array.isArray(e.value)&&((c=e.value[0])==null?void 0:c.status_mensagem)||((w=(m=h==null?void 0:h.value)==null?void 0:m.data)==null?void 0:w.details)||"Não foi possível concluir o reconhecimento"}async function ge(s){const{data:e,error:h,status:q}=await V($,{method:"POST",body:{ato_token:s,cartorio_token:M.value,escrevente_token:r.escrevente}},"$KyoIzBxZyr");if(q.value==="success"){const c=Array.isArray(e.value)?e.value[0]:null;if(!c)return;if(c.tipo_etiqueta==="html"){const m=window.open("","_blank");m.document.open(),m.document.write(c.etiqueta),m.document.close()}else if(c.tipo_etiqueta==="zpl"){const{status:m,error:w}=await V(`${ie}`,{method:"POST",body:{zpl:atob(c.etiqueta)}},"$Vem9mHWYqw");if(m.value!=="success"){T.value=!0,H.value=w.value.data.message;return}}L()}}const he=()=>{T.value=!1,L()},L=()=>{const s=v.query.origem||"criar",e=v.query.id;s==="atualizar"?p.push(`/os/atualizar/${e}`):p.push("/os/criar-registro")};return(s,e)=>{const h=Ve,q=be,c=xe,m=Le,w=Ne,y=je;return x(),N(Ee,null,[o(z,{class:"mt-5"},{default:a(()=>[o(b,{cols:"5"},{default:a(()=>[o(Ke,{label:"Tabelião/escrevente",modelValue:t(r).escrevente,"onUpdate:modelValue":e[0]||(e[0]=l=>t(r).escrevente=l),items:t(J),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"])]),_:1}),o(b,{cols:"2"},{default:a(()=>[o(D,{label:"Quantidade",type:"number",modelValue:t(r).quantidade,"onUpdate:modelValue":e[1]||(e[1]=l=>t(r).quantidade=l)},null,8,["modelValue"])]),_:1})]),_:1}),o(z,null,{default:a(()=>[o(b,{cols:"3"},{default:a(()=>[o(D,{label:"Documento",modelValue:t(r).documento,"onUpdate:modelValue":e[2]||(e[2]=l=>t(r).documento=l)},null,8,["modelValue"])]),_:1}),o(b,{cols:"4"},{default:a(()=>[o(D,{label:"Pessoa",modelValue:t(r).nome,"onUpdate:modelValue":e[3]||(e[3]=l=>t(r).nome=l)},null,8,["modelValue"])]),_:1}),u("div",null,[u("img",{class:"btn-pointer mt-1",src:le,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:me})]),u("div",null,[u("img",{class:"btn-pointer mt-1 ml-2",src:Be,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:de})])]),_:1}),o(z,null,{default:a(()=>[o(b,{class:"mr-10"},{default:a(()=>[o(ae,{style:{height:"465px"},headers:G,items:t(Z)},{"item.actions":a(({item:l})=>[u("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:we=>ve(l),title:"Visualizar Ficha"},[l.link_ficha?(x(),N("img",Je)):(x(),N("img",Ye))],8,Qe)]),_:1},8,["items"])]),_:1}),o(b,null,{default:a(()=>[o(ae,{headers:G,items:t(P),style:{height:"465px"},"item-key":"id"},{"item.actions":a(({item:l})=>[u("div",{style:{display:"flex","justify-content":"flex-end"},onClick:we=>fe(l),title:"Remover"},e[8]||(e[8]=[u("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:Ie,alt:"Remover"},null,-1)]),8,Ge)]),_:1},8,["items"])]),_:1})]),_:1}),o(h,{show:t(W),onClose:e[4]||(e[4]=l=>W.value=!1)},null,8,["show"]),t(E)?(x(),se(q,{key:0,show:t(E),item:t(F),"pessoa-obj":t(F),"link-view":t(Y),onConfirmar:e[5]||(e[5]=l=>pe(t(F))),onClose:e[6]||(e[6]=l=>E.value=!1)},null,8,["show","item","pessoa-obj","link-view"])):ne("",!0),o(c,{show:t(T),errorMessage:t(H),onClose:he},null,8,["show","errorMessage"]),o(m,{show:t(R),onClose:e[7]||(e[7]=l=>R.value=!1),onConfirm:ke},null,8,["show"]),o(z,null,{default:a(()=>[o(w,{onClick:L},{default:a(()=>[o(Q,{size:"large",color:"red"},{default:a(()=>e[9]||(e[9]=[j("Voltar")])),_:1})]),_:1}),o(y,{onSave:_e,disabled:t(K),class:"ml-5",size:"large",color:"green"},{default:a(()=>e[10]||(e[10]=[j("Salvar")])),_:1},8,["disabled"])]),_:1})],64)}}};export{Eo as default};
