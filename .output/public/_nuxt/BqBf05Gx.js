import{_ as Ve}from"./CKlsskjG.js";import{_ as be}from"./mSPGmM3e.js";import{_ as xe}from"./--QJ8LSE.js";import{_ as Ce,r as n,g as $e,o as x,h as ne,w as a,b as o,a as c,t as te,i as t,s as z,j as ae,J as Pe,c as B,p as le,V as J,d as U,D as qe,K as Ae,u as Me,e as A,f as Se,y as Te,F as Ee,k as Fe}from"./Db6k_Kyv.js";import{V as Oe,a as Re,c as De}from"./z0qL6n1y.js";import{V as Ne}from"./Cm-UCmX_.js";import{_ as je}from"./DTJjMKWI.js";import{_ as ze}from"./DyU_gOgQ.js";import{_ as re}from"./CDSCY-0E.js";import{_ as Be}from"./BVz1G1IN.js";import{_ as Ue}from"./509dIx4m.js";import{a as Ie}from"./DJvq3mCv.js";import{u as V}from"./OwNuggDs.js";import{V as j}from"./C80HnjTW.js";import{V as b}from"./BKgxh_o5.js";import{V as Ke}from"./BkL2xDa7.js";import{V as se}from"./ByPcQOfK.js";import"./B8mkZ3k6.js";import"./YBPuwmu9.js";import"./CtUULwMa.js";import"./DrJhNMAt.js";import"./B0IxRygJ.js";import"./C1clp3eH.js";import"./BQiBtQTz.js";import"./CQCOKYRR.js";import"./D2tHNIjG.js";import"./B2x-_XEO.js";import"./Q-hnmrRM.js";import"./FbQsH44d.js";import"./D_ZdkqB4.js";import"./D2_D-ZzI.js";import"./D-e4yEFl.js";import"./TDtrdbi3.js";import"./CB0JcqVn.js";const Ze={class:"random-numbers"},We={key:0,class:"error-message"},He={__name:"ValidadorAutencidade",props:{show:Boolean},emits:["close","confirm"],setup(I,{emit:K}){const k=I,C=K,d=n(k.show),h=n([]),p=n(""),v=n("");function f(){h.value=[];for(let _=0;_<4;_++)h.value.push(Math.floor(Math.random()*10))}$e(()=>k.show,_=>{d.value=_,_&&(f(),p.value="",v.value="")});const Z=()=>{d.value=!1,C("close")},M=()=>{p.value===h.value.join("")?(v.value="",d.value=!1,C("confirm")):v.value="Números digitados incorretos. Tente novamente."};return(_,u)=>(x(),ne(Ne,{persistent:"",modelValue:t(d),"onUpdate:modelValue":u[1]||(u[1]=$=>ae(d)?d.value=$:null),"max-width":"500"},{default:a(()=>[o(Oe,null,{default:a(()=>[o(Re,null,{default:a(()=>[c("div",null,[u[2]||(u[2]=c("p",null," Digite o código de validação para confirmar o ato de reconhecimento por autenticidade: ",-1)),c("div",Ze,[c("span",null,te(t(h).join(" ")),1)]),o(z,{modelValue:t(p),"onUpdate:modelValue":u[0]||(u[0]=$=>ae(p)?p.value=$:null),label:"Digite os números",maxlength:"4",outlined:"",dense:"",onKeyup:Pe(M,["enter"])},null,8,["modelValue"]),t(v)?(x(),B("div",We,te(t(v)),1)):le("",!0)])]),_:1}),o(De,null,{default:a(()=>[o(J,{style:{"background-color":"red",color:"white"},onClick:Z},{default:a(()=>u[3]||(u[3]=[U("Cancelar")])),_:1}),o(J,{style:{"background-color":"green",color:"white"},onClick:M},{default:a(()=>u[4]||(u[4]=[U("Validar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Le=Ce(He,[["__scopeId","data-v-c978e7cc"]]),Qe=["onClick"],Je={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:re,alt:"Possui Ficha",title:"Possui Ficha"},Ye={key:1,style:{width:"30px",height:"30px",cursor:"pointer"},src:Ue,alt:"Visualizar",title:"Não Possui Ficha"},Ge=["onClick"],Fo={__name:"autencidade",props:{ato_token:{type:String,required:!0}},emits:["ato-created"],async setup(I,{emit:K}){var oe;let k,C;const d=I,h=K,p=qe(),v=Ae(),f=Fe(),{$toast:Z}=Me(),M=`${f.public.managemant}/listarEscrevente`,_=`${f.public.managemant}/pesquisarPessoas`,u=`${f.public.managemant}/atoReconhecimento`,$=`${f.public.managemant}/etiquetaAutenticidade`,ie=`${f.public.managemant}/download`,ue=`${f.public.envioDoc}/print`,S=n(A("user-data").value.cartorio_token),ce=n(A("user-service").value.token).value||n(A("user-service").value).value,me=A("auth_token").value,W=n(!1),H=n([]),Y=n([]),P=n([]),T=n(!1),L=n(!1),E=n(!1),F=n(null),G=n(null),O=n(""),R=n(null),D=n(!1),X=[{title:"Documento",align:"start",key:"documento"},{title:"Pessoa",align:"start",key:"nome"},{value:"actions"}],r=Se({quantidade:1,escrevente:null,nome:null,documento:null}),{data:ee}=([k,C]=Te(()=>V(M,{method:"POST",body:{cartorio_token:S}},"$qpB20nOlUE")),k=await k,C(),k);Y.value=Array.isArray(ee.value)&&((oe=ee.value[0])==null?void 0:oe.func_json_escreventes)||[];async function de(){try{const{data:s,error:e}=await V(_,{method:"POST",body:{cartorio_token:S.value,documento:r.documento,nome:r.nome}},"$CfpM9wZnUE");s.value.length>0?(h("ato-created"),H.value=s.value):H.value=[]}catch(s){console.error("Erro na requisição",s)}}const pe=()=>{L.value=!0};function ve(s){P.value.push(s)}const fe=async s=>{F.value=s,E.value=!0;const{data:e}=await V(ie,{method:"POST",body:{bucket:A("user-data").value.cartorio_token,path:s.link_ficha}},"$LrKAtpxZwH");G.value=e.value};function _e(s){P.value=P.value.filter(e=>e.token!==s.token)}function ke(){return new Promise(s=>{R.value=s,D.value=!0})}async function ye(){D.value=!1;try{await ge()}finally{R.value&&(R.value(),R.value=null)}}async function ge(){var y,g,m;if(!r.escrevente)throw Z.error("Por favor selecione um Escrevente"),new Error("Escrevente não selecionado");if(W.value)return;W.value=!0;const s=P.value.map(i=>({pessoa_token:i.token})),{data:e,error:w,status:q}=await V(u,{method:"POST",body:{pessoas:s,cartorio_token:S.value,ordemserv_token:ce,quantidade:r.quantidade,usuario_token:me,ato_tipo_token:d.ato_token}},"$EE94jKo1pQ");if(q.value==="success"&&e.value[0].status==="OK"){if(e.value[0].livro&&e.value[0].livro!==null){const i=window.open("","_blank");i.document.open(),i.document.write(e.value[0].livro),i.document.close()}he(e.value[0].token)}else T.value=!0,O.value=Array.isArray(e.value)&&((y=e.value[0])==null?void 0:y.status_mensagem)||((m=(g=w==null?void 0:w.value)==null?void 0:g.data)==null?void 0:m.details)||"Não foi possível concluir o reconhecimento"}async function he(s){var y,g;const{data:e,error:w,status:q}=await V($,{method:"POST",body:{ato_token:s,cartorio_token:S.value,escrevente_token:r.escrevente}},"$KyoIzBxZyr");if(q.value==="success"){const m=Array.isArray(e.value)?e.value[0]:null;if(!m)return;if(m.tipo_etiqueta==="html"){const i=window.open("","_blank");i.document.open(),i.document.write(m.etiqueta),i.document.close()}else if(m.tipo_etiqueta==="zpl"){const{status:i,error:l}=await V(`${ue}`,{method:"POST",body:{zpl:atob(e.value[0].etiqueta)},timeout:3e4},"$Vem9mHWYqw");if(i.value!=="success"){T.value=!0;const N=(g=(y=l.value)==null?void 0:y.data)==null?void 0:g.message;N?O.value=N:O.value="O sistema demorou demais para responder e a impressão não foi feita.";return}}Q()}}const we=()=>{T.value=!1,Q()},Q=()=>{const s=v.query.origem||"criar",e=v.query.id;s==="atualizar"?p.push(`/os/atualizar/${e}`):p.push("/os/criar-registro")};return(s,e)=>{const w=Ve,q=be,y=xe,g=Le,m=je,i=ze;return x(),B(Ee,null,[o(j,{class:"mt-5"},{default:a(()=>[o(b,{cols:"5"},{default:a(()=>[o(Ke,{label:"Tabelião/escrevente",modelValue:t(r).escrevente,"onUpdate:modelValue":e[0]||(e[0]=l=>t(r).escrevente=l),items:t(Y),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"])]),_:1}),o(b,{cols:"2"},{default:a(()=>[o(z,{label:"Quantidade",type:"number",modelValue:t(r).quantidade,"onUpdate:modelValue":e[1]||(e[1]=l=>t(r).quantidade=l)},null,8,["modelValue"])]),_:1})]),_:1}),o(j,null,{default:a(()=>[o(b,{cols:"3"},{default:a(()=>[o(z,{label:"Documento",modelValue:t(r).documento,"onUpdate:modelValue":e[2]||(e[2]=l=>t(r).documento=l)},null,8,["modelValue"])]),_:1}),o(b,{cols:"4"},{default:a(()=>[o(z,{label:"Pessoa",modelValue:t(r).nome,"onUpdate:modelValue":e[3]||(e[3]=l=>t(r).nome=l)},null,8,["modelValue"])]),_:1}),c("div",null,[c("img",{class:"btn-pointer mt-1",src:re,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:de})]),c("div",null,[c("img",{class:"btn-pointer mt-1 ml-2",src:Be,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:pe})])]),_:1}),o(j,null,{default:a(()=>[o(b,{class:"mr-10"},{default:a(()=>[o(se,{style:{height:"465px"},headers:X,items:t(H)},{"item.actions":a(({item:l})=>[c("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:N=>fe(l),title:"Visualizar Ficha"},[l.link_ficha?(x(),B("img",Je)):(x(),B("img",Ye))],8,Qe)]),_:1},8,["items"])]),_:1}),o(b,null,{default:a(()=>[o(se,{headers:X,items:t(P),style:{height:"465px"},"item-key":"id"},{"item.actions":a(({item:l})=>[c("div",{style:{display:"flex","justify-content":"flex-end"},onClick:N=>_e(l),title:"Remover"},e[8]||(e[8]=[c("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:Ie,alt:"Remover"},null,-1)]),8,Ge)]),_:1},8,["items"])]),_:1})]),_:1}),o(w,{show:t(L),onClose:e[4]||(e[4]=l=>L.value=!1)},null,8,["show"]),t(E)?(x(),ne(q,{key:0,show:t(E),item:t(F),"pessoa-obj":t(F),"link-view":t(G),onConfirmar:e[5]||(e[5]=l=>ve(t(F))),onClose:e[6]||(e[6]=l=>E.value=!1)},null,8,["show","item","pessoa-obj","link-view"])):le("",!0),o(y,{show:t(T),errorMessage:t(O),onClose:we},null,8,["show","errorMessage"]),o(g,{show:t(D),onClose:e[7]||(e[7]=l=>D.value=!1),onConfirm:ye},null,8,["show"]),o(j,null,{default:a(()=>[o(m,{onClick:Q},{default:a(()=>[o(J,{size:"large",color:"red"},{default:a(()=>e[9]||(e[9]=[U("Voltar")])),_:1})]),_:1}),o(i,{onSave:ke,disabled:t(W),class:"ml-5",size:"large",color:"green"},{default:a(()=>e[10]||(e[10]=[U("Salvar")])),_:1},8,["disabled"])]),_:1})],64)}}};export{Fo as default};
