import{_ as se}from"./B_4CAgfy.js";import{c as we,r as Ce,u as Ve}from"./CEn_AuPw.js";import{g as Me,D as Q,K as H,u as re,r as l,e as S,f as ce,y as de,o as V,h as X,w as a,b as e,i as t,s as oe,V as J,d as U,k as ee,A as De,a as v,c as L,p as pe,M as Re,N as je,F as ze,O as xe,t as ae}from"./BByDlLmN.js";import{u as h}from"./DEqwmX4B.js";import{V as O}from"./BR4JYKwL.js";import{V as N}from"./Dla0_UEN.js";import{V as le}from"./DHu74AEx.js";import{V as me}from"./KYmhQMWN.js";import{_ as Ne,a as Ie,b as Ue}from"./CLNynHxL.js";import{_ as Be,a as Fe,b as Le,T as We,W as Ke,D as Ee,c as Je,d as Ge}from"./2wIrtf2J.js";import{_ as Ye,r as Pe}from"./CuuQCXov.js";import{_ as ie}from"./BM1-cHce.js";import{_ as ue}from"./BVz1G1IN.js";import{_ as Xe}from"./Dcq_7Fnl.js";import{_ as be,a as he}from"./DJvq3mCv.js";import{V as ke}from"./DFCAmhU7.js";import{_ as Ze}from"./nLRMiXLS.js";import{V as Qe}from"./CILLoBl0.js";import{f as $e}from"./B0IxRygJ.js";import{_ as He}from"./esdrYL2a.js";const Ut={__name:"Dados",props:{ato_token:{type:String,required:!0},ato_tipo_id:{type:Number}},emits:["saved"],async setup(W,{emit:$}){let g,_;const f=W;Me(()=>f.ato_tipo_id,o=>{k.value={id:o}});const z=$,y=Q(),E=H(),B=ee(),{$toast:F}=re(),K=`${B.public.managemant}/listarSituacoes`,w=`${B.public.managemant}/createAtos`;`${B.public.managemant}`;const T=l(S("user-data").value.cartorio_token),b=l(S("user-service").value.id).value||l(S("user-service").value).value,C=l([]),k=l(f.ato_tipo_id?{id:f.ato_tipo_id}:null),x=ce({dt_abertura:null,status:"EM EDIÇÃO",mne:null}),P={status:{required:we.withMessage("O campo é obrigatorio",Ce)}},q=Ve(P,x);async function R(){if(await q.value.$validate()){const{data:o,error:s,status:i}=await h(w,{method:"POST",body:{ato_tipo_id:k.value.id,cartorio_id:S("user-data").value.cartorio_id,ordemserv_id:b,status:x.status,dt_abertura:x.dt_abertura,mne:x.mne,user_id:S("user-data").value.usuario_id,user_alteracao_id:S("user-data").value.usuario_id}},"$9ZmTYsLk0K");i.value==="success"&&(F.success("Ato registrado com sucesso!"),z("saved",{id:o.value.id,token:o.value.token}))}else F.error("Preencha os campos obrigatorios.")}const{data:j}=([g,_]=de(()=>h(K,{method:"POST",body:{cartorio_token:T.value}},"$hyq5YcBEjF")),g=await g,_(),g);C.value=j.value;const u=()=>{const o=E.query.origem||"criar",s=E.query.id;switch(o){case"atualizar":case"vizualizar":y.push(`/os/atualizar/${s}`);break;case"atualizar-lista":case"vizualizar-lista":y.push("/atos/lista");break;default:y.push("/os/criar-registro");break}};return(o,s)=>{const i=se;return V(),X(me,null,{default:a(()=>[e(O,{class:"mt-5"},{default:a(()=>[e(N,{cols:"3"},{default:a(()=>[e(le,{label:"Situação",modelValue:t(x).status,"onUpdate:modelValue":s[0]||(s[0]=r=>t(x).status=r),items:t(C),"item-title":"descricao","item-value":"descricao",required:"","error-messages":t(q).status.$errors.map(r=>r.$message),onBlur:t(q).status.$touch,onInput:t(q).status.$touch},null,8,["modelValue","items","error-messages","onBlur","onInput"])]),_:1})]),_:1}),e(O,null,{default:a(()=>[e(N,{cols:"5"},{default:a(()=>[e(oe,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:t(x).mne,"onUpdate:modelValue":s[1]||(s[1]=r=>t(x).mne=r)},null,8,["modelValue"])]),_:1})]),_:1}),e(O,null,{default:a(()=>[e(N,{cols:"2"},{default:a(()=>[e(oe,{modelValue:t(x).dt_abertura,"onUpdate:modelValue":s[2]||(s[2]=r=>t(x).dt_abertura=r),type:"date",label:"Data Lavratura",disabled:"",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(O,{class:"mb-3"},{default:a(()=>[e(i,{onClick:u},{default:a(()=>[e(J,{size:"large",color:"red"},{default:a(()=>s[3]||(s[3]=[U("Voltar")])),_:1})]),_:1}),e(J,{class:"ml-10",onClick:R,size:"large",color:"green"},{default:a(()=>s[4]||(s[4]=[U("Salvar")])),_:1})]),_:1})]),_:1})}}},et=["onClick"],tt=["onClick"],at=["onClick"],ot={key:0,style:{width:"30px",height:"30px"},src:be,alt:"Visualizar",title:"Reativar"},st={key:1,src:he,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},rt=["onClick"],Bt={__name:"Partes",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},async setup(W){let $,g;const _=W,f=Q(),z=H(),y=ee(),{$toast:E}=re(),B=`${y.public.managemant}/pesquisarPessoas`,F=`${y.public.managemant}/listarPapeis`,K=`${y.public.managemant}/download`,w=`${y.public.managemant}/createAtosPessoa`,T=`${y.public.managemant}/getAtosPessoaById`,b=`${y.public.managemant}/updateAtosPessoa`,C=l(S("user-data").value.cartorio_token),k=l([]),x=l({}),P=l([]),q=l([]),R=l(!1),j=l(!1),u=l(!1),o=l(!1),s=l(null),i=l(null),r=l(null),c=l(null);l(null);const m=l(null),A=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"400px"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome"},{value:"actions"}],d=ce({papeis:null,nome:null,pessoa:null,documento:null});De(()=>{var p;return((p=d.pessoa)==null?void 0:p.link_ficha)||!1});const{data:Y}=([$,g]=de(()=>h(F,{method:"POST",body:{tipo_ato_token:_.ato_token}},"$fFKndZhA4W")),$=await $,g(),$);q.value=Y.value;async function ve(){try{const{data:p,error:n}=await h(B,{method:"POST",body:{cartorio_token:C.value,documento:d.documento,nome:d.nome}},"$o3ZL1rvYrY");p.value.length>0?(k.value=p.value,d.pessoa=k.value[0]):k.value=[]}catch(p){console.error("Erro na requisição",p)}}const G=()=>{j.value=!0},I=p=>{P.value=P.value.map(n=>n.id===r.value?{...n,papel:{...n.papel,descricao:p}}:n)},te=p=>{const n=P.value.find(M=>M.pessoa.id===c.value);n.representante.nome=p},Z=async()=>{const p={pessoa:d.pessoa,papel:q.value.find(M=>M.id===d.papeis),representante:{nome:null}},n=await h(`${T}/${_.ato_id}`,{method:"GET"},"$kXSxUa4grs");for(const M of n.data.value)if(M.pessoa_id===d.pessoa.id&&M.ato_id===_.ato_id&&M.tipo_parte_id===d.papeis){E.error("Pessoa Já Registrada Com Esse Papel!");return}try{const{data:M,error:fe,status:ge}=await h(w,{method:"POST",body:{ato_id:Number(_.ato_id),pessoa_id:d.pessoa.id,tipo_parte_id:d.papeis,user_id:Number(S("user-data").value.usuario_id)}},"$So3qnQu7ek");ge.value==="success"?(p.id=M.value.id,E.success("Pessoa Registrada com Sucesso!"),P.value.push(p)):E.error(fe.value.message)}catch{E.error("Erro no servidor. Tente novamente.")}},ne=async p=>{u.value=!0;const{data:n}=await h(K,{method:"POST",body:{bucket:S("user-data").value.cartorio_token,path:p.pessoa.link_ficha}},"$Q3kbIwtd9t");m.value=n.value,x.value=p.pessoa},_e=p=>{const n=P.value.filter(M=>M.pessoa.id!==p.pessoa.id).map(M=>({id:M.pessoa.id,nome:M.pessoa.nome}));r.value=p.id,s.value=n,R.value=!0,i.value=p.pessoa.nome,c.value=p.pessoa.id},Ae=p=>{r.value=p.id,o.value=!0,i.value=p.pessoa.nome};async function Se(p){p.excluido=!p.excluido;try{await h(`${b}/${r.value}`,{method:"PUT",body:JSON.stringify({excluido:p.excluido})},"$9xStKwGd7o")}catch(n){console.error("Erro ao excluir pessoa:",n)}}const Oe=()=>{const p=z.query.origem||"criar",n=z.query.id;switch(p){case"atualizar":case"vizualizar":f.push(`/os/atualizar/${n}`);break;case"atualizar-lista":case"vizualizar-lista":f.push("/atos/lista");break;default:f.push("/os/criar-registro");break}};return(p,n)=>{const M=Ne,fe=Fe,ge=Le,Te=Ye,qe=se;return V(),X(me,null,{default:a(()=>[e(O,{class:"mt-5"},{default:a(()=>[e(N,{cols:"3"},{default:a(()=>[e(oe,{label:"Documento",modelValue:t(d).documento,"onUpdate:modelValue":n[0]||(n[0]=D=>t(d).documento=D)},null,8,["modelValue"])]),_:1}),e(N,{cols:"4"},{default:a(()=>[e(oe,{label:"Pessoa",modelValue:t(d).nome,"onUpdate:modelValue":n[1]||(n[1]=D=>t(d).nome=D)},null,8,["modelValue"])]),_:1}),v("div",null,[v("img",{class:"mt-3",src:ie,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:ve})]),v("div",null,[v("img",{class:"mt-3 ml-2",src:ue,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:G})])]),_:1}),e(O,null,{default:a(()=>[e(N,{cols:"4"},{default:a(()=>[e(le,{label:"Selecione a Pessoa",modelValue:t(d).pessoa,"onUpdate:modelValue":n[2]||(n[2]=D=>t(d).pessoa=D),items:t(k),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),e(N,{cols:"3"},{default:a(()=>[e(le,{label:"Papel",modelValue:t(d).papeis,"onUpdate:modelValue":n[3]||(n[3]=D=>t(d).papeis=D),items:t(q),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),v("div",null,[v("img",{class:"mt-3",src:ue,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:Z})])]),_:1}),e(O,null,{default:a(()=>[e(N,null,{default:a(()=>[e(ke,{style:{height:"465px"},headers:A,items:t(P)},{"item.actions":a(({item:D})=>[e(O,null,{default:a(()=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ye=>ne(D),title:"Visualizar Ficha"},n[8]||(n[8]=[v("img",{style:{width:"30px",height:"30px"},src:ie,alt:"Visualizar"},null,-1)]),8,et),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ye=>Ae(D),class:"mr-2",title:"Alterar Papel"},n[9]||(n[9]=[v("img",{style:{width:"30px",height:"30px"},src:Xe,alt:"Visualizar"},null,-1)]),8,tt),v("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ye=>Se(D),title:"Deletar Pessoa"},[D.excluido?(V(),L("img",ot)):(V(),L("img",st))],8,at),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ye=>_e(D),title:"Selecionar Representante"},n[10]||(n[10]=[v("img",{style:{width:"30px",height:"30px"},src:Be,alt:"Visualizar"},null,-1)]),8,rt)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),e(M,{show:t(j),onClose:n[4]||(n[4]=D=>j.value=!1)},null,8,["show"]),e(fe,{representante_nome:t(i),representantes:t(s),ato_id:t(r),show:t(R),onClose:n[5]||(n[5]=D=>R.value=!1),onUpdateRepresentante:te},null,8,["representante_nome","representantes","ato_id","show"]),e(ge,{representante_nome:t(i),ato_token:_.ato_token,ato_id:t(r),show:t(o),onClose:n[6]||(n[6]=D=>o.value=!1),onUpdatePapel:I},null,8,["representante_nome","ato_token","ato_id","show"]),t(u)?(V(),X(Te,{key:0,show:t(u),"link-view":t(m),"pessoa-obj":t(x),"is-view":!0,onClose:n[7]||(n[7]=D=>u.value=!1)},null,8,["show","link-view","pessoa-obj"])):pe("",!0),e(O,null,{default:a(()=>[e(qe,{onClick:Oe},{default:a(()=>[e(J,{size:"large",color:"red"},{default:a(()=>n[11]||(n[11]=[U("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},nt={key:0,class:"loading-overlay"},lt="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",Ft={__name:"Minuta",props:{ato_token:{type:String,required:!0}},emits:["page","doc"],setup(W,{emit:$}){const g=W;Re("DocumentEditorContainer",[We,Ke]);const _=ee(),{$toast:f}=re(),z=Q(),y=H(),E=$;Pe(`${_.public.docEditor}`);const B=`${_.public.managemant}/upload`,F=`${_.public.managemant}/subitituirModelo`,K=`${_.public.managemant}/download`,w=l(null),T=l(!1),b=async u=>{try{const o=await fetch(u);if(!o.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await o.blob()}catch(o){return console.error(o),null}},C=async()=>{const o=await w.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),s=new FileReader;s.onload=()=>{const i=s.result;E("doc",i)},s.readAsText(o)},k=async()=>{T.value=!0;try{const o=await w.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),s=new FormData;s.append("file",o,"anexo.docx"),s.append("cartorio_token",S("user-data").value.cartorio_token),s.append("token",g.ato_token),s.append("tipo","ato_minuta");const{data:i,status:r}=await h(B,{method:"POST",body:s},"$071xxdqs20");if(r.value==="success"){f.success("Documento enviado!");const m=w.value.ej2Instances.documentEditor.pageCount;C(),E("page",m)}else f.error("Erro ao enviar documento para o sistema.")}catch(u){f.error("Erro ao salvar documento."),console.error(u)}finally{T.value=!1}},x=async()=>{R(!0);try{await P(),R(!0);const{data:u,status:o}=await h(F,{method:"POST",body:{ato_token:g.ato_token}},"$0ktpWliD4l");u.value&&q(u.value)}catch(u){console.error("Erro ao gerar a minuta:",u),f.error("Ocorreu um erro ao gerar a minuta.")}finally{R(!1)}},P=async()=>{try{const{data:u}=await h(K,{method:"POST",body:{bucket:S("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$jXVvQjEE6u"),o=await b(u.value);if(o){const s=new FileReader;s.onload=()=>{const i=s.result;w.value.ej2Instances.documentEditor.open(i),E("doc",i)},s.readAsText(o)}}catch(u){console.error("Erro ao carregar o modelo de minuta:",u),f.error("Falha ao carregar o modelo de minuta.")}},q=u=>{const o=w.value.ej2Instances.documentEditor,s=i=>{for(const[r,c]of Object.entries(i))if(/^<<.+>>$/.test(r))try{o.search.findAll(r),o.search.searchResults.length>0&&o.search.searchResults.replaceAll(c)}catch(m){console.error(`Erro ao substituir o marcador ${r}:`,m)}else if(r==="partes"&&Array.isArray(c)&&c.length>0)for(const m of c)typeof m=="object"&&s(m)};s(u)},R=u=>{T.value=u},j=()=>{const u=y.query.origem||"criar",o=y.query.id;switch(u){case"atualizar":case"vizualizar":z.push(`/os/atualizar/${o}`);break;case"atualizar-lista":case"vizualizar-lista":z.push("/atos/lista");break;default:z.push("/os/criar-registro");break}};return(u,o)=>{const s=se;return V(),L(ze,null,[e(t(Ee),{height:"900px",ref_key:"documentEditorContainer",ref:w,serviceUrl:lt,enableToolbar:!0,enableWordExport:!0},null,512),t(T)?(V(),L("div",nt,[e(je,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):pe("",!0),e(O,{class:"ml-4 mt-4 mb-4"},{default:a(()=>[e(s,{class:"mr-4"},{default:a(()=>[e(J,{size:"large",onClick:j,color:"red"},{default:a(()=>o[0]||(o[0]=[U("Voltar")])),_:1})]),_:1}),e(J,{size:"large",color:"green",onClick:k,disabled:t(T)},{default:a(()=>o[1]||(o[1]=[U("Salvar")])),_:1},8,["disabled"]),e(J,{class:"ml-4",size:"large",color:"blue",onClick:x},{default:a(()=>o[2]||(o[2]=[U("Gerar Minuta")])),_:1})]),_:1})],64)}}},it=["innerHTML"],Lt={__name:"Livro",props:{ato_token:{type:String,required:!0},pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(W){let $,g;const _=W,f=ee();Pe(`${f.public.docEditor}`);const{$toast:z}=re(),y=Q(),E=H(),B=`${f.public.managemant}/listarEscrevente`,F=`${f.public.managemant}/lavrarAto`,K=`${f.public.managemant}/valida_lavratura`,w=`${f.public.managemant}/ato_calcular`,T=l("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),b=l(!1),C=l(null),k=l(null),x=l(null),P=l(S("user-data").value.cartorio_token),q=S("auth_token").value,R=l([]),j=l({}),u=l(null),o=l(""),s=ce({escrevente:null}),i=async(G=!1)=>{if(!G){const{data:Z}=await h(K,{method:"POST",body:{ato_token:_.ato_token}},"$ZKnVBNYxp9"),ne=Z.value[0].status,_e=Z.value[0].status_mensagem;if(ne!=="OK"){u.value=ne,o.value=_e,j.value=null,b.value=!0,T.value="O ato apresenta inconsistências, deseja prosseguir?";return}}const{data:I,status:te}=await h(F,{method:"POST",body:{ato_token:_.ato_token,qtd_paginas:_.pages,escrevente_token:s.escrevente,usuario_token:q,cartorio_token:P}},"$XouuxOFIWh");te.value==="success"?(C.value=I.value,k.value=I.value[0].selo,z.success("Ato lavrado com sucesso!")):z.error("Falha ao lavrar o ato.")},r=()=>{b.value=!1,u.value=null,o.value="",j.value={}},c=async()=>{const{data:G,status:I}=await h(w,{method:"POST",body:{ato_token:_.ato_token,cartorio_token:P,quantidade:1,usuario_token:q,escrevente_token:s.escrevente,qtd_paginas:_.pages}},"$R51FaaSzOI");I.value==="success"?j.value=G.value[0]:z.error("Falha ao calcular o ato.")},m=async()=>{b.value=!1,u.value&&u.value!=="OK"?(await i(!0),u.value=null,o.value=""):await i()},A=async()=>{b.value=!0,console.log("oi"),await c()},{data:d}=([$,g]=de(()=>h(B,{method:"POST",body:{cartorio_token:P}},"$JCPnpnnRzP")),$=await $,g(),$);R.value=d.value[0].func_json_escreventes;const Y=function(){x.value.ej2Instances.documentEditor.open(_.document)},ve=()=>{const G=E.query.origem||"criar",I=E.query.id;switch(G){case"atualizar":case"vizualizar":y.push(`/os/atualizar/${I}`);break;case"atualizar-lista":case"vizualizar-lista":y.push("/atos/lista");break;default:y.push("/os/criar-registro");break}};return(G,I)=>{const te=Ze;return V(),L(ze,null,[e(O,null,{default:a(()=>[e(N,null,{default:a(()=>[(V(),X(t(Ee),{restrictEditing:!0,enableToolbar:!1,created:_.document?Y:null,ref_key:"documentEditorContainer",ref:x,height:"850px",width:"850px",key:_.document},null,8,["created"]))]),_:1}),e(N,null,{default:a(()=>[e(le,{class:"mt-15",label:"Tabelião/escrevente",modelValue:t(s).escrevente,"onUpdate:modelValue":I[0]||(I[0]=Z=>t(s).escrevente=Z),items:t(R),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),v("div",null,[v("div",null,[v("img",{onClick:I[1]||(I[1]=Z=>A()),class:"ml-2",style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:Je}),t(C)?(V(),X(Qe,{key:0,class:"mr-16"},{default:a(()=>[e(O,{"no-gutters":""},{default:a(()=>[e(N,null,{default:a(()=>[e(xe,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:a(()=>[e(N,null,{default:a(()=>[U(" Livro: "+ae(t(C)[0].livro_numero),1)]),_:1}),e(N,null,{default:a(()=>[U(" Protocolo: "+ae(t(C)[0].protocolo?t(C)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),e(N,null,{default:a(()=>[e(xe,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:a(()=>[U(" Folhas : "+ae(t(C)[0].pagina_inicial)+" A "+ae(t(C)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),v("div",{innerHTML:t(k)},null,8,it)]),_:1})):pe("",!0)])])]),_:1})]),_:1}),e(J,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:ve},{default:a(()=>I[2]||(I[2]=[U("Voltar")])),_:1}),e(te,{show:t(b),condMessage:t(T),valor:t(j),description:t(o),onClose:r,onConfirm:m},null,8,["show","condMessage","valor","description"])],64)}}},ut=["onClick"],ct=["onClick"],dt={key:0,style:{width:"30px",height:"30px"},src:be,alt:"Visualizar",title:"Reativar"},pt={key:1,src:he,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Wt={__name:"Observacao",props:{ato_id:{type:Number,required:!0}},async setup(W){let $,g;const _=W,f=Q(),z=H(),y=ee(),E=`${y.public.managemant}/listarEscrevente`,B=`${y.public.managemant}/atos_observacao`,F=`${y.public.managemant}/atos_observacao`,K=l(S("user-data").value.cartorio_token),w=l([]),T=l([]),b=l(!1),C=l(!1),k=l(""),x=[{title:"Data",align:"start",key:"data"},{title:"Escrevente",align:"start",key:"escrevente"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}];function P(i){k.value=i.observacao,C.value=!0,b.value=!0}const q=()=>{C.value=!1,b.value=!0,k.value=""};async function R(i){i.excluido=!i.excluido;try{await h(`${B}/${i.id}`,{method:"PUT",body:JSON.stringify({excluido:i.excluido})},"$aJM1TL1buW")}catch(r){console.error("Erro ao excluir observacao:",r)}}const j=async()=>{b.value=!1,await u()};async function u(){const{data:i}=await h(`${F}/${_.ato_id}`,{method:"GET"},"$dMg99jeUNP");Array.isArray(i.value)?w.value=i.value.map(r=>({...r,created:$e(r.created,"dd/mm/yyyy hh:mm")})):i.value&&typeof i.value=="object"&&(w.value=[{...i.value,created:$e(i.value.created,"dd/mm/yyyy hh:mm")}])}const{data:o}=([$,g]=de(()=>h(E,{method:"POST",body:{cartorio_token:K}},"$B6PdRx8Gp4")),$=await $,g(),$);T.value=o.value[0].func_json_escreventes;const s=()=>{const i=z.query.origem||"criar",r=z.query.id;i==="atualizar"?f.push(`/os/atualizar/${r}`):f.push("/os/criar-registro")};return(i,r)=>{const c=Ge,m=se;return V(),X(me,null,{default:a(()=>[e(O,{class:"mt-5"},{default:a(()=>[e(J,{class:"mb-4 ml-8",onClick:q,size:"large",color:"green"},{default:a(()=>r[1]||(r[1]=[U("Novo")])),_:1}),v("div",null,[v("img",{class:"btn-pointer ml-2",src:ue,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:r[0]||(r[0]=(...A)=>i.onSubmit&&i.onSubmit(...A))})])]),_:1}),e(O,null,{default:a(()=>[e(N,null,{default:a(()=>[e(ke,{style:{height:"465px"},headers:x,items:t(w)},{"item.observacao":a(({item:A})=>[U(ae(A.observacao.length>100?A.observacao.slice(0,100)+"...":A.observacao),1)]),"item.actions":a(({item:A})=>[e(O,null,{default:a(()=>[v("div",{onClick:d=>P(A)},r[2]||(r[2]=[v("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ie,alt:"Visualizar"},null,-1)]),8,ut),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:d=>R(A),title:"Deletar Observação"},[A.excluido?(V(),L("img",dt)):(V(),L("img",pt))],8,ct)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),t(b)?(V(),X(c,{key:0,show:t(b),observacao:t(k),visualizar:t(C),onClose:j},null,8,["show","observacao","visualizar"])):pe("",!0),e(O,null,{default:a(()=>[e(m,{onClick:s},{default:a(()=>[e(J,{size:"large",color:"red"},{default:a(()=>r[3]||(r[3]=[U("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},mt={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ie,alt:"Criar"},vt={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ue,alt:"Criar"},_t={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:He,alt:"Criar"},ft=["onClick"],gt=["onClick"],yt=["onClick"],bt={key:0,style:{width:"30px",height:"30px"},src:be,alt:"Visualizar",title:"Reativar"},ht={key:1,src:he,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Kt={__name:"Anexos",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},setup(W){const $=W,g=ee(),{$toast:_}=re(),f=Q(),z=H(),y=`${g.public.biometria}/run-scanner`,E=`${g.public.managemant}/atos_anexos`,B=`${g.public.managemant}/atos_anexos`,F=`${g.public.managemant}/download`;`${g.public.managemant}`,`${g.public.managemant}`;const K=l(!1),w=l(null),T=l([]);S("pessoa_token");const b=ce({descricao:"",fileEvent:null}),C={descricao:{required:we.withMessage("O campo é obrigatório",Ce)}},k=Ve(C,b,{$autoDirty:!0}),x=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}];async function P(){try{await q(),await R()}catch(c){console.error("Erro ao executar scanner ou listar arquivos:",c)}}async function q(){try{const{data:c}=await h(y,{method:"GET"},"$WazoKp68Tw")}catch(c){_.error("Erro ao acionar o scanner:",c)}}async function R(){try{const{data:c,status:m}=await h("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:z.query.ato_token_edit,cartorio_token:S("user-data").value.cartorio_token}},"$03Wxiia3aI")}catch(c){console.error("Erro ao enviar o arquivo:",c)}}const j=async()=>{K.value=!0};function u(c){return c?!0:(console.error("Erro: Nenhum arquivo foi selecionado!"),w.value=!1,!1)}const o=async()=>{if(k.value.$touch(),!k.value.$invalid&&u(b.fileEvent)){const{data:c,error:m,status:A}=await h(E,{method:"POST",body:{ato_id:$.ato_id,descricao:b.descricao,user_id:S("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$WyW0hasRPI");A.value==="success"&&(_.success("Anexo registrado com sucesso!"),T.value.push(c.value))}};async function s(c){c.excluido=!c.excluido;try{await h(`${B}/${c.id}`,{method:"PUT",body:JSON.stringify({excluido:c.excluido})},"$Y3y6TjqbSV")}catch(m){console.error("Erro ao excluir pessoa:",m)}}async function i(c){try{const m=await h(`${F}`,{method:"POST",body:{bucket:S("user-data").value.cartorio_token,path:c.link}},"$bkXJSi7s76"),d=await(await fetch(m.data.value)).blob(),Y=URL.createObjectURL(d);window.open(Y,"_blank")}catch(m){console.error("Erro ao excluir pessoa:",m)}}const r=()=>{const c=z.query.origem||"criar",m=z.query.id;switch(c){case"atualizar":case"vizualizar":f.push(`/os/atualizar/${m}`);break;case"atualizar-lista":case"vizualizar-lista":f.push("/atos/lista");break;default:f.push("/os/criar-registro");break}};return(c,m)=>{const A=se;return V(),X(me,null,{default:a(()=>[e(O,null,{default:a(()=>[e(N,{cols:"5",class:"mt-2"},{default:a(()=>[e(oe,{modelValue:t(b).descricao,"onUpdate:modelValue":[m[0]||(m[0]=d=>t(b).descricao=d),t(k).descricao.$touch],"error-messages":t(k).descricao.$errors.map(d=>d.$message),onBlur:t(k).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"])]),_:1}),v("div",{onClick:P,title:"Criar",style:{"padding-right":"10px"}},[t(w)===!1?(V(),L("img",mt)):t(w)===!0?(V(),L("img",vt)):(V(),L("img",_t))]),v("div",{onClick:o,title:"Criar"},m[1]||(m[1]=[v("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:ue,alt:"Escanear"},null,-1)]))]),_:1}),e(ke,{headers:x,items:t(T),style:{height:"465px","max-width":"600px"}},{"item.actions":a(({item:d})=>[e(O,null,{default:a(()=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:Y=>j(d),title:"Visualizar Anexo"},[v("img",{style:{width:"30px",height:"30px"},onClick:Y=>i(d),src:ie,alt:"Visualizar"},null,8,gt)],8,ft),v("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:Y=>s(d),title:"Deletar Pessoa"},[d.excluido?(V(),L("img",bt)):(V(),L("img",ht))],8,yt)]),_:2},1024)]),_:1},8,["items"]),e(A,{onClick:r},{default:a(()=>[e(J,{size:"large",color:"red"},{default:a(()=>m[2]||(m[2]=[U("Voltar")])),_:1})]),_:1})]),_:1})}}};export{Ut as _,Bt as a,Ft as b,Lt as c,Wt as d,Kt as e};
