import{_ as k,O as _,r as l,h as E,c as i,a as r,F as v,P as w,B as L,Q as R,J as S,o as u,E as B,d as C,t as N,s as O}from"./DwiyjMKx.js";const U={class:"chat-container"},D=["onClick"],M={__name:"index",setup(T){const b=_(),c=l(""),f=l([{from:"server",text:"Por favor, me informe seu nome"}]),m=l(),d=l(null),p=l();let a=null;b.query.cartorio_token;function n(t,e){f.value.push({from:t,text:e}),O(()=>{d.value&&(d.value.scrollTop=d.value.scrollHeight)})}function h(){if(m.value||(m.value=c.value,g()),!c.value.trim())return;const t=y(c.value);n("user",t);const e={type:"chat_bot_message",message:t,cartorio_token:"qvgjz"};c.value="",a.send(JSON.stringify(e))}function g(){a=new WebSocket(`ws://localhost:3452?user_name=${m.value}`),a.addEventListener("open",()=>{console.log("✅ Conectado ao servidor")}),a.addEventListener("message",t=>{try{const e=JSON.parse(t.data);e.message&&e.message.state!=="ExibirResposta"?n("server",e.message):e.message&&e.message.state==="ExibirResposta"?(console.log("@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@data.message"),p.value=e.message,n("button",e.message)):e.type==="connection_info"||n("server",JSON.stringify(e))}catch{n("server",t.data)}}),a.addEventListener("close",()=>{console.log("❌ Conexão encerrada"),n("system","⚠️ Conexão encerrada")}),a.addEventListener("error",t=>{console.error("⚠️ Erro na conexão:",t),n("system","⚠️ Erro na conexão")})}function x(t){fetch(t).then(e=>{if(!e.ok)throw new Error("Erro ao baixar o arquivo");return e.blob()}).then(e=>{const s=URL.createObjectURL(e),o=document.createElement("a");o.href=s,o.download="documento.pdf",o.click(),URL.revokeObjectURL(s)})}function y(t){const e=typeof t=="object"?t.message:t,s=/(https?:\/\/[^\s]+)/g;return e.replace(s,o=>`<a href="${o}" target="_blank" class="chat-link">${o}</a>`)}return E(()=>{a&&a.readyState===WebSocket.OPEN&&a.close()}),(t,e)=>(u(),i("div",U,[e[2]||(e[2]=r("div",{class:"chat-header"},[r("span",{class:"chat-title"},"Chat"),r("button",{class:"chat-close"},"×")],-1)),r("div",{ref_key:"chatHistory",ref:d,class:"chat-history"},[(u(!0),i(v,null,w(f.value,(s,o)=>(u(),i("div",{key:o,class:B(["chat-bubble",s.from==="user"?"user-bubble":s.from==="system"?"system-bubble":"server-bubble"])},[s.from==="button"?(u(),i("button",{key:0,class:"chat-button",onClick:j=>x(s.text.message)}," 📎 Baixar documento ",8,D)):(u(),i(v,{key:1},[C(N(s.text.message||s.text),1)],64))],2))),128))],512),r("form",{onSubmit:S(h,["prevent"]),class:"chat-input-area"},[L(r("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),type:"text",placeholder:"Digite sua mensagem...",class:"chat-input"},null,512),[[R,c.value]]),e[1]||(e[1]=r("button",{type:"submit",class:"chat-send-button"},"➤",-1))],32)]))}},$=k(M,[["__scopeId","data-v-da9fe312"]]);export{$ as default};
