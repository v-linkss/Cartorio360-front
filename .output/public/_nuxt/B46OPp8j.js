import{_ as le}from"./CYkTZ1_x.js";import{_ as J}from"./B4JYSWAY.js";import{_ as ce}from"./DDcyvl-p.js";import{_ as ue}from"./gxXzbsry.js";import{m as K,u as x,r as l,z as X,A as ee,B as N,o as M,c as F,b as a,w as t,a as v,V as B,s as u,C as V,D as Q,E as ie,v as ae,d as z,F as oe,q as te,y as j,p as de}from"./71XPcA9R.js";import{u as re}from"./DSwZ9fSC.js";import{V as y}from"./CkunldK5.js";import{V as R}from"./BKR7fvaq.js";import{V as me}from"./D3dhr9qD.js";import{V as se}from"./H7fyLadS.js";import{V as G}from"./DGSs8xQ5.js";import{_ as pe}from"./CmNw1Pd9.js";import{_ as ve}from"./BVz1G1IN.js";import{_ as _e,a as fe}from"./DJvq3mCv.js";import{V as Y,a as xe,b as Z,c as be}from"./BKIounpu.js";import"./BitbLBW3.js";import"./D6uI46L9.js";import"./Db1Z63DZ.js";import"./CzTN88TR.js";import"./DWSkwQVm.js";import"./D3goRUa3.js";import"./D-2oYXqn.js";const ge=["title","onClick"],Ce=["onClick"],ye={__name:"Os",setup(H){const d=te(),{$toast:i}=K(),m=`${d.public.managemant}/listarOSCaixas`,_=`${d.public.managemant}/lista_sit_ordemserv`,P=`${d.public.managemant}/updateOrdensServico`;x("caixa-service").value.usuario_nome,x("caixa-service").value.data;const b=l([]),g=l([]),w=l(""),$=l(""),h=l({}),U=l(null),A=l("O encerramento de OS não poderá ser revertido. Confirma o encerramento?"),O=l(!1),S=l(!1),I=()=>{j("/caixas/lista")},k=[{title:"Número",value:"numero"},{title:"Situação",value:"situacao"},{title:"CPF",value:"apresentante_cpf"},{title:"Apresentante",value:"apresentante_nome"},{title:"Usuário",value:"usuario_nome"},{title:"Valor",value:"valor"},{title:"A Receber",value:"valor_a_receber"},{title:"Ações",value:"actions"}],C=l("");async function D(){try{const o=await $fetch(m,{method:"POST",body:{caixa_token:x("caixa-service").value.caixa_token}});o&&Array.isArray(o)?b.value=o:i.error("Erro ao buscar dados da API.")}catch(o){const e=o.message||"Erro ao buscar dados da API. Tente novamente.";i.error(e)}}function q(){const o=new Date,e=o.getFullYear(),c=String(o.getMonth()+1).padStart(2,"0"),f=String(o.getDate()).padStart(2,"0");return`${e}-${c}-${f}`}const W=o=>{h.value=o,S.value=!0};async function r(){try{const{data:o,error:e}=await re(_,{method:"GET"},"$nTZq0SR2Wg");o.value&&Array.isArray(o.value)?g.value=o.value.map(c=>({title:c.descricao,value:c.descricao})):(i.error("Erro ao buscar dados da API de situação."),e.value&&console.error("Erro detalhado:",e.value))}catch(o){const e=o.message||"Erro ao buscar dados da API. Tente novamente.";i.error(e),console.error("Erro na requisição:",o)}}r();async function s(o){try{await $fetch(`${P}/${o}`,{method:"PUT",body:{dt_pagto:q()}})?(i.success("Ordem de Serviço encerrada com sucesso!"),S.value=!1,D()):i.error("Erro ao encerrar OS. Tente novamente.")}catch(e){const c=e.message||"Erro ao buscar dados da API. Tente novamente.";i.error(c)}}X(()=>{D()});const p=ee(()=>b.value.filter(o=>{const e=o.numero?o.numero.toString().toLowerCase():"",c=o.apresentante_nome?o.apresentante_nome.toLowerCase():"",f=o.situacao?o.situacao.toUpperCase():"",L=e.includes(w.value.toLowerCase()),E=c.includes($.value.toLowerCase()),n=C.value?f===C.value:!0;return L&&E&&n}));function T(o,e){U.value=o,h.value={token:e.token,numero:e.numero,valor:e.valor,valor_pago:e.valor_pago},O.value=!0}return(o,e)=>{const c=le,f=J,L=N("v-cols"),E=N("v-rows");return M(),F(oe,null,[a(G,{class:"mt-5"},{default:t(()=>[a(y,{class:"mb-5"},{default:t(()=>e[6]||(e[6]=[v("h1",null,"Recebimento de Ordens de Serviço",-1)])),_:1}),a(y,null,{default:t(()=>[a(R,{cols:"2"},{default:t(()=>[a(B,{modelValue:u(w),"onUpdate:modelValue":e[0]||(e[0]=n=>V(w)?w.value=n:null),type:"text",label:"Número"},null,8,["modelValue"])]),_:1}),a(R,{md:"3"},{default:t(()=>[a(B,{modelValue:u($),"onUpdate:modelValue":e[1]||(e[1]=n=>V($)?$.value=n:null),label:"Apresentante"},null,8,["modelValue"])]),_:1})]),_:1}),a(y,null,{default:t(()=>[a(R,{md:"3"},{default:t(()=>[a(me,{modelValue:u(C),"onUpdate:modelValue":e[2]||(e[2]=n=>V(C)?C.value=n:null),items:u(g),label:"Situação",clearable:""},null,8,["modelValue","items"])]),_:1})]),_:1}),e[8]||(e[8]=v("hr",{class:"mt-5 mb-5"},null,-1)),a(se,{headers:k,items:u(p),"item-key":"id"},{"item.actions":t(({item:n})=>[a(y,{style:{display:"flex",gap:"4px","margin-top":"-5px"}},{default:t(()=>[v("div",{class:Q({disabled:!n.btn_receber}),title:n.btn_receber?"Receber":"Bloqueado",onClick:ne=>n.btn_receber?T(n.numero,n):null},[v("img",{style:ie({cursor:n.btn_receber?"pointer":"default",width:"30px",height:"30px"}),src:ce,alt:"Receber"},null,4)],10,ge),v("div",{class:Q({disabled:!n.btn_encerrar}),onClick:ne=>n.btn_encerrar?W(n.id):!1,title:"Cancelamento"},e[7]||(e[7]=[v("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ue,alt:"Encerrar",title:"Encerrar"},null,-1)]),10,Ce)]),_:2},1024)]),_:1},8,["items"]),a(c,{show:u(O),numero_os:u(U),ordem:u(h),onClose:e[3]||(e[3]=n=>O.value=!1)},null,8,["show","numero_os","ordem"]),a(f,{onConfirm:e[4]||(e[4]=n=>s(u(h))),condMessage:u(A),show:u(S),onClose:e[5]||(e[5]=n=>S.value=!1)},null,8,["condMessage","show"])]),_:1}),a(E,null,{default:t(()=>[a(L,null,{default:t(()=>[a(ae,{class:"ml-8",size:"large",onClick:I,color:"red"},{default:t(()=>e[9]||(e[9]=[z("Voltar ")])),_:1})]),_:1})]),_:1})],64)}}},Ve=["onClick"],we={key:0,style:{width:"30px",height:"30px"},src:_e,alt:"Visualizar",title:"Reativar"},$e={key:1,src:fe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},he={__name:"Lançamentos",setup(H){const d=te(),{$toast:i}=K(),m=`${d.public.managemant}/lista_lanctos_caixa`,_=`${d.public.managemant}/caixasLanctos`;x("caixa-service").value.usuario_nome,x("caixa-service").value.data;const P=l([]),b=l(""),g=l(""),w=l(""),$=l(""),h=l({});l(null);const U=l("O encerramento de OS não poderá ser revertido. Confirma o encerramento?");l(!1);const A=l(!1),O=()=>{j("/caixas/lista")},S=[{title:"Forma recebimento",value:"forma_receb"},{title:"Valor",value:"valor"},{title:"Descrição",value:"descricao"},{title:"O.S",value:"ordemserv_numero"},{title:"Apresentatante",value:"apresentante_nome"},{title:"Usuário",value:"usuario_nome"},{title:"Ações",value:"actions"}],I=l("");async function k(){try{const r=await $fetch(m,{method:"POST",body:{caixa_token:x("caixa-service").value.caixa_token}});r&&Array.isArray(r)?P.value=r:i.error("Erro ao buscar dados da API."),console.log("data",r)}catch(r){const s=r.message||"Erro ao buscar dados da API. Tente novamente.";i.error(s)}}async function C(r){try{r.excluido=!r.excluido;const{data:s,error:p}=await re(`${_}/${r.id}`,{method:"PUT",body:{excluido:r.excluido},headers:{"Content-Type":"application/json"}},"$LFu4iQCu2T");if(p.value)throw p.value;i.success("Lançamento excluído com sucesso!"),await k()}catch(s){console.error("Erro ao excluir lançamento:",s),i.error("Erro ao excluir lançamento")}}async function D(r){try{await $fetch(`${_}/${r}`,{method:"PUT",body:{excluido:!0}})?(i.success("Lançamento do caixa encerrada com sucesso!"),A.value=!1,k()):i.error("Erro ao encerrar o Lançamento do caixa. Tente novamente.")}catch(s){const p=s.message||"Erro ao buscar dados da API. Tente novamente.";i.error(p)}}X(()=>{k()});const q=ee(()=>P.value.filter(r=>{const s=r.numero?r.numero.toString().toLowerCase():"",p=r.apresentante_nome?r.apresentante_nome.toLowerCase():"",T=r.situacao?r.situacao.toUpperCase():"",o=r.descricao?r.descricao.toLowerCase():"",e=r.forma_receb?r.forma_receb.toLowerCase():"",c=s.includes(w.value.toLowerCase()),f=p.includes($.value.toLowerCase()),L=I.value?T===I.value:!0,E=o.includes(b.value.toLowerCase()),n=e.includes(g.value.toLowerCase());return c&&f&&L&&E&&n})),W=()=>{j("/caixas/cadastro")};return(r,s)=>{const p=pe,T=J,o=N("v-cols"),e=N("v-rows");return M(),F(oe,null,[a(G,{class:"mt-5"},{default:t(()=>[a(y,{class:"mb-5"},{default:t(()=>[s[4]||(s[4]=v("h1",null," Lançamentos do caixa ",-1)),a(p,{to:"/caixas/cadastro"},{default:t(()=>[v("img",{style:{width:"60px",height:"60px",cursor:"pointer","margin-left":"70px"},src:ve,alt:"novo",onClick:W})]),_:1})]),_:1}),a(y,null,{default:t(()=>[a(R,{cols:"3"},{default:t(()=>[a(B,{modelValue:u(b),"onUpdate:modelValue":s[0]||(s[0]=c=>V(b)?b.value=c:null),label:"Descrição"},null,8,["modelValue"])]),_:1}),a(R,{cols:"3"},{default:t(()=>[a(B,{modelValue:u(g),"onUpdate:modelValue":s[1]||(s[1]=c=>V(g)?g.value=c:null),label:"Forma de Recebimento"},null,8,["modelValue"])]),_:1})]),_:1}),s[5]||(s[5]=v("hr",{class:"mt-5 mb-5"},null,-1)),a(se,{headers:S,items:u(q),"item-key":"id"},{"item.actions":t(({item:c})=>[a(y,{style:{display:"flex",gap:"4px","margin-top":"-5px"}},{default:t(()=>[v("div",{style:{cursor:"pointer"},onClick:f=>C(c),title:"Cancelamento"},[c.excluido?(M(),F("img",we)):(M(),F("img",$e))],8,Ve)]),_:2},1024)]),_:1},8,["items"]),a(T,{onConfirm:s[2]||(s[2]=c=>D(u(h))),condMessage:u(U),show:u(A),onClose:s[3]||(s[3]=c=>A.value=!1)},null,8,["condMessage","show"])]),_:1}),a(e,null,{default:t(()=>[a(o,null,{default:t(()=>[a(ae,{class:"ml-8",size:"large",onClick:O,color:"red"},{default:t(()=>s[6]||(s[6]=[z("Voltar ")])),_:1})]),_:1})]),_:1})],64)}}},Qe={__name:"index",setup(H){const d=l("ordens");return x("caixa-service").value.data,x("caixa-service").value.usuario_nome,(i,m)=>(M(),de(G,{class:"mt-5"},{default:t(()=>[a(xe,{modelValue:u(d),"onUpdate:modelValue":m[0]||(m[0]=_=>V(d)?d.value=_:null)},{default:t(()=>[a(Y,{value:"ordens"},{default:t(()=>m[2]||(m[2]=[z("Ordens de Serviço")])),_:1}),a(Y,{value:"lancamentos"},{default:t(()=>m[3]||(m[3]=[z("Lançamentos")])),_:1})]),_:1},8,["modelValue"]),a(be,{modelValue:u(d),"onUpdate:modelValue":m[1]||(m[1]=_=>V(d)?d.value=_:null)},{default:t(()=>[a(Z,{value:"ordens"},{default:t(()=>[a(ye)]),_:1}),a(Z,{value:"lancamentos"},{default:t(()=>[a(he)]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Qe as default};
