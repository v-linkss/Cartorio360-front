import{_ as he}from"./PkdZMHSI.js";import{u as de,C as me,J as pe,r as s,f as be,o as d,j as N,w as t,b as a,i as e,V as ye,v as te,d as X,k as R,l as ve,e as K,y as Ue,s as ge,a as A,c as j,M as Fe,g as Ie,N as Ne,F as Pe,H as Be,O as qe,t as fe}from"./BkvpCUKT.js";import{u as _}from"./B9wrWlxw.js";import{V as U}from"./CN02Inq4.js";import{V as L}from"./tL_dU8xg.js";import{V as ke}from"./CekT6yPb.js";import{V as xe}from"./Cn7ZiGJA.js";import{_ as Le,a as Ge,b as He,c as Je}from"./Bpjq0ic9.js";import{_ as Ke,a as We,b as Xe,T as Ye,W as Qe,S as Ze,D as Oe,c as ea,d as aa}from"./CfB34emo.js";import{_ as ta,r as Me}from"./BqB8_RUq.js";import{_ as $e}from"./DD_s6tIt.js";import{_ as ze}from"./BVz1G1IN.js";import{_ as oa}from"./BmX1Cj0d.js";import{_ as sa}from"./MJoG-67g.js";import{_ as Ce,a as Ee}from"./DJvq3mCv.js";import{V as Ve}from"./BFF_Sdr7.js";import{_ as Te}from"./CQmua4bw.js";import{V as ra}from"./D4OLfovi.js";import{c as De,r as Se,u as je}from"./D6vszR0f.js";import{f as Ae}from"./B0IxRygJ.js";import{_ as na}from"./-zgYk4Vu.js";const Qa={__name:"Dados",props:{item_dados:{type:Array,required:!0},item_situacoes:{type:Array,required:!0}},setup(ie){const v=ie,{$toast:E}=de(),b=ve(),i=me(),p=pe(),k=`${b.public.managemant}/updateAtos`,V=s(v.item_situacoes),ee=s(p.query.origem==="vizualizar"),M=be({dt_abertura:v.item_dados[0].dt_abertura||null,status:v.item_dados[0].status||null,mne:v.item_dados[0].mne||null});async function Z(){const{data:T,error:h,status:q}=await _(`${k}/${p.query.ato_id}`,{method:"PUT",body:{status:M.status,mne:M.mne,dt_abertura:M.dt_abertura}},"$EIT5jtTUdX");q.value==="success"&&E.success("Ato Atualizado com sucesso")}const z=()=>{const T=p.query.origem||"criar",h=p.query.id;switch(T){case"atualizar":case"vizualizar":i.push(`/os/atualizar/${h}`);break;case"atualizar-lista":case"vizualizar-lista":i.push("/atos/lista");break;default:i.push("/os/criar-registro");break}};return(T,h)=>{const q=he;return d(),N(xe,null,{default:t(()=>[a(U,{class:"mt-5"},{default:t(()=>[a(L,{cols:"3"},{default:t(()=>[a(ke,{label:"Situação",modelValue:e(M).status,"onUpdate:modelValue":h[0]||(h[0]=f=>e(M).status=f),items:e(V),"item-title":"descricao","item-value":"descricao",required:""},null,8,["modelValue","items"])]),_:1})]),_:1}),a(U,null,{default:t(()=>[a(L,{cols:"5"},{default:t(()=>[a(ye,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:e(M).mne,"onUpdate:modelValue":h[1]||(h[1]=f=>e(M).mne=f)},null,8,["modelValue"])]),_:1})]),_:1}),a(U,null,{default:t(()=>[a(L,{cols:"2"},{default:t(()=>[a(ye,{modelValue:e(M).dt_abertura,"onUpdate:modelValue":h[2]||(h[2]=f=>e(M).dt_abertura=f),type:"date",label:"Data Lavratura",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),a(U,{class:"mb-3"},{default:t(()=>[a(q,{onClick:z},{default:t(()=>[a(te,{size:"large",color:"red"},{default:t(()=>h[3]||(h[3]=[X("Voltar")])),_:1})]),_:1}),e(ee)?R("",!0):(d(),N(te,{key:0,class:"ml-10",onClick:Z,size:"large",color:"green"},{default:t(()=>h[4]||(h[4]=[X("Atualizar")])),_:1}))]),_:1})]),_:1})}}},la={key:0},ia=["onClick"],ca={key:0,style:{width:"30px",height:"30px"},src:$e,alt:"Visualizar"},ua={key:1,style:{width:"30px",height:"30px"},src:oa,alt:"Visualizar"},da=["onClick"],ma=["onClick"],pa={key:0,style:{width:"30px",height:"30px"},src:Ce,alt:"Visualizar",title:"Reativar"},va={key:1,src:Ee,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},_a=["onClick"],Za={__name:"Partes",async setup(ie){let v,E;const b=me(),i=pe(),p=ve(),{$toast:k}=de(),V=`${p.public.managemant}/pesquisarPessoas`,ee=`${p.public.managemant}/listarPapeis`,M=`${p.public.managemant}/createAtosPessoa`,Z=`${p.public.managemant}/updateAtosPessoa`,z=`${p.public.managemant}/getAtosPessoaById`,T=`${p.public.managemant}/download`,h=s(K("user-data").value.cartorio_token),q=s(i.query.origem==="vizualizar"),f=s([]),G=s({}),x=s([]),W=s([]),P=s(!1),F=s(!1),D=s(!1),ae=s(!1),Y=s(null),Q=s(null),g=s(null),$=s(null),l=s(null),r=s(i.query.tipo_ato_token),c=s(null),O=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"320px"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome",width:"320px"},{value:"actions"}],u=be({papeis:null,nome:null,pessoa:null,documento:null});Ue(()=>{var m;return((m=u.pessoa)==null?void 0:m.link_ficha)||!1});const{data:I}=([v,E]=ge(()=>_(ee,{method:"POST",body:{tipo_ato_token:i.query.tipo_ato_token}},"$acoiTIUp00")),v=await v,E(),v);W.value=I.value;const o=async()=>{const{data:m}=await _(`${z}/${i.query.ato_id}`,{method:"GET"},"$ypnU9hCpVn"),J=(_e=>_e.map(le=>({...le,pessoa:{...le.pessoa,documento:le.pessoa.doc_identificacao},papel:{...le.partes_tipos}})))(m.value);x.value=J};o();async function y(){try{const{data:m,error:n}=await _(V,{method:"POST",body:{cartorio_token:h.value,documento:u.documento,nome:u.nome}},"$pr30MyPXfY");m.value.length>0?(f.value=m.value,u.pessoa=f.value[0]):f.value=[]}catch(m){console.error("Erro na requisição",m)}}const H=()=>{F.value=!0},B=async()=>{await o()},w=async()=>{await o()},C=async()=>{const m={pessoa:u.pessoa,papel:W.value.find(ce=>ce.id===u.papeis),representante:{nome:null}},n=await _(`${z}/${i.query.ato_id}`,{method:"GET"},"$scHdIvxj2D");for(const ce of n.data.value)if(ce.pessoa_id===u.pessoa.id&&ce.ato_id===Number(i.query.ato_id)&&ce.tipo_parte_id===u.papeis){k.error("Pessoa Já Registrada Com Esse Papel!");return}const{data:J,error:_e,status:le}=await _(M,{method:"POST",body:{ato_id:Number(i.query.ato_id),pessoa_id:u.pessoa.id,tipo_parte_id:u.papeis,user_id:K("user-data").value.usuario_id}},"$18isAgOJxG");le.value==="success"?(m.id=J.value.id,k.success("Pessoa Registrada com Sucesso!"),x.value.push(m)):k.error(_e.value.message)},oe=async m=>{D.value=!0;const{data:n}=await _(T,{method:"POST",body:{bucket:K("user-data").value.cartorio_token,path:m.pessoa.link_ficha}},"$hmDzSF3F61");c.value=n.value,G.value=m.pessoa},re=m=>{const n=x.value.filter(J=>J.pessoa.id!==m.pessoa.id&&!J.excluido).map(J=>({id:J.pessoa.id,nome:J.pessoa.nome}));g.value=m.id,Y.value=n,P.value=!0,Q.value=m.pessoa.nome,l.value=m.pessoa.id},ue=m=>{ae.value=!0,$.value=m.id,Q.value=m.pessoa.nome};async function se(m){m.excluido=!m.excluido;try{await _(`${Z}/${m.id}`,{method:"PUT",body:JSON.stringify({excluido:m.excluido})},"$l09I6nLRfk")}catch(n){console.error("Erro ao excluir pessoa:",n)}}const ne=()=>{const m=i.query.origem||"criar",n=i.query.id;switch(m){case"atualizar":case"vizualizar":b.push(`/os/atualizar/${n}`);break;case"atualizar-lista":case"vizualizar-lista":b.push("/atos/lista");break;default:b.push("/os/criar-registro");break}};return(m,n)=>{const J=Le,_e=We,le=Xe,ce=ta,Re=he;return d(),N(xe,null,{default:t(()=>[e(q)?R("",!0):(d(),N(U,{key:0,class:"mt-5"},{default:t(()=>[a(L,{cols:"3"},{default:t(()=>[a(ye,{label:"Documento",modelValue:e(u).documento,"onUpdate:modelValue":n[0]||(n[0]=S=>e(u).documento=S)},null,8,["modelValue"])]),_:1}),a(L,{cols:"4"},{default:t(()=>[a(ye,{label:"Pessoa",modelValue:e(u).nome,"onUpdate:modelValue":n[1]||(n[1]=S=>e(u).nome=S)},null,8,["modelValue"])]),_:1}),A("div",null,[A("img",{class:"mt-1",src:$e,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:y})]),A("div",null,[A("img",{class:"mt-1 ml-2",src:ze,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:H})])]),_:1})),e(q)?R("",!0):(d(),N(U,{key:1},{default:t(()=>[a(L,{cols:"4"},{default:t(()=>[a(ke,{label:"Selecione a Pessoa",modelValue:e(u).pessoa,"onUpdate:modelValue":n[2]||(n[2]=S=>e(u).pessoa=S),items:e(f),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),a(L,{cols:"3"},{default:t(()=>[a(ke,{label:"Papel",modelValue:e(u).papeis,"onUpdate:modelValue":n[3]||(n[3]=S=>e(u).papeis=S),items:e(W),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),e(q)?R("",!0):(d(),j("div",la,[A("img",{class:"mt-1",src:ze,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:C})]))]),_:1})),a(U,null,{default:t(()=>[a(L,null,{default:t(()=>[a(Ve,{style:{height:"465px"},headers:O,items:e(x)},{"item.actions":t(({item:S})=>[e(q)?R("",!0):(d(),N(U,{key:0},{default:t(()=>[A("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-1",onClick:we=>oe(S),title:"Visualizar Ficha"},[S.pessoa.link_ficha?(d(),j("img",ca)):(d(),j("img",ua))],8,ia),A("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:we=>ue(S),class:"mr-1",title:"Alterar Papel"},n[8]||(n[8]=[A("img",{style:{width:"30px",height:"30px"},src:sa,alt:"Visualizar"},null,-1)]),8,da),A("div",{class:"mr-1",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:we=>se(S),title:"Deletar Pessoa"},[S.excluido?(d(),j("img",pa)):(d(),j("img",va))],8,ma),A("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-1",onClick:we=>re(S),title:"Selecionar Representante"},n[9]||(n[9]=[A("img",{style:{width:"30px",height:"30px"},src:Ke,alt:"Visualizar"},null,-1)]),8,_a)]),_:2},1024))]),_:1},8,["items"])]),_:1})]),_:1}),a(J,{show:e(F),onClose:n[4]||(n[4]=S=>F.value=!1)},null,8,["show"]),a(_e,{representante_nome:e(Q),representantes:e(Y),ato_id:e(g),show:e(P),onClose:n[5]||(n[5]=S=>P.value=!1),onUpdateRepresentante:w},null,8,["representante_nome","representantes","ato_id","show"]),a(le,{representante_nome:e(Q),ato_token:e(r),ato_id:e($),show:e(ae),onClose:n[6]||(n[6]=S=>ae.value=!1),onUpdatePapel:B},null,8,["representante_nome","ato_token","ato_id","show"]),e(D)?(d(),N(ce,{key:2,show:e(D),"link-view":e(c),"pessoa-obj":e(G),"is-view":!0,onClose:n[7]||(n[7]=S=>D.value=!1)},null,8,["show","link-view","pessoa-obj"])):R("",!0),a(U,null,{default:t(()=>[a(Re,{onClick:ne},{default:t(()=>[a(te,{size:"large",color:"red"},{default:t(()=>n[10]||(n[10]=[X("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},fa={key:0,class:"loading-overlay"},ya="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",et={__name:"Minuta",emits:["page","doc"],setup(ie,{emit:v}){Fe("DocumentEditorContainer",[Ye,Qe,Ze]);const E=ve(),{$toast:b}=de(),i=me(),p=pe(),k=v;Me(`${E.public.docEditor}`);const V=`${E.public.managemant}/download`,ee=`${E.public.managemant}/atos/files`,M=`${E.public.managemant}/subitituirModelo`,Z=`${E.public.managemant}/upload`,z=s(null),T=s(!1),h=s("Ao executar a geração, a minuta atual será substituída e não poderá ser recuperada.Confirma ?"),q=s(p.query.origem==="vizualizar"),f=s(!1),G=async l=>{try{const r=await fetch(l);if(!r.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await r.blob()}catch(r){return console.error(r),null}},x=async()=>{try{const{data:l}=await _(`${ee}/${p.query.ato_token_edit}`,{method:"GET"},"$5jxI4TvFse");return l.value.link_ato}catch(l){console.error("Erro ao carregar o documento:",l),b.error(l)}},W=async()=>{f.value=!0;try{const l=await x(),{data:r,status:c}=await _(V,{method:"POST",body:{bucket:K("user-data").value.cartorio_token,path:l}},"$dvNFfvmIJC"),O=r.value,u=await G(O);if(u){const I=new FileReader;I.onload=()=>{const o=I.result;z.value.ej2Instances.documentEditor.open(o),k("doc",o)},I.readAsText(u)}}catch{console.error("Erro ao carregar o documento.")}finally{f.value=!1}},P=async()=>{const r=await z.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),c=new FileReader;c.onload=()=>{const O=c.result,I=z.value.ej2Instances.documentEditor.pageCount;k("page",I),k("doc",O)},c.readAsText(r)},F=async()=>{f.value=!0;try{const r=await z.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),c=new FormData;c.append("file",r,"anexo.sfdt"),c.append("cartorio_token",K("user-data").value.cartorio_token),c.append("token",p.query.ato_token_edit),c.append("tipo","ato_minuta");const{data:O,status:u}=await _(Z,{method:"POST",body:c},"$xv11VtUdMy");if(u.value==="success"){b.success("Documento enviado!");const o=z.value.ej2Instances.documentEditor.pageCount;P(),k("page",o)}else b.error("Erro ao enviar documento para o sistema.")}catch(l){b.error("Erro ao salvar documento."),console.error(l)}finally{f.value=!1}},D=()=>{T.value=!1,ae()},ae=async()=>{g(!0);try{await Y(),g(!0);const{data:l,status:r}=await _(M,{method:"POST",body:{ato_token:p.query.ato_token_edit}},"$zyzWHTXTBW");l.value&&Q(l.value)}catch(l){console.error("Erro ao gerar a minuta:",l),b.error("Ocorreu um erro ao gerar a minuta.")}finally{g(!1)}},Y=async()=>{try{const{data:l}=await _(V,{method:"POST",body:{bucket:K("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$KreLE0Ys81"),r=await G(l.value);if(r){const c=new FileReader;c.onload=()=>{const O=c.result;z.value.ej2Instances.documentEditor.open(O),k("doc",O)},c.readAsText(r)}}catch(l){console.error("Erro ao carregar o modelo de minuta:",l)}},Q=l=>{const r=z.value.ej2Instances.documentEditor,c=O=>{for(const[u,I]of Object.entries(O))if(/^<<.+>>$/.test(u))try{r.search.findAll(u),r.search.searchResults.length>0&&r.search.searchResults.replaceAll(I)}catch(o){console.error(`Erro ao substituir o marcador ${u}:`,o)}else if(u==="partes"&&Array.isArray(I)&&I.length>0)for(const o of I)typeof o=="object"&&c(o)};c(l)},g=l=>{f.value=l},$=()=>{const l=p.query.origem||"criar",r=p.query.id;switch(l){case"atualizar":case"vizualizar":i.push(`/os/atualizar/${r}`);break;case"atualizar-lista":case"vizualizar-lista":i.push("/atos/lista");break;default:i.push("/os/criar-registro");break}};return Ie(async()=>{await W(),P()}),(l,r)=>{const c=he,O=Te;return d(),j(Pe,null,[a(e(Oe),{height:"900px",ref_key:"documentEditorContainer",ref:z,serviceUrl:ya,enableToolbar:!0,enableWordExport:!0},null,512),e(f)?(d(),j("div",fa,[a(Ne,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):R("",!0),a(U,{class:"ml-4 mt-4 mb-4"},{default:t(()=>[a(c,{class:"mr-4"},{default:t(()=>[a(te,{size:"large",onClick:$,color:"red"},{default:t(()=>r[2]||(r[2]=[X("Voltar")])),_:1})]),_:1}),e(q)?R("",!0):(d(),N(te,{key:0,size:"large",color:"green",onClick:F,disabled:e(f)},{default:t(()=>r[3]||(r[3]=[X("Atualizar")])),_:1},8,["disabled"])),e(q)?R("",!0):(d(),N(te,{key:1,class:"ml-4",size:"large",color:"blue",onClick:r[0]||(r[0]=u=>T.value=!0)},{default:t(()=>r[4]||(r[4]=[X("Gerar Minuta")])),_:1}))]),_:1}),a(O,{onConfirm:D,condMessage:e(h),show:e(T),onClose:r[1]||(r[1]=u=>T.value=!1)},null,8,["condMessage","show"])],64)}}},ga=["innerHTML"],at={__name:"Livro",props:{pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(ie){let v,E;const b=ie,i=ve();Me(`${i.public.docEditor}`);const{$toast:p}=de(),k=me(),V=pe(),ee=`${i.public.managemant}/download`,M=`${i.public.managemant}/atos/files`,Z=`${i.public.managemant}/lavrarAto`,z=`${i.public.managemant}/valida_lavratura`,T=`${i.public.managemant}/listarEscrevente`,h=`${i.public.managemant}/ato_calcular`,q=s(K("user-data").value.cartorio_token),f=K("auth_token").value,G=s("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),x=s(null),W=s(""),P=s(!1),F=s(null),D=s(null),ae=s(V.query.origem==="vizualizar"),Y=s(null),Q=s([]),g=s({}),$=be({escrevente:null}),l=async w=>{try{const C=await fetch(w);if(!C.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await C.blob()}catch(C){return console.error(C),null}},r=async()=>{try{const{data:w}=await _(`${M}/${V.query.ato_token_edit}`,{method:"GET"},"$FnEbAJEARP");return w.value.link_ato}catch(w){console.error("Erro ao carregar o documento:",w),p.error(w)}},c=async()=>{try{const w=await r(),{data:C,status:oe}=await _(ee,{method:"POST",body:{bucket:K("user-data").value.cartorio_token,path:w}},"$7ljqltMqa0"),re=C.value,ue=await l(re);if(ue){const se=new FileReader;se.onload=()=>{const ne=se.result;Y.value.ej2Instances.documentEditor.open(ne)},se.readAsText(ue)}}catch{p.error("Erro ao carregar o documento.")}};c();const O=async(w=!1)=>{const C=Y.value.ej2Instances.documentEditor.pageCount;if(!w){const{data:se,error:ne,status:m}=await _(z,{method:"POST",body:{ato_token:V.query.ato_token_edit}},"$OWxZSQkyX8");let n,J;if(m.value==="success"&&se.value?(n=se.value[0].status,J=se.value[0].status_mensagem):ne.value&&ne.value.data&&(n=ne.value.data[0].status,J=ne.value.data[0].status_mensagem),n!=="OK"){x.value=n,W.value=J,g.value=null,P.value=!0,G.value=" O ato apresenta inconsistências, deseja prosseguir?";return}}const{data:oe,status:re,error:ue}=await _(Z,{method:"POST",body:{ato_token:V.query.ato_token_edit,qtd_paginas:C,escrevente_token:$.escrevente,usuario_token:f,cartorio_token:q}},"$sMqfUUQcBM");re.value==="success"?(F.value=oe.value,D.value=oe.value[0].selo,p.success("Ato lavrado com sucesso!")):p.error(ue.value.data[0].status_mensagem||"Falha ao lavrar o ato.")},u=()=>{P.value=!1,x.value=null,W.value="",g.value={}},I=async()=>{const w=Y.value.ej2Instances.documentEditor.pageCount,{data:C,status:oe}=await _(h,{method:"POST",body:{ato_token:V.query.ato_token_edit,cartorio_token:q,quantidade:1,usuario_token:f,escrevente_token:$.escrevente,qtd_paginas:w}},"$OVwiKSwcOE");oe.value==="success"?g.value=C.value[0]:p.error("Falha ao calcular o ato.")},o=async()=>{P.value=!1,x.value&&x.value!=="OK"?(await O(!0),x.value=null,W.value=""):await O()},y=async()=>{P.value=!0,G.value="Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?",await I()},{data:H}=([v,E]=ge(()=>_(T,{method:"POST",body:{cartorio_token:q}},"$iv1N3XD6We")),v=await v,E(),v);Q.value=H.value[0].func_json_escreventes;const B=()=>{const w=V.query.origem||"criar",C=V.query.id;switch(w){case"atualizar":case"vizualizar":k.push(`/os/atualizar/${C}`);break;case"atualizar-lista":case"vizualizar-lista":k.push("/atos/lista");break;default:k.push("/os/criar-registro");break}};return Be(()=>b.document,(w,C)=>{c()}),(w,C)=>{const oe=Te;return d(),j(Pe,null,[a(U,null,{default:t(()=>[a(L,null,{default:t(()=>[a(e(Oe),{restrictEditing:!0,enableToolbar:!1,ref_key:"documentEditorContainer",ref:Y,height:"850px",width:"850px"},null,512)]),_:1}),e(ae)?R("",!0):(d(),N(L,{key:0},{default:t(()=>[a(ke,{class:"mt-15",label:"Tabelião/escrevente",modelValue:e($).escrevente,"onUpdate:modelValue":C[0]||(C[0]=re=>e($).escrevente=re),items:e(Q),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),A("img",{onClick:C[1]||(C[1]=re=>y()),style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:ea}),e(F)?(d(),N(ra,{key:0,width:"360"},{default:t(()=>[a(U,null,{default:t(()=>[a(L,null,{default:t(()=>[a(qe,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:t(()=>[a(L,null,{default:t(()=>[X(" Livro: "+fe(e(F)[0].livro_numero),1)]),_:1}),a(L,null,{default:t(()=>[X(" Protocolo: "+fe(e(F)[0].protocolo?e(F)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),a(L,null,{default:t(()=>[a(qe,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:t(()=>[X(" Folhas : "+fe(e(F)[0].pagina_inicial)+" A "+fe(e(F)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),A("div",{style:{"margin-left":"10px","padding-bottom":"20px","margin-top":"-10px"},innerHTML:e(D)},null,8,ga)]),_:1})):R("",!0)]),_:1}))]),_:1}),a(te,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:B},{default:t(()=>C[2]||(C[2]=[X("Voltar")])),_:1}),a(oe,{show:e(P),condMessage:e(G),description:e(W),valor:e(g),onClose:u,onConfirm:o},null,8,["show","condMessage","description","valor"])],64)}}},ha=["onClick"],ba=["onClick"],ka={key:0,style:{width:"30px",height:"30px"},src:Ce,alt:"Visualizar",title:"Reativar"},xa={key:1,src:Ee,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},tt={__name:"Observacao",props:{ato_id:{type:Number,required:!0}},async setup(ie){let v,E;const b=me(),i=pe(),p=ve();de();const k=`${p.public.managemant}/listarEscrevente`,V=`${p.public.managemant}/atos_observacao`,ee=`${p.public.managemant}/atos_observacao`,M=s(K("user-data").value.cartorio_token),Z=s(i.query.origem==="vizualizar"),z=s(!1),T=s(!1),h=s(""),q=s([]),f=s([]);function G(g){h.value=g.observacao,T.value=!0,z.value=!0}const x=()=>{T.value=!1,z.value=!0,h.value=""},W=[{title:"Data",align:"start",key:"created"},{title:"Escrevente",align:"start",key:"users.nome"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}],P=be({observacao:""}),F={observacao:{required:De.withMessage("O campo é obrigatório",Se)}};je(F,P);const{data:D}=([v,E]=ge(()=>_(`${ee}/${i.query.ato_id}`,{method:"GET"},"$HyzoO40swN")),v=await v,E(),v);Array.isArray(D.value)?q.value=D.value.map(g=>({...g,created:Ae(g.created,"dd/mm/yyyy hh:mm")})):D.value&&typeof D.value=="object"&&(q.value=[{...D.value,created:Ae(D.value.created,"dd/mm/yyyy hh:mm")}]);async function ae(g){g.excluido=!g.excluido;try{await _(`${V}/${g.id}`,{method:"PUT",body:JSON.stringify({excluido:g.excluido})},"$gnHMo4uCXD")}catch($){console.error("Erro ao excluir observação:",$)}}const{data:Y}=([v,E]=ge(()=>_(k,{method:"POST",body:{cartorio_token:M}},"$sP9AKdd3Ky")),v=await v,E(),v);f.value=Y.value[0].func_json_escreventes;const Q=()=>{const g=i.query.origem||"criar",$=i.query.id;switch(g){case"atualizar":case"vizualizar":b.push(`/os/atualizar/${$}`);break;case"atualizar-lista":case"vizualizar-lista":b.push("/atos/lista");break;default:b.push("/os/criar-registro");break}};return(g,$)=>{const l=aa,r=he;return d(),N(xe,null,{default:t(()=>[Z.value?R("",!0):(d(),N(U,{key:0,class:"mt-5"},{default:t(()=>[Z.value?R("",!0):(d(),N(te,{key:0,class:"mb-4 ml-8",onClick:x,size:"large",color:"green"},{default:t(()=>$[1]||($[1]=[X("Novo")])),_:1}))]),_:1})),a(U,null,{default:t(()=>[a(L,null,{default:t(()=>[a(Ve,{style:{height:"465px"},headers:W,items:q.value},{"item.observacao":t(({item:c})=>[X(fe(c.observacao.length>100?c.observacao.slice(0,100)+"...":c.observacao),1)]),"item.actions":t(({item:c})=>[a(U,null,{default:t(()=>[A("div",{onClick:O=>G(c)},$[2]||($[2]=[A("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:$e,alt:"Visualizar"},null,-1)]),8,ha),A("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end","margin-left":"5px"},onClick:O=>ae(c),title:"Deletar Observação"},[c.excluido?(d(),j("img",ka)):(d(),j("img",xa))],8,ba)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),z.value?(d(),N(l,{key:1,show:z.value,observacao:h.value,visualizar:T.value,onClose:$[0]||($[0]=c=>z.value=!1)},null,8,["show","observacao","visualizar"])):R("",!0),a(U,null,{default:t(()=>[a(r,{onClick:Q},{default:t(()=>[a(te,{size:"large",color:"red"},{default:t(()=>$[3]||($[3]=[X("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},$a={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:He,alt:"Criar"},wa={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Je,alt:"Criar"},za={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:na,alt:"Criar"},Ca=["onClick"],Ea=["onClick"],Va=["onClick"],qa={key:0,style:{width:"30px",height:"30px"},src:Ce,alt:"Visualizar",title:"Reativar"},Aa={key:1,src:Ee,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},ot={__name:"Anexos",async setup(ie){let v,E;const b=ve(),{$toast:i}=de(),p=me(),k=pe(),V=s(k.query.origem==="vizualizar"),ee=`${b.public.biometria}/run-scanner`,M=`${b.public.managemant}/atos_anexos`,Z=`${b.public.managemant}/atos_anexos`,z=`${b.public.managemant}/download`,T=`${b.public.managemant}/atos_anexos`,h=`${b.public.managemant}/upload`,q=s(!1),f=s(null),G=s([]);K("pessoa_token");const x=be({descricao:"",fileEvent:null}),W={descricao:{required:De.withMessage("O campo é obrigatório",Se)}},P=je(W,x,{$autoDirty:!0}),F=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}],{data:D}=([v,E]=ge(()=>_(`${T}/${k.query.ato_id}`,{method:"GET"},"$AOZpbz65MA")),v=await v,E(),v);G.value=D.value;async function ae(){try{await Y(),await Q()}catch(o){console.error("Erro ao executar scanner ou listar arquivos:",o)}}async function Y(){try{const{data:o}=await _(ee,{method:"GET"},"$KttjFhHivJ")}catch(o){i.error("Erro ao acionar o scanner:",o)}}async function Q(){try{const{data:o,status:y}=await _("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:k.query.ato_token_edit,cartorio_token:K("user-data").value.cartorio_token}},"$TqQrsgxUkd")}catch(o){console.error("Erro ao enviar o arquivo:",o)}}async function g(){try{const o=document.createElement("input");o.type="file",o.accept="*/*",o.onchange=async y=>{x.fileEvent=y,y.target.files[0]&&(f.value=!0)},o.click()}catch(o){console.error("Erro ao abrir o explorador de arquivos:",o)}}const $=async()=>{q.value=!0};function l(o){return o?!0:(f.value=!1,!1)}const r=async o=>{if(!x.fileEvent||!x.fileEvent.target.files.length){i.error("Nenhum arquivo selecionado.");return}const y=x.fileEvent.target.files[0],H=new FormData;H.append("file",y),H.append("cartorio_token",K("user-data").value.cartorio_token),H.append("token",o),H.append("tipo","ato_anexo");try{const B=await _(h,{method:"POST",body:H},"$KDhIYzGKzM");i.success("Anexo registrado com sucesso!")}catch{i.error("Erro ao enviar o arquivo.")}},c=async()=>{if(P.value.$touch(),!P.value.$invalid&&l(x.fileEvent)){const{data:o,error:y,status:H}=await _(M,{method:"POST",body:{ato_id:k.query.ato_id,descricao:x.descricao,user_id:K("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$cdoFBGO0Ti");H.value==="success"&&(i.success("Anexo registrado com sucesso!"),G.value.push(o.value),r(o.value.token))}};async function O(o){o.excluido=!o.excluido;try{await _(`${Z}/${o.id}`,{method:"PUT",body:JSON.stringify({excluido:o.excluido})},"$WLSrgYRoHq")}catch(y){console.error("Erro ao excluir pessoa:",y)}}async function u(o){try{const y=await _(`${z}`,{method:"POST",body:{bucket:K("user-data").value.cartorio_token,path:o.link}},"$NdgRjioizH"),B=await(await fetch(y.data.value)).blob(),w=URL.createObjectURL(B);window.open(w,"_blank")}catch(y){console.error("Erro ao excluir pessoa:",y)}}const I=()=>{const o=k.query.origem||"criar",y=k.query.id;switch(o){case"atualizar":case"vizualizar":p.push(`/os/atualizar/${y}`);break;case"atualizar-lista":case"vizualizar-lista":p.push("/atos/lista");break;default:p.push("/os/criar-registro");break}};return(o,y)=>{const H=he;return d(),N(xe,null,{default:t(()=>[a(U,null,{default:t(()=>[a(L,{cols:"5",class:"mt-2"},{default:t(()=>[e(V)?R("",!0):(d(),N(ye,{key:0,modelValue:e(x).descricao,"onUpdate:modelValue":[y[0]||(y[0]=B=>e(x).descricao=B),e(P).descricao.$touch],"error-messages":e(P).descricao.$errors.map(B=>B.$message),onBlur:e(P).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"]))]),_:1}),e(V)?R("",!0):(d(),j("div",{key:0,onClick:ae,title:"Escanear"},y[1]||(y[1]=[A("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ge,alt:"Escanear"},null,-1)]))),e(V)?R("",!0):(d(),j("div",{key:1,onClick:g,title:"Criar"},[e(f)===!1?(d(),j("img",$a)):e(f)===!0?(d(),j("img",wa)):(d(),j("img",za))])),e(V)?R("",!0):(d(),j("div",{key:2,onClick:c,title:"Criar"},y[2]||(y[2]=[A("img",{class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:ze,alt:"Criar"},null,-1)])))]),_:1}),a(Ve,{headers:F,items:e(G),style:{height:"465px","max-width":"600px"}},{"item.actions":t(({item:B})=>[a(U,null,{default:t(()=>[A("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:w=>$(B),title:"Visualizar Anexo"},[A("img",{style:{width:"30px",height:"30px"},onClick:w=>u(B),src:$e,alt:"Visualizar"},null,8,Ea)],8,Ca),A("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:w=>O(B),title:"Deletar Pessoa"},[B.excluido?(d(),j("img",qa)):(d(),j("img",Aa))],8,Va)]),_:2},1024)]),_:1},8,["items"]),a(H,{onClick:I},{default:t(()=>[a(te,{size:"large",color:"red"},{default:t(()=>y[3]||(y[3]=[X("Voltar")])),_:1})]),_:1})]),_:1})}}};export{Qa as _,Za as a,et as b,at as c,tt as d,ot as e};
