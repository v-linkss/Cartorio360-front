import{_ as me}from"./ViBG4SqG.js";import{_ as de}from"./BypR8L4A.js";import{_ as pe}from"./BRvIf8n8.js";import{_ as ve}from"./G649sGvS.js";import{_ as _e}from"./40_iMjYg.js";import{_ as I}from"./DK2wQyjF.js";import{_ as fe}from"./BVz1G1IN.js";import{_ as ke}from"./BiC0xr9W.js";import{a as he}from"./DJvq3mCv.js";import{D as ye,K as ge,u as Ve,r as i,e as g,f as be,y as we,c as F,b as t,w as r,i as o,h as Pe,p as xe,F as $e,k as qe,o as $,s as T,a as c,V as Ce,d as j}from"./B3qHAfY2.js";import{u as _}from"./AbqtXxaM.js";import{V as q}from"./C-gLg2rw.js";import{V as f}from"./CztrV56-.js";import{V as Se}from"./CP6hhYYs.js";import{V as D}from"./CksH81Bl.js";import"./Bkxv2Vrw.js";import"./lnLrcPWe.js";import"./CVDpgRqx.js";import"./BTdgIE5n.js";import"./B0IxRygJ.js";import"./BRhLhDx8.js";import"./yElaiGuO.js";import"./C4qHYQYW.js";import"./Cl68E8m0.js";import"./DeW-NlDP.js";import"./BWhwLF6L.js";import"./vWFD-yVi.js";import"./BDkFPGjG.js";import"./DspjLGNf.js";import"./BP1X5Ijr.js";import"./BB_xEO0D.js";import"./M6uHpD5D.js";import"./dvwuH5U4.js";const Fe=["onClick"],Te={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:I,alt:"Possui Ficha",title:"Possui Ficha"},Ae={key:1,style:{width:"30px",height:"30px",cursor:"pointer"},src:ke,alt:"Visualizar",title:"Não Possui Ficha"},Me=["onClick"],pt={__name:"semelhanca",props:{ato_token:{type:String,required:!0}},emits:["ato-created"],async setup(U,{emit:K}){var B;let V,A;const L=U,W=K,M=ye(),O=ge(),m=qe(),{$toast:Q}=Ve(),Z=`${m.public.managemant}/listarEscrevente`,G=`${m.public.managemant}/pesquisarPessoas`,H=`${m.public.managemant}/atoReconhecimento`,Y=`${m.public.managemant}/etiquetaReconhecimento`,J=`${m.public.managemant}/download`,X=`${m.public.envioDoc}/print`,b=i(g("user-data").value.cartorio_token),ee=i(g("user-service").value.token).value||i(g("user-service").value).value,te=g("auth_token").value,C=i([]),R=i([]),k=i([]),d=i(!1),S=i(!1),w=i(!1),P=i(null),z=i(null),h=i(""),E=[{title:"Documento",align:"start",key:"documento"},{title:"Pessoa",align:"start",key:"nome"},{value:"actions"}],n=be({quantidade:1,escrevente:null,nome:null,documento:null}),{data:N}=([V,A]=we(()=>_(Z,{method:"POST",body:{cartorio_token:b}},"$iEFsIjdWdW")),V=await V,A(),V);R.value=Array.isArray(N.value)&&((B=N.value[0])==null?void 0:B.func_json_escreventes)||[];async function oe(){try{const{data:a,error:e}=await _(G,{method:"POST",body:{cartorio_token:b.value,documento:n.documento,nome:n.nome}},"$uzKb8LPV3v");a.value.length>0?(C.value=a.value,W("ato-created")):C.value=[]}catch(a){console.error("Erro na requisição",a)}}const ae=()=>{S.value=!0};function se(a){k.value.push(a)}const re=async a=>{P.value=a,w.value=!0;const{data:e}=await _(J,{method:"POST",body:{bucket:g("user-data").value.cartorio_token,path:a.link_ficha}},"$MulQmK1LAp");z.value=e.value};function ne(a){k.value=k.value.filter(e=>e.token!==a.token)}async function le(){var e,p,v,u;if(!n.escrevente){Q.error("Por favor selecione um Escrevente");return}const a=k.value.map(l=>({pessoa_token:l.token}));try{const{data:l,error:y,status:s}=await _(H,{method:"POST",body:{pessoas:a,cartorio_token:b.value,ordemserv_token:ee,quantidade:n.quantidade,usuario_token:te,ato_tipo_token:L.ato_token}},"$fMGlIlw995");s.value==="success"&&Array.isArray(l.value)&&((e=l.value[0])==null?void 0:e.status)==="OK"?(ie(l.value[0].token),x()):(x(),d.value=!0,h.value=Array.isArray(l.value)&&((p=l.value[0])==null?void 0:p.status_mensagem)||((u=(v=y==null?void 0:y.value)==null?void 0:v.data)==null?void 0:u.details)||"Não foi possível concluir o reconhecimento")}catch(l){d.value=!0,h.value=ato_token.value.status_mensagem||l.value.data.details||"erro na requisição",console.error("Erro na requisição",l)}}async function ie(a){try{const{data:e,error:p,status:v}=await _(Y,{method:"POST",body:{ato_token:a,cartorio_token:b.value,escrevente_token:n.escrevente}},"$oSnYNRtP6Z");if(v.value==="success"){if(e.value[0].tipo_etiqueta==="html"){const u=window.open("","_blank");u.document.open(),u.document.write(e.value[0].etiqueta),u.document.close()}else if(e.value[0].tipo_etiqueta==="zpl"){const{status:u}=await _(`${X}`,{method:"POST",body:{zpl:atob(e.value[0].etiqueta)}},"$BtUyHn78O6");if(u.value!=="success"){d.value=!0,h.value=p.value.data.message;return}}}}catch(e){d.value=!0,h.value=ato_token.value.status_mensagem||e.value.data.details||"erro na requisição",console.error("Erro na requisição",e)}}const ue=()=>{d.value=!1,x()},x=()=>{const a=O.query.origem||"criar",e=O.query.id;a==="atualizar"?M.push(`/os/atualizar/${e}`):M.push("/os/criar-registro")};return(a,e)=>{const p=me,v=de,u=pe,l=ve,y=_e;return $(),F($e,null,[t(q,{class:"mt-5"},{default:r(()=>[t(f,{cols:"5"},{default:r(()=>[t(Se,{label:"Tabelião/escrevente",modelValue:o(n).escrevente,"onUpdate:modelValue":e[0]||(e[0]=s=>o(n).escrevente=s),items:o(R),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"])]),_:1}),t(f,{cols:"2"},{default:r(()=>[t(T,{label:"Quantidade",type:"number",modelValue:o(n).quantidade,"onUpdate:modelValue":e[1]||(e[1]=s=>o(n).quantidade=s)},null,8,["modelValue"])]),_:1})]),_:1}),t(q,null,{default:r(()=>[t(f,{cols:"3"},{default:r(()=>[t(T,{label:"Documento",modelValue:o(n).documento,"onUpdate:modelValue":e[2]||(e[2]=s=>o(n).documento=s)},null,8,["modelValue"])]),_:1}),t(f,{cols:"4"},{default:r(()=>[t(T,{label:"Pessoa",modelValue:o(n).nome,"onUpdate:modelValue":e[3]||(e[3]=s=>o(n).nome=s)},null,8,["modelValue"])]),_:1}),c("div",null,[c("img",{class:"btn-pointer mt-3",src:I,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:oe})]),c("div",null,[c("img",{class:"btn-pointer mt-3 ml-2",src:fe,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:ae})])]),_:1}),t(q,null,{default:r(()=>[t(f,{class:"mr-10"},{default:r(()=>[t(D,{style:{height:"465px"},headers:E,items:o(C)},{"item.actions":r(({item:s})=>[c("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ce=>re(s),title:"Visualizar Ficha"},[s.link_ficha?($(),F("img",Te)):($(),F("img",Ae))],8,Fe)]),_:1},8,["items"])]),_:1}),t(f,null,{default:r(()=>[t(D,{headers:E,items:o(k),style:{height:"465px"},"item-key":"id"},{"item.actions":r(({item:s})=>[c("div",{style:{display:"flex","justify-content":"flex-end"},onClick:ce=>ne(s),title:"Remover"},e[7]||(e[7]=[c("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:he,alt:"Remover"},null,-1)]),8,Me)]),_:1},8,["items"])]),_:1})]),_:1}),t(p,{show:o(S),onClose:e[4]||(e[4]=s=>S.value=!1)},null,8,["show"]),o(w)?($(),Pe(v,{key:0,show:o(w),item:o(P),"pessoa-obj":o(P),"link-view":o(z),onConfirmar:e[5]||(e[5]=s=>se(o(P))),onClose:e[6]||(e[6]=s=>w.value=!1)},null,8,["show","item","pessoa-obj","link-view"])):xe("",!0),t(q,null,{default:r(()=>[t(u,{onClick:x},{default:r(()=>[t(Ce,{size:"large",color:"red"},{default:r(()=>e[8]||(e[8]=[j("Voltar")])),_:1})]),_:1}),t(l,{class:"ml-5",onSave:le,size:"large",color:"green"},{default:r(()=>e[9]||(e[9]=[j("Salvar ")])),_:1})]),_:1}),t(y,{show:o(d),errorMessage:o(h),onClose:ue},null,8,["show","errorMessage"])],64)}}};export{pt as default};
