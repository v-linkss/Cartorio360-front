import{_ as ye}from"./Ctp2pzB9.js";import{_ as Ve}from"./dNMyeM9g.js";import{_ as he}from"./S6UtIGjv.js";import{_ as ge,r as l,H as we,o as w,j as te,w as a,b as o,a as m,t as X,i as t,V as R,A as ee,G as be,c as z,k as ae,v as j,d as D,C as Ce,J as xe,u as $e,e as P,f as qe,s as Pe,F as Ae,l as Me}from"./DuCAdtKR.js";import{V as Te,b as Fe,c as Ee}from"./s16dpdHP.js";import{V as Se}from"./D6aCYhjf.js";import{_ as Ne}from"./DwHtPDeF.js";import{_ as se}from"./DyYqMMT0.js";import{_ as Oe}from"./BVz1G1IN.js";import{_ as Re}from"./BcZTJmhO.js";import{a as ze}from"./DJvq3mCv.js";import{u as h}from"./BiwPb9tQ.js";import{V as O}from"./Dh2ucjuV.js";import{V as g}from"./D608pAuO.js";import{V as je}from"./DWnzJl3M.js";import{V as oe}from"./2wimWgTE.js";import"./CZeXb5lK.js";import"./DKA_ycZo.js";import"./Bx_MEcHW.js";import"./yrhla_Gq.js";import"./B0IxRygJ.js";import"./BeThayk-.js";import"./CekLoRKi.js";import"./BcQ-L0Xn.js";import"./CQkdFVpB.js";import"./CQdUSAzJ.js";import"./BSefbEwt.js";import"./BwC2rM5i.js";import"./EQ8d6mnN.js";const De={class:"random-numbers"},Be={key:0,class:"error-message"},Ue={__name:"ValidadorAutencidade",props:{show:Boolean},emits:["close","confirm"],setup(B,{emit:U}){const k=B,b=U,d=l(k.show),y=l([]),p=l(""),v=l("");function f(){y.value=[];for(let _=0;_<4;_++)y.value.push(Math.floor(Math.random()*10))}we(()=>k.show,_=>{d.value=_,_&&(f(),p.value="",v.value="")});const A=()=>{d.value=!1,b("close")},M=()=>{p.value===y.value.join("")?(v.value="",d.value=!1,b("confirm")):v.value="Números digitados incorretos. Tente novamente."};return(_,u)=>(w(),te(Se,{persistent:"",modelValue:t(d),"onUpdate:modelValue":u[1]||(u[1]=C=>ee(d)?d.value=C:null),"max-width":"500"},{default:a(()=>[o(Te,null,{default:a(()=>[o(Fe,null,{default:a(()=>[m("div",null,[u[2]||(u[2]=m("p",null," Digite o código de validação para confirmar o ato de reconhecimento por autenticidade: ",-1)),m("div",De,[m("span",null,X(t(y).join(" ")),1)]),o(R,{modelValue:t(p),"onUpdate:modelValue":u[0]||(u[0]=C=>ee(p)?p.value=C:null),label:"Digite os números",maxlength:"4",outlined:"",dense:"",onKeyup:be(M,["enter"])},null,8,["modelValue"]),t(v)?(w(),z("div",Be,X(t(v)),1)):ae("",!0)])]),_:1}),o(Ee,null,{default:a(()=>[o(j,{style:{"background-color":"red",color:"white"},onClick:A},{default:a(()=>u[3]||(u[3]=[D("Cancelar")])),_:1}),o(j,{style:{"background-color":"green",color:"white"},onClick:M},{default:a(()=>u[4]||(u[4]=[D("Validar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ie=ge(Ue,[["__scopeId","data-v-c978e7cc"]]),Ke=["onClick"],Ze={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:se,alt:"Possui Ficha",title:"Possui Ficha"},He={key:1,style:{width:"30px",height:"30px",cursor:"pointer"},src:Re,alt:"Visualizar",title:"Não Possui Ficha"},Le=["onClick"],Co={__name:"autencidade",props:{ato_token:{type:String,required:!0}},emits:["ato-created"],async setup(B,{emit:U}){var Y;let k,b;const d=B,y=U,p=Ce(),v=xe(),f=Me(),{$toast:A}=$e(),M=`${f.public.managemant}/listarEscrevente`,_=`${f.public.managemant}/pesquisarPessoas`,u=`${f.public.managemant}/atoReconhecimento`,C=`${f.public.managemant}/etiquetaAutenticidade`,ne=`${f.public.managemant}/download`,le=`${f.public.envioDoc}/print`,T=l(P("user-data").value.cartorio_token),re=l(P("user-service").value.token).value||l(P("user-service").value).value,ie=P("auth_token").value,I=l([]),L=l([]),x=l([]),F=l(!1),K=l(!1),E=l(!1),S=l(null),Q=l(null),Z=l(""),N=l(!1),W=[{title:"Documento",align:"start",key:"documento"},{title:"Pessoa",align:"start",key:"nome"},{value:"actions"}],r=qe({quantidade:1,escrevente:null,nome:null,documento:null}),{data:G}=([k,b]=Pe(()=>h(M,{method:"POST",body:{cartorio_token:T}},"$qpB20nOlUE")),k=await k,b(),k);L.value=Array.isArray(G.value)&&((Y=G.value[0])==null?void 0:Y.func_json_escreventes)||[];async function ue(){try{const{data:s,error:e}=await h(_,{method:"POST",body:{cartorio_token:T.value,documento:r.documento,nome:r.nome}},"$CfpM9wZnUE");s.value.length>0?(y("ato-created"),I.value=s.value):I.value=[]}catch(s){console.error("Erro na requisição",s)}}const ce=()=>{K.value=!0};function me(s){x.value.push(s)}const de=async s=>{S.value=s,E.value=!0;const{data:e}=await h(ne,{method:"POST",body:{bucket:P("user-data").value.cartorio_token,path:s.link_ficha}},"$LrKAtpxZwH");Q.value=e.value};function pe(s){x.value=x.value.filter(e=>e.token!==s.token)}function ve(){N.value=!0}function fe(){N.value=!1,_e()}async function _e(){var s,e,$,V;if(!r.escrevente){A.error("Por favor selecione um Escrevente");return}try{const c=x.value.map(H=>({pessoa_token:H.token})),{data:i,error:q,status:n}=await h(u,{method:"POST",body:{pessoas:c,cartorio_token:T.value,ordemserv_token:re,quantidade:r.quantidade,usuario_token:ie,ato_tipo_token:d.ato_token}},"$EE94jKo1pQ");n.value==="success"&&Array.isArray(i.value)&&((s=i.value[0])==null?void 0:s.status)==="OK"?(ke(i.value[0].token),J()):(F.value=!0,Z.value=Array.isArray(i.value)&&((e=i.value[0])==null?void 0:e.status_mensagem)||((V=($=q==null?void 0:q.value)==null?void 0:$.data)==null?void 0:V.details)||"Não foi possível concluir o reconhecimento")}catch(c){F.value=!0,Z.value=c,console.error("Erro na requisição",c)}}async function ke(s){try{const{data:e,error:$,status:V}=await h(C,{method:"POST",body:{ato_token:s,cartorio_token:T.value,escrevente_token:r.escrevente}},"$KyoIzBxZyr");if(V.value==="success"){const c=Array.isArray(e.value)?e.value[0]:null;if(!c)return;if(c.tipo_etiqueta==="html"){const i=window.open("","_blank");i.document.open(),i.document.write(c.etiqueta),i.document.close()}else if(c.tipo_etiqueta==="zpl"){const{status:i}=await h(`${le}`,{method:"POST",body:{zpl:atob(c.etiqueta)}},"$Vem9mHWYqw");if(i.value!=="success"){A.error("Não foi possivel fazer a impressao da etiqueta");return}}}}catch(e){console.error("Erro na requisição",e)}}const J=()=>{const s=v.query.origem||"criar",e=v.query.id;s==="atualizar"?p.push(`/os/atualizar/${e}`):p.push("/os/criar-registro")};return(s,e)=>{const $=ye,V=Ve,c=he,i=Ie,q=Ne;return w(),z(Ae,null,[o(O,{class:"mt-5"},{default:a(()=>[o(g,{cols:"5"},{default:a(()=>[o(je,{label:"Tabelião/escrevente",modelValue:t(r).escrevente,"onUpdate:modelValue":e[0]||(e[0]=n=>t(r).escrevente=n),items:t(L),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"])]),_:1}),o(g,{cols:"2"},{default:a(()=>[o(R,{label:"Quantidade",type:"number",modelValue:t(r).quantidade,"onUpdate:modelValue":e[1]||(e[1]=n=>t(r).quantidade=n)},null,8,["modelValue"])]),_:1})]),_:1}),o(O,null,{default:a(()=>[o(g,{cols:"3"},{default:a(()=>[o(R,{label:"Documento",modelValue:t(r).documento,"onUpdate:modelValue":e[2]||(e[2]=n=>t(r).documento=n)},null,8,["modelValue"])]),_:1}),o(g,{cols:"4"},{default:a(()=>[o(R,{label:"Pessoa",modelValue:t(r).nome,"onUpdate:modelValue":e[3]||(e[3]=n=>t(r).nome=n)},null,8,["modelValue"])]),_:1}),m("div",null,[m("img",{class:"btn-pointer mt-1",src:se,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:ue})]),m("div",null,[m("img",{class:"btn-pointer mt-1 ml-2",src:Oe,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:ce})])]),_:1}),o(O,null,{default:a(()=>[o(g,{class:"mr-10"},{default:a(()=>[o(oe,{style:{height:"465px"},headers:W,items:t(I)},{"item.actions":a(({item:n})=>[m("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:H=>de(n),title:"Visualizar Ficha"},[n.link_ficha?(w(),z("img",Ze)):(w(),z("img",He))],8,Ke)]),_:1},8,["items"])]),_:1}),o(g,null,{default:a(()=>[o(oe,{headers:W,items:t(x),style:{height:"465px"},"item-key":"id"},{"item.actions":a(({item:n})=>[m("div",{style:{display:"flex","justify-content":"flex-end"},onClick:H=>pe(n),title:"Remover"},e[9]||(e[9]=[m("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ze,alt:"Remover"},null,-1)]),8,Le)]),_:1},8,["items"])]),_:1})]),_:1}),o($,{show:t(K),onClose:e[4]||(e[4]=n=>K.value=!1)},null,8,["show"]),t(E)?(w(),te(V,{key:0,show:t(E),item:t(S),"pessoa-obj":t(S),"link-view":t(Q),onConfirmar:e[5]||(e[5]=n=>me(t(S))),onClose:e[6]||(e[6]=n=>E.value=!1)},null,8,["show","item","pessoa-obj","link-view"])):ae("",!0),o(c,{show:t(F),errorMessage:t(Z),onClose:e[7]||(e[7]=n=>F.value=!1)},null,8,["show","errorMessage"]),o(i,{show:t(N),onClose:e[8]||(e[8]=n=>N.value=!1),onConfirm:fe},null,8,["show"]),o(O,null,{default:a(()=>[o(q,{onClick:J},{default:a(()=>[o(j,{size:"large",color:"red"},{default:a(()=>e[10]||(e[10]=[D("Voltar")])),_:1})]),_:1}),o(j,{class:"ml-5",onClick:ve,size:"large",color:"green"},{default:a(()=>e[11]||(e[11]=[D("Salvar")])),_:1})]),_:1})],64)}}};export{Co as default};
