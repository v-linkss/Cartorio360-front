import{_ as ge}from"./B_4CAgfy.js";import{u as he,D as me,K as pe,r as s,f as be,o as u,h as I,w as t,b as a,i as e,s as fe,V as oe,d as W,p as U,k as _e,e as G,A as Se,y as ye,a as z,c as q,M as je,l as Ue,N as Re,F as qe,g as Fe,O as Ae,t as ve}from"./BByDlLmN.js";import{u as p}from"./DEqwmX4B.js";import{V as R}from"./BR4JYKwL.js";import{V as B}from"./Dla0_UEN.js";import{V as ke}from"./DHu74AEx.js";import{V as xe}from"./KYmhQMWN.js";import{_ as Ie,a as Ne,b as Le}from"./CLNynHxL.js";import{_ as Be,a as Ge,b as Ke,T as He,W as Je,S as We,D as Oe,c as Xe,d as Ye}from"./2wIrtf2J.js";import{_ as Qe,r as Te}from"./CuuQCXov.js";import{_ as $e}from"./BM1-cHce.js";import{_ as ze}from"./BVz1G1IN.js";import{_ as Ze}from"./8GaTPY2g.js";import{_ as ea}from"./Dcq_7Fnl.js";import{_ as Ce,a as Ee}from"./DJvq3mCv.js";import{V as Ve}from"./DFCAmhU7.js";import{_ as Me}from"./nLRMiXLS.js";import{V as aa}from"./CILLoBl0.js";import{f as Pe}from"./B0IxRygJ.js";import{_ as ta}from"./esdrYL2a.js";import{_ as oa}from"./-zgYk4Vu.js";import{c as sa,r as ra,u as na}from"./CEn_AuPw.js";const tt={__name:"Dados",props:{item_dados:{type:Array,required:!0},item_situacoes:{type:Array,required:!0}},setup(ce){const _=ce,{$toast:C}=he(),h=_e(),d=me(),m=pe(),x=`${h.public.managemant}/updateAtos`,E=s(_.item_situacoes),Q=s(m.query.origem==="vizualizar"),O=be({dt_abertura:_.item_dados[0].dt_abertura||null,status:_.item_dados[0].status||null,mne:_.item_dados[0].mne||null});async function Z(){const{data:T,error:b,status:V}=await p(`${x}/${m.query.ato_id}`,{method:"PUT",body:{status:O.status,mne:O.mne,dt_abertura:O.dt_abertura}},"$EIT5jtTUdX");V.value==="success"&&C.success("Ato Atualizado com sucesso")}const w=()=>{const T=m.query.origem||"criar",b=m.query.id;switch(T){case"atualizar":case"vizualizar":d.push(`/os/atualizar/${b}`);break;case"atualizar-lista":case"vizualizar-lista":d.push("/atos/lista");break;default:d.push("/os/criar-registro");break}};return(T,b)=>{const V=ge;return u(),I(xe,null,{default:t(()=>[a(R,{class:"mt-5"},{default:t(()=>[a(B,{cols:"3"},{default:t(()=>[a(ke,{label:"Situação",modelValue:e(O).status,"onUpdate:modelValue":b[0]||(b[0]=v=>e(O).status=v),items:e(E),"item-title":"descricao","item-value":"descricao",required:""},null,8,["modelValue","items"])]),_:1})]),_:1}),a(R,null,{default:t(()=>[a(B,{cols:"5"},{default:t(()=>[a(fe,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:e(O).mne,"onUpdate:modelValue":b[1]||(b[1]=v=>e(O).mne=v)},null,8,["modelValue"])]),_:1})]),_:1}),a(R,null,{default:t(()=>[a(B,{cols:"2"},{default:t(()=>[a(fe,{modelValue:e(O).dt_abertura,"onUpdate:modelValue":b[2]||(b[2]=v=>e(O).dt_abertura=v),type:"date",label:"Data Lavratura",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),a(R,{class:"mb-3"},{default:t(()=>[a(V,{onClick:w},{default:t(()=>[a(oe,{size:"large",color:"red"},{default:t(()=>b[3]||(b[3]=[W("Voltar")])),_:1})]),_:1}),e(Q)?U("",!0):(u(),I(oe,{key:0,class:"ml-10",onClick:Z,size:"large",color:"green"},{default:t(()=>b[4]||(b[4]=[W("Atualizar")])),_:1}))]),_:1})]),_:1})}}},la={key:0},ia=["onClick"],ca={key:0,style:{width:"30px",height:"30px"},src:$e,alt:"Visualizar"},ua={key:1,style:{width:"30px",height:"30px"},src:Ze,alt:"Visualizar"},da=["onClick"],ma=["onClick"],pa={key:0,style:{width:"30px",height:"30px"},src:Ce,alt:"Visualizar",title:"Reativar"},_a={key:1,src:Ee,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},va=["onClick"],ot={__name:"Partes",async setup(ce){let _,C;const h=me(),d=pe(),m=_e(),{$toast:x}=he(),E=`${m.public.managemant}/pesquisarPessoas`,Q=`${m.public.managemant}/listarPapeis`,O=`${m.public.managemant}/createAtosPessoa`,Z=`${m.public.managemant}/updateAtosPessoa`,w=`${m.public.managemant}/getAtosPessoaById`,T=`${m.public.managemant}/download`,b=s(G("user-data").value.cartorio_token),V=s(d.query.origem==="vizualizar"),v=s([]),K=s({}),$=s([]),J=s([]),P=s(!1),M=s(!1),X=s(!1),ee=s(!1),Y=s(null),f=s(null),k=s(null),ae=s(null),n=s(null),r=s(d.query.tipo_ato_token),y=s(null),D=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"320px"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome",width:"320px"},{value:"actions"}],i=be({papeis:null,nome:null,pessoa:null,documento:null});Se(()=>{var l;return((l=i.pessoa)==null?void 0:l.link_ficha)||!1});const{data:F}=([_,C]=ye(()=>p(Q,{method:"POST",body:{tipo_ato_token:d.query.tipo_ato_token}},"$acoiTIUp00")),_=await _,C(),_);J.value=F.value;const o=async()=>{const{data:l}=await p(`${w}/${d.query.ato_id}`,{method:"GET"},"$ypnU9hCpVn"),L=(re=>re.map(ie=>({...ie,pessoa:{...ie.pessoa,documento:ie.pessoa.doc_identificacao},papel:{...ie.partes_tipos}})))(l.value);$.value=L};o();async function g(){try{const{data:l,error:c}=await p(E,{method:"POST",body:{cartorio_token:b.value,documento:i.documento,nome:i.nome}},"$pr30MyPXfY");l.value.length>0?(v.value=l.value,i.pessoa=v.value[0]):v.value=[]}catch(l){console.error("Erro na requisição",l)}}const H=()=>{M.value=!0},N=async()=>{await o()},ne=async()=>{await o()},S=async()=>{const l={pessoa:i.pessoa,papel:J.value.find(ue=>ue.id===i.papeis),representante:{nome:null}},c=await p(`${w}/${d.query.ato_id}`,{method:"GET"},"$scHdIvxj2D");for(const ue of c.data.value)if(ue.pessoa_id===i.pessoa.id&&ue.ato_id===Number(d.query.ato_id)&&ue.tipo_parte_id===i.papeis){x.error("Pessoa Já Registrada Com Esse Papel!");return}const{data:L,error:re,status:ie}=await p(O,{method:"POST",body:{ato_id:Number(d.query.ato_id),pessoa_id:i.pessoa.id,tipo_parte_id:i.papeis,user_id:G("user-data").value.usuario_id}},"$18isAgOJxG");ie.value==="success"?(l.id=L.value.id,x.success("Pessoa Registrada com Sucesso!"),$.value.push(l)):x.error(re.value.message)},A=async l=>{X.value=!0;const{data:c}=await p(T,{method:"POST",body:{bucket:G("user-data").value.cartorio_token,path:l.pessoa.link_ficha}},"$hmDzSF3F61");y.value=c.value,K.value=l.pessoa},se=l=>{const c=$.value.filter(L=>L.pessoa.id!==l.pessoa.id&&!L.excluido).map(L=>({id:L.pessoa.id,nome:L.pessoa.nome}));k.value=l.id,Y.value=c,P.value=!0,f.value=l.pessoa.nome,n.value=l.pessoa.id},le=l=>{ee.value=!0,ae.value=l.id,f.value=l.pessoa.nome};async function de(l){l.excluido=!l.excluido;try{await p(`${Z}/${l.id}`,{method:"PUT",body:JSON.stringify({excluido:l.excluido})},"$l09I6nLRfk")}catch(c){console.error("Erro ao excluir pessoa:",c)}}const te=()=>{const l=d.query.origem||"criar",c=d.query.id;switch(l){case"atualizar":case"vizualizar":h.push(`/os/atualizar/${c}`);break;case"atualizar-lista":case"vizualizar-lista":h.push("/atos/lista");break;default:h.push("/os/criar-registro");break}};return(l,c)=>{const L=Ie,re=Ge,ie=Ke,ue=Qe,De=ge;return u(),I(xe,null,{default:t(()=>[e(V)?U("",!0):(u(),I(R,{key:0,class:"mt-5"},{default:t(()=>[a(B,{cols:"3"},{default:t(()=>[a(fe,{label:"Documento",modelValue:e(i).documento,"onUpdate:modelValue":c[0]||(c[0]=j=>e(i).documento=j)},null,8,["modelValue"])]),_:1}),a(B,{cols:"4"},{default:t(()=>[a(fe,{label:"Pessoa",modelValue:e(i).nome,"onUpdate:modelValue":c[1]||(c[1]=j=>e(i).nome=j)},null,8,["modelValue"])]),_:1}),z("div",null,[z("img",{class:"mt-1",src:$e,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:g})]),z("div",null,[z("img",{class:"mt-1 ml-2",src:ze,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:H})])]),_:1})),e(V)?U("",!0):(u(),I(R,{key:1},{default:t(()=>[a(B,{cols:"4"},{default:t(()=>[a(ke,{label:"Selecione a Pessoa",modelValue:e(i).pessoa,"onUpdate:modelValue":c[2]||(c[2]=j=>e(i).pessoa=j),items:e(v),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),a(B,{cols:"3"},{default:t(()=>[a(ke,{label:"Papel",modelValue:e(i).papeis,"onUpdate:modelValue":c[3]||(c[3]=j=>e(i).papeis=j),items:e(J),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),e(V)?U("",!0):(u(),q("div",la,[z("img",{class:"mt-1",src:ze,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:S})]))]),_:1})),a(R,null,{default:t(()=>[a(B,null,{default:t(()=>[a(Ve,{style:{height:"465px"},headers:D,items:e($)},{"item.actions":t(({item:j})=>[e(V)?U("",!0):(u(),I(R,{key:0},{default:t(()=>[z("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-1",onClick:we=>A(j),title:"Visualizar Ficha"},[j.pessoa.link_ficha?(u(),q("img",ca)):(u(),q("img",ua))],8,ia),z("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:we=>le(j),class:"mr-1",title:"Alterar Papel"},c[8]||(c[8]=[z("img",{style:{width:"30px",height:"30px"},src:ea,alt:"Visualizar"},null,-1)]),8,da),z("div",{class:"mr-1",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:we=>de(j),title:"Deletar Pessoa"},[j.excluido?(u(),q("img",pa)):(u(),q("img",_a))],8,ma),z("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-1",onClick:we=>se(j),title:"Selecionar Representante"},c[9]||(c[9]=[z("img",{style:{width:"30px",height:"30px"},src:Be,alt:"Visualizar"},null,-1)]),8,va)]),_:2},1024))]),_:1},8,["items"])]),_:1})]),_:1}),a(L,{show:e(M),onClose:c[4]||(c[4]=j=>M.value=!1)},null,8,["show"]),a(re,{representante_nome:e(f),representantes:e(Y),ato_id:e(k),show:e(P),onClose:c[5]||(c[5]=j=>P.value=!1),onUpdateRepresentante:ne},null,8,["representante_nome","representantes","ato_id","show"]),a(ie,{representante_nome:e(f),ato_token:e(r),ato_id:e(ae),show:e(ee),onClose:c[6]||(c[6]=j=>ee.value=!1),onUpdatePapel:N},null,8,["representante_nome","ato_token","ato_id","show"]),e(X)?(u(),I(ue,{key:2,show:e(X),"link-view":e(y),"pessoa-obj":e(K),"is-view":!0,onClose:c[7]||(c[7]=j=>X.value=!1)},null,8,["show","link-view","pessoa-obj"])):U("",!0),a(R,null,{default:t(()=>[a(De,{onClick:te},{default:t(()=>[a(oe,{size:"large",color:"red"},{default:t(()=>c[10]||(c[10]=[W("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},fa={key:0,class:"loading-overlay"},ya="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",st={__name:"Minuta",emits:["page","doc"],setup(ce,{emit:_}){je("DocumentEditorContainer",[He,Je,We]);const C=_e(),{$toast:h}=he(),d=me(),m=pe(),x=_;Te(`${C.public.docEditor}`);const E=`${C.public.managemant}/download`,Q=`${C.public.managemant}/atos/files`,O=`${C.public.managemant}/subitituirModelo`,Z=`${C.public.managemant}/upload`,w=s(null),T=s(!1),b=s("Ao executar a geração, a minuta atual será substituída e não poderá ser recuperada.Confirma ?"),V=s(m.query.origem==="vizualizar"),v=s(!1),K=async n=>{try{const r=await fetch(n);if(!r.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await r.blob()}catch(r){return console.error(r),null}},$=async()=>{try{const{data:n}=await p(`${Q}/${m.query.ato_token_edit}`,{method:"GET"},"$5jxI4TvFse");return n.value.link_ato}catch(n){console.error("Erro ao carregar o documento:",n),h.error(n)}},J=async()=>{v.value=!0;try{const n=await $(),{data:r,status:y}=await p(E,{method:"POST",body:{bucket:G("user-data").value.cartorio_token,path:n}},"$dvNFfvmIJC"),D=r.value,i=await K(D);if(i){const F=new FileReader;F.onload=()=>{const o=F.result;w.value.ej2Instances.documentEditor.open(o),x("doc",o)},F.readAsText(i)}}catch{console.error("Erro ao carregar o documento.")}finally{v.value=!1}},P=async()=>{const r=await w.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),y=new FileReader;y.onload=()=>{const D=y.result,F=w.value.ej2Instances.documentEditor.pageCount;x("page",F),x("doc",D)},y.readAsText(r)},M=async()=>{v.value=!0;try{const r=await w.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),y=new FormData;y.append("file",r,"anexo.sfdt"),y.append("cartorio_token",G("user-data").value.cartorio_token),y.append("token",m.query.ato_token_edit),y.append("tipo","ato_minuta");const{data:D,status:i}=await p(Z,{method:"POST",body:y},"$xv11VtUdMy");if(i.value==="success"){h.success("Documento enviado!");const o=w.value.ej2Instances.documentEditor.pageCount;P(),x("page",o)}else h.error("Erro ao enviar documento para o sistema.")}catch(n){h.error("Erro ao salvar documento."),console.error(n)}finally{v.value=!1}},X=()=>{T.value=!1,ee()},ee=async()=>{k(!0);try{await Y(),k(!0);const{data:n,status:r}=await p(O,{method:"POST",body:{ato_token:m.query.ato_token_edit}},"$zyzWHTXTBW");n.value&&f(n.value)}catch(n){console.error("Erro ao gerar a minuta:",n),h.error("Ocorreu um erro ao gerar a minuta.")}finally{k(!1)}},Y=async()=>{try{const{data:n}=await p(E,{method:"POST",body:{bucket:G("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$KreLE0Ys81"),r=await K(n.value);if(r){const y=new FileReader;y.onload=()=>{const D=y.result;w.value.ej2Instances.documentEditor.open(D),x("doc",D)},y.readAsText(r)}}catch(n){console.error("Erro ao carregar o modelo de minuta:",n)}},f=n=>{const r=w.value.ej2Instances.documentEditor,y=D=>{for(const[i,F]of Object.entries(D))if(/^<<.+>>$/.test(i))try{r.search.findAll(i),r.search.searchResults.length>0&&r.search.searchResults.replaceAll(F)}catch(o){console.error(`Erro ao substituir o marcador ${i}:`,o)}else if(i==="partes"&&Array.isArray(F)&&F.length>0)for(const o of F)typeof o=="object"&&y(o)};y(n)},k=n=>{v.value=n},ae=()=>{const n=m.query.origem||"criar",r=m.query.id;switch(n){case"atualizar":case"vizualizar":d.push(`/os/atualizar/${r}`);break;case"atualizar-lista":case"vizualizar-lista":d.push("/atos/lista");break;default:d.push("/os/criar-registro");break}};return Ue(async()=>{await J(),P()}),(n,r)=>{const y=ge,D=Me;return u(),q(qe,null,[a(e(Oe),{height:"900px",ref_key:"documentEditorContainer",ref:w,serviceUrl:ya,enableToolbar:!0,enableWordExport:!0},null,512),e(v)?(u(),q("div",fa,[a(Re,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):U("",!0),a(R,{class:"ml-4 mt-4 mb-4"},{default:t(()=>[a(y,{class:"mr-4"},{default:t(()=>[a(oe,{size:"large",onClick:ae,color:"red"},{default:t(()=>r[2]||(r[2]=[W("Voltar")])),_:1})]),_:1}),e(V)?U("",!0):(u(),I(oe,{key:0,size:"large",color:"green",onClick:M,disabled:e(v)},{default:t(()=>r[3]||(r[3]=[W("Atualizar")])),_:1},8,["disabled"])),e(V)?U("",!0):(u(),I(oe,{key:1,class:"ml-4",size:"large",color:"blue",onClick:r[0]||(r[0]=i=>T.value=!0)},{default:t(()=>r[4]||(r[4]=[W("Gerar Minuta")])),_:1}))]),_:1}),a(D,{onConfirm:X,condMessage:e(b),show:e(T),onClose:r[1]||(r[1]=i=>T.value=!1)},null,8,["condMessage","show"])],64)}}},ga={key:0},ha=["src"],ka={key:1},ba=["innerHTML"],rt={__name:"Livro",props:{pages:{type:Number,required:!0},document:{type:String,required:!0},linkLivro:{type:String||null}},async setup(ce){let _,C;const h=ce,d=_e();Te(`${d.public.docEditor}`);const{$toast:m}=he(),x=me(),E=pe(),Q=`${d.public.managemant}/download`,O=`${d.public.managemant}/atos/files`,Z=`${d.public.managemant}/lavrarAto`,w=`${d.public.managemant}/valida_lavratura`,T=`${d.public.managemant}/listarEscrevente`,b=`${d.public.managemant}/ato_calcular`,V=s(G("user-data").value.cartorio_token),v=G("auth_token").value,K=s("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),$=s(null),J=s(""),P=s(!1),M=s(null),X=s(null),ee=s(E.query.origem==="vizualizar"),Y=s(null),f=s([]),k=s({}),ae=s(null),n=be({escrevente:null}),r=async S=>{try{const A=await fetch(S);if(!A.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await A.blob()}catch(A){return console.error(A),null}},y=async()=>{try{const{data:S}=await p(`${O}/${E.query.ato_token_edit}`,{method:"GET"},"$FnEbAJEARP");return S.value.link_ato}catch(S){console.error("Erro ao carregar o documento:",S),m.error(S)}},D=async()=>{try{if(h.linkLivro){const{data:te}=await p(Q,{method:"POST",body:{bucket:G("user-data").value.cartorio_token,path:h.linkLivro}},"$7ljqltMqa0");ae.value=te.value;return}const S=await y(),{data:A,status:se}=await p(Q,{method:"POST",body:{bucket:G("user-data").value.cartorio_token,path:S}},"$OWxZSQkyX8"),le=A.value,de=await r(le);if(de){const te=new FileReader;te.onload=()=>{const l=te.result;Y.value.ej2Instances.documentEditor.open(l)},te.readAsText(de)}}catch{m.error("Erro ao carregar o documento.")}};D();const i=async(S=!1)=>{const A=Y.value.ej2Instances.documentEditor.pageCount;if(!S){const{data:te,error:l,status:c}=await p(w,{method:"POST",body:{ato_token:E.query.ato_token_edit}},"$sMqfUUQcBM");let L,re;if(c.value==="success"&&te.value?(L=te.value[0].status,re=te.value[0].status_mensagem):l.value&&l.value.data&&(L=l.value.data[0].status,re=l.value.data[0].status_mensagem),L!=="OK"){$.value=L,J.value=re,k.value=null,P.value=!0,K.value=" O ato apresenta inconsistências, deseja prosseguir?";return}}const{data:se,status:le,error:de}=await p(Z,{method:"POST",body:{ato_token:E.query.ato_token_edit,qtd_paginas:A,escrevente_token:n.escrevente,usuario_token:v,cartorio_token:V}},"$OVwiKSwcOE");le.value==="success"?(M.value=se.value,X.value=se.value[0].selo,m.success("Ato lavrado com sucesso!")):m.error(de.value.data[0].status_mensagem||"Falha ao lavrar o ato.")},F=()=>{P.value=!1,$.value=null,J.value="",k.value={}},o=async()=>{const S=Y.value.ej2Instances.documentEditor.pageCount,{data:A,status:se}=await p(b,{method:"POST",body:{ato_token:E.query.ato_token_edit,cartorio_token:V,quantidade:1,usuario_token:v,escrevente_token:n.escrevente,qtd_paginas:S}},"$iv1N3XD6We");se.value==="success"?k.value=A.value[0]:m.error("Falha ao calcular o ato.")},g=async()=>{P.value=!1,$.value&&$.value!=="OK"?(await i(!0),$.value=null,J.value=""):await i()},H=async()=>{P.value=!0,K.value="Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?",await o()},{data:N}=([_,C]=ye(()=>p(T,{method:"POST",body:{cartorio_token:V}},"$Kj765fCvMC")),_=await _,C(),_);f.value=N.value[0].func_json_escreventes;const ne=()=>{const S=E.query.origem||"criar",A=E.query.id;switch(S){case"atualizar":case"vizualizar":x.push(`/os/atualizar/${A}`);break;case"atualizar-lista":case"vizualizar-lista":x.push("/atos/lista");break;default:x.push("/os/criar-registro");break}};return Fe(()=>h.document,()=>{D()}),(S,A)=>{const se=Me;return u(),q(qe,null,[a(R,null,{default:t(()=>[a(B,null,{default:t(()=>[h.linkLivro?(u(),q("div",ga,[z("iframe",{src:e(ae),type:"application/pdf",width:"100%",height:"850px"},null,8,ha)])):(u(),q("div",ka,[a(e(Oe),{restrictEditing:!0,enableToolbar:!1,ref_key:"documentEditorContainer",ref:Y,height:"850px",width:"850px"},null,512)]))]),_:1}),e(ee)?U("",!0):(u(),I(B,{key:0},{default:t(()=>[a(ke,{class:"mt-15",label:"Tabelião/escrevente",modelValue:e(n).escrevente,"onUpdate:modelValue":A[0]||(A[0]=le=>e(n).escrevente=le),items:e(f),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),z("img",{onClick:A[1]||(A[1]=le=>H()),style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:Xe}),e(M)?(u(),I(aa,{key:0,width:"360"},{default:t(()=>[a(R,null,{default:t(()=>[a(B,null,{default:t(()=>[a(Ae,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:t(()=>[a(B,null,{default:t(()=>[W(" Livro: "+ve(e(M)[0].livro_numero),1)]),_:1}),a(B,null,{default:t(()=>[W(" Protocolo: "+ve(e(M)[0].protocolo?e(M)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),a(B,null,{default:t(()=>[a(Ae,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:t(()=>[W(" Folhas : "+ve(e(M)[0].pagina_inicial)+" A "+ve(e(M)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),z("div",{style:{"margin-left":"10px","padding-bottom":"20px","margin-top":"-10px"},innerHTML:e(X)},null,8,ba)]),_:1})):U("",!0)]),_:1}))]),_:1}),a(oe,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:ne},{default:t(()=>A[2]||(A[2]=[W("Voltar")])),_:1}),a(se,{show:e(P),condMessage:e(K),description:e(J),valor:e(k),onClose:F,onConfirm:g},null,8,["show","condMessage","description","valor"])],64)}}},xa=["onClick"],$a=["onClick"],wa={key:0,style:{width:"30px",height:"30px"},src:Ce,alt:"Visualizar",title:"Reativar"},za={key:1,src:Ee,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},nt={__name:"Observacao",async setup(ce){let _,C;const h=me(),d=pe(),m=_e(),x=`${m.public.managemant}/listarEscrevente`,E=`${m.public.managemant}/atos_observacao`,Q=`${m.public.managemant}/atos_observacao`,O=s(G("user-data").value.cartorio_token),Z=s(d.query.origem==="vizualizar"),w=s(!1),T=s(!1),b=s(""),V=s([]),v=s([]);function K(f){b.value=f.observacao,T.value=!0,w.value=!0}const $=()=>{T.value=!1,w.value=!0,b.value=""},J=[{title:"Data",align:"start",key:"created"},{title:"Escrevente",align:"start",key:"users.nome"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}],P=async()=>{w.value=!1,await M()};async function M(){const{data:f}=await p(`${Q}/${d.query.ato_id}`,{method:"GET"},"$HyzoO40swN");Array.isArray(f.value)?V.value=f.value.map(k=>({...k,created:Pe(k.created,"dd/mm/yyyy hh:mm")})):f.value&&typeof f.value=="object"&&(V.value=[{...f.value,created:Pe(f.value.created,"dd/mm/yyyy hh:mm")}])}[_,C]=ye(()=>M()),await _,C();async function X(f){f.excluido=!f.excluido;try{await p(`${E}/${f.id}`,{method:"PUT",body:JSON.stringify({excluido:f.excluido})},"$gnHMo4uCXD")}catch(k){console.error("Erro ao excluir observação:",k)}}const{data:ee}=([_,C]=ye(()=>p(x,{method:"POST",body:{cartorio_token:O}},"$sP9AKdd3Ky")),_=await _,C(),_);v.value=ee.value[0].func_json_escreventes;const Y=()=>{const f=d.query.origem||"criar",k=d.query.id;switch(f){case"atualizar":case"vizualizar":h.push(`/os/atualizar/${k}`);break;case"atualizar-lista":case"vizualizar-lista":h.push("/atos/lista");break;default:h.push("/os/criar-registro");break}};return(f,k)=>{const ae=Ye,n=ge;return u(),I(xe,null,{default:t(()=>[e(Z)?U("",!0):(u(),I(R,{key:0,class:"mt-5"},{default:t(()=>[e(Z)?U("",!0):(u(),I(oe,{key:0,class:"mb-4 ml-8",onClick:$,size:"large",color:"green"},{default:t(()=>k[0]||(k[0]=[W("Novo")])),_:1}))]),_:1})),a(R,null,{default:t(()=>[a(B,null,{default:t(()=>[a(Ve,{style:{height:"465px"},headers:J,items:e(V)},{"item.observacao":t(({item:r})=>[W(ve(r.observacao.length>100?r.observacao.slice(0,100)+"...":r.observacao),1)]),"item.actions":t(({item:r})=>[a(R,null,{default:t(()=>[z("div",{onClick:y=>K(r)},k[1]||(k[1]=[z("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:$e,alt:"Visualizar"},null,-1)]),8,xa),z("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end","margin-left":"5px"},onClick:y=>X(r),title:"Deletar Observação"},[r.excluido?(u(),q("img",wa)):(u(),q("img",za))],8,$a)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),e(w)?(u(),I(ae,{key:1,show:e(w),observacao:e(b),visualizar:e(T),onClose:P},null,8,["show","observacao","visualizar"])):U("",!0),a(R,null,{default:t(()=>[a(n,{onClick:Y},{default:t(()=>[a(oe,{size:"large",color:"red"},{default:t(()=>k[2]||(k[2]=[W("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},Ca={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ne,alt:"Criar"},Ea={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Le,alt:"Criar"},Va={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:oa,alt:"Criar"},Aa=["onClick"],Pa=["onClick"],qa=["onClick"],Oa={key:0,style:{width:"30px",height:"30px"},src:Ce,alt:"Visualizar",title:"Reativar"},Ta={key:1,src:Ee,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},lt={__name:"Anexos",async setup(ce){let _,C;const h=_e(),{$toast:d}=he(),m=me(),x=pe(),E=s(x.query.origem==="vizualizar"),Q=`${h.public.biometria}/run-scanner`,O=`${h.public.managemant}/atos_anexos`,Z=`${h.public.managemant}/atos_anexos`,w=`${h.public.managemant}/download`,T=`${h.public.managemant}/atos_anexos`,b=`${h.public.managemant}/upload`,V=s(!1),v=s(null),K=s([]);G("pessoa_token");const $=be({descricao:"",fileEvent:null}),J={descricao:{required:sa.withMessage("O campo é obrigatório",ra)}},P=na(J,$,{$autoDirty:!0}),M=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}],{data:X}=([_,C]=ye(()=>p(`${T}/${x.query.ato_id}`,{method:"GET"},"$AOZpbz65MA")),_=await _,C(),_);K.value=X.value;async function ee(){try{await Y(),await f()}catch(o){console.error("Erro ao executar scanner ou listar arquivos:",o)}}async function Y(){try{const{data:o}=await p(Q,{method:"GET"},"$KttjFhHivJ")}catch(o){d.error("Erro ao acionar o scanner:",o)}}async function f(){try{const{data:o,status:g}=await p("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:x.query.ato_token_edit,cartorio_token:G("user-data").value.cartorio_token}},"$TqQrsgxUkd")}catch(o){console.error("Erro ao enviar o arquivo:",o)}}async function k(){try{const o=document.createElement("input");o.type="file",o.accept="*/*",o.onchange=async g=>{$.fileEvent=g,g.target.files[0]&&(v.value=!0)},o.click()}catch(o){console.error("Erro ao abrir o explorador de arquivos:",o)}}const ae=async()=>{V.value=!0};function n(o){return o?!0:(v.value=!1,!1)}const r=async o=>{if(!$.fileEvent||!$.fileEvent.target.files.length){d.error("Nenhum arquivo selecionado.");return}const g=$.fileEvent.target.files[0],H=new FormData;H.append("file",g),H.append("cartorio_token",G("user-data").value.cartorio_token),H.append("token",o),H.append("tipo","ato_anexo");try{const N=await p(b,{method:"POST",body:H},"$KDhIYzGKzM");d.success("Anexo registrado com sucesso!")}catch{d.error("Erro ao enviar o arquivo.")}},y=async()=>{if(P.value.$touch(),!P.value.$invalid&&n($.fileEvent)){const{data:o,error:g,status:H}=await p(O,{method:"POST",body:{ato_id:x.query.ato_id,descricao:$.descricao,user_id:G("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$cdoFBGO0Ti");H.value==="success"&&(d.success("Anexo registrado com sucesso!"),K.value.push(o.value),r(o.value.token))}};async function D(o){o.excluido=!o.excluido;try{await p(`${Z}/${o.id}`,{method:"PUT",body:JSON.stringify({excluido:o.excluido})},"$WLSrgYRoHq")}catch(g){console.error("Erro ao excluir pessoa:",g)}}async function i(o){try{const g=await p(`${w}`,{method:"POST",body:{bucket:G("user-data").value.cartorio_token,path:o.link}},"$NdgRjioizH"),N=await(await fetch(g.data.value)).blob(),ne=URL.createObjectURL(N);window.open(ne,"_blank")}catch(g){console.error("Erro ao excluir pessoa:",g)}}const F=()=>{const o=x.query.origem||"criar",g=x.query.id;switch(o){case"atualizar":case"vizualizar":m.push(`/os/atualizar/${g}`);break;case"atualizar-lista":case"vizualizar-lista":m.push("/atos/lista");break;default:m.push("/os/criar-registro");break}};return(o,g)=>{const H=ge;return u(),I(xe,null,{default:t(()=>[a(R,null,{default:t(()=>[a(B,{cols:"5",class:"mt-2"},{default:t(()=>[e(E)?U("",!0):(u(),I(fe,{key:0,modelValue:e($).descricao,"onUpdate:modelValue":[g[0]||(g[0]=N=>e($).descricao=N),e(P).descricao.$touch],"error-messages":e(P).descricao.$errors.map(N=>N.$message),onBlur:e(P).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"]))]),_:1}),e(E)?U("",!0):(u(),q("div",{key:0,onClick:ee,title:"Escanear"},g[1]||(g[1]=[z("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:ta,alt:"Escanear"},null,-1)]))),e(E)?U("",!0):(u(),q("div",{key:1,onClick:k,title:"Criar"},[e(v)===!1?(u(),q("img",Ca)):e(v)===!0?(u(),q("img",Ea)):(u(),q("img",Va))])),e(E)?U("",!0):(u(),q("div",{key:2,onClick:y,title:"Criar"},g[2]||(g[2]=[z("img",{class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:ze,alt:"Criar"},null,-1)])))]),_:1}),a(Ve,{headers:M,items:e(K),style:{height:"465px","max-width":"600px"}},{"item.actions":t(({item:N})=>[a(R,null,{default:t(()=>[z("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ne=>ae(N),title:"Visualizar Anexo"},[z("img",{style:{width:"30px",height:"30px"},onClick:ne=>i(N),src:$e,alt:"Visualizar"},null,8,Pa)],8,Aa),z("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ne=>D(N),title:"Deletar Pessoa"},[N.excluido?(u(),q("img",Oa)):(u(),q("img",Ta))],8,qa)]),_:2},1024)]),_:1},8,["items"]),a(H,{onClick:F},{default:t(()=>[a(oe,{size:"large",color:"red"},{default:t(()=>g[3]||(g[3]=[W("Voltar")])),_:1})]),_:1})]),_:1})}}};export{tt as _,ot as a,st as b,rt as c,nt as d,lt as e};
