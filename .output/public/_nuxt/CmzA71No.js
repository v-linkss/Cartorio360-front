import{_ as ge}from"./nC6vdcSH.js";import{_ as we}from"./afIlJatG.js";import{_ as Ve}from"./BsiqYdVA.js";import{_ as be,r as n,g as xe,o as x,h as ae,w as s,b as o,a as m,t as ee,i as t,s as D,j as oe,J as Ce,c as j,p as se,V as W,d as B,D as $e,K as qe,u as Pe,e as E,f as Ae,y as Ee,F as Me,k as Se}from"./DocoAQKL.js";import{V as Te,a as Fe,c as Re}from"./BozcXUgZ.js";import{V as Ne}from"./BsdO4JMn.js";import{_ as Oe}from"./sTbs4YzT.js";import{_ as ze}from"./D4VE6rzS.js";import{_ as ne}from"./D8j2CE4o.js";import{_ as De}from"./BVz1G1IN.js";import{_ as je}from"./fkO_bi1V.js";import{a as Be}from"./DJvq3mCv.js";import{u as V}from"./Cvx8zdu2.js";import{V as z}from"./B9iCPK4m.js";import{V as b}from"./BSDvzSLA.js";import{V as Ue}from"./Cx7c1Ztz.js";import{V as te}from"./D4E_y4tl.js";import"./D15pP43p.js";import"./B_m3Ck84.js";import"./DTe9xx4m.js";import"./Beg2b42J.js";import"./B0IxRygJ.js";import"./DKETEyTG.js";import"./D9fOi_Mf.js";import"./COd1z7Ka.js";import"./CXFWiv6o.js";import"./CfnjFqkD.js";import"./BiBQLpS5.js";import"./CqZJ2IID.js";import"./DcknbuxL.js";import"./i-OcCrcV.js";import"./CeE42oMv.js";import"./H0-YxZKq.js";const Ie={class:"random-numbers"},Ke={key:0,class:"error-message"},Le={__name:"ValidadorAutencidade",props:{show:Boolean},emits:["close","confirm"],setup(U,{emit:I}){const y=U,C=I,d=n(y.show),g=n([]),p=n(""),v=n("");function f(){g.value=[];for(let _=0;_<4;_++)g.value.push(Math.floor(Math.random()*10))}xe(()=>y.show,_=>{d.value=_,_&&(f(),p.value="",v.value="")});const $=()=>{d.value=!1,C("close")},M=()=>{p.value===g.value.join("")?(v.value="",d.value=!1,C("confirm")):v.value="Números digitados incorretos. Tente novamente."};return(_,u)=>(x(),ae(Ne,{persistent:"",modelValue:t(d),"onUpdate:modelValue":u[1]||(u[1]=q=>oe(d)?d.value=q:null),"max-width":"500"},{default:s(()=>[o(Te,null,{default:s(()=>[o(Fe,null,{default:s(()=>[m("div",null,[u[2]||(u[2]=m("p",null," Digite o código de validação para confirmar o ato de reconhecimento por autenticidade: ",-1)),m("div",Ie,[m("span",null,ee(t(g).join(" ")),1)]),o(D,{modelValue:t(p),"onUpdate:modelValue":u[0]||(u[0]=q=>oe(p)?p.value=q:null),label:"Digite os números",maxlength:"4",outlined:"",dense:"",onKeyup:Ce(M,["enter"])},null,8,["modelValue"]),t(v)?(x(),j("div",Ke,ee(t(v)),1)):se("",!0)])]),_:1}),o(Re,null,{default:s(()=>[o(W,{style:{"background-color":"red",color:"white"},onClick:$},{default:s(()=>u[3]||(u[3]=[B("Cancelar")])),_:1}),o(W,{style:{"background-color":"green",color:"white"},onClick:M},{default:s(()=>u[4]||(u[4]=[B("Validar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ze=be(Le,[["__scopeId","data-v-c978e7cc"]]),He=["onClick"],We={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:ne,alt:"Possui Ficha",title:"Possui Ficha"},Qe={key:1,style:{width:"30px",height:"30px",cursor:"pointer"},src:je,alt:"Visualizar",title:"Não Possui Ficha"},Je=["onClick"],Mo={__name:"autencidade",props:{ato_token:{type:String,required:!0}},emits:["ato-created"],async setup(U,{emit:I}){var X;let y,C;const d=U,g=I,p=$e(),v=qe(),f=Se(),{$toast:$}=Pe(),M=`${f.public.managemant}/listarEscrevente`,_=`${f.public.managemant}/pesquisarPessoas`,u=`${f.public.managemant}/atoReconhecimento`,q=`${f.public.managemant}/etiquetaAutenticidade`,le=`${f.public.managemant}/download`,re=`${f.public.envioDoc}/print`,S=n(E("user-data").value.cartorio_token),ie=n(E("user-service").value.token).value||n(E("user-service").value).value,ue=E("auth_token").value,K=n([]),Q=n([]),P=n([]),T=n(!1),L=n(!1),F=n(!1),R=n(null),J=n(null),Z=n(""),N=n(null),O=n(!1),Y=[{title:"Documento",align:"start",key:"documento"},{title:"Pessoa",align:"start",key:"nome"},{value:"actions"}],i=Ae({quantidade:1,escrevente:null,nome:null,documento:null}),{data:G}=([y,C]=Ee(()=>V(M,{method:"POST",body:{cartorio_token:S}},"$qpB20nOlUE")),y=await y,C(),y);Q.value=Array.isArray(G.value)&&((X=G.value[0])==null?void 0:X.func_json_escreventes)||[];async function ce(){try{const{data:a,error:e}=await V(_,{method:"POST",body:{cartorio_token:S.value,documento:i.documento,nome:i.nome}},"$CfpM9wZnUE");a.value.length>0?(g("ato-created"),K.value=a.value):K.value=[]}catch(a){console.error("Erro na requisição",a)}}const me=()=>{L.value=!0};function de(a){P.value.push(a)}const pe=async a=>{R.value=a,F.value=!0;const{data:e}=await V(le,{method:"POST",body:{bucket:E("user-data").value.cartorio_token,path:a.link_ficha}},"$LrKAtpxZwH");J.value=e.value};function ve(a){P.value=P.value.filter(e=>e.token!==a.token)}function fe(){return new Promise(a=>{N.value=a,O.value=!0})}async function _e(){O.value=!1;try{await ke()}finally{N.value&&(N.value(),N.value=null)}}async function ke(){var a,e,A;if(!i.escrevente)throw $.error("Por favor selecione um Escrevente"),new Error("Escrevente não selecionado");try{const k=P.value.map(h=>({pessoa_token:h.token})),{data:r,error:c,status:H}=await V(u,{method:"POST",body:{pessoas:k,cartorio_token:S.value,ordemserv_token:ie,quantidade:i.quantidade,usuario_token:ue,ato_tipo_token:d.ato_token}},"$EE94jKo1pQ");if(H.value==="success"&&r.value[0].status==="OK"){if(r.value[0].livro&&r.value[0].livro!==null){const h=window.open("","_blank");h.document.open(),h.document.write(r.value[0].livro),h.document.close()}console.log("Mostrando Livro"),ye(r.value[0].token),w()}else w(),T.value=!0,Z.value=Array.isArray(r.value)&&((a=r.value[0])==null?void 0:a.status_mensagem)||((A=(e=c==null?void 0:c.value)==null?void 0:e.data)==null?void 0:A.details)||"Não foi possível concluir o reconhecimento"}catch(k){w(),T.value=!0,Z.value=k,console.error("Erro na requisição",k)}}async function ye(a){try{console.log("Reconhecimento de Etiqueta");const{data:e,error:A,status:k}=await V(q,{method:"POST",body:{ato_token:a,cartorio_token:S.value,escrevente_token:i.escrevente}},"$KyoIzBxZyr");if(k.value==="success"){const r=Array.isArray(e.value)?e.value[0]:null;if(!r)return;if(r.tipo_etiqueta==="html"){console.log("Abrindo Etiqueta HTML");const c=window.open("","_blank");c.document.open(),c.document.write(r.etiqueta),c.document.close()}else if(r.tipo_etiqueta==="zpl"){const{status:c}=await V(`${re}`,{method:"POST",body:{zpl:atob(r.etiqueta)}},"$Vem9mHWYqw");if(c.value!=="success"){w(),$.error("Não foi possivel fazer a impressao da etiqueta");return}}}}catch(e){w(),$.error("Erro ao reconhecer a etiqueta"),console.error("Erro na requisição",e)}}const w=()=>{const a=v.query.origem||"criar",e=v.query.id;a==="atualizar"?p.push(`/os/atualizar/${e}`):p.push("/os/criar-registro")};return(a,e)=>{const A=ge,k=we,r=Ve,c=Ze,H=Oe,h=ze;return x(),j(Me,null,[o(z,{class:"mt-5"},{default:s(()=>[o(b,{cols:"5"},{default:s(()=>[o(Ue,{label:"Tabelião/escrevente",modelValue:t(i).escrevente,"onUpdate:modelValue":e[0]||(e[0]=l=>t(i).escrevente=l),items:t(Q),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"])]),_:1}),o(b,{cols:"2"},{default:s(()=>[o(D,{label:"Quantidade",type:"number",modelValue:t(i).quantidade,"onUpdate:modelValue":e[1]||(e[1]=l=>t(i).quantidade=l)},null,8,["modelValue"])]),_:1})]),_:1}),o(z,null,{default:s(()=>[o(b,{cols:"3"},{default:s(()=>[o(D,{label:"Documento",modelValue:t(i).documento,"onUpdate:modelValue":e[2]||(e[2]=l=>t(i).documento=l)},null,8,["modelValue"])]),_:1}),o(b,{cols:"4"},{default:s(()=>[o(D,{label:"Pessoa",modelValue:t(i).nome,"onUpdate:modelValue":e[3]||(e[3]=l=>t(i).nome=l)},null,8,["modelValue"])]),_:1}),m("div",null,[m("img",{class:"btn-pointer mt-1",src:ne,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:ce})]),m("div",null,[m("img",{class:"btn-pointer mt-1 ml-2",src:De,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:me})])]),_:1}),o(z,null,{default:s(()=>[o(b,{class:"mr-10"},{default:s(()=>[o(te,{style:{height:"465px"},headers:Y,items:t(K)},{"item.actions":s(({item:l})=>[m("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:he=>pe(l),title:"Visualizar Ficha"},[l.link_ficha?(x(),j("img",We)):(x(),j("img",Qe))],8,He)]),_:1},8,["items"])]),_:1}),o(b,null,{default:s(()=>[o(te,{headers:Y,items:t(P),style:{height:"465px"},"item-key":"id"},{"item.actions":s(({item:l})=>[m("div",{style:{display:"flex","justify-content":"flex-end"},onClick:he=>ve(l),title:"Remover"},e[9]||(e[9]=[m("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:Be,alt:"Remover"},null,-1)]),8,Je)]),_:1},8,["items"])]),_:1})]),_:1}),o(A,{show:t(L),onClose:e[4]||(e[4]=l=>L.value=!1)},null,8,["show"]),t(F)?(x(),ae(k,{key:0,show:t(F),item:t(R),"pessoa-obj":t(R),"link-view":t(J),onConfirmar:e[5]||(e[5]=l=>de(t(R))),onClose:e[6]||(e[6]=l=>F.value=!1)},null,8,["show","item","pessoa-obj","link-view"])):se("",!0),o(r,{show:t(T),errorMessage:t(Z),onClose:e[7]||(e[7]=l=>T.value=!1)},null,8,["show","errorMessage"]),o(c,{show:t(O),onClose:e[8]||(e[8]=l=>O.value=!1),onConfirm:_e},null,8,["show"]),o(z,null,{default:s(()=>[o(H,{onClick:w},{default:s(()=>[o(W,{size:"large",color:"red"},{default:s(()=>e[10]||(e[10]=[B("Voltar")])),_:1})]),_:1}),o(h,{onSave:fe,class:"ml-5",size:"large",color:"green"},{default:s(()=>e[11]||(e[11]=[B("Salvar")])),_:1})]),_:1})],64)}}};export{Mo as default};
