import{_ as ke}from"./VyiJpgDY.js";import{_ as ge}from"./CicUCV1v.js";import{_ as Ve}from"./CErUMR8k.js";import{_ as he,r as l,g as we,o as h,p as G,w as s,b as o,a as c,t as H,q as t,C as O,s as Q,Y as ye,c as z,A as J,V as N,d as R,L as be,P as Ce,u as xe,m as x,n as $e,G as qe,F as Pe,v as Me}from"./B2VtM2rW.js";import{V as Te,a as Fe,c as Ae}from"./LHNS4Z4N.js";import{V as Ee}from"./_BT7bE8n.js";import{_ as Se}from"./BctZgZx-.js";import{_ as X}from"./rq1FF7Er.js";import{_ as Oe}from"./BVz1G1IN.js";import{_ as ze}from"./BLUZo0Qf.js";import{a as Ne}from"./DJvq3mCv.js";import{u as g}from"./CHCsbJ5v.js";import{V as S}from"./CKJp8KVK.js";import{V}from"./BWDM5pjC.js";import{V as Re}from"./CtpVxkyR.js";import{V as Y}from"./DRPx7C5b.js";import"./D9lSe22M.js";import"./KEEwv0yT.js";import"./ofnURvvQ.js";import"./BB7DuAK_.js";import"./B0IxRygJ.js";import"./Dv6nqkSV.js";import"./BcGgCMWD.js";import"./BeJLNKl7.js";import"./C5kxU3lb.js";import"./Cd2jDOOI.js";import"./SaEGSYn3.js";import"./CP1ABfly.js";import"./DbXmQOS5.js";const De={class:"random-numbers"},je={key:0,class:"error-message"},Be={__name:"ValidadorAutencidade",props:{show:Boolean},emits:["close","confirm"],setup(D,{emit:j}){const _=D,w=j,d=l(_.show),k=l([]),m=l(""),p=l("");function v(){k.value=[];for(let f=0;f<4;f++)k.value.push(Math.floor(Math.random()*10))}we(()=>_.show,f=>{d.value=f,f&&(v(),m.value="",p.value="")});const $=()=>{d.value=!1,w("close")},q=()=>{m.value===k.value.join("")?(p.value="",d.value=!1,w("confirm")):p.value="Números digitados incorretos. Tente novamente."};return(f,u)=>(h(),G(Ee,{persistent:"",modelValue:t(d),"onUpdate:modelValue":u[1]||(u[1]=y=>Q(d)?d.value=y:null),"max-width":"500"},{default:s(()=>[o(Te,null,{default:s(()=>[o(Fe,null,{default:s(()=>[c("div",null,[u[2]||(u[2]=c("p",null," Digite o código de validação para confirmar o ato de reconhecimento por autenticidade: ",-1)),c("div",De,[c("span",null,H(t(k).join(" ")),1)]),o(O,{modelValue:t(m),"onUpdate:modelValue":u[0]||(u[0]=y=>Q(m)?m.value=y:null),label:"Digite os números",maxlength:"4",outlined:"",dense:"",onKeyup:ye(q,["enter"])},null,8,["modelValue"]),t(p)?(h(),z("div",je,H(t(p)),1)):J("",!0)])]),_:1}),o(Ae,null,{default:s(()=>[o(N,{style:{"background-color":"red",color:"white"},onClick:$},{default:s(()=>u[3]||(u[3]=[R("Cancelar")])),_:1}),o(N,{style:{"background-color":"green",color:"white"},onClick:q},{default:s(()=>u[4]||(u[4]=[R("Validar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ue=he(Be,[["__scopeId","data-v-c978e7cc"]]),Ie=["onClick"],Ke={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:X,alt:"Possui Ficha",title:"Possui Ficha"},Ze={key:1,style:{width:"30px",height:"30px",cursor:"pointer"},src:ze,alt:"Visualizar",title:"Não Possui Ficha"},Le=["onClick"],bo={__name:"autencidade",props:{ato_token:{type:String,required:!0}},emits:["ato-created"],async setup(D,{emit:j}){let _,w;const d=D,k=j,m=be(),p=Ce(),v=Me(),{$toast:$}=xe(),q=`${v.public.managemant}/listarEscrevente`,f=`${v.public.managemant}/pesquisarPessoas`,u=`${v.public.managemant}/atoReconhecimento`,y=`${v.public.managemant}/etiquetaAutenticidade`,ee=`${v.public.managemant}/download`,oe=`${v.public.envioDoc}/print`,P=l(x("user-data").value.cartorio_token),te=l(x("user-service").value.token).value||l(x("user-service").value).value,ae=x("auth_token").value,B=l([]),K=l([]),b=l([]),M=l(!1),U=l(!1),T=l(!1),F=l(null),Z=l(null),I=l(""),A=l(!1),L=[{title:"Documento",align:"start",key:"documento"},{title:"Pessoa",align:"start",key:"nome"},{value:"actions"}],r=$e({quantidade:1,escrevente:null,nome:null,documento:null}),{data:se}=([_,w]=qe(()=>g(q,{method:"POST",body:{cartorio_token:P}},"$qpB20nOlUE")),_=await _,w(),_);K.value=se.value[0].func_json_escreventes;async function ne(){try{const{data:a,error:e}=await g(f,{method:"POST",body:{cartorio_token:P.value,documento:r.documento,nome:r.nome}},"$CfpM9wZnUE");a.value.length>0?(k("ato-created"),B.value=a.value):B.value=[]}catch(a){console.error("Erro na requisição",a)}}const le=()=>{U.value=!0};function re(a){b.value.push(a)}const ie=async a=>{F.value=a,T.value=!0;const{data:e}=await g(ee,{method:"POST",body:{bucket:x("user-data").value.cartorio_token,path:a.link_ficha}},"$LrKAtpxZwH");Z.value=e.value};function ue(a){b.value=b.value.filter(e=>e.token!==a.token)}function ce(){A.value=!0}function de(){A.value=!1,me()}async function me(){if(!r.escrevente){$.error("Por favor selecione um Escrevente");return}try{const a=b.value.map(i=>({pessoa_token:i.token})),{data:e,error:E,status:C}=await g(u,{method:"POST",body:{pessoas:a,cartorio_token:P.value,ordemserv_token:te,quantidade:r.quantidade,usuario_token:ae,ato_tipo_token:d.ato_token}},"$EE94jKo1pQ");if(C.value==="success"&&e.value[0].status==="OK"){if(e.value[0].livro&&e.value[0].livro!==null){console.log("############################ livro valido");const i=window.open("","_blank");i.document.open(),i.document.write(e.value[0].livro),i.document.close()}pe(e.value[0].token),W()}else M.value=!0,I.value=ato_token.value.status_mensagem||E.value.data.details}catch(a){M.value=!0,I.value=a,console.error("Erro na requisição",a)}}async function pe(a){try{const{data:e,error:E,status:C}=await g(y,{method:"POST",body:{ato_token:a,cartorio_token:P.value,escrevente_token:r.escrevente}},"$KyoIzBxZyr");if(C.value==="success"){if(e.value[0].tipo_etiqueta==="html"){const i=window.open("","_blank");i.document.open(),i.document.write(e.value[0].etiqueta),i.document.close()}else if(e.value[0].tipo_etiqueta==="zpl"){const{status:i}=await g(`${oe}`,{method:"POST",body:{zpl:atob(e.value[0].etiqueta)}},"$Vem9mHWYqw");if(i.value!=="success"){$.error("Não foi possivel fazer a impressao da etiqueta");return}}}}catch(e){console.error("Erro na requisição",e)}}const W=()=>{const a=p.query.origem||"criar",e=p.query.id;a==="atualizar"?m.push(`/os/atualizar/${e}`):m.push("/os/criar-registro")};return(a,e)=>{const E=ke,C=ge,i=Ve,ve=Ue,fe=Se;return h(),z(Pe,null,[o(S,{class:"mt-5"},{default:s(()=>[o(V,{cols:"5"},{default:s(()=>[o(Re,{label:"Tabelião/escrevente",modelValue:t(r).escrevente,"onUpdate:modelValue":e[0]||(e[0]=n=>t(r).escrevente=n),items:t(K),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"])]),_:1}),o(V,{cols:"2"},{default:s(()=>[o(O,{label:"Quantidade",type:"number",modelValue:t(r).quantidade,"onUpdate:modelValue":e[1]||(e[1]=n=>t(r).quantidade=n)},null,8,["modelValue"])]),_:1})]),_:1}),o(S,null,{default:s(()=>[o(V,{cols:"3"},{default:s(()=>[o(O,{label:"Documento",modelValue:t(r).documento,"onUpdate:modelValue":e[2]||(e[2]=n=>t(r).documento=n)},null,8,["modelValue"])]),_:1}),o(V,{cols:"4"},{default:s(()=>[o(O,{label:"Pessoa",modelValue:t(r).nome,"onUpdate:modelValue":e[3]||(e[3]=n=>t(r).nome=n)},null,8,["modelValue"])]),_:1}),c("div",null,[c("img",{class:"btn-pointer mt-1",src:X,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:ne})]),c("div",null,[c("img",{class:"btn-pointer mt-1 ml-2",src:Oe,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:le})])]),_:1}),o(S,null,{default:s(()=>[o(V,{class:"mr-10"},{default:s(()=>[o(Y,{style:{height:"465px"},headers:L,items:t(B)},{"item.actions":s(({item:n})=>[c("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:_e=>ie(n),title:"Visualizar Ficha"},[n.link_ficha?(h(),z("img",Ke)):(h(),z("img",Ze))],8,Ie)]),_:1},8,["items"])]),_:1}),o(V,null,{default:s(()=>[o(Y,{headers:L,items:t(b),style:{height:"465px"},"item-key":"id"},{"item.actions":s(({item:n})=>[c("div",{style:{display:"flex","justify-content":"flex-end"},onClick:_e=>ue(n),title:"Remover"},e[9]||(e[9]=[c("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:Ne,alt:"Remover"},null,-1)]),8,Le)]),_:1},8,["items"])]),_:1})]),_:1}),o(E,{show:t(U),onClose:e[4]||(e[4]=n=>U.value=!1)},null,8,["show"]),t(T)?(h(),G(C,{key:0,show:t(T),item:t(F),"pessoa-obj":t(F),"link-view":t(Z),onConfirmar:e[5]||(e[5]=n=>re(t(F))),onClose:e[6]||(e[6]=n=>T.value=!1)},null,8,["show","item","pessoa-obj","link-view"])):J("",!0),o(i,{show:t(M),errorMessage:t(I),onClose:e[7]||(e[7]=n=>M.value=!1)},null,8,["show","errorMessage"]),o(ve,{show:t(A),onClose:e[8]||(e[8]=n=>A.value=!1),onConfirm:de},null,8,["show"]),o(S,null,{default:s(()=>[o(fe,{onClick:W},{default:s(()=>[o(N,{size:"large",color:"red"},{default:s(()=>e[10]||(e[10]=[R("Voltar")])),_:1})]),_:1}),o(N,{class:"ml-5",onClick:ce,size:"large",color:"green"},{default:s(()=>e[11]||(e[11]=[R("Salvar")])),_:1})]),_:1})],64)}}};export{bo as default};
