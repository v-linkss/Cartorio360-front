import{_ as se}from"./DzodBXVr.js";import{_ as re}from"./C1LUWoP8.js";import{c as ue,r as ie,u as de}from"./D5AURBFW.js";import{r as u,m as g,C as Y,g as me,o as T,E as G,w as s,b as o,a as i,t as J,d as I,v as t,z as L,I as ce,s as X,u as pe,B as _e,n as ve,D as fe,V as c,x as F,y as j,c as K}from"./2k1OG2be.js";import{u as C}from"./BfC1W_vO.js";import{a as W,c as Ve,V as be}from"./DYLGoNUO.js";import{V as P}from"./CDrJLU9K.js";import{V as $}from"./CJG1SXhp.js";import{V as ke}from"./FsvFKtXb.js";import{_ as ge}from"./BVz1G1IN.js";import{_ as ye}from"./DuZSbDVd.js";import{_ as xe}from"./BAk91-bp.js";import{_ as Ce,a as Se,b as he}from"./BmSnlvkJ.js";import{_ as Oe}from"./CdP3NN9a.js";import{V as d}from"./CQWWYt0l.js";import{V as M}from"./B2iGOswU.js";import{V as $e}from"./BSaZDp9i.js";import"./mIwvMMMU.js";import"./Cy0AwNjf.js";import"./C3w2BmkS.js";import"./Dwy3Riue.js";import"./BlPBofm_.js";const we={style:{color:"red","margin-left":"18px"}},Ue={class:"mb-5",style:{display:"flex","justify-content":"flex-start"}},De={class:"ml-6"},Ae={class:"ml-6"},Te={__name:"Ordem",props:{show:Boolean,numero_os:Number,ordemserv_token:String},emits:["close"],setup(R,{emit:S}){const b=R,k=u(b.show),h=X();u(g("user-data").value.cartorio_token).value;const N=g("auth_token").value,q=`${h.public.managemant}/analisaCancelamento`,O=`${h.public.managemant}/cancelaOs`,p=Y({motivo:null}),_=u(null),w=S,U={motivo:{required:ue.withMessage("O campo é obrigatorio",ie)}},y=de(U,p);me(()=>b.show,v=>{k.value=v});const x=()=>{k.value=!1,w("close")};(async()=>{const{data:v,error:r}=await C(`${q}`,{method:"POST",body:{ordemserv_token:b.ordemserv_token}},"$1fnrIk2fgs");_.value=v.value.mensagem})();const A=async()=>{if(await y.value.$validate()){const{status:v}=await C(`${O}`,{method:"POST",body:{usuario_token:N,motivo:p.motivo,ordemserv_token:b.ordemserv_token}},"$21WlhUNXeM");v.value==="success"&&(window.location.reload(),x())}};return(v,r)=>(T(),G(be,{persistent:"",modelValue:t(k),"onUpdate:modelValue":r[1]||(r[1]=f=>ce(k)?k.value=f:null),"max-width":"650"},{default:s(()=>[o(W,null,{default:s(()=>[o(P,null,{default:s(()=>[o($,{class:"mb-5 mt-1 ml-2"},{default:s(()=>[r[2]||(r[2]=i("h1",null,"Cancelamento da OS nº",-1)),i("h1",we,J(b.numero_os),1)]),_:1}),o(P,null,{default:s(()=>[o(W,{variant:"outlined",class:"mb-5"},{default:s(()=>[o(Ve,null,{default:s(()=>[I(J(t(_)),1)]),_:1})]),_:1}),o(ke,{label:"Motivo",modelValue:t(p).motivo,"onUpdate:modelValue":r[0]||(r[0]=f=>t(p).motivo=f),required:"","error-messages":t(y).motivo.$errors.map(f=>f.$message),onBlur:t(y).motivo.$touch,onInput:t(y).motivo.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1})]),_:1}),i("div",Ue,[i("div",De,[o(L,{size:"large",color:"red",onClick:x},{default:s(()=>r[3]||(r[3]=[I("Fechar")])),_:1})]),i("div",Ae,[o(L,{size:"large",color:"green",onClick:A},{default:s(()=>r[4]||(r[4]=[I("Salvar")])),_:1})])])]),_:1})]),_:1},8,["modelValue"]))}},Ne=["title","onClick"],qe=["onClick","title"],Be=["disabled","onClick"],Ie={key:0,style:{width:"30px",height:"30px"},src:Se,alt:"Visualizar",title:"Bloqueado"},Me={key:1,src:he,alt:"Cancelamento",class:"trash-icon",style:{width:"30px",height:"30px",cursor:"pointer"},title:"Cancelamento"},sa={__name:"index",setup(R){const S=X(),{$toast:b}=pe(),k=`${S.public.managemant}/listarUsuarios`,h=`${S.public.managemant}/listarOrdensServico`,N=`${S.public.managemant}/tipoAtos`,q=_e(),O=u(g("auth_token").value)||null,p=u(g("user-data").value.cartorio_token)||null,_=u([]),w=u([]),U=u([]),y=u(["PENDENTE","EM ANDAMENTO","CONCLUÍDA","LAVRADA"]),x=u(!1),D=u(!1),A=u(null),v=u(null),r=u(null),f=u({}),l=Y({numero:null,data_inicio:B(),data_fim:B(),data_lavratura_inicio:null,data_lavratura_fim:null,protocolo:null,livro:null,folha:null,situacao:null,usuario_token:O.value,selo:null,ato_tipo_token:null,apresentante:null}),Z=[{title:"Data Recebimento",value:"data"},{title:"Número",value:"numero"},{title:"Situação",value:"situacao"},{title:"CPF",value:"apresentante_cpf"},{title:"Apresentante",value:"apresentante_nome"},{title:"Usuario",value:"usuario_nome"},{title:"Valor",value:"valor"},{value:"actions"}];function B(){const n=new Date,e=n.getFullYear(),m=String(n.getMonth()+1).padStart(2,"0"),V=String(n.getDate()).padStart(2,"0");return`${e}-${m}-${V}`}async function H(){const{data:n,error:e}=await C(k,{method:"POST",body:{cartorio_token:p.value}},"$pAAptWJdb1");w.value=n.value}async function Q(){try{sessionStorage.setItem("pesquisaOS",JSON.stringify(l));const{data:n,error:e}=await C(h,{method:"POST",body:{cartorio_token:p.value,numero:l.numero||null,data_inicio:l.data_inicio||null,data_fim:l.data_fim||null,data_lavratura_inicio:l.data_lavratura_inicio||null,data_lavratura_fim:l.data_lavratura_fim||null,protocolo:l.protocolo||null,livro:l.livro||null,folha:l.folha||null,situacao:l.situacao||null,usuario_token:l.usuario_token,selo:l.selo||null,ato_tipo_token:l.ato_tipo_token,apresentante:l.apresentante||null}},"$IO02J210Z9");n.value.length>0?_.value=n.value:(_.value=[],b.error("Não existe Ordem de Serviço Registrada!"))}catch(n){console.error("Erro na requisição",n)}}async function ee(){const{data:n,error:e}=await C(N,{method:"POST",body:{cartorio_token:p.value,usuario_token:O.value}},"$YgUhKRJlsV");U.value=n.value}const ae=async()=>{try{const n=B(),e=sessionStorage.getItem("pesquisaOS"),m=JSON.parse(e),{data:V,error:E}=await C(h,{method:"POST",body:{cartorio_token:p.value,usuario_token:O.value,data_fim:(m==null?void 0:m.data_fim)||n,data_inicio:(m==null?void 0:m.data_inicio)||n}},"$xKnfARCL4G");V.value.length>0?_.value=V.value.map(a=>({...a,data:Oe(a.data,"dd/mm/yyyy")})):_.value=[]}catch(n){console.error("Erro ao buscar serviços",n)}};H(),ee();function oe(n){r.value=n.numero,v.value=n.token,D.value=!0}function te(n){const e=g("user-service"),m=_.value.find(V=>V.id===n);e.value=e.value=JSON.stringify({id:m.id,token:m.token}),q.push({path:`/os/atualizar/${n}`})}function le(n,e){r.value=n,f.value={token:e.token,numero:e.numero,valor:e.valor,valor_pago:e.valor_pago},x.value=!0}const ne=()=>{const n=g("user-service"),e=g("ordem-button");n.value=null,A.value=!0,e.value=A.value};return ve(()=>{fe(async()=>{const n=sessionStorage.getItem("pesquisaOS");if(n){const e=JSON.parse(n);Object.assign(l,e)}await ae()})}),(n,e)=>{const m=se,V=re,E=Te;return T(),G(P,{class:"mt-5"},{default:s(()=>[o($,{class:"mb-5"},{default:s(()=>[e[15]||(e[15]=i("h1",null,"Ordens de Serviço",-1)),o(m,{to:"/os/criar-registro"},{default:s(()=>[i("img",{style:{width:"60px",height:"60px",cursor:"pointer","margin-left":"70px"},src:ge,alt:"novo",onClick:ne})]),_:1})]),_:1}),o($,{style:{"margin-bottom":"-35px"}},{default:s(()=>[o(d,null,{default:s(()=>[o(c,{modelValue:t(l).numero,"onUpdate:modelValue":e[0]||(e[0]=a=>t(l).numero=a),label:"Número"},null,8,["modelValue"])]),_:1}),o(d,null,{default:s(()=>[o(c,{modelValue:t(l).data_inicio,"onUpdate:modelValue":e[1]||(e[1]=a=>t(l).data_inicio=a),type:"date",label:"Abertura de",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),o(d,null,{default:s(()=>[o(c,{modelValue:t(l).data_fim,"onUpdate:modelValue":e[2]||(e[2]=a=>t(l).data_fim=a),type:"date",label:"Abertura até",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),o(d,null,{default:s(()=>[o(c,{modelValue:t(l).data_lavratura_inicio,"onUpdate:modelValue":e[3]||(e[3]=a=>t(l).data_lavratura_inicio=a),type:"date",label:"Lavratura de",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),o(d,null,{default:s(()=>[o(c,{modelValue:t(l).data_lavratura_fim,"onUpdate:modelValue":e[4]||(e[4]=a=>t(l).data_lavratura_fim=a),type:"date",label:"Lavratura até",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),o(d,null,{default:s(()=>[o(c,{modelValue:t(l).protocolo,"onUpdate:modelValue":e[5]||(e[5]=a=>t(l).protocolo=a),label:"Protocolo"},null,8,["modelValue"])]),_:1}),o(d,{md:"1"},{default:s(()=>[o(c,{modelValue:t(l).livro,"onUpdate:modelValue":e[6]||(e[6]=a=>t(l).livro=a),label:"Livro"},null,8,["modelValue"])]),_:1}),o(d,{md:"1"},{default:s(()=>[o(c,{modelValue:t(l).folha,"onUpdate:modelValue":e[7]||(e[7]=a=>t(l).folha=a),label:"Folha"},null,8,["modelValue"])]),_:1})]),_:1}),o($,null,{default:s(()=>[o(d,{md:"3"},{default:s(()=>[o(M,{modelValue:t(l).situacao,"onUpdate:modelValue":e[8]||(e[8]=a=>t(l).situacao=a),items:t(y),label:"Situação"},null,8,["modelValue","items"])]),_:1}),o(d,{md:"2"},{default:s(()=>[o(M,{items:t(w),modelValue:t(l).usuario_token,"onUpdate:modelValue":e[9]||(e[9]=a=>t(l).usuario_token=a),"item-title":"user_nome","item-value":"user_token",label:"Usuario"},null,8,["items","modelValue"])]),_:1}),o(d,{md:"1"},{default:s(()=>[o(c,{modelValue:t(l).selo,"onUpdate:modelValue":e[10]||(e[10]=a=>t(l).selo=a),label:"Selo"},null,8,["modelValue"])]),_:1}),o(d,{md:"3"},{default:s(()=>[o(M,{modelValue:t(l).ato_tipo_token,"onUpdate:modelValue":e[11]||(e[11]=a=>t(l).ato_tipo_token=a),items:t(U),"item-title":"descricao","item-value":"token",label:"Serviço"},null,8,["modelValue","items"])]),_:1}),o(d,{md:"2"},{default:s(()=>[o(c,{modelValue:t(l).apresentante,"onUpdate:modelValue":e[12]||(e[12]=a=>t(l).apresentante=a),label:"Apresentante"},null,8,["modelValue"])]),_:1}),o(d,null,{default:s(()=>[i("div",null,[i("img",{onClick:Q,style:{width:"40px",height:"40px",cursor:"pointer"},src:ye,alt:"Pesquisar"})])]),_:1})]),_:1}),e[16]||(e[16]=i("hr",{class:"mt-5 mb-5"},null,-1)),o($e,{headers:Z,items:t(_),"item-key":"id"},{"item.actions":s(({item:a})=>[o($,{style:{display:"flex",gap:"10px","margin-top":"-5px"}},{default:s(()=>[i("div",{class:j({disabled:!a.btn_receber}),title:a.btn_receber?"Receber":"Bloqueado",onClick:z=>a.btn_receber?le(a.numero,a):null},[i("img",{style:F({cursor:a.btn_receber?"pointer":"default",width:"30px",height:"30px"}),src:xe,alt:"Receber"},null,4)],10,Ne),i("div",{class:j({disabled:!a.btn_editar}),onClick:z=>a.btn_editar?te(a.id):null,title:a.btn_editar?"Editar":"Bloqueado"},[i("img",{style:F({cursor:a.btn_editar?"pointer":"default",width:"30px",height:"30px"}),src:Ce,alt:"Editar"},null,4)],10,qe),i("div",{disabled:!a.btn_cancelar,onClick:z=>a.btn_cancelar?oe(a):null,title:"Cancelamento"},[a.excluido?(T(),K("img",Ie)):(T(),K("img",Me))],8,Be)]),_:2},1024)]),_:1},8,["items"]),o(V,{show:t(x),numero_os:t(r),ordem:t(f),onClose:e[13]||(e[13]=a=>x.value=!1)},null,8,["show","numero_os","ordem"]),o(E,{show:t(D),numero_os:t(r),ordemserv_token:t(v),onClose:e[14]||(e[14]=a=>D.value=!1)},null,8,["show","numero_os","ordemserv_token"])]),_:1})}}};export{sa as default};
