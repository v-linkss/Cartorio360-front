import{_ as pe}from"./CQV2caZ7.js";import{_ as me,a as ce}from"./CHXtduJ1.js";import{m as ve,G as _e,r as u,u as r,H as fe,n as ge,M as be,p as g,w as i,q as ke,o as m,b as n,a as l,t as Ve,s as o,N as ye,V as D,K as L,E as xe,D as Ce,c as H,v as he,d as $e}from"./CXy-O3pO.js";import{_ as we}from"./DEQeS9HP.js";import{_ as Oe}from"./BVz1G1IN.js";import{_ as Se}from"./BWhwCx-u.js";import{_ as De}from"./NBfHJzEc.js";import{_ as Te,a as Ee}from"./DJvq3mCv.js";import{c as G,r as J,u as Ae}from"./DLasD2s_.js";import{u as T}from"./D9ECQSBA.js";import"./BrXkLNsI.js";import{f as Ne}from"./Pbd_Wvg0.js";import{V as Re}from"./DNIXRYd8.js";import{V as x}from"./fA9_M00z.js";import{V as C}from"./BxTbtGjW.js";import{V as qe}from"./3l9EdeBY.js";import{V as Be}from"./BOxfJ-8N.js";import"./CEpqj5as.js";import"./BK9WUwmv.js";import"./BpyMifUh.js";import"./DxXiLqnm.js";import"./B0Yjsr4p.js";import"./BFhcHmwz.js";const ze={style:{color:"red","margin-left":"30px"}},Fe=["onClick"],Pe=["onClick","title"],Ie=["disabled","onClick"],Ue={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:Te,alt:"Visualizar",title:"Reativar"},Me={key:1,src:Ee,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px",cursor:"pointer"},title:"Excluir"},ca={__name:"criar-registro",async setup(Le){var B,z,F,P,I,U,M;let b,E;const{$toast:v}=ve(),A=_e(),k=ke(),W=`${k.public.managemant}/createOrdensServico`,j=`${k.public.managemant}/validarCpf`,K=`${k.public.managemant}/listarAtos`,X=`${k.public.managemant}/updateAtos`,Q=u(r("user-data").value.cartorio_id),Y=u(r("user-data").value.usuario_id),Z=u((B=r("user-service").value)==null?void 0:B.token).value||null,ee=u(r("user-data").value.cartorio_token).value,V=u((z=r("user-service").value)==null?void 0:z.numero),y=u((F=r("user-service").value)==null?void 0:F.isDisabled);let N=u(!!((P=r("user-service").value)!=null&&P.numero)),h=u(r("ordem-button").value),$=!1;const w=u(!1),O=u([]),s=fe({nacionalidade:((I=r("user-service").value)==null?void 0:I.estrangeiro)||!1,apresentante_nome:(U=r("user-service").value)==null?void 0:U.apresentante_nome,apresentante_cpf:(M=r("user-service").value)==null?void 0:M.apresentante_cpf}),_=u(!1),ae=[{title:"ID",value:"id"},{title:"Protocolo",value:"protocolo"},{title:"Usuario",value:"usuario_nome"},{title:"Situação",value:"situacao"},{title:"Valor",value:"valor"},{title:"Tipo",value:"tipo"},{value:"actions"}],te=[{title:"BRASILEIRO",value:!1},{title:"ESTRANGEIRO",value:!0}],oe={apresentante_nome:{required:G.withMessage("O campo é obrigatorio",J)},apresentante_cpf:{required:G.withMessage("O campo é obrigatorio",J)}},p=Ae(oe,s);function R(t){if(t)return t.replace(/[.\-]/g,"");t=null}const re=t=>{(t.rota==="/fontes/atos/ato-com-bem/geral"||t.rota==="/fontes/atos/ato-sem-bem/geral")&&A.push({path:`/fontes/atos/atos-com-bem/atualizar/${t.id}`,query:{origem:"atualizar",id:r("user-service").value.id,ato_id:t.id,tipo_ato:t.tipo,tipo_ato_token:t.tipo_token,ato_token_edit:t.token,numero_os:V}})},se=t=>{(t.usa_imoveis||!t.usa_imoveis)&&A.push({path:`/fontes/atos/atos-com-bem/atualizar/${t.id}`,query:{origem:"atualizar",id:r("user-service").value.id,ato_id:t.id,tipo_ato:t.tipo,tipo_ato_token:t.tipo_token,ato_token_edit:t.token,numero_os:V.value}})};function ie(){const t=r("user-service"),e=r("ordem-button");t.value=null,e.value=null}const ne=()=>{w.value=!0};async function le(){const t={apresentante_cpf:R(s.apresentante_cpf),apresentante_nome:s.apresentante_nome,user_id:Y.value,cartorio_id:Q.value,estrangeiro:s.nacionalidade};if(await p.value.$validate()){const{data:e,error:c,status:d}=await T(W,{method:"POST",body:t},"$HqnOwnLBio");if(d.value==="error"&&c.value.statusCode===500)v.error("Erro ao cadastrar ordem,erro no sistema.");else{v.success("Ordem registrada com sucesso!"),N.value=!0,h.value=!1,V.value=e.value.numero;const f=r("ordem-button");f.value=h.value;const a=r("user-service");a.value=a.value=JSON.stringify({numero:e.value.numero,id:e.value.id,apresentante_cpf:e.value.apresentante_cpf,apresentante_nome:e.value.apresentante_nome,estrangeiro:e.value.estrangeiro,token:e.value.token,isDisabled:!0}),_.value=!0}}}async function ue(t){const e=R(t);if(e.length===11&&!$){$=!0;const c={cpf:e};try{const{data:d,error:f,status:a}=await T(j,{method:"POST",body:c},"$DfuVr7OuaN");a.value==="error"&&f.value.statusCode===500?v.error("Erro ao cadastrar pessoa, o CPF já está cadastrado."):d.value.cpfValidation===!0?(s.apresentante_nome=d.value.nome,v.success("Cpf autenticado com sucesso!")):d.value.cpfValidation===!1&&v.error("Cpf não cadastrado!")}catch(d){console.error("Erro ao validar CPF:",d)}finally{$=!1}}}async function de(t){t.excluido=!t.excluido;try{await Ne(`${X}/${t.id}`,{method:"PUT",body:{excluido:t.excluido}})}catch(e){console.error("Erro ao excluir pessoa:",e)}}const{data:q}=([b,E]=ge(()=>T(K,{method:"POST",body:{cartorio_token:ee,ordemserv_token:Z}},"$bJ1XcDsWLH")),b=await b,E(),b);return q.value.length>0?O.value=q.value:O.value=[],(t,e)=>{const c=pe,d=ce,f=be("mask");return m(),g(Re,{class:"mt-5"},{default:i(()=>[n(x,{class:"mb-5"},{default:i(()=>{var a;return[e[8]||(e[8]=l("h1",null,"Ordem de Serviço nº",-1)),l("h1",ze,Ve(o(V)||((a=("useCookie"in t?t.useCookie:o(r))("user-service").value)==null?void 0:a.numero)),1)]}),_:1}),n(x,null,{default:i(()=>[n(C,{md:"3"},{default:i(()=>[n(qe,{label:"Nacionalidade",items:te,modelValue:o(s).nacionalidade,"onUpdate:modelValue":e[0]||(e[0]=a=>o(s).nacionalidade=a),disabled:o(y)||o(_)},null,8,["modelValue","disabled"])]),_:1}),n(C,{md:"2"},{default:i(()=>[o(s).nacionalidade===!1?ye((m(),g(D,{key:0,autofocus:"",modelValue:o(s).apresentante_cpf,"onUpdate:modelValue":e[1]||(e[1]=a=>o(s).apresentante_cpf=a),label:"CPF",required:"","error-messages":o(p).apresentante_cpf.$errors.map(a=>a.$message),onBlur:o(p).apresentante_cpf.$touch,onInput:e[2]||(e[2]=a=>ue(o(s).apresentante_cpf)),disabled:o(y)||o(_)},null,8,["modelValue","error-messages","onBlur","disabled"])),[[f,"###.###.###-##"]]):(m(),g(D,{key:1,autofocus:"",modelValue:o(s).apresentante_cpf,"onUpdate:modelValue":e[3]||(e[3]=a=>o(s).apresentante_cpf=a),label:"Documento",required:"","error-messages":o(p).apresentante_cpf.$errors.map(a=>a.$message),onBlur:o(p).apresentante_cpf.$touch,disabled:o(y)||o(_)},null,8,["modelValue","error-messages","onBlur","disabled"]))]),_:1}),n(C,{md:"4"},{default:i(()=>[n(D,{modelValue:o(s).apresentante_nome,"onUpdate:modelValue":e[4]||(e[4]=a=>o(s).apresentante_nome=a),label:"Nome Apresentante",required:"","error-messages":o(p).apresentante_nome.$errors.map(a=>a.$message),onInput:o(p).apresentante_nome.$touch,disabled:o(y)||o(_)},null,8,["modelValue","error-messages","onInput","disabled"])]),_:1}),o(h)?(m(),g(C,{key:0},{default:i(()=>[l("div",null,[l("img",{style:{width:"40px",height:"40px",cursor:"pointer"},src:we,alt:"Salvar",onClick:e[5]||(e[5]=a=>le())})])]),_:1})):L("",!0)]),_:1}),o(N)?(m(),g(x,{key:0,style:{display:"flex","margin-bottom":"10px",gap:"2rem"}},{default:i(()=>[e[12]||(e[12]=l("h1",{class:"ml-5"},"Atos",-1)),n(c,{to:{path:"/os/criar-ato",query:{origem:"criar"}}},{default:i(()=>e[9]||(e[9]=[l("img",{style:{width:"45px",height:"45px",cursor:"pointer"},src:Oe,alt:"novo"},null,-1)])),_:1}),n(Be,{headers:ae,items:o(O),"item-key":"id"},{"item.actions":i(({item:a})=>[n(x,{style:{display:"flex",gap:"2px","margin-top":"-5px"}},{default:i(()=>[l("div",{onClick:S=>re(a),title:"Visualizar"},e[10]||(e[10]=[l("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:Se,alt:"Visualizar"},null,-1)]),8,Fe),l("div",{onClick:e[6]||(e[6]=S=>ne()),title:"Reimprimir"},e[11]||(e[11]=[l("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:me,alt:"Reimprimir"},null,-1)])),l("div",{class:Ce({disabled:!a.btn_editar}),onClick:S=>a.btn_editar?se({id:a.id,tipo:a.tipo,token:a.token,tipo_token:a.tipo_token,usa_imoveis:a.usa_imoveis}):null,title:a.btn_editar?"Editar":"Desabilitado"},[l("img",{style:xe({cursor:a.btn_editar?"pointer":"default",width:"30px",height:"30px"}),src:De,alt:"Editar"},null,4)],10,Pe),l("div",{disabled:!a.btn_cancelar,onClick:S=>a.btn_cancelar?de(a):null,title:"Excluir"},[a.excluido?(m(),H("img",Ue)):(m(),H("img",Me))],8,Ie)]),_:2},1024)]),_:1},8,["items"]),n(d,{show:o(w),onClose:e[7]||(e[7]=a=>w.value=!1)},null,8,["show"])]),_:1})):L("",!0),n(c,{to:"/os/lista"},{default:i(()=>[n(he,{size:"large",color:"red",onClick:ie},{default:i(()=>e[13]||(e[13]=[$e("Voltar")])),_:1})]),_:1})]),_:1})}}};export{ca as default};
