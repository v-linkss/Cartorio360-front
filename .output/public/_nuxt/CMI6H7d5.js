import{_,O as E,r as l,h as w,c as i,a as r,F as v,P as L,B as R,Q as S,J as B,o as u,E as C,d as N,t as O,s as U}from"./DZLix1Jq.js";const D={class:"chat-container"},M=["onClick"],T={__name:"index",setup(J){const b=E(),c=l(""),f=l([{from:"server",text:"Por favor, me informe seu nome"}]),m=l(),d=l(null),p=l();let a=null;const h=b.query.cartorio_token;function n(t,e){f.value.push({from:t,text:e}),U(()=>{d.value&&(d.value.scrollTop=d.value.scrollHeight)})}function g(){if(m.value||(m.value=c.value,x()),!c.value.trim())return;const t=k(c.value);n("user",t);const e={type:"chat_bot_message",message:t,cartorio_token:h};c.value="",a.send(JSON.stringify(e))}function x(){a=new WebSocket(`ws://157.230.216.74:3452?user_name=${m.value}`),a.addEventListener("open",()=>{console.log("✅ Conectado ao servidor")}),a.addEventListener("message",t=>{try{const e=JSON.parse(t.data);e.message&&e.message.state!=="ExibirResposta"?n("server",e.message):e.message&&e.message.state==="ExibirResposta"?(p.value=e.message,n("button",e.message)):e.type==="connection_info"||n("server",JSON.stringify(e))}catch{n("server",t.data)}}),a.addEventListener("close",()=>{console.log("❌ Conexão encerrada"),n("system","⚠️ Conexão encerrada")}),a.addEventListener("error",t=>{console.error("⚠️ Erro na conexão:",t),n("system","⚠️ Erro na conexão")})}function y(t){fetch(t).then(e=>{if(!e.ok)throw new Error("Erro ao baixar o arquivo");return e.blob()}).then(e=>{const s=URL.createObjectURL(e),o=document.createElement("a");o.href=s,o.download="documento.pdf",o.click(),URL.revokeObjectURL(s)})}function k(t){const e=typeof t=="object"?t.message:t,s=/(https?:\/\/[^\s]+)/g;return e.replace(s,o=>`<a href="${o}" target="_blank" class="chat-link">${o}</a>`)}return w(()=>{a&&a.readyState===WebSocket.OPEN&&a.close()}),(t,e)=>(u(),i("div",D,[e[2]||(e[2]=r("div",{class:"chat-header"},[r("span",{class:"chat-title"},"Chat"),r("button",{class:"chat-close"},"×")],-1)),r("div",{ref_key:"chatHistory",ref:d,class:"chat-history"},[(u(!0),i(v,null,L(f.value,(s,o)=>(u(),i("div",{key:o,class:C(["chat-bubble",s.from==="user"?"user-bubble":s.from==="system"?"system-bubble":"server-bubble"])},[s.from==="button"?(u(),i("button",{key:0,class:"chat-button",onClick:$=>y(s.text.message)}," 📎 Baixar documento ",8,M)):(u(),i(v,{key:1},[N(O(s.text.message||s.text),1)],64))],2))),128))],512),r("form",{onSubmit:B(g,["prevent"]),class:"chat-input-area"},[R(r("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),type:"text",placeholder:"Digite sua mensagem...",class:"chat-input"},null,512),[[S,c.value]]),e[1]||(e[1]=r("button",{type:"submit",class:"chat-send-button"},"➤",-1))],32)]))}},H=_(T,[["__scopeId","data-v-e82fdf8e"]]);export{H as default};
