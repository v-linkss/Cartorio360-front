import{_ as N}from"./CHvuucKF.js";import{_ as O}from"./Ykg_augn.js";import{_ as q}from"./Bt3saNra.js";import{_ as D,u as T,r as o,e as h,f as E,c as L,b as l,w as n,i as u,F as R,k as B,o as I,a as s,s as H}from"./xjdzLEo0.js";import{u as b}from"./BDbODpYU.js";import{f as C}from"./B0IxRygJ.js";import{V as U}from"./CC8hpuBl.js";import{V as k}from"./Kdc6g5ZJ.js";import{V}from"./CESJstty.js";import{V as j}from"./mn0eXDzS.js";import"./C2Dqb-q3.js";import"./A8ooro0v.js";import"./D3lLDfob.js";import"./Dhr7xOBk.js";import"./C4taKET-.js";import"./CE6Mddv5.js";import"./CiiVCFlm.js";import"./DPKj8ol6.js";import"./BAXHBwVF.js";import"./sgesqSlH.js";const z={style:{display:"flex",gap:"4px","justify-content":"center"}},J=["disabled","onClick"],K={__name:"index",setup(X){const f=B(),{$toast:m}=T(),w=`${f.public.managemant}/cancela_lavratura`,$=`${f.public.managemant}/pesquisaAtos`,A=o(h("auth_token").value)||null,S=o(h("user-data").value.cartorio_token)||null,d=o([]),r=o(!1),v=o(""),_=o(null),i=o(!1),y=o(""),c=E({id:null}),P=[{title:"Protocolo",value:"protocolo"},{title:"Data lavratura/Parte",value:"dt_lavratura"},{title:"Situação/Serviço",key:"situacaoServico",value:e=>e.situacao?`${e.situacao}
${e.ato_servico}`:`${e.ato_servico}`,cellProps:{style:{whiteSpace:"pre-line",lineHeight:"2"}}},{title:"Livro",value:"livro_numero"},{title:"Folha",value:"folha"},{title:"Valor",value:"valor"},{title:"Ações",value:"actions"}];async function x(){try{sessionStorage.setItem("pesquisaAto",JSON.stringify(c));const{data:e}=await b($,{method:"POST",body:{cartorio_token:S.value,ato_id:Number(c.id)||null}},"$xahYxgiURx");e.value.length>0?d.value=e.value.map(a=>({...a,dt_lavratura:a.dt_lavratura?C(a.dt_lavratura,"dd/mm/yyyy hh:mm"):null,dt_abertura:a.dt_abertura?C(a.dt_abertura,"dd/mm/yyyy"):null})):(d.value=[],m.error("Não existe ato Registrado!"))}catch(e){console.error("Erro na requisição",e)}}const F=e=>{_.value=e,v.value="O cancelamento de lavratura é definitivo e não poderá ser revertido. Confirma o cancelamento da lavratura deste ato?",i.value=!1,r.value=!0},M=async()=>{if(i.value){await g(!0);return}await g(!1)},g=async e=>{r.value=!1;const{data:a,status:p}=await b(w,{method:"POST",body:{ato_token:_.value,user_token:A.value,forcar_cancelamento:e}},"$0XhtmZH7s8");if(r.value=!1,p.value==="success"&&a.value&&a.value[0]){const t=a.value[0];t.status==="OK"?(m.success("Lavratura cancelada com sucesso!"),i.value=!1,await x()):(y.value=`${t.status_mensagem} Confirma o cancelamento?`,v.value=y.value,i.value=!0,r.value=!0)}else m.error("Erro ao tentar cancelar o ato. Tente novamente.")};return(e,a)=>{const p=N;return I(),L(R,null,[l(U,null,{default:n(()=>[l(k,{class:"mb-5"},{default:n(()=>a[2]||(a[2]=[s("h1",null,"Cancelamento de Lavratura",-1)])),_:1}),l(k,null,{default:n(()=>[l(V,{cols:"2"},{default:n(()=>[l(H,{modelValue:u(c).id,"onUpdate:modelValue":a[0]||(a[0]=t=>u(c).id=t),label:"ID"},null,8,["modelValue"])]),_:1}),l(V,null,{default:n(()=>[s("div",null,[s("img",{onClick:x,style:{width:"40px",height:"40px",cursor:"pointer"},src:O,alt:"Pesquisar"})])]),_:1})]),_:1}),s("div",null,[a[4]||(a[4]=s("hr",{class:"mt-5 mb-5"},null,-1)),l(j,{headers:P,items:u(d),style:{"font-size":"12px"},"item-key":"id"},{"item.actions":n(({item:t})=>[s("div",z,[s("div",{disabled:!t.btn_cancelar,onClick:Y=>t.btn_cancelar?F(t.token):null,title:"Excluir"},a[3]||(a[3]=[s("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:q,alt:"Cancelar",title:"Cancelar"},null,-1)]),8,J)])]),_:1},8,["items"])])]),_:1}),l(p,{show:u(r),condMessage:u(v),onClose:a[1]||(a[1]=t=>r.value=!1),onConfirm:M},null,8,["show","condMessage"])],64)}}},_a=D(K,[["__scopeId","data-v-bf1eb00e"]]);export{_a as default};
