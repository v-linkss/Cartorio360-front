import{_ as pe}from"./CZSuHefn.js";import{u as ne,m as le,M as ie,r as n,p as _e,o as p,y as G,w as a,b as t,x as e,V as re,G as te,d as K,z as B,A as ce,n as R,I as Re,E as me,a as V,c as S,O as Ie,q as Fe,P as Ne,F as qe,g as Be,Q as Ve,t as fe}from"./g7uLgUnE.js";import{u as f}from"./Wu6duopF.js";import{V as I}from"./DqQrbt9h.js";import{V as N}from"./DenPrABr.js";import{V as ye}from"./DnXtZjwH.js";import{V as he}from"./H3i-eegW.js";import{_ as Le}from"./DU5M287u.js";import{_ as Ge,a as He,b as Je,T as We,W as Ke,S as Xe,D as Pe,c as Qe,d as Ye,e as Ze,f as et}from"./CwsUkGV7.js";import{_ as tt,r as Ae}from"./DgHlAB4P.js";import{_ as xe}from"./DRQe9GS-.js";import{_ as ge}from"./BVz1G1IN.js";import{_ as at}from"./DcaPFJP3.js";import{_ as ot}from"./mvjoZom-.js";import{_ as we,a as ze}from"./DJvq3mCv.js";import{V as Ee}from"./D9ybryxI.js";import{_ as Te}from"./l7qfGuS0.js";import{V as st}from"./DJa0ru9o.js";import{c as Oe,r as Me,u as De}from"./0nUkT_nh.js";import{f as $e}from"./B0IxRygJ.js";import{_ as rt}from"./-zgYk4Vu.js";const Xt={__name:"Dados",props:{item_dados:{type:Array,required:!0},item_situacoes:{type:Array,required:!0}},setup(oe){const v=oe,{$toast:z}=ne(),$=ce(),c=le(),d=ie(),h=`${$.public.managemant}/updateAtos`,q=n(v.item_situacoes),X=n(d.query.origem==="vizualizar"),A=_e({dt_abertura:v.item_dados[0].dt_abertura||null,status:v.item_dados[0].status||null,mne:v.item_dados[0].mne||null});async function Q(){const{data:F,error:b,status:O}=await f(`${h}/${d.query.ato_id}`,{method:"PUT",body:{status:A.status,mne:A.mne,dt_abertura:A.dt_abertura}},"$EIT5jtTUdX");O.value==="success"&&z.success("Ato Atualizado com sucesso")}const T=()=>{const F=d.query.origem||"criar",b=d.query.id;switch(F){case"atualizar":case"vizualizar":c.push(`/os/atualizar/${b}`);break;case"atualizar-lista":case"vizualizar-lista":c.push("/atos/lista");break;default:c.push("/os/criar-registro");break}};return(F,b)=>{const O=pe;return p(),G(he,null,{default:a(()=>[t(I,{class:"mt-5"},{default:a(()=>[t(N,{cols:"3"},{default:a(()=>[t(ye,{label:"Situação",modelValue:e(A).status,"onUpdate:modelValue":b[0]||(b[0]=y=>e(A).status=y),items:e(q),"item-title":"descricao","item-value":"descricao",required:""},null,8,["modelValue","items"])]),_:1})]),_:1}),t(I,null,{default:a(()=>[t(N,{cols:"5"},{default:a(()=>[t(re,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:e(A).mne,"onUpdate:modelValue":b[1]||(b[1]=y=>e(A).mne=y)},null,8,["modelValue"])]),_:1})]),_:1}),t(I,null,{default:a(()=>[t(N,{cols:"2"},{default:a(()=>[t(re,{modelValue:e(A).dt_abertura,"onUpdate:modelValue":b[2]||(b[2]=y=>e(A).dt_abertura=y),type:"date",label:"Data Lavratura",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),t(I,{class:"mb-3"},{default:a(()=>[t(O,{onClick:T},{default:a(()=>[t(te,{size:"large",color:"red"},{default:a(()=>b[3]||(b[3]=[K("Voltar")])),_:1})]),_:1}),e(X)?B("",!0):(p(),G(te,{key:0,class:"ml-10",onClick:Q,size:"large",color:"green"},{default:a(()=>b[4]||(b[4]=[K("Atualizar")])),_:1}))]),_:1})]),_:1})}}},nt={key:0},lt=["onClick"],it={key:0,style:{width:"30px",height:"30px"},src:xe,alt:"Visualizar"},ct={key:1,style:{width:"30px",height:"30px"},src:at,alt:"Visualizar"},ut=["onClick"],dt=["onClick"],mt={key:0,style:{width:"30px",height:"30px"},src:we,alt:"Visualizar",title:"Reativar"},pt={key:1,src:ze,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},_t=["onClick"],Qt={__name:"Partes",async setup(oe){let v,z;const $=le(),c=ie(),d=ce(),{$toast:h}=ne(),q=`${d.public.managemant}/pesquisarPessoas`,X=`${d.public.managemant}/listarPapeis`,A=`${d.public.managemant}/createAtosPessoa`,Q=`${d.public.managemant}/updateAtosPessoa`,T=`${d.public.managemant}/getAtosPessoaById`,F=`${d.public.managemant}/download`,b=n(R("user-data").value.cartorio_token),O=n(c.query.origem==="vizualizar"),y=n([]),M=n({}),x=n([]),E=n([]),w=n(!1),Y=n(!1),L=n(!1),J=n(!1),Z=n(null),g=n(null),P=n(null),W=n(null),r=n(null),i=n(c.query.tipo_ato_token),k=n(null),U=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"30%"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome",width:"25%"},{value:"actions"}],u=_e({papeis:null,nome:null,pessoa:null,documento:null});Re(()=>{var _;return((_=u.pessoa)==null?void 0:_.link_ficha)||!1});const{data:j}=([v,z]=me(()=>f(X,{method:"POST",body:{tipo_ato_token:c.query.tipo_ato_token}},"$acoiTIUp00")),v=await v,z(),v);E.value=j.value;const o=async()=>{const{data:_}=await f(`${T}/${c.query.ato_id}`,{method:"GET"},"$ypnU9hCpVn"),ee=(de=>de.map(ae=>({...ae,pessoa:{...ae.pessoa,documento:ae.pessoa.doc_identificacao},papel:{...ae.partes_tipos}})))(_.value);x.value=ee};o();async function s(){try{const{data:_,error:m}=await f(q,{method:"POST",body:{cartorio_token:b.value,documento:u.documento,nome:u.nome}},"$pr30MyPXfY");_.value.length>0?(y.value=_.value,u.pessoa=y.value[0]):y.value=[]}catch(_){console.error("Erro na requisição",_)}}const l=()=>{Y.value=!0},C=async()=>{await o()},H=async()=>{await o()},ve=async()=>{const _={pessoa:u.pessoa,papel:E.value.find(se=>se.id===u.papeis),representante:{nome:null}},m=await f(`${T}/${c.query.ato_id}`,{method:"GET"},"$scHdIvxj2D");for(const se of m.data.value)if(se.pessoa_id===u.pessoa.id&&se.ato_id===Number(c.query.ato_id)&&se.tipo_parte_id===u.papeis){h.error("Pessoa Já Registrada Com Esse Papel!");return}const{data:ee,error:de,status:ae}=await f(A,{method:"POST",body:{ato_id:Number(c.query.ato_id),pessoa_id:u.pessoa.id,tipo_parte_id:u.papeis,user_id:R("user-data").value.usuario_id}},"$18isAgOJxG");ae.value==="success"?(_.id=ee.value.id,h.success("Pessoa Registrada com Sucesso!"),x.value.push(_)):h.error(de.value.message)},ue=async _=>{L.value=!0;const{data:m}=await f(F,{method:"POST",body:{bucket:R("user-data").value.cartorio_token,path:_.pessoa.link_ficha}},"$hmDzSF3F61");k.value=m.value,M.value=_.pessoa},be=_=>{const m=x.value.filter(ee=>ee.pessoa.id!==_.pessoa.id&&!ee.excluido).map(ee=>({id:ee.pessoa.id,nome:ee.pessoa.nome}));P.value=_.id,Z.value=m,w.value=!0,g.value=_.pessoa.nome,r.value=_.pessoa.id},Ce=_=>{J.value=!0,W.value=_.id,g.value=_.pessoa.nome};async function Se(_){_.excluido=!_.excluido;try{await f(`${Q}/${_.id}`,{method:"PUT",body:JSON.stringify({excluido:_.excluido})},"$l09I6nLRfk")}catch(m){console.error("Erro ao excluir pessoa:",m)}}const Ue=()=>{const _=c.query.origem||"criar",m=c.query.id;switch(_){case"atualizar":case"vizualizar":$.push(`/os/atualizar/${m}`);break;case"atualizar-lista":case"vizualizar-lista":$.push("/atos/lista");break;default:$.push("/os/criar-registro");break}};return(_,m)=>{const ee=Le,de=He,ae=Je,se=tt,je=pe;return p(),G(he,null,{default:a(()=>[e(O)?B("",!0):(p(),G(I,{key:0,class:"mt-5"},{default:a(()=>[t(N,{cols:"3"},{default:a(()=>[t(re,{label:"Documento",modelValue:e(u).documento,"onUpdate:modelValue":m[0]||(m[0]=D=>e(u).documento=D)},null,8,["modelValue"])]),_:1}),t(N,{cols:"4"},{default:a(()=>[t(re,{label:"Pessoa",modelValue:e(u).nome,"onUpdate:modelValue":m[1]||(m[1]=D=>e(u).nome=D)},null,8,["modelValue"])]),_:1}),V("div",null,[V("img",{class:"mt-1",src:xe,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:s})]),V("div",null,[V("img",{class:"mt-1 ml-2",src:ge,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:l})])]),_:1})),e(O)?B("",!0):(p(),G(I,{key:1},{default:a(()=>[t(N,{cols:"4"},{default:a(()=>[t(ye,{label:"Selecione a Pessoa",modelValue:e(u).pessoa,"onUpdate:modelValue":m[2]||(m[2]=D=>e(u).pessoa=D),items:e(y),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),t(N,{cols:"3"},{default:a(()=>[t(ye,{label:"Papel",modelValue:e(u).papeis,"onUpdate:modelValue":m[3]||(m[3]=D=>e(u).papeis=D),items:e(E),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),e(O)?B("",!0):(p(),S("div",nt,[V("img",{class:"mt-1",src:ge,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:ve})]))]),_:1})),t(I,null,{default:a(()=>[t(N,null,{default:a(()=>[t(Ee,{style:{height:"465px"},headers:U,items:e(x)},{"item.actions":a(({item:D})=>[e(O)?B("",!0):(p(),G(I,{key:0},{default:a(()=>[V("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-1",onClick:ke=>ue(D),title:"Visualizar Ficha"},[D.pessoa.link_ficha?(p(),S("img",it)):(p(),S("img",ct))],8,lt),V("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ke=>Ce(D),class:"mr-1",title:"Alterar Papel"},m[8]||(m[8]=[V("img",{style:{width:"30px",height:"30px"},src:ot,alt:"Visualizar"},null,-1)]),8,ut),V("div",{class:"mr-1",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ke=>Se(D),title:"Deletar Pessoa"},[D.excluido?(p(),S("img",mt)):(p(),S("img",pt))],8,dt),V("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-1",onClick:ke=>be(D),title:"Selecionar Representante"},m[9]||(m[9]=[V("img",{style:{width:"30px",height:"30px"},src:Ge,alt:"Visualizar"},null,-1)]),8,_t)]),_:2},1024))]),_:1},8,["items"])]),_:1})]),_:1}),t(ee,{show:e(Y),onClose:m[4]||(m[4]=D=>Y.value=!1)},null,8,["show"]),t(de,{representante_nome:e(g),representantes:e(Z),ato_id:e(P),show:e(w),onClose:m[5]||(m[5]=D=>w.value=!1),onUpdateRepresentante:H},null,8,["representante_nome","representantes","ato_id","show"]),t(ae,{representante_nome:e(g),ato_token:e(i),ato_id:e(W),show:e(J),onClose:m[6]||(m[6]=D=>J.value=!1),onUpdatePapel:C},null,8,["representante_nome","ato_token","ato_id","show"]),e(L)?(p(),G(se,{key:2,show:e(L),"link-view":e(k),"pessoa-obj":e(M),"is-view":!0,onClose:m[7]||(m[7]=D=>L.value=!1)},null,8,["show","link-view","pessoa-obj"])):B("",!0),t(I,null,{default:a(()=>[t(je,{onClick:Ue},{default:a(()=>[t(te,{size:"large",color:"red"},{default:a(()=>m[10]||(m[10]=[K("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},vt={key:0,class:"loading-overlay"},ft="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",Yt={__name:"Minuta",emits:["page","doc"],setup(oe,{emit:v}){Ie("DocumentEditorContainer",[We,Ke,Xe]);const z=ce(),{$toast:$}=ne(),c=le(),d=ie(),h=v;Ae(`${z.public.docEditor}`);const q=`${z.public.managemant}/download`,X=`${z.public.managemant}/atos/files`,A=`${z.public.managemant}/subitituirModelo`,Q=`${z.public.managemant}/upload`,T=n(null),F=n(!1),b=n("Ao executar a geração, a minuta atual será substituída e não poderá ser recuperada.Confirma ?"),O=n(d.query.origem==="vizualizar"),y=n(!1),M=async r=>{try{const i=await fetch(r);if(!i.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await i.blob()}catch(i){return console.error(i),null}},x=async()=>{try{const{data:r}=await f(`${X}/${d.query.ato_token_edit}`,{method:"GET"},"$5jxI4TvFse");return r.value.link_ato}catch(r){console.error("Erro ao carregar o documento:",r),$.error(r)}},E=async()=>{y.value=!0;try{const r=await x(),{data:i,status:k}=await f(q,{method:"POST",body:{bucket:R("user-data").value.cartorio_token,path:r}},"$dvNFfvmIJC"),U=i.value,u=await M(U);if(u){const j=new FileReader;j.onload=()=>{const o=j.result;T.value.ej2Instances.documentEditor.open(o),h("doc",o)},j.readAsText(u)}}catch{console.error("Erro ao carregar o documento.")}finally{y.value=!1}},w=async()=>{const i=await T.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),k=new FileReader;k.onload=()=>{const U=k.result,j=T.value.ej2Instances.documentEditor.pageCount;h("page",j),h("doc",U)},k.readAsText(i)},Y=async()=>{y.value=!0;try{const i=await T.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),k=new FormData;k.append("file",i,"anexo.sfdt"),k.append("cartorio_token",R("user-data").value.cartorio_token),k.append("token",d.query.ato_token_edit),k.append("tipo","ato_minuta");const{data:U,status:u}=await f(Q,{method:"POST",body:k},"$xv11VtUdMy");if(u.value==="success"){$.success("Documento enviado!");const o=T.value.ej2Instances.documentEditor.pageCount;w(),h("page",o)}else $.error("Erro ao enviar documento para o sistema.")}catch(r){$.error("Erro ao salvar documento."),console.error(r)}finally{y.value=!1}},L=()=>{F.value=!1,J()},J=async()=>{P(!0);try{await Z(),P(!0);const{data:r,status:i}=await f(A,{method:"POST",body:{ato_token:d.query.ato_token_edit}},"$zyzWHTXTBW");r.value&&g(r.value)}catch(r){console.error("Erro ao gerar a minuta:",r),$.error("Ocorreu um erro ao gerar a minuta.")}finally{P(!1)}},Z=async()=>{try{const{data:r}=await f(q,{method:"POST",body:{bucket:R("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$KreLE0Ys81"),i=await M(r.value);if(i){const k=new FileReader;k.onload=()=>{const U=k.result;T.value.ej2Instances.documentEditor.open(U),h("doc",U)},k.readAsText(i)}}catch(r){console.error("Erro ao carregar o modelo de minuta:",r)}},g=r=>{const i=T.value.ej2Instances.documentEditor,k=U=>{for(const[u,j]of Object.entries(U))if(/^<<.+>>$/.test(u))try{i.search.findAll(u),i.search.searchResults.length>0&&i.search.searchResults.replaceAll(j)}catch(o){console.error(`Erro ao substituir o marcador ${u}:`,o)}else if(u==="partes"&&Array.isArray(j)&&j.length>0)for(const o of j)typeof o=="object"&&k(o)};k(r)},P=r=>{y.value=r},W=()=>{const r=d.query.origem||"criar",i=d.query.id;switch(r){case"atualizar":case"vizualizar":c.push(`/os/atualizar/${i}`);break;case"atualizar-lista":case"vizualizar-lista":c.push("/atos/lista");break;default:c.push("/os/criar-registro");break}};return Fe(async()=>{await E(),w()}),(r,i)=>{const k=pe,U=Te;return p(),S(qe,null,[t(e(Pe),{height:"900px",ref_key:"documentEditorContainer",ref:T,serviceUrl:ft,enableToolbar:!0,enableWordExport:!0},null,512),e(y)?(p(),S("div",vt,[t(Ne,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):B("",!0),t(I,{class:"ml-4 mt-4 mb-4"},{default:a(()=>[t(k,{class:"mr-4"},{default:a(()=>[t(te,{size:"large",onClick:W,color:"red"},{default:a(()=>i[2]||(i[2]=[K("Voltar")])),_:1})]),_:1}),e(O)?B("",!0):(p(),G(te,{key:0,size:"large",color:"green",onClick:Y,disabled:e(y)},{default:a(()=>i[3]||(i[3]=[K("Atualizar")])),_:1},8,["disabled"])),e(O)?B("",!0):(p(),G(te,{key:1,class:"ml-4",size:"large",color:"blue",onClick:i[0]||(i[0]=u=>F.value=!0)},{default:a(()=>i[4]||(i[4]=[K("Gerar Minuta")])),_:1}))]),_:1}),t(U,{onConfirm:L,condMessage:e(b),show:e(F),onClose:i[1]||(i[1]=u=>F.value=!1)},null,8,["condMessage","show"])],64)}}},yt=["innerHTML"],Zt={__name:"Livro",props:{pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(oe){let v,z;const $=oe,c=ce();Ae(`${c.public.docEditor}`);const{$toast:d}=ne(),h=le(),q=ie(),X=`${c.public.managemant}/download`,A=`${c.public.managemant}/atos/files`,Q=`${c.public.managemant}/lavrarAto`,T=`${c.public.managemant}/listarEscrevente`,F=`${c.public.managemant}/ato_calcular`,b=`${c.public.envioDoc}/print`,O=n(R("user-data").value.cartorio_token),y=R("auth_token").value,M=n("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),x=n(!1),E=n(null),w=n(null),Y=n(q.query.origem==="vizualizar"),L=n(null),J=n([]),Z=n({}),g=_e({escrevente:null}),P=async s=>{try{const l=await fetch(s);if(!l.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await l.blob()}catch(l){return console.error(l),null}},W=async()=>{try{const{data:s}=await f(`${A}/${q.query.ato_token_edit}`,{method:"GET"},"$FnEbAJEARP");return s.value.link_ato}catch(s){console.error("Erro ao carregar o documento:",s),d.error(s)}},r=async()=>{try{const s=await W(),{data:l,status:C}=await f(X,{method:"POST",body:{bucket:R("user-data").value.cartorio_token,path:s}},"$7ljqltMqa0"),H=l.value,ve=await P(H);if(ve){const ue=new FileReader;ue.onload=()=>{const be=ue.result;L.value.ej2Instances.documentEditor.open(be)},ue.readAsText(ve)}}catch{d.error("Erro ao carregar o documento.")}};r();const i=async()=>{const s=L.value.ej2Instances.documentEditor.pageCount,{data:l,status:C}=await f(Q,{method:"POST",body:{ato_token:q.query.ato_token_edit,qtd_paginas:s,escrevente_token:g.escrevente,usuario_token:y,cartorio_token:O}},"$OWxZSQkyX8");if(C.value==="success"){if(l.value[0].tipo_etiqueta==="html")E.value=l.value,w.value=l.value[0].selo;else if(l.value[0].tipo_etiqueta==="zpl"){const{status:H}=await f(`${b}`,{method:"POST",body:{zpl:l.value[0].selo}},"$sMqfUUQcBM");if(H.value!=="success"){d.error("Não foi possivel fazer a impressao da etiqueta");return}}d.success("Ato lavrado com sucesso!")}else d.error("Falha ao lavrar o ato.")},k=async()=>{const s=L.value.ej2Instances.documentEditor.pageCount,{data:l,status:C}=await f(F,{method:"POST",body:{ato_token:q.query.ato_token_edit,cartorio_token:O,quantidade:1,usuario_token:y,escrevente_token:g.escrevente,qtd_paginas:s}},"$OVwiKSwcOE");C.value==="success"?Z.value=l.value[0]:d.error("Falha ao calcular o ato.")},U=async()=>{x.value=!1,i()},u=async()=>{x.value=!0,await k()},{data:j}=([v,z]=me(()=>f(T,{method:"POST",body:{cartorio_token:O}},"$iv1N3XD6We")),v=await v,z(),v);J.value=j.value[0].func_json_escreventes;const o=()=>{const s=q.query.origem||"criar",l=q.query.id;switch(s){case"atualizar":case"vizualizar":h.push(`/os/atualizar/${l}`);break;case"atualizar-lista":case"vizualizar-lista":h.push("/atos/lista");break;default:h.push("/os/criar-registro");break}};return Be(()=>$.document,(s,l)=>{r()}),(s,l)=>{const C=Te;return p(),S(qe,null,[t(I,null,{default:a(()=>[t(N,null,{default:a(()=>[t(e(Pe),{restrictEditing:!0,enableToolbar:!1,ref_key:"documentEditorContainer",ref:L,height:"850px",width:"850px"},null,512)]),_:1}),e(Y)?B("",!0):(p(),G(N,{key:0},{default:a(()=>[t(ye,{class:"mt-15",label:"Tabelião/escrevente",modelValue:e(g).escrevente,"onUpdate:modelValue":l[0]||(l[0]=H=>e(g).escrevente=H),items:e(J),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),V("img",{onClick:l[1]||(l[1]=H=>u()),style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:Qe}),e(E)?(p(),G(st,{key:0,width:"360"},{default:a(()=>[t(I,null,{default:a(()=>[t(N,null,{default:a(()=>[t(Ve,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:a(()=>[t(N,null,{default:a(()=>[K(" Livro: "+fe(e(E)[0].livro_numero),1)]),_:1}),t(N,null,{default:a(()=>[K(" Protocolo: "+fe(e(E)[0].protocolo?e(E)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),t(N,null,{default:a(()=>[t(Ve,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:a(()=>[K(" Folhas : "+fe(e(E)[0].pagina_inicial)+" A "+fe(e(E)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),V("div",{style:{"margin-left":"10px","padding-bottom":"20px","margin-top":"-10px"},innerHTML:e(w)},null,8,yt)]),_:1})):B("",!0)]),_:1}))]),_:1}),t(te,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:o},{default:a(()=>l[3]||(l[3]=[K("Voltar")])),_:1}),t(C,{show:e(x),condMessage:e(M),valor:e(Z),onClose:l[2]||(l[2]=H=>x.value=!1),onConfirm:U},null,8,["show","condMessage","valor"])],64)}}},gt=["onClick"],ht={key:0,style:{width:"30px",height:"30px"},src:we,alt:"Visualizar",title:"Reativar"},bt={key:1,src:ze,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},ea={__name:"Observacao",props:{ato_id:{type:Number,required:!0}},async setup(oe){let v,z;const $=le(),c=ie(),d=ce(),{$toast:h}=ne(),q=`${d.public.managemant}/listarEscrevente`;`${d.public.managemant}`;const X=`${d.public.managemant}/atos_observacao`,A=`${d.public.managemant}/atos_observacao`,Q=`${d.public.managemant}/atos_observacao`,T=n(R("user-data").value.cartorio_token),F=n(c.query.origem==="vizualizar"),b=n([]),O=n([]),y=[{title:"Data",align:"start",key:"created"},{title:"Escrevente",align:"start",key:"users.nome"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}],M=_e({observacao:""}),x={observacao:{required:Oe.withMessage("O campo é obrigatório",Me)}},E=De(x,M),{data:w}=([v,z]=me(()=>f(`${Q}/${c.query.ato_id}`,{method:"GET"},"$HyzoO40swN")),v=await v,z(),v);Array.isArray(w.value)?b.value=w.value.map(g=>({...g,created:$e(g.created,"dd/mm/yyyy hh:mm")})):w.value&&typeof w.value=="object"&&(b.value=[{...w.value,created:$e(w.value.created,"dd/mm/yyyy hh:mm")}]);async function Y(){if(M.observacao.trim()===""){h.error("O campo de observação está vazio.");return}if(await E.value.$validate()){const{data:g,error:P,status:W}=await f(X,{method:"POST",body:{ato_id:Number(c.query.ato_id),observacao:M.observacao,user_id:R("user-data").value.usuario_id}},"$gnHMo4uCXD");W.value==="success"&&(b.value.push({created:$e(g.value.created,"dd/mm/yyyy hh:mm"),observacao:g.value.observacao,id:g.value.id,escrevente:R("user-data").value.nome}),M.observacao="",h.success("Observação registrada com sucesso"))}else h.error("Preencha os campos obrigatórios.")}async function L(g){g.excluido=!g.excluido;try{await f(`${A}/${g.id}`,{method:"PUT",body:JSON.stringify({excluido:g.excluido})},"$sP9AKdd3Ky")}catch(P){console.error("Erro ao excluir observação:",P)}}const{data:J}=([v,z]=me(()=>f(q,{method:"POST",body:{cartorio_token:T}},"$HL9pndqGh0")),v=await v,z(),v);O.value=J.value[0].func_json_escreventes;const Z=()=>{const g=c.query.origem||"criar",P=c.query.id;switch(g){case"atualizar":case"vizualizar":$.push(`/os/atualizar/${P}`);break;case"atualizar-lista":case"vizualizar-lista":$.push("/atos/lista");break;default:$.push("/os/criar-registro");break}};return(g,P)=>{const W=pe;return p(),G(he,null,{default:a(()=>[F.value?B("",!0):(p(),G(I,{key:0,class:"mt-5"},{default:a(()=>[t(re,{label:"Observação",modelValue:M.observacao,"onUpdate:modelValue":P[0]||(P[0]=r=>M.observacao=r),required:"","error-messages":e(E).observacao.$errors.length>0?e(E).observacao.$errors.map(r=>r.$message):[],onBlur:e(E).observacao.$touch,onInput:e(E).observacao.$touch},null,8,["modelValue","error-messages","onBlur","onInput"]),V("div",null,[V("img",{class:"btn-pointer ml-2",src:ge,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:Y})])]),_:1})),t(I,null,{default:a(()=>[t(N,null,{default:a(()=>[t(Ee,{style:{height:"465px"},headers:y,items:b.value},{"item.actions":a(({item:r})=>[V("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:i=>L(r),title:"Deletar Observação"},[r.excluido?(p(),S("img",ht)):(p(),S("img",bt))],8,gt)]),_:1},8,["items"])]),_:1})]),_:1}),t(I,null,{default:a(()=>[t(W,{onClick:Z},{default:a(()=>[t(te,{size:"large",color:"red"},{default:a(()=>P[1]||(P[1]=[K("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},kt={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ze,alt:"Criar"},$t={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:et,alt:"Criar"},xt={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:rt,alt:"Criar"},wt=["onClick"],zt=["onClick"],Et=["onClick"],Ct={key:0,style:{width:"30px",height:"30px"},src:we,alt:"Visualizar",title:"Reativar"},Vt={key:1,src:ze,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},ta={__name:"Anexos",async setup(oe){let v,z;const $=ce(),{$toast:c}=ne(),d=le(),h=ie(),q=n(h.query.origem==="vizualizar"),X=`${$.public.biometria}/run-scanner`,A=`${$.public.managemant}/atos_anexos`,Q=`${$.public.managemant}/atos_anexos`,T=`${$.public.managemant}/download`,F=`${$.public.managemant}/atos_anexos`,b=`${$.public.managemant}/upload`,O=n(!1),y=n(null),M=n([]);R("pessoa_token");const x=_e({descricao:"",fileEvent:null}),E={descricao:{required:Oe.withMessage("O campo é obrigatório",Me)}},w=De(E,x,{$autoDirty:!0}),Y=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}],{data:L}=([v,z]=me(()=>f(`${F}/${h.query.ato_id}`,{method:"GET"},"$AOZpbz65MA")),v=await v,z(),v);M.value=L.value;async function J(){try{await Z(),await g()}catch(o){console.error("Erro ao executar scanner ou listar arquivos:",o)}}async function Z(){try{const{data:o}=await f(X,{method:"GET"},"$KttjFhHivJ")}catch(o){c.error("Erro ao acionar o scanner:",o)}}async function g(){try{const{data:o,status:s}=await f("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:h.query.ato_token_edit,cartorio_token:R("user-data").value.cartorio_token}},"$TqQrsgxUkd")}catch(o){console.error("Erro ao enviar o arquivo:",o)}}async function P(){try{const o=document.createElement("input");o.type="file",o.accept="*/*",o.onchange=async s=>{x.fileEvent=s,s.target.files[0]&&(y.value=!0)},o.click()}catch(o){console.error("Erro ao abrir o explorador de arquivos:",o)}}const W=async()=>{O.value=!0};function r(o){return o?!0:(y.value=!1,!1)}const i=async o=>{if(!x.fileEvent||!x.fileEvent.target.files.length){c.error("Nenhum arquivo selecionado.");return}const s=x.fileEvent.target.files[0],l=new FormData;l.append("file",s),l.append("cartorio_token",R("user-data").value.cartorio_token),l.append("token",o),l.append("tipo","ato_anexo");try{const C=await f(b,{method:"POST",body:l},"$KDhIYzGKzM");c.success("Anexo registrado com sucesso!")}catch{c.error("Erro ao enviar o arquivo.")}},k=async()=>{if(w.value.$touch(),!w.value.$invalid&&r(x.fileEvent)){const{data:o,error:s,status:l}=await f(A,{method:"POST",body:{ato_id:h.query.ato_id,descricao:x.descricao,user_id:R("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$cdoFBGO0Ti");l.value==="success"&&(c.success("Anexo registrado com sucesso!"),M.value.push(o.value),i(o.value.token))}};async function U(o){o.excluido=!o.excluido;try{await f(`${Q}/${o.id}`,{method:"PUT",body:JSON.stringify({excluido:o.excluido})},"$WLSrgYRoHq")}catch(s){console.error("Erro ao excluir pessoa:",s)}}async function u(o){try{const s=await f(`${T}`,{method:"POST",body:{bucket:R("user-data").value.cartorio_token,path:o.link}},"$NdgRjioizH"),C=await(await fetch(s.data.value)).blob(),H=URL.createObjectURL(C);window.open(H,"_blank")}catch(s){console.error("Erro ao excluir pessoa:",s)}}const j=()=>{const o=h.query.origem||"criar",s=h.query.id;switch(o){case"atualizar":case"vizualizar":d.push(`/os/atualizar/${s}`);break;case"atualizar-lista":case"vizualizar-lista":d.push("/atos/lista");break;default:d.push("/os/criar-registro");break}};return(o,s)=>{const l=pe;return p(),G(he,null,{default:a(()=>[t(I,null,{default:a(()=>[t(N,{cols:"5",class:"mt-2"},{default:a(()=>[e(q)?B("",!0):(p(),G(re,{key:0,modelValue:e(x).descricao,"onUpdate:modelValue":[s[0]||(s[0]=C=>e(x).descricao=C),e(w).descricao.$touch],"error-messages":e(w).descricao.$errors.map(C=>C.$message),onBlur:e(w).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"]))]),_:1}),e(q)?B("",!0):(p(),S("div",{key:0,onClick:J,title:"Escanear"},s[1]||(s[1]=[V("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ye,alt:"Escanear"},null,-1)]))),e(q)?B("",!0):(p(),S("div",{key:1,onClick:P,title:"Criar"},[e(y)===!1?(p(),S("img",kt)):e(y)===!0?(p(),S("img",$t)):(p(),S("img",xt))])),e(q)?B("",!0):(p(),S("div",{key:2,onClick:k,title:"Criar"},s[2]||(s[2]=[V("img",{class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:ge,alt:"Criar"},null,-1)])))]),_:1}),t(Ee,{headers:Y,items:e(M),style:{height:"465px","max-width":"600px"}},{"item.actions":a(({item:C})=>[t(I,null,{default:a(()=>[V("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:H=>W(C),title:"Visualizar Anexo"},[V("img",{style:{width:"30px",height:"30px"},onClick:H=>u(C),src:xe,alt:"Visualizar"},null,8,zt)],8,wt),V("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:H=>U(C),title:"Deletar Pessoa"},[C.excluido?(p(),S("img",Ct)):(p(),S("img",Vt))],8,Et)]),_:2},1024)]),_:1},8,["items"]),t(l,{onClick:j},{default:a(()=>[t(te,{size:"large",color:"red"},{default:a(()=>s[3]||(s[3]=[K("Voltar")])),_:1})]),_:1})]),_:1})}}};export{Xt as _,Qt as a,Yt as b,Zt as c,ea as d,ta as e};
