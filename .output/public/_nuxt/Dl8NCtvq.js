import{_ as q}from"./D3gC1Lns.js";import{_ as Y}from"./CmxF6V3n.js";import{_ as j}from"./CilZQLZf.js";import{_ as G}from"./B708E445.js";import{u as H,m as b,r as s,n as J,p as K,q as w,c as Q,b as t,w as n,F as W,s as X,o as Z,a as i,t as O,v as r,V as S,x as $,y as ee,z as h,A as oe,d as ae,B as te}from"./BRgeNrnL.js";import{V as re}from"./Cxxm9SZ6.js";import{V as g}from"./Dc2UOyeh.js";import{V as k}from"./PZU4-x0j.js";import{V as ne}from"./BAFdKjV9.js";import"./BELCwK6Y.js";import"./CBeogmQW.js";import"./BKd1Lqaz.js";import"./hZZAu9Sv.js";import"./BP1uhy__.js";import"./CjX0ZVmJ.js";import"./DGrvkeHE.js";import"./BvKh3xkw.js";const se=["title","onClick"],le=["onClick"],$e={__name:"index",setup(ie){const C=X(),{$toast:c}=H(),A=`${C.public.managemant}/listarOSCaixas`,M=`${C.public.managemant}/updateOrdensServico`,R=b("caixa-service").value.usuario_nome,T=b("caixa-service").value.data,x=s([]),m=s(""),d=s(""),p=s({}),y=s(null),N=s("O encerramento de OS não poderá ser revertido. Confirma o encerramento?"),_=s(!1),v=s(!1),B=()=>{te("/caixas/lista")},D=[{title:"Data Recebimento",value:"data"},{title:"Número",value:"numero"},{title:"Situação",value:"situacao"},{title:"CPF",value:"apresentante_cpf"},{title:"Apresentante",value:"apresentante_nome"},{title:"Usuário",value:"usuario_nome"},{title:"Valor",value:"valor"},{title:"A Receber",value:"valor_a_receber"},{title:"Ações",value:"actions"}];async function V(){try{const o=await $fetch(A,{method:"POST",body:{caixa_token:b("caixa-service").value.caixa_token}});o&&Array.isArray(o)?x.value=o:c.error("Nenhum dado retornado da API.")}catch(o){const e=o.message||"Erro ao buscar dados da API. Tente novamente.";c.error(e)}}function P(){const o=new Date,e=o.getFullYear(),l=String(o.getMonth()+1).padStart(2,"0"),u=String(o.getDate()).padStart(2,"0");return`${e}-${l}-${u}`}const E=o=>{p.value=o,v.value=!0};async function F(o){try{await $fetch(`${M}/${o}`,{method:"PUT",body:{dt_pagto:P()}})?(c.success("Ordem de Serviço encerrada com sucesso!"),v.value=!1,V()):c.error("Erro ao encerrar OS. Tente novamente.")}catch(e){const l=e.message||"Erro ao buscar dados da API. Tente novamente.";c.error(l)}}J(()=>{V()});const I=K(()=>x.value.filter(o=>{const e=o.numero?o.numero.toString().toLowerCase():"",l=o.apresentante_nome?o.apresentante_nome.toLowerCase():"",u=e.includes(m.value.toLowerCase()),f=l.includes(d.value.toLowerCase());return u&&f}));function z(o,e){y.value=o,p.value={token:e.token,numero:e.numero,valor:e.valor,valor_pago:e.valor_pago},_.value=!0}return(o,e)=>{const l=q,u=Y,f=w("v-cols"),L=w("v-rows");return Z(),Q(W,null,[t(re,{class:"mt-5"},{default:n(()=>[t(g,{class:"mb-5"},{default:n(()=>[i("h1",null," Recebimento de Ordens de Serviço - Caixa "+O(r(T))+" - "+O(r(R)),1)]),_:1}),t(g,null,{default:n(()=>[t(k,{cols:"2"},{default:n(()=>[t(S,{modelValue:r(m),"onUpdate:modelValue":e[0]||(e[0]=a=>$(m)?m.value=a:null),type:"text",label:"Número"},null,8,["modelValue"])]),_:1}),t(k,{md:"3"},{default:n(()=>[t(S,{modelValue:r(d),"onUpdate:modelValue":e[1]||(e[1]=a=>$(d)?d.value=a:null),label:"Apresentante"},null,8,["modelValue"])]),_:1})]),_:1}),e[6]||(e[6]=i("hr",{class:"mt-5 mb-5"},null,-1)),t(ne,{headers:D,items:r(I),"item-key":"id"},{"item.actions":n(({item:a})=>[t(g,{style:{display:"flex",gap:"4px","margin-top":"-5px"}},{default:n(()=>[i("div",{class:h({disabled:!a.btn_receber}),title:a.btn_receber?"Receber":"Bloqueado",onClick:U=>a.btn_receber?z(a.numero,a):null},[i("img",{style:ee({cursor:a.btn_receber?"pointer":"default",width:"30px",height:"30px"}),src:j,alt:"Receber"},null,4)],10,se),i("div",{class:h({disabled:!a.btn_encerrar}),onClick:U=>a.btn_encerrar?E(a.id):!1,title:"Cancelamento"},e[5]||(e[5]=[i("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:G,alt:"Encerrar",title:"Encerrar"},null,-1)]),10,le)]),_:2},1024)]),_:1},8,["items"]),t(l,{show:r(_),numero_os:r(y),ordem:r(p),onClose:e[2]||(e[2]=a=>_.value=!1)},null,8,["show","numero_os","ordem"]),t(u,{onConfirm:e[3]||(e[3]=a=>F(r(p))),condMessage:r(N),show:r(v),onClose:e[4]||(e[4]=a=>v.value=!1)},null,8,["condMessage","show"])]),_:1}),t(L,null,{default:n(()=>[t(f,null,{default:n(()=>[t(oe,{class:"ml-8",size:"large",onClick:B,color:"red"},{default:n(()=>e[7]||(e[7]=[ae("Voltar ")])),_:1})]),_:1})]),_:1})],64)}}};export{$e as default};
