import{_ as q}from"./BcIHK8bh.js";import{_ as I}from"./C2wXVBaH.js";import{_ as L}from"./CeQA-iT-.js";import{_ as R,u as T,r as s,e as C,f as B,c as E,b as t,w as u,i as r,F as U,k as H,o as j,a as n,s as h}from"./BFubt5K-.js";import{u as k}from"./DO0JiUxm.js";import{f as V}from"./B0IxRygJ.js";import{V as z}from"./B9P8d4Wk.js";import{V as b}from"./Cn46jq14.js";import{V as f}from"./CCJ0H2nG.js";import{V as J}from"./0HI9nnWz.js";import"./BAz72YtY.js";import"./CGSGkCFE.js";import"./CJw_lHYf.js";import"./BcLYmS-Z.js";import"./kJoZuS00.js";import"./BjBE1yu7.js";import"./DS_gXmtl.js";import"./Q4Fj7ezm.js";import"./DXFSGs24.js";import"./BU3oJa_R.js";const K={style:{display:"flex",gap:"4px","justify-content":"center"}},X=["onClick"],Y={__name:"index",setup(Z){const _=H(),{$toast:v}=T(),w=`${_.public.managemant}/cancela_lavratura`,$=`${_.public.managemant}/pesquisaAtos`,A=s(C("auth_token").value)||null,S=s(C("user-data").value.cartorio_token)||null,c=s([]),i=s(!1),p=s(""),y=s(null),N=s(null),m=s(!1),x=s(""),o=B({id:null,selo_numero:null}),P=[{title:"Protocolo",value:"protocolo"},{title:"Data lavratura/Parte",value:"dt_lavratura"},{title:"Situação/Serviço",key:"situacaoServico",value:e=>e.situacao?`${e.situacao}
${e.ato_servico}`:`${e.ato_servico}`,cellProps:{style:{whiteSpace:"pre-line",lineHeight:"2"}}},{title:"Livro",value:"livro_numero"},{title:"Folha",value:"folha"},{title:"Valor",value:"valor"},{title:"Ações",value:"actions"}];async function D(){try{if(o.id===null){v.error("Informe o ID do ato!");return}sessionStorage.setItem("pesquisaAto",JSON.stringify(o));const{data:e}=await k($,{method:"POST",body:{cartorio_token:S.value,ato_id:Number(o.id)||null}},"$xahYxgiURx");e.value.length>0?c.value=e.value.map(a=>({...a,dt_lavratura:a.dt_lavratura?V(a.dt_lavratura,"dd/mm/yyyy hh:mm"):null,dt_abertura:a.dt_abertura?V(a.dt_abertura,"dd/mm/yyyy"):null})):(c.value=[],v.error("Não existe ato Registrado!"))}catch(e){console.error("Erro na requisição",e)}}const F=(e,a)=>{y.value=e,a.value=a,p.value="O cancelamento de lavratura é definitivo e não poderá ser revertido. Confirma o cancelamento da lavratura deste ato?",m.value=!1,i.value=!0},M=async()=>{if(m.value){await g(!0);return}await g(!1)},g=async e=>{i.value=!1;const{data:a,status:d,error:l}=await k(w,{method:"POST",body:{ato_token:y.value,user_token:A.value,selo_numero:N.value,forcar_cancelamento:e}},"$0XhtmZH7s8");i.value=!1,d.value==="success"&&a.value&&a.value[0]?a.value[0].status==="OK"&&(v.success("Lavratura cancelada com sucesso!"),c.value=[],o.id=null,m.value=!1):d.value==="error"&&l.value&&(x.value=`${l.value.data[0].status_mensagem} Confirma o cancelamento?`,p.value=x.value,m.value=!0,i.value=!0)};return(e,a)=>{const d=q;return j(),E(U,null,[t(z,null,{default:u(()=>[t(b,{class:"mb-5"},{default:u(()=>a[3]||(a[3]=[n("h1",null,"Cancelamento de Lavratura",-1)])),_:1}),t(b,null,{default:u(()=>[t(f,{cols:"2"},{default:u(()=>[t(h,{modelValue:r(o).id,"onUpdate:modelValue":a[0]||(a[0]=l=>r(o).id=l),label:"ID do ato"},null,8,["modelValue"])]),_:1}),t(f,{cols:"2"},{default:u(()=>[t(h,{modelValue:r(o).selo_numero,"onUpdate:modelValue":a[1]||(a[1]=l=>r(o).selo_numero=l),label:"Numero do selo"},null,8,["modelValue"])]),_:1}),t(f,null,{default:u(()=>[n("div",null,[n("img",{onClick:D,style:{width:"40px",height:"40px",cursor:"pointer"},src:I,alt:"Pesquisar"})])]),_:1})]),_:1}),n("div",null,[a[5]||(a[5]=n("hr",{class:"mt-5 mb-5"},null,-1)),t(J,{headers:P,items:r(c),style:{"font-size":"12px"},"item-key":"id"},{"item.actions":u(({item:l})=>[n("div",K,[n("div",{onClick:O=>F(l.token,r(o).selo_numero),title:"Excluir"},a[4]||(a[4]=[n("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:L,alt:"Cancelar",title:"Cancelar"},null,-1)]),8,X)])]),_:1},8,["items"])])]),_:1}),t(d,{show:r(i),condMessage:r(p),onClose:a[2]||(a[2]=l=>i.value=!1),onConfirm:M},null,8,["show","condMessage"])],64)}}},ya=R(Y,[["__scopeId","data-v-e7096d77"]]);export{ya as default};
