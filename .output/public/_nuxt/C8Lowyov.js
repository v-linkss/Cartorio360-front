import{_ as ae}from"./DYggmnY1.js";import{V as E,c as le}from"./3yZZc8HG.js";import{V as T}from"./BeulduU8.js";import{V as g}from"./BpRt-f4R.js";import{r as b,g as L,o as C,p as K,w as t,b as r,a as c,v as R,d as x,s as u,C as O,m as re,u as M,H as te,t as j,V as z,c as I,K as q,q as se,by as ne}from"./BWUaJUvi.js";import{V as H}from"./BurSB6Hx.js";import{_ as ue}from"./BVz1G1IN.js";import{a as me,_ as ie}from"./DJvq3mCv.js";import{u as w}from"./JICjdrAR.js";import{V as ce}from"./DYwCSLK9.js";import{V as de}from"./BKuWNhKb.js";const fe={__name:"ModalRecebimentoCond",props:{show:Boolean,faltaReceber:Number},emits:["close","confirmar"],setup(h,{emit:$}){const a=h,v=b(a.show),d=$;L(()=>a.show,V=>{v.value=V});const _=()=>{d("confirmar"),p()},p=()=>{v.value=!1,d("close")};return(V,n)=>(C(),K(H,{persistent:"",modelValue:u(v),"onUpdate:modelValue":n[0]||(n[0]=F=>O(v)?v.value=F:null),"max-width":"650"},{default:t(()=>[r(E,null,{default:t(()=>[r(T,null,{default:t(()=>[r(g,{class:"mb-5 mt-1 ml-2"},{default:t(()=>n[1]||(n[1]=[c("h1",null,"Confirmação de Recebimento",-1)])),_:1}),r(g,{class:"ml-2"},{default:t(()=>n[2]||(n[2]=[c("p",null," O valor recebido é menor que o valor da OS, confirma o recebimento parcial? ",-1)])),_:1})]),_:1}),r(le,null,{default:t(()=>[r(R,{style:{"background-color":"#429946",color:"white"},onClick:_},{default:t(()=>n[3]||(n[3]=[x("Confirmar")])),_:1}),r(R,{style:{"background-color":"red",color:"white"},onClick:p},{default:t(()=>n[4]||(n[4]=[x("Cancelar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ve={style:{color:"red","margin-left":"18px"}},pe={style:{"max-width":"180px"}},be={style:{display:"flex","justify-content":"flex-end"}},_e=["onClick"],Ve={key:1,src:ie,style:{width:"30px",height:"30px",cursor:"not-allowed"},alt:"Remover"},ye={style:{display:"flex","justify-content":"flex-start"}},Me={__name:"Ordem",props:{show:Boolean,ordem:{type:Object,required:!0}},emits:["close","refresh-value"],setup(h,{emit:$}){const a=h,v=$,{$toast:d}=re(),_=b(a.show),p=b(!1),V=se(),n=`${V.public.managemant}/listarFormasReceb`,F=`${V.public.managemant}/listar_recebimentos_os`,J=`${V.public.managemant}/receberOs`,Q=`${V.public.managemant}/caixasLanctos`,W=M("auth_token").value,S=b([]),U=b(null),y=b([]),k=b([]),m=te({descricao:null,forma:null,valor:""}),Z=[{title:"Forma",value:"descricao"},{title:"Valor",value:"valor"},{value:"actions"}],i=b(0),G=()=>{i.value=f(a.ordem.valor-a.ordem.valor_pago)};L(()=>a.show,async o=>{_.value=o;const{data:e}=await w(F,{method:"POST",body:{os_token:a.ordem.token}},"$vhMIR8Sr2p"),s=Array.isArray(e.value)?e.value:[];s&&(y.value=s.map(({forma_recebimento:N,...l})=>({descricao:N,...l}))),o&&G()});const B=()=>{_.value=!1,Object.assign(m,{forma:null,descricao:null,valor:""}),k.value=[],y.value=[],v("close")},X=()=>{U.value=Number(a.ordem.valor),p.value=!0},D=async()=>{try{const o={ordemserv_token:a.ordem.token,usuario_token:W,recebimentos:[k.value],caixa_token:M("caixa-service").value.caixa_token},{data:e}=await w(J,{method:"POST",body:o},"$eiMzO5y6Bb");e.value[0].status==="OK"?(d.success(`${e.value[0].status}: Valores Recebidos com Sucesso!`),y.value=[],v("refresh-value"),B()):d.error(e.value[0].status_mensagem)}catch(o){d.error(o)}},A=()=>{a.ordem.valor=f(a.ordem.valor),a.ordem.valor_pago=f(a.ordem.valor_pago),i.value=f(i.value)},f=o=>Number(parseFloat(o).toFixed(2)),Y=async()=>{try{const e={cartorio_token:M("user-data").value.cartorio_token},{data:s}=await w(n,{method:"POST",body:JSON.stringify(e)},"$7DferZWeQF");S.value=ne(s.value)}catch(o){console.error("Erro ao carregar formas de pagamento:",o)}},ee=()=>{const o=S.value.find(s=>s.token===m.forma);if(!o)return d.error("Por favor, selecione uma forma.");const e=P(m.valor);y.value.push({forma:m.forma,descricao:o.descricao,valor:e,btn_cancelar:!0}),k.value.push({forma_receb_token:m.forma,valor:e}),a.ordem.valor_pago=f(a.ordem.valor_pago+e),a.ordem.valor=f(a.ordem.valor-e),i.value=f(i.value-e),Object.assign(m,{forma:null,valor:"0.00"}),A()},oe=async o=>{const e=y.value.indexOf(o);if(o.id&&o.id!==null){o.btn_cancelar=!o.btn_cancelar;const{status:s}=await w(`${Q}/${o.id}`,{method:"PUT",body:{excluido:!0}},"$yTL1AnUqrk");s.value==="success"?d.success("Item marcado para remoção."):d.error("Erro ao marcar o item para remoção.")}else{y.value.splice(e,1),k.value.splice(e,1);const s=P(o.valor);a.ordem.valor_pago=f(a.ordem.valor_pago-s),i.value=f(i.value+s)}A()},P=o=>Number(o.toString().replace(/,/g,""));return Y(),(o,e)=>{const s=ae,N=fe;return C(),K(H,{persistent:"",modelValue:u(_),"onUpdate:modelValue":e[7]||(e[7]=l=>O(_)?_.value=l:null),"max-width":"650"},{default:t(()=>[r(E,null,{default:t(()=>[r(T,null,{default:t(()=>[r(g,{class:"mb-5 mt-1 ml-2"},{default:t(()=>[e[8]||(e[8]=c("h1",null,"Ordem de Serviço nº",-1)),c("h1",ve,j(a.ordem.numero),1)]),_:1}),r(T,null,{default:t(()=>[r(g,null,{default:t(()=>[r(z,{class:"mr-5",label:"Recebido",modelValue:a.ordem.valor_pago,"onUpdate:modelValue":e[0]||(e[0]=l=>a.ordem.valor_pago=l),readonly:"",style:{"font-weight":"bold",cursor:"default","pointer-events":"none"}},null,8,["modelValue"]),r(z,{label:"Falta Receber",modelValue:u(i),"onUpdate:modelValue":e[1]||(e[1]=l=>O(i)?i.value=l:null),readonly:"",style:{"font-weight":"bold",cursor:"default","pointer-events":"none"}},null,8,["modelValue"])]),_:1}),r(g,null,{default:t(()=>[r(ce,{class:"mb-5 mr-5",label:"Forma",modelValue:u(m).forma,"onUpdate:modelValue":e[2]||(e[2]=l=>u(m).forma=l),items:u(S),"item-title":"descricao","item-value":"token"},null,8,["modelValue","items"]),c("div",pe,[r(s,{modelValue:u(m).valor,"onUpdate:modelValue":e[3]||(e[3]=l=>u(m).valor=l)},null,8,["modelValue"])]),c("div",null,[c("img",{src:ue,class:"ml-5",style:{cursor:"pointer",height:"40px",width:"40px"},onClick:ee})])]),_:1})]),_:1}),e[9]||(e[9]=c("hr",{class:"mb-5"},null,-1)),r(de,{headers:Z,items:u(y),"item-value":"token"},{"item.forma":t(({item:l})=>[x(j(l.descricao),1)]),"item.actions":t(({item:l})=>[c("div",be,[l.btn_cancelar===!0?(C(),I("img",{key:0,src:me,style:{width:"30px",height:"30px",cursor:"pointer"},onClick:ge=>oe(l),alt:"Mudar Status"},null,8,_e)):q("",!0),l.btn_cancelar===!1?(C(),I("img",Ve)):q("",!0)])]),_:1},8,["items"])]),_:1}),c("div",ye,[r(R,{class:"ml-8",size:"large",onClick:B,color:"red"},{default:t(()=>e[10]||(e[10]=[x("Voltar")])),_:1}),r(R,{size:"large",class:"ml-6 mb-6",color:"green",onClick:e[4]||(e[4]=l=>a.ordem.valor>0?X():D())},{default:t(()=>e[11]||(e[11]=[x(" Salvar ")])),_:1})])]),_:1}),r(N,{modelValue:u(p),"onUpdate:modelValue":e[5]||(e[5]=l=>O(p)?p.value=l:null),faltaReceber:u(U),onClose:e[6]||(e[6]=l=>p.value=!1),onConfirmar:D},null,8,["modelValue","faltaReceber"])]),_:1},8,["modelValue"])}}};export{Me as _};
