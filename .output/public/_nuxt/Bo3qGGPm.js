import{_ as ne}from"./CH7smhNU.js";import{c as ye,r as he,u as be}from"./D9mhfAR6.js";import{H as ze,C as H,J as Q,u as ee,r as s,e as T,f as le,s as se,o as P,j as X,w as o,b as e,i as t,V as re,v as K,d as F,l as te,y as Me,a as v,c as W,k as pe,M as Re,N as De,F as Ce,O as we,t as ae}from"./53wtz2vB.js";import{u as w}from"./DEp3O3ub.js";import{V as q}from"./CQ4VLSVb.js";import{V as j}from"./ByL2bqCk.js";import{V as ue}from"./1RGlw7YC.js";import{V as me}from"./CesdksN3.js";import{_ as je,b as Ne,c as Ie,a as Ue}from"./AR8fguhP.js";import{_ as Be,a as Fe,b as Le,T as We,W as Je,D as Ve,c as Ke,d as Ge}from"./DYap6aty.js";import{_ as Ye,r as Pe}from"./Tg6EN9oL.js";import{_ as ce}from"./CzTVSLYn.js";import{_ as de}from"./BVz1G1IN.js";import{_ as Xe}from"./BXWRW_0h.js";import{_ as ke,a as xe}from"./DJvq3mCv.js";import{V as $e}from"./BUpEVBD4.js";import{_ as Ze}from"./C7c9nufs.js";import{V as He}from"./BaNYGi72.js";const jt={__name:"Dados",props:{ato_token:{type:String,required:!0},ato_tipo_id:{type:Number}},emits:["saved"],async setup(J,{emit:h}){let f,b;const k=J;ze(()=>k.ato_tipo_id,m=>{V.value={id:m}});const S=h,C=H(),E=Q(),L=te(),{$toast:O}=ee(),N=`${L.public.managemant}/listarSituacoes`,B=`${L.public.managemant}/createAtos`;`${L.public.managemant}`;const D=s(T("user-data").value.cartorio_token),g=s(T("user-service").value.id).value||s(T("user-service").value).value,I=s([]),V=s(k.ato_tipo_id?{id:k.ato_tipo_id}:null),y=le({dt_abertura:null,status:"EM EDIÇÃO",mne:null}),z={status:{required:ye.withMessage("O campo é obrigatorio",he)}},r=be(z,y);async function n(){if(await r.value.$validate()){const{data:m,error:p,status:d}=await w(B,{method:"POST",body:{ato_tipo_id:V.value.id,cartorio_id:T("user-data").value.cartorio_id,ordemserv_id:g,status:y.status,dt_abertura:y.dt_abertura,mne:y.mne,user_id:T("user-data").value.usuario_id,user_alteracao_id:T("user-data").value.usuario_id}},"$9ZmTYsLk0K");d.value==="success"&&(O.success("Ato registrado com sucesso!"),S("saved",{id:m.value.id,token:m.value.token}))}else O.error("Preencha os campos obrigatorios.")}const{data:l}=([f,b]=se(()=>w(N,{method:"POST",body:{cartorio_token:D.value}},"$hyq5YcBEjF")),f=await f,b(),f);I.value=l.value;const x=()=>{const m=E.query.origem||"criar",p=E.query.id;m==="atualizar"?C.push(`/os/atualizar/${p}`):C.push("/os/criar-registro")};return(m,p)=>{const d=ne;return P(),X(me,null,{default:o(()=>[e(q,{class:"mt-5"},{default:o(()=>[e(j,{cols:"3"},{default:o(()=>[e(ue,{label:"Situação",modelValue:t(y).status,"onUpdate:modelValue":p[0]||(p[0]=i=>t(y).status=i),items:t(I),"item-title":"descricao","item-value":"descricao",required:"","error-messages":t(r).status.$errors.map(i=>i.$message),onBlur:t(r).status.$touch,onInput:t(r).status.$touch},null,8,["modelValue","items","error-messages","onBlur","onInput"])]),_:1})]),_:1}),e(q,null,{default:o(()=>[e(j,{cols:"5"},{default:o(()=>[e(re,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:t(y).mne,"onUpdate:modelValue":p[1]||(p[1]=i=>t(y).mne=i)},null,8,["modelValue"])]),_:1})]),_:1}),e(q,null,{default:o(()=>[e(j,{cols:"2"},{default:o(()=>[e(re,{modelValue:t(y).dt_abertura,"onUpdate:modelValue":p[2]||(p[2]=i=>t(y).dt_abertura=i),type:"date",label:"Data Lavratura",disabled:"",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(q,{class:"mb-3"},{default:o(()=>[e(d,{onClick:x},{default:o(()=>[e(K,{size:"large",color:"red"},{default:o(()=>p[3]||(p[3]=[F("Voltar")])),_:1})]),_:1}),e(K,{class:"ml-10",onClick:n,size:"large",color:"green"},{default:o(()=>p[4]||(p[4]=[F("Salvar")])),_:1})]),_:1})]),_:1})}}},Qe=["onClick"],et=["onClick"],tt=["onClick"],ot={key:0,style:{width:"30px",height:"30px"},src:ke,alt:"Visualizar",title:"Reativar"},at={key:1,src:xe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},st=["onClick"],Nt={__name:"Partes",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},async setup(J){let h,f;const b=J,k=H(),S=Q(),C=te(),{$toast:E}=ee(),L=`${C.public.managemant}/pesquisarPessoas`,O=`${C.public.managemant}/listarPapeis`,N=`${C.public.managemant}/download`,B=`${C.public.managemant}/createAtosPessoa`,D=`${C.public.managemant}/getAtosPessoaById`,g=`${C.public.managemant}/updateAtosPessoa`,I=s(T("user-data").value.cartorio_token),V=s([]),y=s({}),z=s([]),r=s([]),n=s(!1),l=s(!1),x=s(!1),m=s(!1),p=s(null),d=s(null),i=s(null),_=s(null);s(null);const $=s(null),A=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"400px"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome"},{value:"actions"}],u=le({papeis:null,nome:null,pessoa:null,documento:null});Me(()=>{var c;return((c=u.pessoa)==null?void 0:c.link_ficha)||!1});const{data:Y}=([h,f]=se(()=>w(O,{method:"POST",body:{tipo_ato_token:b.ato_token}},"$fFKndZhA4W")),h=await h,f(),h);r.value=Y.value;async function G(){try{const{data:c,error:a}=await w(L,{method:"POST",body:{cartorio_token:I.value,documento:u.documento,nome:u.nome}},"$o3ZL1rvYrY");c.value.length>0?(V.value=c.value,u.pessoa=V.value[0]):V.value=[]}catch(c){console.error("Erro na requisição",c)}}const U=()=>{l.value=!0},oe=c=>{z.value=z.value.map(a=>a.id===i.value?{...a,papel:{...a.papel,descricao:c}}:a)},Z=c=>{const a=z.value.find(M=>M.pessoa.id===_.value);a.representante.nome=c},ie=async()=>{const c={pessoa:u.pessoa,papel:r.value.find(M=>M.id===u.papeis),representante:{nome:null}},a=await w(`${D}/${b.ato_id}`,{method:"GET"},"$kXSxUa4grs");for(const M of a.data.value)if(M.pessoa_id===u.pessoa.id&&M.ato_id===b.ato_id&&M.tipo_parte_id===u.papeis){E.error("Pessoa Já Registrada Com Esse Papel!");return}try{const{data:M,error:ve,status:fe}=await w(B,{method:"POST",body:{ato_id:Number(b.ato_id),pessoa_id:u.pessoa.id,tipo_parte_id:u.papeis,user_id:Number(T("user-data").value.usuario_id)}},"$So3qnQu7ek");fe.value==="success"?(c.id=M.value.id,E.success("Pessoa Registrada com Sucesso!"),z.value.push(c)):E.error(ve.value.message)}catch{E.error("Erro no servidor. Tente novamente.")}},_e=async c=>{x.value=!0;const{data:a}=await w(N,{method:"POST",body:{bucket:T("user-data").value.cartorio_token,path:c.pessoa.link_ficha}},"$Q3kbIwtd9t");$.value=a.value,y.value=c.pessoa},Ee=c=>{const a=z.value.filter(M=>M.pessoa.id!==c.pessoa.id).map(M=>({id:M.pessoa.id,nome:M.pessoa.nome}));i.value=c.id,p.value=a,n.value=!0,d.value=c.pessoa.nome,_.value=c.pessoa.id},Ae=c=>{i.value=c.id,m.value=!0,d.value=c.pessoa.nome};async function Se(c){c.excluido=!c.excluido;try{await w(`${g}/${i.value}`,{method:"PUT",body:JSON.stringify({excluido:c.excluido})},"$9xStKwGd7o")}catch(a){console.error("Erro ao excluir pessoa:",a)}}const Te=()=>{const c=S.query.origem||"criar",a=S.query.id;c==="atualizar"?k.push(`/os/atualizar/${a}`):k.push("/os/criar-registro")};return(c,a)=>{const M=je,ve=Fe,fe=Le,qe=Ye,Oe=ne;return P(),X(me,null,{default:o(()=>[e(q,{class:"mt-5"},{default:o(()=>[e(j,{cols:"3"},{default:o(()=>[e(re,{label:"Documento",modelValue:t(u).documento,"onUpdate:modelValue":a[0]||(a[0]=R=>t(u).documento=R)},null,8,["modelValue"])]),_:1}),e(j,{cols:"4"},{default:o(()=>[e(re,{label:"Pessoa",modelValue:t(u).nome,"onUpdate:modelValue":a[1]||(a[1]=R=>t(u).nome=R)},null,8,["modelValue"])]),_:1}),v("div",null,[v("img",{class:"mt-3",src:ce,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:G})]),v("div",null,[v("img",{class:"mt-3 ml-2",src:de,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:U})])]),_:1}),e(q,null,{default:o(()=>[e(j,{cols:"4"},{default:o(()=>[e(ue,{label:"Selecione a Pessoa",modelValue:t(u).pessoa,"onUpdate:modelValue":a[2]||(a[2]=R=>t(u).pessoa=R),items:t(V),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),e(j,{cols:"3"},{default:o(()=>[e(ue,{label:"Papel",modelValue:t(u).papeis,"onUpdate:modelValue":a[3]||(a[3]=R=>t(u).papeis=R),items:t(r),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),v("div",null,[v("img",{class:"mt-3",src:de,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:ie})])]),_:1}),e(q,null,{default:o(()=>[e(j,null,{default:o(()=>[e($e,{style:{height:"465px"},headers:A,items:t(z)},{"item.actions":o(({item:R})=>[e(q,null,{default:o(()=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ge=>_e(R),title:"Visualizar Ficha"},a[8]||(a[8]=[v("img",{style:{width:"30px",height:"30px"},src:ce,alt:"Visualizar"},null,-1)]),8,Qe),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ge=>Ae(R),class:"mr-2",title:"Alterar Papel"},a[9]||(a[9]=[v("img",{style:{width:"30px",height:"30px"},src:Xe,alt:"Visualizar"},null,-1)]),8,et),v("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ge=>Se(R),title:"Deletar Pessoa"},[R.excluido?(P(),W("img",ot)):(P(),W("img",at))],8,tt),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ge=>Ee(R),title:"Selecionar Representante"},a[10]||(a[10]=[v("img",{style:{width:"30px",height:"30px"},src:Be,alt:"Visualizar"},null,-1)]),8,st)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),e(M,{show:t(l),onClose:a[4]||(a[4]=R=>l.value=!1)},null,8,["show"]),e(ve,{representante_nome:t(d),representantes:t(p),ato_id:t(i),show:t(n),onClose:a[5]||(a[5]=R=>n.value=!1),onUpdateRepresentante:Z},null,8,["representante_nome","representantes","ato_id","show"]),e(fe,{representante_nome:t(d),ato_token:b.ato_token,ato_id:t(i),show:t(m),onClose:a[6]||(a[6]=R=>m.value=!1),onUpdatePapel:oe},null,8,["representante_nome","ato_token","ato_id","show"]),t(x)?(P(),X(qe,{key:0,show:t(x),"link-view":t($),"pessoa-obj":t(y),"is-view":!0,onClose:a[7]||(a[7]=R=>x.value=!1)},null,8,["show","link-view","pessoa-obj"])):pe("",!0),e(q,null,{default:o(()=>[e(Oe,{onClick:Te},{default:o(()=>[e(K,{size:"large",color:"red"},{default:o(()=>a[11]||(a[11]=[F("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},rt={key:0,class:"loading-overlay"},nt="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",It={__name:"Minuta",props:{ato_token:{type:String,required:!0}},emits:["page","doc"],setup(J,{emit:h}){const f=J;Re("DocumentEditorContainer",[We,Je]);const b=te(),{$toast:k}=ee(),S=H(),C=Q(),E=h;Pe(`${b.public.docEditor}`);const L=`${b.public.managemant}/upload`,O=s(null),N=s(!1),B=async()=>{const n=await O.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),l=new FileReader;l.onload=()=>{const x=l.result;E("doc",x)},l.readAsText(n)},D=async()=>{N.value=!0;try{const n=await O.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),l=new FormData;l.append("file",n,"anexo.docx"),l.append("cartorio_token",T("user-data").value.cartorio_token),l.append("token",f.ato_token),l.append("tipo","ato_minuta");const{data:x,status:m}=await w(L,{method:"POST",body:l},"$071xxdqs20");if(m.value==="success"){k.success("Documento enviado!");const d=O.value.ej2Instances.documentEditor.pageCount;B(),E("page",d)}else k.error("Erro ao enviar documento para o sistema.")}catch(r){k.error("Erro ao salvar documento."),console.error(r)}finally{N.value=!1}},g=async()=>{y(!0);try{await I(),y(!0);const{data:r,status:n}=await w(substituirModelo,{method:"POST",body:{ato_token:f.ato_token}},"$0ktpWliD4l");r.value&&V(r.value)}catch(r){console.error("Erro ao gerar a minuta:",r),k.error("Ocorreu um erro ao gerar a minuta.")}finally{y(!1)}},I=async()=>{try{const{data:r}=await w(baixarDocumento,{method:"POST",body:{bucket:T("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$jXVvQjEE6u"),n=await fetchBlobFromMinIO(r.value);if(n){const l=new FileReader;l.onload=()=>{const x=l.result;O.value.ej2Instances.documentEditor.open(x),E("doc",x)},l.readAsText(n)}}catch(r){console.error("Erro ao carregar o modelo de minuta:",r),k.error("Falha ao carregar o modelo de minuta.")}},V=r=>{const n=O.value.ej2Instances.documentEditor,l=x=>{for(const[m,p]of Object.entries(x))if(/^<<.+>>$/.test(m))try{n.search.findAll(m),n.search.searchResults.length>0&&n.search.searchResults.replaceAll(p)}catch(d){console.error(`Erro ao substituir o marcador ${m}:`,d)}else if(m==="partes"&&Array.isArray(p)&&p.length>0)for(const d of p)typeof d=="object"&&l(d)};l(r)},y=r=>{N.value=r},z=()=>{const r=C.query.origem||"criar",n=C.query.id;r==="atualizar"?S.push(`/os/atualizar/${n}`):S.push("/os/criar-registro")};return(r,n)=>{const l=ne;return P(),W(Ce,null,[e(t(Ve),{height:"900px",ref_key:"documentEditorContainer",ref:O,serviceUrl:nt,enableToolbar:!0,enableWordExport:!0},null,512),t(N)?(P(),W("div",rt,[e(De,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):pe("",!0),e(q,{class:"ml-4 mt-4 mb-4"},{default:o(()=>[e(l,{class:"mr-4"},{default:o(()=>[e(K,{size:"large",onClick:z,color:"red"},{default:o(()=>n[0]||(n[0]=[F("Voltar")])),_:1})]),_:1}),e(K,{size:"large",color:"green",onClick:D,disabled:t(N)},{default:o(()=>n[1]||(n[1]=[F("Salvar")])),_:1},8,["disabled"]),e(K,{class:"ml-4",size:"large",color:"blue",onClick:g},{default:o(()=>n[2]||(n[2]=[F("Gerar Minuta")])),_:1})]),_:1})],64)}}},lt=["innerHTML"],Ut={__name:"Livro",props:{ato_token:{type:String,required:!0},pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(J){let h,f;const b=J,k=te();Pe(`${k.public.docEditor}`);const{$toast:S}=ee(),C=H(),E=Q(),L=`${k.public.managemant}/listarEscrevente`,O=`${k.public.managemant}/lavrarAto`,N=`${k.public.managemant}/valida_lavratura`,B=s("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),D=s(!1),g=s(null),I=s(null),V=s(null),y=s(T("user-data").value.cartorio_token),z=T("auth_token").value,r=s([]),n=s({}),l=s(null),x=s(""),m=le({escrevente:null}),p=async(G=!1)=>{if(!G){const{data:Z}=await w(N,{method:"POST",body:{ato_token:b.ato_token}},"$ZKnVBNYxp9"),ie=Z.value[0].status,_e=Z.value[0].status_mensagem;if(ie!=="OK"){l.value=ie,x.value=_e,n.value=null,D.value=!0,B.value="O ato apresenta inconsistências, deseja prosseguir?";return}}const{data:U,status:oe}=await w(O,{method:"POST",body:{ato_token:b.ato_token,qtd_paginas:b.pages,escrevente_token:m.escrevente,usuario_token:z,cartorio_token:y}},"$XouuxOFIWh");oe.value==="success"?(g.value=U.value,I.value=U.value[0].selo,S.success("Ato lavrado com sucesso!")):S.error("Falha ao lavrar o ato.")},d=()=>{D.value=!1,l.value=null,x.value="",n.value={}},i=async()=>{const{data:G,status:U}=await w(calculaAto,{method:"POST",body:{ato_token:E.query.ato_token_edit,cartorio_token:y,quantidade:1,usuario_token:z,escrevente_token:m.escrevente,qtd_paginas:b.pages}},"$R51FaaSzOI");U.value==="success"?n.value=G.value[0]:S.error("Falha ao calcular o ato.")},_=async()=>{D.value=!1,l.value&&l.value!=="OK"?(await p(!0),l.value=null,x.value=""):await p()},$=async()=>{D.value=!0,await i()},{data:A}=([h,f]=se(()=>w(L,{method:"POST",body:{cartorio_token:y}},"$JCPnpnnRzP")),h=await h,f(),h);r.value=A.value[0].func_json_escreventes;const u=function(){V.value.ej2Instances.documentEditor.open(b.document)},Y=()=>{const G=E.query.origem||"criar",U=E.query.id;G==="atualizar"?C.push(`/os/atualizar/${U}`):C.push("/os/criar-registro")};return(G,U)=>{const oe=Ze;return P(),W(Ce,null,[e(q,null,{default:o(()=>[e(j,null,{default:o(()=>[(P(),X(t(Ve),{restrictEditing:!0,enableToolbar:!1,created:b.document?u:null,ref_key:"documentEditorContainer",ref:V,height:"850px",width:"850px",key:b.document},null,8,["created"]))]),_:1}),e(j,null,{default:o(()=>[e(ue,{class:"mt-15",label:"Tabelião/escrevente",modelValue:t(m).escrevente,"onUpdate:modelValue":U[0]||(U[0]=Z=>t(m).escrevente=Z),items:t(r),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),v("div",null,[v("div",null,[v("img",{onClick:U[1]||(U[1]=Z=>$()),class:"ml-2",style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:Ke}),t(g)?(P(),X(He,{key:0,class:"mr-16"},{default:o(()=>[e(q,{"no-gutters":""},{default:o(()=>[e(j,null,{default:o(()=>[e(we,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:o(()=>[e(j,null,{default:o(()=>[F(" Livro: "+ae(t(g)[0].livro_numero),1)]),_:1}),e(j,null,{default:o(()=>[F(" Protocolo: "+ae(t(g)[0].protocolo?t(g)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),e(j,null,{default:o(()=>[e(we,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:o(()=>[F(" Folhas : "+ae(t(g)[0].pagina_inicial)+" A "+ae(t(g)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),v("div",{innerHTML:t(I)},null,8,lt)]),_:1})):pe("",!0)])])]),_:1})]),_:1}),e(K,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:Y},{default:o(()=>U[2]||(U[2]=[F("Voltar")])),_:1}),e(oe,{show:t(D),condMessage:t(B),valor:t(n),description:t(x),onClose:d,onConfirm:_},null,8,["show","condMessage","valor","description"])],64)}}},it=["onClick"],ut=["onClick"],ct={key:0,style:{width:"30px",height:"30px"},src:ke,alt:"Visualizar",title:"Reativar"},dt={key:1,src:xe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Bt={__name:"Observacao",props:{ato_id:{type:Number,required:!0}},async setup(J){let h,f;const b=J,k=H(),S=Q(),C=te();ee();const E=`${C.public.managemant}/listarEscrevente`,L=`${C.public.managemant}/getAtosTiposByToken`;`${C.public.managemant}`;const O=`${C.public.managemant}/atos_observacao`,N=s(T("user-data").value.cartorio_token),B=s([]),D=s([]),g=s(!1),I=s(!1),V=s(""),y=[{title:"Data",align:"start",key:"data"},{title:"Escrevente",align:"start",key:"escrevente"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}],z=le({observacao:null}),r={observacao:{required:ye.withMessage("O campo é obrigatorio",he)}};be(r,z),[h,f]=se(()=>w(`${L}/${b.ato_token}`,{method:"GET"},"$aJM1TL1buW")),h=await h,f();function n(d){V.value=d.observacao,I.value=!0,g.value=!0}const l=()=>{I.value=!1,g.value=!0,V.value=""};async function x(d){d.excluido=!d.excluido;try{await w(`${O}/${d.id}`,{method:"PUT",body:JSON.stringify({excluido:d.excluido})},"$dMg99jeUNP")}catch(i){console.error("Erro ao excluir observacao:",i)}}const{data:m}=([h,f]=se(()=>w(E,{method:"POST",body:{cartorio_token:N}},"$B6PdRx8Gp4")),h=await h,f(),h);D.value=m.value[0].func_json_escreventes;const p=()=>{const d=S.query.origem||"criar",i=S.query.id;d==="atualizar"?k.push(`/os/atualizar/${i}`):k.push("/os/criar-registro")};return(d,i)=>{const _=Ge,$=ne;return P(),X(me,null,{default:o(()=>[e(q,{class:"mt-5"},{default:o(()=>[e(K,{class:"mb-4 ml-8",onClick:l,size:"large",color:"green"},{default:o(()=>i[2]||(i[2]=[F("Novo")])),_:1}),v("div",null,[v("img",{class:"btn-pointer ml-2",src:de,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:i[0]||(i[0]=(...A)=>d.onSubmit&&d.onSubmit(...A))})])]),_:1}),e(q,null,{default:o(()=>[e(j,null,{default:o(()=>[e($e,{style:{height:"465px"},headers:y,items:t(B)},{"item.observacao":o(({item:A})=>[F(ae(A.observacao.length>100?A.observacao.slice(0,100)+"...":A.observacao),1)]),"item.actions":o(({item:A})=>[e(q,null,{default:o(()=>[v("div",{onClick:u=>n(A)},i[3]||(i[3]=[v("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ce,alt:"Visualizar"},null,-1)]),8,it),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:u=>x(A),title:"Deletar Observação"},[A.excluido?(P(),W("img",ct)):(P(),W("img",dt))],8,ut)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),t(g)?(P(),X(_,{key:0,show:t(g),observacao:t(V),visualizar:t(I),onClose:i[1]||(i[1]=A=>g.value=!1)},null,8,["show","observacao","visualizar"])):pe("",!0),e(q,null,{default:o(()=>[e($,{onClick:p},{default:o(()=>[e(K,{size:"large",color:"red"},{default:o(()=>i[4]||(i[4]=[F("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},pt={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ne,alt:"Criar"},mt={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ie,alt:"Criar"},_t={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ue,alt:"Criar"},vt=["onClick"],ft=["onClick"],gt=["onClick"],yt={key:0,style:{width:"30px",height:"30px"},src:ke,alt:"Visualizar",title:"Reativar"},ht={key:1,src:xe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Ft={__name:"Anexos",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},setup(J){const h=J,f=te(),{$toast:b}=ee(),k=H(),S=Q(),C=`${f.public.biometria}/run-scanner`,E=`${f.public.managemant}/atos_anexos`,L=`${f.public.managemant}/atos_anexos`,O=`${f.public.managemant}/download`;`${f.public.managemant}`,`${f.public.managemant}`;const N=s(!1),B=s(null),D=s([]);T("pessoa_token");const g=le({descricao:"",fileEvent:null}),I={descricao:{required:ye.withMessage("O campo é obrigatório",he)}},V=be(I,g,{$autoDirty:!0}),y=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}];async function z(){try{await r(),await n()}catch(_){console.error("Erro ao executar scanner ou listar arquivos:",_)}}async function r(){try{const{data:_}=await w(C,{method:"GET"},"$WazoKp68Tw")}catch(_){b.error("Erro ao acionar o scanner:",_)}}async function n(){try{const{data:_,status:$}=await w("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:S.query.ato_token_edit,cartorio_token:T("user-data").value.cartorio_token}},"$03Wxiia3aI")}catch(_){console.error("Erro ao enviar o arquivo:",_)}}const l=async()=>{N.value=!0};function x(_){return _?!0:(console.error("Erro: Nenhum arquivo foi selecionado!"),B.value=!1,!1)}const m=async()=>{if(V.value.$touch(),!V.value.$invalid&&x(g.fileEvent)){const{data:_,error:$,status:A}=await w(E,{method:"POST",body:{ato_id:h.ato_id,descricao:g.descricao,user_id:T("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$WyW0hasRPI");A.value==="success"&&(b.success("Anexo registrado com sucesso!"),D.value.push(_.value))}};async function p(_){_.excluido=!_.excluido;try{await w(`${L}/${_.id}`,{method:"PUT",body:JSON.stringify({excluido:_.excluido})},"$Y3y6TjqbSV")}catch($){console.error("Erro ao excluir pessoa:",$)}}async function d(_){try{const $=await w(`${O}`,{method:"POST",body:{bucket:T("user-data").value.cartorio_token,path:_.link}},"$bkXJSi7s76"),u=await(await fetch($.data.value)).blob(),Y=URL.createObjectURL(u);window.open(Y,"_blank")}catch($){console.error("Erro ao excluir pessoa:",$)}}const i=()=>{const _=S.query.origem||"criar",$=S.query.id;_==="atualizar"?k.push(`/os/atualizar/${$}`):k.push("/os/criar-registro")};return(_,$)=>{const A=ne;return P(),X(me,null,{default:o(()=>[e(q,null,{default:o(()=>[e(j,{cols:"5",class:"mt-2"},{default:o(()=>[e(re,{modelValue:t(g).descricao,"onUpdate:modelValue":[$[0]||($[0]=u=>t(g).descricao=u),t(V).descricao.$touch],"error-messages":t(V).descricao.$errors.map(u=>u.$message),onBlur:t(V).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"])]),_:1}),v("div",{onClick:z,title:"Criar",style:{"padding-right":"10px"}},[t(B)===!1?(P(),W("img",pt)):t(B)===!0?(P(),W("img",mt)):(P(),W("img",_t))]),v("div",{onClick:m,title:"Criar"},$[1]||($[1]=[v("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:de,alt:"Escanear"},null,-1)]))]),_:1}),e($e,{headers:y,items:t(D),style:{height:"465px","max-width":"600px"}},{"item.actions":o(({item:u})=>[e(q,null,{default:o(()=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:Y=>l(u),title:"Visualizar Anexo"},[v("img",{style:{width:"30px",height:"30px"},onClick:Y=>d(u),src:ce,alt:"Visualizar"},null,8,ft)],8,vt),v("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:Y=>p(u),title:"Deletar Pessoa"},[u.excluido?(P(),W("img",yt)):(P(),W("img",ht))],8,gt)]),_:2},1024)]),_:1},8,["items"]),e(A,{onClick:i},{default:o(()=>[e(K,{size:"large",color:"red"},{default:o(()=>$[2]||($[2]=[F("Voltar")])),_:1})]),_:1})]),_:1})}}};export{jt as _,Nt as a,It as b,Ut as c,Bt as d,Ft as e};
