import{_ as pe}from"./JlQkR5Ep.js";import{a as ce,_ as me}from"./Dlnqi5ml.js";import{u as ve,r as u,e as r,f as fe,y as _e,m as ge,h as _,w as n,k as be,o as g,b as l,a as i,t as ke,i as a,q as Ve,s as T,p as H,v as D,x as Ce,V as ye,d as xe}from"./DRaUCYIu.js";import{_ as $e}from"./DJ76oMBP.js";import{_ as he}from"./BVz1G1IN.js";import{_ as we}from"./gq1sqmF6.js";import{_ as Oe}from"./LNBvxnia.js";import{_ as Se}from"./tgrDYS3m.js";import{c as J,r as W,u as Te}from"./BkqLXJFV.js";import{u as A}from"./1zHOOLER.js";import"./DQIgvI77.js";import{f as De}from"./Bv6XwzS6.js";import{V as Ae}from"./BP-43IfJ.js";import{V as y}from"./Hg6i5c29.js";import{V as x}from"./Bgy3z4kd.js";import{V as Ne}from"./QkfWEfKs.js";import{V as Re}from"./DMm8xb1-.js";import"./BfXb2Y63.js";import"./3CqgsptR.js";import"./D5DmKkg3.js";import"./BuvYh9EX.js";import"./s7_nstSd.js";import"./BYaGnJdC.js";import"./CZsMlnK8.js";import"./B2RcQ1sK.js";import"./BuXASzVT.js";import"./HxpmNk1j.js";const Be={style:{color:"red","margin-left":"30px"}},Ee=["onClick"],qe=["onClick"],Fe=["onClick","title"],Pe=["onClick"],ze=["title"],vt={__name:"criar-registro",async setup(Ie){var F,P,z,I,U,L,M;let b,N;const{$toast:m}=ve(),k=be(),j=`${k.public.managemant}/createOrdensServico`,G=`${k.public.managemant}/validarCpf`,X=`${k.public.managemant}/listarAtos`,K=`${k.public.managemant}/updateAtos`,Q=u(r("user-data").value.cartorio_id),Y=u(r("user-data").value.usuario_id),Z=u((F=r("user-service").value)==null?void 0:F.token).value||null,ee=u(r("user-data").value.cartorio_token).value,V=u((P=r("user-service").value)==null?void 0:P.numero),C=u((z=r("user-service").value)==null?void 0:z.isDisabled);let R=u(!!((I=r("user-service").value)!=null&&I.numero)),$=u(r("ordem-button").value),h=!1;const B=u(null),w=u(!1),O=u([]),s=fe({nacionalidade:((U=r("user-service").value)==null?void 0:U.estrangeiro)||!1,apresentante_nome:(L=r("user-service").value)==null?void 0:L.apresentante_nome,apresentante_cpf:(M=r("user-service").value)==null?void 0:M.apresentante_cpf}),v=u(!1),te=[{title:"ID",value:"id"},{title:"Protocolo",value:"protocolo"},{title:"Usuario",value:"usuario_nome"},{title:"Situação",value:"situacao"},{title:"Valor",value:"valor"},{title:"Tipo",value:"tipo"},{value:"actions"}],ae=[{title:"BRASILEIRO",value:!1},{title:"ESTRANGEIRO",value:!0}],oe={apresentante_nome:{required:J.withMessage("O campo é obrigatorio",W)},apresentante_cpf:{required:J.withMessage("O campo é obrigatorio",W)}},p=Te(oe,s);function E(o){if(o)return o.replace(/[.\-]/g,"");o=null}const re=o=>{redirectTo({item:o,id:r("user-service").value.id,numeroOs:V.value,origem:"vizualizar"})},se=o=>{redirectTo({item:o,id:r("user-service").value.id,numeroOs:V.value,origem:"atualizar"})};function ie(){const o=r("user-service"),t=r("ordem-button");o.value=null,t.value=null}const ne=o=>{B.value=o,w.value=!0};async function le(){const o={apresentante_cpf:E(s.apresentante_cpf),apresentante_nome:s.apresentante_nome,user_id:Y.value,cartorio_id:Q.value,estrangeiro:s.nacionalidade};if(await p.value.$validate()){const{data:t,error:c,status:d}=await A(j,{method:"POST",body:o},"$HqnOwnLBio");if(d.value==="error"&&c.value.statusCode===500)m.error("Erro ao cadastrar ordem,erro no sistema.");else{m.success("Ordem registrada com sucesso!"),R.value=!0,$.value=!1,V.value=t.value.numero;const f=r("ordem-button");f.value=$.value;const e=r("user-service");e.value=e.value=JSON.stringify({numero:t.value.numero,id:t.value.id,apresentante_cpf:t.value.apresentante_cpf,apresentante_nome:t.value.apresentante_nome,estrangeiro:t.value.estrangeiro,token:t.value.token,isDisabled:!0}),v.value=!0}}}async function ue(o){const t=E(o);if(t.length===11&&!h){h=!0;const c={cpf:t};try{const{data:d,error:f,status:e}=await A(G,{method:"POST",body:c},"$DfuVr7OuaN");e.value==="error"&&f.value.statusCode===500?m.error("Erro ao cadastrar pessoa, o CPF já está cadastrado."):d.value.cpfValidation===!0?(s.apresentante_nome=d.value.nome,m.success("Cpf autenticado com sucesso!")):d.value.cpfValidation===!1&&m.error("Cpf não cadastrado!")}catch(d){console.error("Erro ao validar CPF:",d)}finally{h=!1}}}async function de(o){o.excluido=!o.excluido;try{await De(`${K}/${o.id}`,{method:"PUT",body:{excluido:o.excluido}})}catch(t){console.error("Erro ao excluir pessoa:",t)}}const{data:q}=([b,N]=_e(()=>A(X,{method:"POST",body:{cartorio_token:ee,ordemserv_token:Z}},"$bJ1XcDsWLH")),b=await b,N(),b);return q.value.length>0?O.value=q.value:O.value=[],(o,t)=>{const c=pe,d=me,f=ge("mask");return g(),_(Ae,{class:"mt-5"},{default:n(()=>[l(y,{class:"mb-5"},{default:n(()=>{var e;return[t[7]||(t[7]=i("h1",null,"Ordem de Serviço nº",-1)),i("h1",Be,ke(a(V)||((e=("useCookie"in o?o.useCookie:a(r))("user-service").value)==null?void 0:e.numero)),1)]}),_:1}),l(y,null,{default:n(()=>[l(x,{md:"3"},{default:n(()=>[l(Ne,{label:"Nacionalidade",items:ae,modelValue:a(s).nacionalidade,"onUpdate:modelValue":t[0]||(t[0]=e=>a(s).nacionalidade=e),disabled:a(C)||a(v)},null,8,["modelValue","disabled"])]),_:1}),l(x,{md:"2"},{default:n(()=>[a(s).nacionalidade===!1?Ve((g(),_(T,{key:0,autofocus:"",modelValue:a(s).apresentante_cpf,"onUpdate:modelValue":t[1]||(t[1]=e=>a(s).apresentante_cpf=e),label:"CPF",required:"","error-messages":a(p).apresentante_cpf.$errors.map(e=>e.$message),onBlur:a(p).apresentante_cpf.$touch,onInput:t[2]||(t[2]=e=>ue(a(s).apresentante_cpf)),disabled:a(C)||a(v)},null,8,["modelValue","error-messages","onBlur","disabled"])),[[f,"###.###.###-##"]]):(g(),_(T,{key:1,autofocus:"",modelValue:a(s).apresentante_cpf,"onUpdate:modelValue":t[3]||(t[3]=e=>a(s).apresentante_cpf=e),label:"Documento",required:"","error-messages":a(p).apresentante_cpf.$errors.map(e=>e.$message),onBlur:a(p).apresentante_cpf.$touch,disabled:a(C)||a(v)},null,8,["modelValue","error-messages","onBlur","disabled"]))]),_:1}),l(x,{md:"4"},{default:n(()=>[l(T,{modelValue:a(s).apresentante_nome,"onUpdate:modelValue":t[4]||(t[4]=e=>a(s).apresentante_nome=e),label:"Nome Apresentante",required:"","error-messages":a(p).apresentante_nome.$errors.map(e=>e.$message),onInput:a(p).apresentante_nome.$touch,disabled:a(C)||a(v)},null,8,["modelValue","error-messages","onInput","disabled"])]),_:1}),a($)?(g(),_(x,{key:0},{default:n(()=>[i("div",null,[i("img",{style:{width:"40px",height:"40px",cursor:"pointer"},src:$e,alt:"Salvar",onClick:t[5]||(t[5]=e=>le())})])]),_:1})):H("",!0)]),_:1}),a(R)?(g(),_(y,{key:0,style:{display:"flex","margin-bottom":"10px",gap:"2rem"}},{default:n(()=>[t[11]||(t[11]=i("h1",{class:"ml-5"},"Atos",-1)),l(c,{to:{path:"/os/criar-ato",query:{origem:"criar"}}},{default:n(()=>t[8]||(t[8]=[i("img",{style:{width:"45px",height:"45px",cursor:"pointer"},src:he,alt:"novo"},null,-1)])),_:1}),l(Re,{headers:te,items:a(O),"item-key":"id"},{"item.actions":n(({item:e})=>[l(y,{style:{display:"flex",gap:"2px","margin-top":"-5px"}},{default:n(()=>[i("div",{onClick:S=>re(e),title:"Visualizar"},t[9]||(t[9]=[i("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:we,alt:"Visualizar"},null,-1)]),8,Ee),i("div",{onClick:S=>ne(e.token),title:"Reimprimir"},t[10]||(t[10]=[i("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ce,alt:"Reimprimir"},null,-1)]),8,qe),i("div",{class:Ce({disabled:!e.btn_editar}),onClick:S=>e.btn_editar?se({id:e.id,tipo:e.tipo,token:e.token,tipo_token:e.tipo_token,rota:e.rota}):null,title:e.btn_editar?"Editar":"Desabilitado"},[i("img",{style:D({cursor:e.btn_editar?"pointer":"default",width:"30px",height:"30px"}),src:Oe,alt:"Editar"},null,4)],10,Fe),i("div",{onClick:S=>e.btn_cancelar?de(e):null,title:"Excluir",style:D({cursor:e.btn_cancelar?"pointer":"not-allowed"})},[i("img",{style:D({width:"30px",height:"30px",cursor:e.btn_cancelar?"pointer":"not-allowed",opacity:e.btn_cancelar?"1":"0.5"}),src:Se,alt:"Cancelar",title:e.btn_cancelar?"Cancelar":"Não permitido"},null,12,ze)],12,Pe)]),_:2},1024)]),_:1},8,["items"]),l(d,{show:a(w),ato_token:a(B),onClose:t[6]||(t[6]=e=>w.value=!1)},null,8,["show","ato_token"])]),_:1})):H("",!0),l(c,{to:"/os/lista"},{default:n(()=>[l(ye,{size:"large",color:"red",onClick:ie},{default:n(()=>t[12]||(t[12]=[xe("Voltar")])),_:1})]),_:1})]),_:1})}}};export{vt as default};
