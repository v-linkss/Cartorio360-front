import{_ as te}from"./CjIyr1ba.js";import{c as ce,r as de,u as me}from"./dygJZCrA.js";import{g as Oe,D as H,H as X,u as Z,r as i,m as P,E as oe,I as ee,o as A,C as Y,w as o,b as e,s as t,V as K,z as G,d as W,A as Q,a as _,c as F,v as ze,N as De,O as Me,J as ye,F as he,P as ge,t as ie}from"./BtoUabsN.js";import{u as k}from"./CF4HZHhm.js";import{V as z}from"./CaLFK6z5.js";import{V as N}from"./iYH1_FD3.js";import{V as pe}from"./C0ncvcx_.js";import{V as se}from"./CJ3fSt9M.js";import{_ as Re}from"./CBVsRvLg.js";import{_ as je,a as Be,b as Ie,T as Ne,W as Ue,r as be,D as xe,c as Fe,e as Le,f as We,d as Ge}from"./D0ALPRp7.js";import{_ as ue}from"./BY98d50j.js";import{_ as ae}from"./BVz1G1IN.js";import{_ as Je}from"./BAGrgZyY.js";import{_ as _e,a as ve}from"./DJvq3mCv.js";import{V as fe}from"./DIidcIpw.js";import{V as Ye}from"./BfCuv1I2.js";import{V as ke}from"./5fXIeGAC.js";import{V as Ke}from"./Czcnt_A8.js";import{_ as He}from"./9w6C4IRR.js";import{f as Xe}from"./B0IxRygJ.js";const jt={__name:"Dados",props:{ato_token:{type:String,required:!0},ato_tipo_id:{type:Number}},emits:["saved"],async setup(L,{emit:f}){let v,y;const b=L;Oe(()=>b.ato_tipo_id,g=>{$.value={id:g}});const E=f,x=H(),V=X(),j=Q(),{$toast:S}=Z(),R=`${j.public.managemant}/listarSituacoes`,D=`${j.public.managemant}/createAtos`;`${j.public.managemant}`;const M=i(P("user-data").value.cartorio_token),T=i(P("user-service").value.id).value||i(P("user-service").value).value,B=i([]),$=i(b.ato_tipo_id?{id:b.ato_tipo_id}:null),d=oe({dt_abertura:null,status:"EM EDIÇÃO",mne:null}),I={status:{required:ce.withMessage("O campo é obrigatorio",de)}},r=me(I,d);async function u(){if(await r.value.$validate()){const{data:g,error:s,status:n}=await k(D,{method:"POST",body:{ato_tipo_id:$.value.id,cartorio_id:P("user-data").value.cartorio_id,ordemserv_id:T,status:d.status,dt_abertura:d.dt_abertura,mne:d.mne,user_id:P("user-data").value.usuario_id,user_alteracao_id:P("user-data").value.usuario_id}},"$9ZmTYsLk0K");n.value==="success"&&(S.success("Ato registrado com sucesso!"),E("saved",{id:g.value.id,token:g.value.token}))}else S.error("Preencha os campos obrigatorios.")}const{data:c}=([v,y]=ee(()=>k(R,{method:"POST",body:{cartorio_token:M.value}},"$hyq5YcBEjF")),v=await v,y(),v);B.value=c.value;const C=()=>{const g=V.query.origem||"criar",s=V.query.id;g==="atualizar"?x.push(`/os/atualizar/${s}`):x.push("/os/criar-registro")};return(g,s)=>{const n=te;return A(),Y(se,null,{default:o(()=>[e(z,{class:"mt-5"},{default:o(()=>[e(N,{cols:"3"},{default:o(()=>[e(pe,{label:"Situação",modelValue:t(d).status,"onUpdate:modelValue":s[0]||(s[0]=m=>t(d).status=m),items:t(B),"item-title":"descricao","item-value":"descricao",required:"","error-messages":t(r).status.$errors.map(m=>m.$message),onBlur:t(r).status.$touch,onInput:t(r).status.$touch},null,8,["modelValue","items","error-messages","onBlur","onInput"])]),_:1})]),_:1}),e(z,null,{default:o(()=>[e(N,{cols:"5"},{default:o(()=>[e(K,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:t(d).mne,"onUpdate:modelValue":s[1]||(s[1]=m=>t(d).mne=m)},null,8,["modelValue"])]),_:1})]),_:1}),e(z,null,{default:o(()=>[e(N,{cols:"2"},{default:o(()=>[e(K,{modelValue:t(d).dt_abertura,"onUpdate:modelValue":s[2]||(s[2]=m=>t(d).dt_abertura=m),type:"date",label:"Data Lavratura",disabled:"",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(z,{class:"mb-3"},{default:o(()=>[e(n,{onClick:C},{default:o(()=>[e(G,{size:"large",color:"red"},{default:o(()=>s[3]||(s[3]=[W("Voltar")])),_:1})]),_:1}),e(G,{class:"ml-10",onClick:u,size:"large",color:"green"},{default:o(()=>s[4]||(s[4]=[W("Salvar")])),_:1})]),_:1})]),_:1})}}},Ze=["onClick"],Qe=["onClick"],et=["onClick"],tt={key:0,style:{width:"30px",height:"30px"},src:_e,alt:"Visualizar",title:"Reativar"},ot={key:1,src:ve,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},at=["onClick"],Bt={__name:"Partes",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},async setup(L){let f,v;const y=L,b=H(),E=X(),x=Q(),{$toast:V}=Z(),j=`${x.public.managemant}/pesquisarPessoas`,S=`${x.public.managemant}/listarPapeis`,R=`${x.public.managemant}/getLinkTipo`,D=`${x.public.managemant}/createAtosPessoa`,M=`${x.public.managemant}/getAtosPessoaById`,T=`${x.public.managemant}/updateAtosPessoa`,B=i(P("user-data").value.cartorio_token),$=i([]),d=i([]),I=i([]),r=i(!1),u=i(!1),c=i(!1),C=i(!1),g=i(null),s=i(null),n=i(null),m=i(null);i(null);const l=i(null),h=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome"},{value:"actions"}],w=oe({papeis:null,nome:null,pessoa:null,documento:null}),{data:U}=([f,v]=ee(()=>k(S,{method:"POST",body:{tipo_ato_token:y.ato_token}},"$fFKndZhA4W")),f=await f,v(),f);I.value=U.value;async function J(){try{const{data:p,error:a}=await k(j,{method:"POST",body:{cartorio_token:B.value,documento:w.documento,nome:w.nome}},"$o3ZL1rvYrY");p.value.length>0?($.value=p.value,w.pessoa=$.value[0]):$.value=[]}catch(p){console.error("Erro na requisição",p)}}const $e=()=>{u.value=!0},we=p=>{d.value=d.value.map(a=>a.id===n.value?{...a,papel:{...a.papel,descricao:p}}:a)},Ve=p=>{const a=d.value.find(q=>q.pessoa.id===m.value);a.representante.nome=p},Ce=async()=>{const p={pessoa:w.pessoa,papel:I.value.find(q=>q.id===w.papeis),representante:{nome:null}},a=await k(`${M}/${y.ato_id}`,{method:"GET"},"$kXSxUa4grs");for(const q of a.data.value)if(q.pessoa_id===w.pessoa.id&&q.ato_id===y.ato_id&&q.tipo_parte_id===w.papeis){V.error("Pessoa Já Registrada Com Esse Papel!");return}try{const{data:q,error:re,status:ne}=await k(D,{method:"POST",body:{ato_id:Number(y.ato_id),pessoa_id:w.pessoa.id,tipo_parte_id:w.papeis,user_id:Number(P("user-data").value.usuario_id)}},"$So3qnQu7ek");ne.value==="success"?(p.id=q.value.id,V.success("Pessoa Registrada com Sucesso!"),d.value.push(p)):V.error(re.value.message)}catch{V.error("Erro no servidor. Tente novamente.")}},Ee=async p=>{c.value=!0,l.value=null;const{data:a}=await k(`${R}`,{method:"POST",body:{id:p.pessoa.id,tipo:"ficha"}},"$Q3kbIwtd9t");a.value&&a.value.link?l.value=`data:image/jpeg;base64,${a.value.link}`:l.value=null},Pe=p=>{const a=d.value.filter(q=>q.pessoa.id!==p.pessoa.id).map(q=>({id:q.pessoa.id,nome:q.pessoa.nome}));n.value=p.id,g.value=a,r.value=!0,s.value=p.pessoa.nome,m.value=p.pessoa.id},Ae=p=>{n.value=p.id,C.value=!0,s.value=p.pessoa.nome};async function Se(p){p.excluido=!p.excluido;try{await k(`${T}/${n.value}`,{method:"PUT",body:JSON.stringify({excluido:p.excluido})},"$9xStKwGd7o")}catch(a){console.error("Erro ao excluir pessoa:",a)}}const Te=()=>{const p=E.query.origem||"criar",a=E.query.id;p==="atualizar"?b.push(`/os/atualizar/${a}`):b.push("/os/criar-registro")};return(p,a)=>{const q=Re,re=Be,ne=Ie,qe=te;return A(),Y(se,null,{default:o(()=>[e(z,{class:"mt-5"},{default:o(()=>[e(N,{cols:"3"},{default:o(()=>[e(K,{label:"Documento",modelValue:t(w).documento,"onUpdate:modelValue":a[0]||(a[0]=O=>t(w).documento=O)},null,8,["modelValue"])]),_:1}),e(N,{cols:"4"},{default:o(()=>[e(K,{label:"Pessoa",modelValue:t(w).nome,"onUpdate:modelValue":a[1]||(a[1]=O=>t(w).nome=O)},null,8,["modelValue"])]),_:1}),_("div",null,[_("img",{class:"mt-3",src:ue,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:J})]),_("div",null,[_("img",{class:"mt-3 ml-2",src:ae,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:$e})])]),_:1}),e(z,null,{default:o(()=>[e(N,{cols:"4"},{default:o(()=>[e(pe,{label:"Selecione a Pessoa",modelValue:t(w).pessoa,"onUpdate:modelValue":a[2]||(a[2]=O=>t(w).pessoa=O),items:t($),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),_("div",null,[_("img",{class:"mt-3",src:ae,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:Ce})])]),_:1}),e(z,null,{default:o(()=>[e(N,null,{default:o(()=>[e(fe,{style:{height:"465px"},headers:h,items:t(d)},{"item.actions":o(({item:O})=>[e(z,null,{default:o(()=>[_("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:le=>Ee(O),title:"Visualizar Ficha"},a[8]||(a[8]=[_("img",{style:{width:"30px",height:"30px"},src:ue,alt:"Visualizar"},null,-1)]),8,Ze),_("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:le=>Ae(O),class:"mr-2",title:"Alterar Papel"},a[9]||(a[9]=[_("img",{style:{width:"30px",height:"30px"},src:Je,alt:"Visualizar"},null,-1)]),8,Qe),_("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:le=>Se(O),title:"Deletar Pessoa"},[O.excluido?(A(),F("img",tt)):(A(),F("img",ot))],8,et),_("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:le=>Pe(O),title:"Selecionar Representante"},a[10]||(a[10]=[_("img",{style:{width:"30px",height:"30px"},src:je,alt:"Visualizar"},null,-1)]),8,at)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),e(q,{show:t(u),onClose:a[3]||(a[3]=O=>u.value=!1)},null,8,["show"]),e(re,{representante_nome:t(s),representantes:t(g),ato_id:t(n),show:t(r),onClose:a[4]||(a[4]=O=>r.value=!1),onUpdateRepresentante:Ve},null,8,["representante_nome","representantes","ato_id","show"]),e(ne,{representante_nome:t(s),ato_token:y.ato_token,ato_id:t(n),show:t(C),onClose:a[5]||(a[5]=O=>C.value=!1),onUpdatePapel:we},null,8,["representante_nome","ato_token","ato_id","show"]),e(Ye,{modelValue:t(c),"onUpdate:modelValue":a[7]||(a[7]=O=>ze(c)?c.value=O:null),width:"600"},{default:o(()=>[e(ke,{"max-width":"600",title:"Ficha"},{default:o(()=>[e(Ke,{src:t(l)},null,8,["src"]),e(G,{class:"ms-auto mt-3 mb-3",text:"Fechar",size:"large",color:"red",onClick:a[6]||(a[6]=O=>c.value=!1)})]),_:1})]),_:1},8,["modelValue"]),e(z,null,{default:o(()=>[e(qe,{onClick:Te},{default:o(()=>[e(G,{size:"large",color:"red"},{default:o(()=>a[11]||(a[11]=[W("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},st={key:0,class:"loading-overlay"},rt="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",It={__name:"Minuta",props:{ato_token:{type:String,required:!0}},emits:["page","doc"],setup(L,{emit:f}){const v=L;De("DocumentEditorContainer",[Ne,Ue]);const y=Q(),{$toast:b}=Z(),E=H(),x=X(),V=f;be(`${y.public.docEditor}`);const j=`${y.public.managemant}/upload`,S=i(null),R=i(!1),D=async()=>{const u=await S.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),c=new FileReader;c.onload=()=>{const C=c.result;V("doc",C)},c.readAsText(u)},M=async()=>{R.value=!0;try{const u=await S.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),c=new FormData;c.append("file",u,"anexo.docx"),c.append("cartorio_token",P("user-data").value.cartorio_token),c.append("token",v.ato_token),c.append("tipo","ato_minuta");const{data:C,status:g}=await k(j,{method:"POST",body:c},"$071xxdqs20");if(g.value==="success"){b.success("Documento enviado!");const n=S.value.ej2Instances.documentEditor.pageCount;D(),V("page",n)}else b.error("Erro ao enviar documento para o sistema.")}catch(r){b.error("Erro ao salvar documento."),console.error(r)}finally{R.value=!1}},T=async()=>{d(!0);try{await B(),d(!0);const{data:r,status:u}=await k(substituirModelo,{method:"POST",body:{ato_token:v.ato_token}},"$0ktpWliD4l");r.value&&$(r.value)}catch(r){console.error("Erro ao gerar a minuta:",r),b.error("Ocorreu um erro ao gerar a minuta.")}finally{d(!1)}},B=async()=>{try{const{data:r}=await k(baixarDocumento,{method:"POST",body:{bucket:"qvgjz",path:"provider/modeloAto.sfdt"}},"$jXVvQjEE6u"),u=await fetchBlobFromMinIO(r.value);if(u){const c=new FileReader;c.onload=()=>{const C=c.result;S.value.ej2Instances.documentEditor.open(C),V("doc",C)},c.readAsText(u)}}catch(r){console.error("Erro ao carregar o modelo de minuta:",r),b.error("Falha ao carregar o modelo de minuta.")}},$=r=>{const u=S.value.ej2Instances.documentEditor,c=C=>{for(const[g,s]of Object.entries(C))if(/^<<.+>>$/.test(g))try{u.search.findAll(g),u.search.searchResults.length>0&&u.search.searchResults.replaceAll(s)}catch(n){console.error(`Erro ao substituir o marcador ${g}:`,n)}else if(g==="partes"&&Array.isArray(s)&&s.length>0)for(const n of s)typeof n=="object"&&c(n)};c(r)},d=r=>{R.value=r},I=()=>{const r=x.query.origem||"criar",u=x.query.id;r==="atualizar"?E.push(`/os/atualizar/${u}`):E.push("/os/criar-registro")};return(r,u)=>{const c=te;return A(),F(he,null,[e(t(xe),{height:"900px",ref_key:"documentEditorContainer",ref:S,serviceUrl:rt,enableToolbar:!0,enableWordExport:!0},null,512),t(R)?(A(),F("div",st,[e(Me,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):ye("",!0),e(z,{class:"ml-4 mt-4 mb-4"},{default:o(()=>[e(c,{class:"mr-4"},{default:o(()=>[e(G,{size:"large",onClick:I,color:"red"},{default:o(()=>u[0]||(u[0]=[W("Voltar")])),_:1})]),_:1}),e(G,{size:"large",color:"green",onClick:M,disabled:t(R)},{default:o(()=>u[1]||(u[1]=[W("Salvar")])),_:1},8,["disabled"]),e(G,{class:"ml-4",size:"large",color:"blue",onClick:T},{default:o(()=>u[2]||(u[2]=[W("Gerar Minuta")])),_:1})]),_:1})],64)}}},nt=["innerHTML"],Nt={__name:"Livro",props:{ato_token:{type:String,required:!0},pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(L){let f,v;const y=L,b=Q();be(`${b.public.docEditor}`);const{$toast:E}=Z(),x=H(),V=X(),j=`${b.public.managemant}/listarEscrevente`,S=`${b.public.managemant}/lavrarAto`,R=i("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),D=i(!1),M=i(null),T=i(null),B=i(null),$=i(P("user-data").value.cartorio_token),d=P("auth_token").value,I=i([]),r=oe({escrevente:null}),u=async()=>{try{const{data:n,status:m}=await k(S,{method:"POST",body:{ato_token:y.ato_token,qtd_paginas:y.pages,escrevente_token:r.escrevente,usuario_token:d,cartorio_token:$}},"$ZKnVBNYxp9");m.value==="success"?(M.value=n.value,T.value=n.value[0].selo,E.success("Ato lavrado com sucesso!")):E.error("Falha ao lavrar o ato.")}catch{E.error("Erro ao conectar com o servidor.")}},c=()=>{D.value=!1,u()},{data:C}=([f,v]=ee(()=>k(j,{method:"POST",body:{cartorio_token:$}},"$XouuxOFIWh")),f=await f,v(),f);I.value=C.value[0].func_json_escreventes;const g=function(){B.value.ej2Instances.documentEditor.open(y.document)},s=()=>{const n=V.query.origem||"criar",m=V.query.id;n==="atualizar"?x.push(`/os/atualizar/${m}`):x.push("/os/criar-registro")};return(n,m)=>{const l=He;return A(),F(he,null,[e(z,null,{default:o(()=>[e(N,null,{default:o(()=>[(A(),Y(t(xe),{restrictEditing:!0,enableToolbar:!1,created:y.document?g:null,ref_key:"documentEditorContainer",ref:B,height:"850px",width:"850px",key:y.document},null,8,["created"]))]),_:1}),e(N,null,{default:o(()=>[e(pe,{class:"mt-15",label:"Tabelião/escrevente",modelValue:t(r).escrevente,"onUpdate:modelValue":m[0]||(m[0]=h=>t(r).escrevente=h),items:t(I),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),_("div",null,[_("div",null,[_("img",{onClick:m[1]||(m[1]=h=>D.value=!0),class:"ml-2",style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:Fe}),t(M)?(A(),Y(ke,{key:0,class:"mr-16"},{default:o(()=>[e(z,{"no-gutters":""},{default:o(()=>[e(N,null,{default:o(()=>[e(ge,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:o(()=>[W(" Livro: "+ie(t(M)[0].livro_numero),1)]),_:1})]),_:1}),e(N,null,{default:o(()=>[e(ge,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:o(()=>[W(" Folhas : "+ie(t(M)[0].pagina_inicial)+" A "+ie(t(M)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),_("div",{innerHTML:t(T)},null,8,nt)]),_:1})):ye("",!0)])])]),_:1})]),_:1}),e(G,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:s},{default:o(()=>m[3]||(m[3]=[W("Voltar")])),_:1}),e(l,{show:t(D),condMessage:t(R),onClose:m[2]||(m[2]=h=>D.value=!1),onConfirm:c},null,8,["show","condMessage"])],64)}}},lt=["onClick"],it={key:0,style:{width:"30px",height:"30px"},src:_e,alt:"Visualizar",title:"Reativar"},ut={key:1,src:ve,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Ut={__name:"Observacao",props:{ato_id:{type:Number,required:!0}},async setup(L){let f,v;const y=L,b=H(),E=X(),x=Q(),{$toast:V}=Z(),j=`${x.public.managemant}/listarEscrevente`,S=`${x.public.managemant}/getAtosTiposByToken`,R=`${x.public.managemant}/atos_observacao`,D=`${x.public.managemant}/atos_observacao`,M=i(P("user-data").value.cartorio_token),T=i([]),B=i([]),$=[{title:"Data",align:"start",key:"data"},{title:"Escrevente",align:"start",key:"escrevente"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}],d=oe({observacao:null}),I={observacao:{required:ce.withMessage("O campo é obrigatorio",de)}},r=me(I,d);[f,v]=ee(()=>k(`${S}/${y.ato_token}`,{method:"GET"},"$aJM1TL1buW")),f=await f,v();async function u(){if(await r.value.$validate()){const{data:s,error:n,status:m}=await k(R,{method:"POST",body:{ato_id:y.ato_id,observacao:d.observacao,user_id:P("user-data").value.usuario_id}},"$dMg99jeUNP");m.value==="success"&&(T.value.push({data:Xe(s.value.created,"dd/mm/yyyy hh:mm"),observacao:s.value.observacao,id:s.value.id,escrevente:P("user-data").value.nome}),V.success("Observação registrada com sucesso"))}else V.error("Preencha os campos obrigatorios.")}async function c(s){s.excluido=!s.excluido;try{await k(`${D}/${s.id}`,{method:"PUT",body:JSON.stringify({excluido:s.excluido})},"$B6PdRx8Gp4")}catch(n){console.error("Erro ao excluir observacao:",n)}}const{data:C}=([f,v]=ee(()=>k(j,{method:"POST",body:{cartorio_token:M}},"$xFHPGua26S")),f=await f,v(),f);B.value=C.value[0].func_json_escreventes;const g=()=>{const s=E.query.origem||"criar",n=E.query.id;s==="atualizar"?b.push(`/os/atualizar/${n}`):b.push("/os/criar-registro")};return(s,n)=>{const m=te;return A(),Y(se,null,{default:o(()=>[e(z,{class:"mt-5"},{default:o(()=>[e(K,{label:"Observação",modelValue:t(d).observacao,"onUpdate:modelValue":n[0]||(n[0]=l=>t(d).observacao=l),required:"","error-messages":t(r).observacao.$errors.map(l=>l.$message),onBlur:t(r).observacao.$touch,onInput:t(r).observacao.$touch},null,8,["modelValue","error-messages","onBlur","onInput"]),_("div",null,[_("img",{class:"btn-pointer ml-2",src:ae,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:u})])]),_:1}),e(z,null,{default:o(()=>[e(N,null,{default:o(()=>[e(fe,{style:{height:"465px"},headers:$,items:t(T)},{"item.actions":o(({item:l})=>[_("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:h=>c(l),title:"Deletar Observação"},[l.excluido?(A(),F("img",it)):(A(),F("img",ut))],8,lt)]),_:1},8,["items"])]),_:1})]),_:1}),e(z,null,{default:o(()=>[e(m,{onClick:g},{default:o(()=>[e(G,{size:"large",color:"red"},{default:o(()=>n[1]||(n[1]=[W("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},ct={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Le,alt:"Criar"},dt={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:We,alt:"Criar"},mt={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ge,alt:"Criar"},pt=["onClick"],_t=["onClick"],vt=["onClick"],ft={key:0,style:{width:"30px",height:"30px"},src:_e,alt:"Visualizar",title:"Reativar"},gt={key:1,src:ve,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Ft={__name:"Anexos",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},setup(L){const f=L,v=Q(),{$toast:y}=Z(),b=H(),E=X(),x=`${v.public.biometria}/run-scanner`,V=`${v.public.managemant}/atos_anexos`,j=`${v.public.managemant}/atos_anexos`,S=`${v.public.managemant}/download`;`${v.public.managemant}`,`${v.public.managemant}`;const R=i(!1),D=i(null),M=i([]);P("pessoa_token");const T=oe({descricao:"",fileEvent:null}),B={descricao:{required:ce.withMessage("O campo é obrigatório",de)}},$=me(B,T,{$autoDirty:!0}),d=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}];async function I(){try{await r(),await u()}catch(l){console.error("Erro ao executar scanner ou listar arquivos:",l)}}async function r(){try{const{data:l}=await k(x,{method:"GET"},"$WazoKp68Tw")}catch(l){y.error("Erro ao acionar o scanner:",l)}}async function u(){try{const{data:l,status:h}=await k("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:E.query.ato_token_edit,cartorio_token:P("user-data").value.cartorio_token}},"$03Wxiia3aI")}catch(l){console.error("Erro ao enviar o arquivo:",l)}}const c=async()=>{R.value=!0};function C(l){return l?(console.log("Arquivo válido:",l.name),!0):(console.error("Erro: Nenhum arquivo foi selecionado!"),D.value=!1,!1)}const g=async()=>{if($.value.$touch(),!$.value.$invalid&&C(T.fileEvent)){const{data:l,error:h,status:w}=await k(V,{method:"POST",body:{ato_id:f.ato_id,descricao:T.descricao,user_id:P("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$WyW0hasRPI");w.value==="success"&&(y.success("Anexo registrado com sucesso!"),M.value.push(l.value),console.log(`createAnexo
`,l.value.token))}};async function s(l){l.excluido=!l.excluido;try{await k(`${j}/${l.id}`,{method:"PUT",body:JSON.stringify({excluido:l.excluido})},"$Y3y6TjqbSV")}catch(h){console.error("Erro ao excluir pessoa:",h)}}async function n(l){try{const h=await k(`${S}`,{method:"POST",body:{bucket:P("user-data").value.cartorio_token,path:l.link}},"$bkXJSi7s76"),U=await(await fetch(h.data.value)).blob(),J=URL.createObjectURL(U);window.open(J,"_blank")}catch(h){console.error("Erro ao excluir pessoa:",h)}}const m=()=>{const l=E.query.origem||"criar",h=E.query.id;l==="atualizar"?b.push(`/os/atualizar/${h}`):b.push("/os/criar-registro")};return(l,h)=>{const w=te;return A(),Y(se,null,{default:o(()=>[e(z,null,{default:o(()=>[e(N,{cols:"5",class:"mt-2"},{default:o(()=>[e(K,{modelValue:t(T).descricao,"onUpdate:modelValue":[h[0]||(h[0]=U=>t(T).descricao=U),t($).descricao.$touch],"error-messages":t($).descricao.$errors.map(U=>U.$message),onBlur:t($).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"])]),_:1}),_("div",{onClick:I,title:"Criar",style:{"padding-right":"10px"}},[t(D)===!1?(A(),F("img",ct)):t(D)===!0?(A(),F("img",dt)):(A(),F("img",mt))]),_("div",{onClick:g,title:"Criar"},h[1]||(h[1]=[_("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:ae,alt:"Escanear"},null,-1)]))]),_:1}),e(fe,{headers:d,items:t(M),style:{height:"465px","max-width":"600px"}},{"item.actions":o(({item:U})=>[e(z,null,{default:o(()=>[_("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:J=>c(U),title:"Visualizar Anexo"},[_("img",{style:{width:"30px",height:"30px"},onClick:J=>n(U),src:ue,alt:"Visualizar"},null,8,_t)],8,pt),_("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:J=>s(U),title:"Deletar Pessoa"},[U.excluido?(A(),F("img",ft)):(A(),F("img",gt))],8,vt)]),_:2},1024)]),_:1},8,["items"]),e(w,{onClick:m},{default:o(()=>[e(G,{size:"large",color:"red"},{default:o(()=>h[2]||(h[2]=[W("Voltar")])),_:1})]),_:1})]),_:1})}}};export{jt as _,Bt as a,It as b,Nt as c,Ut as d,Ft as e};
