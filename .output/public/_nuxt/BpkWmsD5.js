import{c as N,r as T,u as ie}from"./D9lSe22M.js";import{L as de,P as ne,u as re,m as y,r as ue,n as me,G as ce,x as pe,z as fe,o as C,c as z,q as a,p as D,S as _e,t as ve,A,w as t,b as s,C as n,B as $,V as q,d as R,F as Ve,v as be}from"./B2VtM2rW.js";import{$ as V,f as I}from"./BB7DuAK_.js";import{f as ge,a as O}from"./B0IxRygJ.js";import{u as ye}from"./ofnURvvQ.js";import{V as f}from"./CKJp8KVK.js";import{V as d}from"./BWDM5pjC.js";import{V as U}from"./CtpVxkyR.js";import{V as Ce}from"./Dv6nqkSV.js";import{V as $e}from"./SaEGSYn3.js";const Pe={key:1},Te={__name:"DadosEstrangeira",props:{isModal:{type:Boolean,default:!1}},emits:["saved","close-modal"],async setup(G,{emit:L}){let b,x;const w=G,P=L,E=de(),j=ne(),{$toast:p}=re(),u=be(),W=`${u.public.auth}/service/gerencia/getPessoaById`,H=`${u.public.auth}/service/gerencia/createPessoa`,J=`${u.public.auth}/service/gerencia/updatePessoa`,K=`${u.public.auth}/service/gerencia/listarEstadoCivil`,Q=`${u.public.auth}/service/gerencia/listarCapacidadeCivil`,X=`${u.public.auth}/service/gerencia/listarCidades`,Y=`${u.public.auth}/service/gerencia/listarSexo`,Z=`${u.public.auth}/service/gerencia/listarPais`,{id:B}=j.params,h={nome:null,nome_pai:null,nome_mae:null,profissao:null,local_trabalho:null,data_nascimento:null,doc_identificacao:null,fone_celular:null,cpf_pai:null,cpf_mae:null,tipo_pessoa:"ESTRANGEIRA",tabvalores_estadocivil_id:null,tabvalores_capacidadecivil_id:null,tabvalores_nacionalidade_id:null,tabvalores_sexo_id:null,cidade_nascimento_estrangeiro:null,cartorio_id:y("user-data").value.cartorio_id,user_id:y("user-data").value.usuario_id},k=ue(!1),S=y("pessoa-id"),e=me({...h});function _(i){if(i)return i.replace(/[.\-]/g,"");i=null}const ee=async()=>{const{data:i,error:o}=await I(`${W}/${B}`,{method:"GET"});i.value&&(i.value.data_nascimento=i.value.data_nascimento?ge(i.value.data_nascimento,"dd/mm/yyyy"):null),Object.assign(e,i.value)},{data:g,status:ke,pending:M,error:F}=([b,x]=ce(async()=>ye("cliente-dados",async()=>{const[i,o,r,l,v]=await Promise.all([V(K),V(Q),V(X),V(Y),V(Z)]);return{estadoCivilItems:i,capacidadeCivilItems:o,cidadeNascimentoItems:r,sexoItems:l,paisItems:v}})),b=await b,x(),b),ae={nome:{required:N.withMessage("O campo é obrigatorio",T)},nome_mae:{required:N.withMessage("O campo é obrigatorio",T)}},m=ie(ae,e);async function oe(){if(await m.value.$validate()){const i={...e};for(const c in i)i[c]===""&&(i[c]=null);const o={...i,doc_identificacao:_(e.doc_identificacao),cpf_pai:_(e.cpf_pai),cpf_mae:_(e.cpf_mae),data_nascimento:O(e.data_nascimento),fone_celular:e.fone_celular?e.fone_celular.replace(/[^0-9]/g,""):null},{data:r,error:l,status:v}=await I(H,{method:"POST",body:o});if(v.value==="error"&&l.value.statusCode===500)p.error("Erro ao cadastrar pessoa,o CPF já está cadastrado.");else{p.success("Pessoa cadastrada com sucesso!");const c=r.value.id;S.value=c;const te=y("pessoa_token");te.value=r.value.token,k.value=!0,P("saved")}}else p.error("Erro ao cadastrar pessoa, preencha os campos obrigatorios.")}async function le(){const i={...e};for(const c in i)i[c]===""&&(i[c]=null);const o={...i,doc_identificacao:_(e.doc_identificacao),cpf_mae:_(e.cpf_mae),fone_celular:e.fone_celular?e.fone_celular.replace(/[^0-9]/g,""):"",data_nascimento:O(e.data_nascimento)},{data:r,error:l,status:v}=await I(`${J}/${S.value}`,{method:"PUT",body:o});if(v.value==="success"){if(w.isModal===!0){p.success("Pessoa atualizada com sucesso!"),P("close-modal");return}p.success("Pessoa atualizada com sucesso!"),E.push("/pessoas/lista")}else p.error("Erro ao atualizar Pessoa Estrangeira")}const se=()=>{if(w.isModal===!0){P("close-modal");return}E.push("/pessoas/lista")};return pe(()=>{B&&(ee(),k.value=!0)}),(i,o)=>{const r=fe("mask");return C(),z(Ve,null,[a(M)?(C(),D(_e,{key:0,class:"loading-spinner",indeterminate:"",size:"64"})):a(F)?(C(),z("div",Pe,ve(a(F).message),1)):A("",!0),a(M)?A("",!0):(C(),D($e,{key:2},{default:t(()=>[s(f,null,{default:t(()=>[s(d,{md:"3"},{default:t(()=>[s(U,{label:"País",modelValue:a(e).tabvalores_nacionalidade_id,"onUpdate:modelValue":o[0]||(o[0]=l=>a(e).tabvalores_nacionalidade_id=l),items:a(g).paisItems,"item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1}),s(d,{md:"4"},{default:t(()=>[s(n,{modelValue:a(e).nome,"onUpdate:modelValue":o[1]||(o[1]=l=>a(e).nome=l),"error-messages":a(m).nome.$errors.map(l=>l.$message),label:"Nome",required:"",onBlur:a(m).nome.$touch,onInput:a(m).nome.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1}),s(d,{md:"3"},{default:t(()=>[s(n,{modelValue:a(e).doc_identificacao,"onUpdate:modelValue":o[2]||(o[2]=l=>a(e).doc_identificacao=l),label:"Documento"},null,8,["modelValue"])]),_:1}),s(d,{md:"2"},{default:t(()=>[s(Ce,{label:"Sexo",modelValue:a(e).tabvalores_sexo_id,"onUpdate:modelValue":o[3]||(o[3]=l=>a(e).tabvalores_sexo_id=l),items:a(g).sexoItems,"item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1})]),_:1}),s(f,null,{default:t(()=>[s(d,{md:"4"},{default:t(()=>[s(U,{modelValue:a(e).tabvalores_estadocivil_id,"onUpdate:modelValue":o[4]||(o[4]=l=>a(e).tabvalores_estadocivil_id=l),items:a(g).estadoCivilItems,"item-title":"descricao","item-value":"id",label:"Estado Civil"},null,8,["modelValue","items"])]),_:1}),s(d,{md:"4"},{default:t(()=>[s(n,{modelValue:a(e).profissao,"onUpdate:modelValue":o[5]||(o[5]=l=>a(e).profissao=l),label:"Profissão"},null,8,["modelValue"])]),_:1}),s(d,{md:"4"},{default:t(()=>[s(n,{modelValue:a(e).local_trabalho,"onUpdate:modelValue":o[6]||(o[6]=l=>a(e).local_trabalho=l),label:"Local de trabalho"},null,8,["modelValue"])]),_:1})]),_:1}),s(f,null,{default:t(()=>[s(d,{md:"2"},{default:t(()=>[$(s(n,{modelValue:a(e).data_nascimento,"onUpdate:modelValue":o[7]||(o[7]=l=>a(e).data_nascimento=l),label:"Data de nascimento",placeholder:"dd/mm/yyyy"},null,8,["modelValue"]),[[r,"##/##/####"]])]),_:1}),s(d,{md:"2"},{default:t(()=>[$(s(n,{modelValue:a(e).fone_celular,"onUpdate:modelValue":o[8]||(o[8]=l=>a(e).fone_celular=l),label:"Celular",placeholder:"'(99) 99999-9999'"},null,8,["modelValue"]),[[r,"(##) #####-####"]])]),_:1}),s(d,{md:"4"},{default:t(()=>[s(U,{modelValue:a(e).tabvalores_capacidadecivil_id,"onUpdate:modelValue":o[9]||(o[9]=l=>a(e).tabvalores_capacidadecivil_id=l),items:a(g).capacidadeCivilItems,label:"Capacidade Civil","item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1}),s(d,{md:"4"},{default:t(()=>[s(n,{modelValue:a(e).cidade_nascimento_estrangeiro,"onUpdate:modelValue":o[10]||(o[10]=l=>a(e).cidade_nascimento_estrangeiro=l),label:"Cidade de nascimento"},null,8,["modelValue"])]),_:1})]),_:1}),s(f,null,{default:t(()=>[s(d,{md:"4"},{default:t(()=>[$(s(n,{modelValue:a(e).cpf_pai,"onUpdate:modelValue":o[11]||(o[11]=l=>a(e).cpf_pai=l),label:"CPF do Pai"},null,8,["modelValue"]),[[r,"###.###.###-##"]])]),_:1}),s(d,{md:"4"},{default:t(()=>[s(n,{modelValue:a(e).nome_pai,"onUpdate:modelValue":o[12]||(o[12]=l=>a(e).nome_pai=l),label:"Nome do Pai"},null,8,["modelValue"])]),_:1})]),_:1}),s(f,null,{default:t(()=>[s(d,{md:"4"},{default:t(()=>[$(s(n,{modelValue:a(e).cpf_mae,"onUpdate:modelValue":o[13]||(o[13]=l=>a(e).cpf_mae=l),label:"CPF da Mãe"},null,8,["modelValue"]),[[r,"###.###.###-##"]])]),_:1}),s(d,{md:"4"},{default:t(()=>[s(n,{modelValue:a(e).nome_mae,"onUpdate:modelValue":o[14]||(o[14]=l=>a(e).nome_mae=l),modelModifiers:{date:!0},"error-messages":a(m).nome_mae.$errors.map(l=>l.$message),label:"Nome da Mãe",required:"",onBlur:a(m).nome_mae.$touch,onInput:a(m).nome_mae.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1})]),_:1}),s(f,{class:"mb-3"},{default:t(()=>[s(q,{onClick:se,size:"large",color:"red"},{default:t(()=>o[16]||(o[16]=[R("Voltar")])),_:1}),s(q,{onClick:o[15]||(o[15]=l=>a(k)?le():oe()),class:"ml-4",size:"large",color:"green"},{default:t(()=>o[17]||(o[17]=[R("Salvar")])),_:1})]),_:1})]),_:1}))],64)}}};export{Te as _};
