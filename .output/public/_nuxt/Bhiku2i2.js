import{_ as le}from"./6JPoiRvd.js";import{a as L,d as te,V as K}from"./C_rF8QLg.js";import{V as M}from"./D30AxCUa.js";import{V as y,u as k}from"./CarYcNlS.js";import{r as v,g as G,o as w,G as J,w as r,b as t,a as d,A as O,d as x,v as u,x as C,u as re,m as j,D as se,t as z,V as I,c as E,K as q,s as ne,bx as ue}from"./B9oWilC6.js";import{_ as me,b as ie,a as de}from"./BP1uhy__.js";import{V as ce}from"./nJ1bzlTB.js";import{V as fe}from"./D1Izg-54.js";const pe={__name:"ModalRecebimentoCond",props:{show:Boolean,faltaReceber:Number},emits:["close","confirmar"],setup(R,{emit:$}){const a=R,b=v(a.show),c=$;G(()=>a.show,V=>{b.value=V});const _=()=>{c("confirmar"),p()},p=()=>{b.value=!1,c("close")};return(V,n)=>(w(),J(K,{persistent:"",modelValue:u(b),"onUpdate:modelValue":n[0]||(n[0]=h=>C(b)?b.value=h:null),"max-width":"650"},{default:r(()=>[t(L,null,{default:r(()=>[t(M,null,{default:r(()=>[t(y,{class:"mb-5 mt-1 ml-2"},{default:r(()=>n[1]||(n[1]=[d("h1",null,"Confirmação de Recebimento",-1)])),_:1}),t(y,{class:"ml-2"},{default:r(()=>n[2]||(n[2]=[d("p",null," O valor recebido é menor que o valor da OS, confirma o recebimento parcial? ",-1)])),_:1})]),_:1}),t(te,null,{default:r(()=>[t(O,{style:{"background-color":"#429946",color:"white"},onClick:_},{default:r(()=>n[3]||(n[3]=[x("Confirmar")])),_:1}),t(O,{style:{"background-color":"red",color:"white"},onClick:p},{default:r(()=>n[4]||(n[4]=[x("Cancelar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ve={style:{color:"red","margin-left":"18px"}},be={style:{"max-width":"180px"}},_e={style:{display:"flex","justify-content":"flex-end"}},Ve=["onClick"],ge=["onClick"],ye={style:{display:"flex","justify-content":"flex-start"}},Fe={__name:"Ordem",props:{show:Boolean,ordem:{type:Object,required:!0}},emits:["close"],setup(R,{emit:$}){const a=R,b=$,{$toast:c}=re(),_=v(a.show),p=v(!1),V=ne(),n=`${V.public.managemant}/listarFormasReceb`,h=`${V.public.managemant}/listar_recebimentos_os`,Q=`${V.public.managemant}/receberOs`,W=`${V.public.managemant}/caixasLanctos`,Z=j("auth_token").value,F=v([]),T=v(null),g=v([]),S=v([]),m=se({descricao:null,forma:null,valor:""}),H=[{title:"Forma",value:"descricao"},{title:"Valor",value:"valor"},{value:"actions"}],i=v(0),X=()=>{i.value=f(a.ordem.valor-a.ordem.valor_pago)};G(()=>a.show,async o=>{_.value=o;const{data:e}=await k(h,{method:"POST",body:{os_token:a.ordem.token}},"$vhMIR8Sr2p"),s=Array.isArray(e.value)?e.value:[];s&&(g.value=s.map(({forma_recebimento:N,...l})=>({descricao:N,...l}))),o&&X()});const U=()=>{_.value=!1,Object.assign(m,{forma:null,descricao:null,valor:""}),g.value=[],b("close")},Y=()=>{T.value=Number(a.ordem.valor),p.value=!0},B=async()=>{try{const o={ordemserv_token:a.ordem.token,usuario_token:Z,recebimentos:[S.value]},{data:e}=await k(Q,{method:"POST",body:o},"$eiMzO5y6Bb");e.value[0].status==="OK"?(c.success(`${e.value[0].status}: Valores Recebidos com Sucesso!`),g.value=[],U()):c.error(e.value[0].status_mensagem)}catch(o){c.error(o)}},D=()=>{a.ordem.valor=f(a.ordem.valor),a.ordem.valor_pago=f(a.ordem.valor_pago),i.value=f(i.value)},f=o=>Number(parseFloat(o).toFixed(2)),ee=async()=>{try{const e={cartorio_token:j("user-data").value.cartorio_token},{data:s}=await k(n,{method:"POST",body:JSON.stringify(e)},"$7DferZWeQF");F.value=ue(s.value)}catch(o){console.error("Erro ao carregar formas de pagamento:",o)}},oe=()=>{const o=F.value.find(s=>s.token===m.forma);if(!o)return c.error("Por favor, selecione uma forma.");const e=P(m.valor);g.value.push({forma:m.forma,descricao:o.descricao,valor:e,btn_cancelar:!0}),S.value.push({forma_receb_token:m.forma,valor:e}),a.ordem.valor_pago=f(a.ordem.valor_pago+e),a.ordem.valor=f(a.ordem.valor-e),i.value=f(i.value-e),Object.assign(m,{forma:null,valor:"0.00"}),D()},A=async o=>{const e=g.value.indexOf(o);if(o.id&&o.id!==null){o.excluido=!o.excluido;const{status:s}=await k(`${W}/${o.id}`,{method:"PUT",body:{excluido:o.excluido}},"$yTL1AnUqrk");s.value==="success"?c.success("Item marcado para remoção."):c.error("Erro ao marcar o item para remoção.")}else{g.value.splice(e,1),S.value.splice(e,1);const s=P(o.valor);a.ordem.valor_pago=f(a.ordem.valor_pago-s),i.value=f(i.value+s)}D()},P=o=>Number(o.toString().replace(/,/g,""));return ee(),(o,e)=>{const s=le,N=pe;return w(),J(K,{persistent:"",modelValue:u(_),"onUpdate:modelValue":e[7]||(e[7]=l=>C(_)?_.value=l:null),"max-width":"650"},{default:r(()=>[t(L,null,{default:r(()=>[t(M,null,{default:r(()=>[t(y,{class:"mb-5 mt-1 ml-2"},{default:r(()=>[e[8]||(e[8]=d("h1",null,"Ordem de Serviço nº",-1)),d("h1",ve,z(a.ordem.numero),1)]),_:1}),t(M,null,{default:r(()=>[t(y,null,{default:r(()=>[t(I,{class:"mr-5",label:"Recebido",modelValue:a.ordem.valor_pago,"onUpdate:modelValue":e[0]||(e[0]=l=>a.ordem.valor_pago=l),readonly:"",style:{"font-weight":"bold",cursor:"default","pointer-events":"none"}},null,8,["modelValue"]),t(I,{label:"Falta Receber",modelValue:u(i),"onUpdate:modelValue":e[1]||(e[1]=l=>C(i)?i.value=l:null),readonly:"",style:{"font-weight":"bold",cursor:"default","pointer-events":"none"}},null,8,["modelValue"])]),_:1}),t(y,null,{default:r(()=>[t(ce,{class:"mb-5 mr-5",label:"Forma",modelValue:u(m).forma,"onUpdate:modelValue":e[2]||(e[2]=l=>u(m).forma=l),items:u(F),"item-title":"descricao","item-value":"token"},null,8,["modelValue","items"]),d("div",be,[t(s,{modelValue:u(m).valor,"onUpdate:modelValue":e[3]||(e[3]=l=>u(m).valor=l)},null,8,["modelValue"])]),d("div",null,[d("img",{src:me,class:"ml-5",style:{cursor:"pointer",height:"40px",width:"40px"},onClick:oe})])]),_:1})]),_:1}),e[9]||(e[9]=d("hr",{class:"mb-5"},null,-1)),t(fe,{headers:H,items:u(g),"item-value":"token"},{"item.forma":r(({item:l})=>[x(z(l.descricao),1)]),"item.actions":r(({item:l})=>[d("div",_e,[l.btn_cancelar===!0?(w(),E("img",{key:0,src:ie,style:{width:"30px",height:"30px",cursor:"pointer"},onClick:ae=>A(l),alt:"Mudar Status"},null,8,Ve)):q("",!0),l.btn_cancelar===!1?(w(),E("img",{key:1,src:de,style:{width:"30px",height:"30px",cursor:"pointer"},onClick:ae=>A(l),alt:"Remover"},null,8,ge)):q("",!0)])]),_:1},8,["items"])]),_:1}),d("div",ye,[t(O,{class:"ml-8",size:"large",onClick:U,color:"red"},{default:r(()=>e[10]||(e[10]=[x("Voltar")])),_:1}),t(O,{size:"large",class:"ml-6 mb-6",color:"green",onClick:e[4]||(e[4]=l=>a.ordem.valor>0?Y():B())},{default:r(()=>e[11]||(e[11]=[x(" Salvar ")])),_:1})])]),_:1}),t(N,{modelValue:u(p),"onUpdate:modelValue":e[5]||(e[5]=l=>C(p)?p.value=l:null),faltaReceber:u(T),onClose:e[6]||(e[6]=l=>p.value=!1),onConfirmar:B},null,8,["modelValue","faltaReceber"])]),_:1},8,["modelValue"])}}};export{Fe as _};
