import{c as B,r as w,u as ue}from"./g4OC3xCi.js";import{L as X,u as Y,r as T,m as p,G as Z,n as ee,z as ie,o as b,c as G,q as e,p as C,S as se,t as de,A as x,w as u,b as o,C as m,B as ne,V as E,d as q,F as me,v as ae,a as ce,s as Q}from"./CiZIOIfX.js";import{u as oe}from"./BbehOYUO.js";import{a as H}from"./B0IxRygJ.js";import{f as le}from"./BORKeKCp.js";import{V as k}from"./CV4b83jd.js";import{V as d}from"./BdhY7VMV.js";import{V as A}from"./Bx1gSjgW.js";import{V as te}from"./Bh4ORosW.js";import{V as pe}from"./Cvbkbytg.js";import{V as J,a as _e,e as K,d as fe}from"./BjaE_aG7.js";import"./DbcAysCy.js";import"./6O5R2sl3.js";import"./CTVZtIGt.js";import"./d2aUBtcU.js";import"./BF26TzQb.js";import"./whozIoLz.js";import"./Cuk3UNsD.js";import"./C8M8BB54.js";const ve={key:1},Ve={__name:"DadosMatricula",emits:["saved","close-modal"],async setup(j,{emit:V}){let _,$;const U=V,h=X(),i=ae(),{$toast:v}=Y(),y=T(!1),g=p("Matricula-id"),S=`${i.public.auth}/service/gerencia/listar_situacao_matriculas`,F=`${i.public.auth}/service/gerencia/natureza_imoveis`,P=`${i.public.auth}/service/gerencia/tipo_logradouros`,L=`${i.public.auth}/service/gerencia/listarCidades`,O=`${i.public.auth}/service/gerencia/livro`,{data:M,status:re,pending:D,error:N}=([_,$]=Z(async()=>oe("cliente-dados",async()=>{const t=p("auth_token");try{const[a,n,r,f,z]=await Promise.all([$fetch(`${S}`,{method:"POST",body:{cartorio_token:p("user-data").value.cartorio_token},headers:{Authorization:`Bearer ${t.value}`}}),$fetch(`${F}`,{headers:{Authorization:`Bearer ${t.value}`}}),$fetch(`${P}`,{headers:{Authorization:`Bearer ${t.value}`}}),$fetch(`${L}`,{headers:{Authorization:`Bearer ${t.value}`}}),$fetch(`${O}`,{headers:{Authorization:`Bearer ${t.value}`}})]);return{situacaoItens:a,naturezaImoveisItens:n,tipoLogradouroItens:r,cidadesItens:f,livroItens:z}}catch(a){return console.error("Erro ao carregar dados:",a),{situacaoItens:[],naturezaImoveisItens:[],tipoLogradouroItens:[],cidadesItens:[],livroItens:[]}}})),_=await _,$(),_),l=ee({numero:null,protocolo:null,livro:null,folhas:null,data:null,descricao:null,cnm:null,livro_id:null,observacao:null,inscricao_municipal:null,situacao_id:null,tabvalores_natureza_id:null,tabvalores_tipologradouro_id:null,end_logradouro:null,end_logradouro_numero:null,end_bairro:null,end_cidade_id:null,end_cep:null,end_complemento:null,end_quadra:null,end_lote:null,folha_inicial:null,folha_final:null,cartorio_id:p("user-data").value.cartorio_id,user_id:p("user-data").value.usuario_id}),I={numero:{required:B.withMessage("O campo é obrigatório",w)},data:{required:B.withMessage("O campo é obrigatório",w)},situacao_id:{required:B.withMessage("O campo é obrigatório",w)},tabvalores_natureza_id:{required:B.withMessage("O campo é obrigatório",w)},livro_id:{required:B.withMessage("O campo é obrigatório",w)}},c=ue(I,l);async function R(){if(await c.value.$validate()){const t={...l};for(const n in t)t[n]===""&&(t[n]=null);const a={...t,data:H(l.data)};try{const n=p("auth_token"),r=await $fetch(`${i.public.auth}/service/gerencia/matriculas`,{method:"POST",body:a,headers:{Authorization:`Bearer ${n.value}`}});if(r.statusCode===500)v.error("Erro ao cadastrar Matricula, o CPF já está cadastrado.");else{v.success("Matricula cadastrada com sucesso!");const f=r.id;g.value=f;const z=p("Matricula_token");z.value=r.token,y.value=!0,U("saved")}}catch{v.error("Erro ao cadastrar. Tente novamente.")}}}async function W(){const t={...l};for(const z in t)t[z]===""&&(t[z]=null);const a={...t,data:H(l.data)},{data:n,error:r,status:f}=await le(`${updateMatricula}/${g.value}`,{method:"PUT",body:a});if(f.value==="success"){v.success("Matricula atualizada com sucesso!"),h.push("/Matriculas/lista");return}}function s(){h.push("/matriculas/lista")}return(t,a)=>{const n=ie("mask");return b(),G(me,null,[e(D)?(b(),C(se,{key:0,class:"loading-spinner",indeterminate:"",size:"64"})):e(N)?(b(),G("div",ve,de(e(N).message),1)):x("",!0),e(D)?x("",!0):(b(),C(te,{key:2},{default:u(()=>[o(k,null,{default:u(()=>[o(d,{md:"6"},{default:u(()=>[o(m,{modelValue:e(l).numero,"onUpdate:modelValue":a[0]||(a[0]=r=>e(l).numero=r),"error-messages":e(c).numero.$errors.map(r=>r.$message),label:"Matrícula",required:"",onBlur:e(c).numero.$touch,onInput:e(c).numero.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1}),o(d,{md:"4"},{default:u(()=>[o(m,{modelValue:e(l).protocolo,"onUpdate:modelValue":a[1]||(a[1]=r=>e(l).protocolo=r),label:"Protocolo",required:""},null,8,["modelValue"])]),_:1}),o(d,{md:"4"},{default:u(()=>[o(A,{modelValue:e(l).livro_id,"onUpdate:modelValue":a[2]||(a[2]=r=>e(l).livro_id=r),"error-messages":e(c).situacao_id.$errors.map(r=>r.$message),items:e(M).livroItens.data,label:"Livro",required:"","item-title":"descricao","item-value":"id"},null,8,["modelValue","error-messages","items"])]),_:1}),o(d,{md:"4"},{default:u(()=>[o(m,{modelValue:e(l).folha_inicial,"onUpdate:modelValue":a[3]||(a[3]=r=>e(l).folha_inicial=r),modelModifiers:{number:!0},label:"Folha inicial",type:"number",required:"",min:"0"},null,8,["modelValue"])]),_:1}),o(d,{md:"4"},{default:u(()=>[o(m,{modelValue:e(l).folha_final,"onUpdate:modelValue":a[4]||(a[4]=r=>e(l).folha_final=r),modelModifiers:{number:!0},label:"Folha Final",type:"number",required:"",min:"0"},null,8,["modelValue"])]),_:1}),o(d,{md:"4"},{default:u(()=>[ne(o(m,{modelValue:e(l).data,"onUpdate:modelValue":a[5]||(a[5]=r=>e(l).data=r),"error-messages":e(c).situacao_id.$errors.map(r=>r.$message),onBlur:e(c).numero.$touch,onInput:e(c).numero.$touch,placeholder:"dd/mm/yyyy",label:"Data"},null,8,["modelValue","error-messages","onBlur","onInput"]),[[n,"##/##/####"]])]),_:1}),o(d,{md:"4"},{default:u(()=>[o(A,{modelValue:e(l).situacao_id,"onUpdate:modelValue":a[6]||(a[6]=r=>e(l).situacao_id=r),"error-messages":e(c).situacao_id.$errors.map(r=>r.$message),items:e(M).situacaoItens,label:"Situação",required:"",onBlur:e(c).situacao_id.$touch,onInput:e(c).situacao_id.$touch,"item-title":"descricao","item-value":"id"},null,8,["modelValue","error-messages","items","onBlur","onInput"])]),_:1}),o(d,{md:"4"},{default:u(()=>[o(m,{modelValue:e(l).descricao,"onUpdate:modelValue":a[7]||(a[7]=r=>e(l).descricao=r),"error-messages":e(c).situacao_id.$errors.map(r=>r.$message),label:"Descrição",required:""},null,8,["modelValue","error-messages"])]),_:1}),o(d,{md:"4"},{default:u(()=>[o(m,{modelValue:e(l).cnm,"onUpdate:modelValue":a[8]||(a[8]=r=>e(l).cnm=r),label:"CNM",required:""},null,8,["modelValue"])]),_:1}),o(d,{md:"4"},{default:u(()=>[o(m,{modelValue:e(l).observacao,"onUpdate:modelValue":a[9]||(a[9]=r=>e(l).observacao=r),label:"Observação",required:""},null,8,["modelValue"])]),_:1})]),_:1}),o(k,{class:"mb-3"},{default:u(()=>[o(E,{onClick:s,size:"large",color:"red"},{default:u(()=>a[11]||(a[11]=[q("Voltar")])),_:1}),o(E,{onClick:a[10]||(a[10]=r=>e(y)?W():R()),class:"ml-4",size:"large",color:"green"},{default:u(()=>a[12]||(a[12]=[q("Salvar")])),_:1})]),_:1})]),_:1}))],64)}}},ge={__name:"EnderecoMatricula",emits:["saved","close-modal"],async setup(j,{emit:V}){let _,$;const U=V,h=X(),i=ae(),{$toast:v}=Y(),y=T(!1),g=p("Matricula-id"),S=`${i.public.auth}/service/gerencia/listar_situacao_matriculas`,F=`${i.public.auth}/service/gerencia/natureza_imoveis`,P=`${i.public.auth}/service/gerencia/tipo_logradouros`,L=`${i.public.auth}/service/gerencia/listarCidades`,O=`${i.public.auth}/service/gerencia/livro`,{data:M,status:re,pending:D,error:N}=([_,$]=Z(async()=>oe("cliente-dados",async()=>{const s=p("auth_token");try{const[t,a,n,r,f]=await Promise.all([$fetch(`${S}`,{method:"POST",body:{cartorio_token:p("user-data").value.cartorio_token},headers:{Authorization:`Bearer ${s.value}`}}),$fetch(`${F}`,{headers:{Authorization:`Bearer ${s.value}`}}),$fetch(`${P}`,{headers:{Authorization:`Bearer ${s.value}`}}),$fetch(`${L}`,{headers:{Authorization:`Bearer ${s.value}`}}),$fetch(`${O}`,{headers:{Authorization:`Bearer ${s.value}`}})]);return{situacaoItens:t,naturezaImoveisItens:a,tipoLogradouroItens:n,cidadesItens:r,livroItens:f}}catch(t){return console.error("Erro ao carregar dados:",t),{situacaoItens:[],naturezaImoveisItens:[],tipoLogradouroItens:[],cidadesItens:[],livroItens:[]}}})),_=await _,$(),_),l=ee({inscricao_municipal:null,situacao_id:null,tabvalores_natureza_id:null,tabvalores_tipologradouro_id:null,end_logradouro:null,end_logradouro_numero:null,end_bairro:null,end_cidade_id:null,end_cep:null,end_complemento:null,end_quadra:null,end_lote:null,folha_inicial:null,folha_final:null,cartorio_id:p("user-data").value.cartorio_id,user_id:p("user-data").value.usuario_id});function I(s){if(s)return s.replace(/[.\-]/g,"");s=null}async function c(){const s={...l};for(const a in s)s[a]===""&&(s[a]=null);const t={...s,doc_identificacao:I(l.doc_identificacao),cpf_pai:I(l.cpf_pai),cpf_mae:I(l.cpf_mae)};try{const a=p("auth_token"),n=await $fetch(`${i.public.auth}/service/gerencia/matriculas`,{method:"POST",body:t,headers:{Authorization:`Bearer ${a.value}`}});if(n.statusCode===500)v.error("Erro ao cadastrar Matricula, o CPF já está cadastrado.");else{v.success("Matricula cadastrada com sucesso!");const r=n.id;g.value=r;const f=p("Matricula_token");f.value=n.token,y.value=!0,U("saved")}}catch{v.error("Erro ao cadastrar. Tente novamente.")}}async function R(){const s={...l};for(const f in s)s[f]===""&&(s[f]=null);const t={...s,doc_identificacao:I(l.doc_identificacao),cpf_mae:I(l.cpf_mae)},{data:a,error:n,status:r}=await le(`${updateMatricula}/${g.value}`,{method:"PUT",body:t});if(r.value==="success"){v.success("Matricula atualizada com sucesso!"),h.push("/Matriculas/lista");return}}function W(){h.push("/matriculas/lista")}return(s,t)=>(b(),C(te,null,{default:u(()=>[o(k,null,{default:u(()=>[o(d,{md:"4"},{default:u(()=>[o(m,{modelValue:e(l).inscricao_municipal,"onUpdate:modelValue":t[0]||(t[0]=a=>e(l).inscricao_municipal=a),label:"Inscrição Municipal",required:""},null,8,["modelValue"])]),_:1}),o(d,{md:"4"},{default:u(()=>[o(A,{modelValue:e(l).tabvalores_natureza_id,"onUpdate:modelValue":t[1]||(t[1]=a=>e(l).tabvalores_natureza_id=a),items:e(M).naturezaImoveisItens,label:"Natureza Imovel","item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1}),o(d,{md:"4"},{default:u(()=>[o(A,{modelValue:e(l).tabvalores_tipologradouro_id,"onUpdate:modelValue":t[2]||(t[2]=a=>e(l).tabvalores_tipologradouro_id=a),items:e(M).tipoLogradouroItens,label:"Tipo de Logradouro","item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1})]),_:1}),o(k,null,{default:u(()=>[o(d,{md:"4"},{default:u(()=>[o(m,{modelValue:e(l).end_logradouro,"onUpdate:modelValue":t[3]||(t[3]=a=>e(l).end_logradouro=a),label:"Endereço",required:""},null,8,["modelValue"])]),_:1}),o(d,{md:"4"},{default:u(()=>[o(m,{modelValue:e(l).end_logradouro_numero,"onUpdate:modelValue":t[4]||(t[4]=a=>e(l).end_logradouro_numero=a),label:"Numero",required:""},null,8,["modelValue"])]),_:1}),o(d,{md:"4"},{default:u(()=>[o(m,{modelValue:e(l).end_bairro,"onUpdate:modelValue":t[5]||(t[5]=a=>e(l).end_bairro=a),label:"Bairro",required:""},null,8,["modelValue"])]),_:1})]),_:1}),o(k,null,{default:u(()=>[o(d,{md:"4"},{default:u(()=>[o(A,{modelValue:e(l).end_cidade_id,"onUpdate:modelValue":t[6]||(t[6]=a=>e(l).end_cidade_id=a),items:e(M).cidadesItens,label:"Cidade","item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1}),o(d,{md:"4"},{default:u(()=>[o(m,{modelValue:e(l).end_cep,"onUpdate:modelValue":t[7]||(t[7]=a=>e(l).end_cep=a),label:"CEP",required:""},null,8,["modelValue"])]),_:1}),o(d,{md:"4"},{default:u(()=>[o(m,{modelValue:e(l).end_complemento,"onUpdate:modelValue":t[8]||(t[8]=a=>e(l).end_complemento=a),label:"Complemento",required:""},null,8,["modelValue"])]),_:1})]),_:1}),o(k,null,{default:u(()=>[o(d,{md:"4"},{default:u(()=>[o(m,{modelValue:e(l).end_quadra,"onUpdate:modelValue":t[9]||(t[9]=a=>e(l).end_quadra=a),label:"Quadra",required:""},null,8,["modelValue"])]),_:1}),o(d,{md:"4"},{default:u(()=>[o(m,{modelValue:e(l).end_lote,"onUpdate:modelValue":t[10]||(t[10]=a=>e(l).end_lote=a),label:"Lote",required:""},null,8,["modelValue"])]),_:1})]),_:1}),o(k,{class:"mb-3"},{default:u(()=>[o(E,{onClick:W,size:"large",color:"red"},{default:u(()=>t[12]||(t[12]=[q("Voltar")])),_:1}),o(E,{onClick:t[11]||(t[11]=a=>e(y)?R():c()),class:"ml-4",size:"large",color:"green"},{default:u(()=>t[13]||(t[13]=[q("Salvar")])),_:1})]),_:1})]),_:1}))}},Pe={__name:"index",setup(j){const V=T("dados"),_=T(!1),$=T(!1),U=()=>{_.value=!0,$.value=!0};return(h,i)=>{const v=Ve,y=ge;return b(),C(pe,{width:"1300"},{default:u(()=>[i[4]||(i[4]=ce("h1",{style:{"background-color":"#f5f2f2",color:"#525050",padding:"5px 0px 0px 20px"}}," Cadastramento de Matriculas ",-1)),o(_e,{modelValue:e(V),"onUpdate:modelValue":i[0]||(i[0]=g=>Q(V)?V.value=g:null),"bg-color":"#f5f2f2"},{default:u(()=>[o(J,{value:"dados"},{default:u(()=>i[2]||(i[2]=[q("Dados")])),_:1}),e(_)?(b(),C(J,{key:0,value:"endereco"},{default:u(()=>i[3]||(i[3]=[q("Endereço")])),_:1})):x("",!0)]),_:1},8,["modelValue"]),o(fe,{modelValue:e(V),"onUpdate:modelValue":i[1]||(i[1]=g=>Q(V)?V.value=g:null)},{default:u(()=>[o(K,{value:"dados"},{default:u(()=>[o(v,{onSaved:U})]),_:1}),e(_)?(b(),C(K,{key:0,value:"endereco"},{default:u(()=>[o(y)]),_:1})):x("",!0)]),_:1},8,["modelValue"])]),_:1})}}};export{Pe as default};
