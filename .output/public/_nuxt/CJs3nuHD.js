import{_ as ke}from"./DLbQsqsH.js";import{_ as Ve}from"./D7v5p52p.js";import{_ as ge}from"./CLYl7Net.js";import{_ as he,r as l,H as ye,o as h,j as J,w as a,b as t,d as $,a as u,t as Q,i as o,V as z,A as W,G as we,c as N,k as Y,v as R,C as be,J as xe,u as Ce,e as C,f as $e,s as qe,F as Pe,l as Me}from"./Tfn9NuBr.js";import{V as Te,a as Ae,b as Fe,c as Ee}from"./CQ7No_Yn.js";import{V as Se}from"./A4ors0Xu.js";import{_ as Oe}from"./DroXbRr1.js";import{_ as X}from"./CTbcy8ju.js";import{_ as ze}from"./BVz1G1IN.js";import{_ as Ne}from"./BtgLYupj.js";import{a as Re}from"./DJvq3mCv.js";import{u as V}from"./bzj915e5.js";import{V as O}from"./LjC4bRoU.js";import{V as g}from"./BJ8W2r7g.js";import{V as je}from"./BUTAiPy7.js";import{V as G}from"./09XaBDXp.js";import"./B4Jdw7dY.js";import"./IQCalDVu.js";import"./NGOnBb3f.js";import"./CtG9K-HS.js";import"./B0IxRygJ.js";import"./CWJ8MV6a.js";import"./B-7euU_K.js";import"./ALudXniF.js";import"./ZiUTAKdp.js";import"./Csyma-kO.js";import"./DHv-h4Tv.js";import"./w8h0yJMR.js";import"./ITOH6S7S.js";import"./DrSltjgo.js";const De={class:"random-numbers"},Be={key:0,class:"error-message"},Ue={__name:"ValidadorAutencidade",props:{show:Boolean},emits:["close","confirm"],setup(j,{emit:D}){const _=j,y=D,m=l(_.show),k=l([]),c=l(""),p=l("");function v(){k.value=[];for(let f=0;f<4;f++)k.value.push(Math.floor(Math.random()*10))}ye(()=>_.show,f=>{m.value=f,f&&(v(),c.value="",p.value="")});const q=()=>{m.value=!1,y("close")},P=()=>{c.value===k.value.join("")?(p.value="",m.value=!1,y("confirm")):p.value="Números digitados incorretos. Tente novamente."};return(f,r)=>(h(),J(Se,{persistent:"",modelValue:o(m),"onUpdate:modelValue":r[1]||(r[1]=w=>W(m)?m.value=w:null),"max-width":"500"},{default:a(()=>[t(Te,null,{default:a(()=>[t(Ae,{class:"text-h6"},{default:a(()=>r[2]||(r[2]=[$("Validador de Autenticidade")])),_:1}),t(Fe,null,{default:a(()=>[u("div",null,[r[3]||(r[3]=u("p",null,"Digite os números abaixo para validar a autenticidade:",-1)),u("div",De,[u("span",null,Q(o(k).join(" ")),1)]),t(z,{modelValue:o(c),"onUpdate:modelValue":r[0]||(r[0]=w=>W(c)?c.value=w:null),label:"Digite os números",maxlength:"4",outlined:"",dense:"",onKeyup:we(P,["enter"])},null,8,["modelValue"]),o(p)?(h(),N("div",Be,Q(o(p)),1)):Y("",!0)])]),_:1}),t(Ee,null,{default:a(()=>[t(R,{style:{"background-color":"red",color:"white"},onClick:q},{default:a(()=>r[4]||(r[4]=[$("Cancelar")])),_:1}),t(R,{style:{"background-color":"green",color:"white"},onClick:P},{default:a(()=>r[5]||(r[5]=[$("Validar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ie=he(Ue,[["__scopeId","data-v-d309f484"]]),Ke=["onClick"],Ze={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:X,alt:"Possui Ficha",title:"Possui Ficha"},He={key:1,style:{width:"30px",height:"30px",cursor:"pointer"},src:Ne,alt:"Visualizar",title:"Não Possui Ficha"},Le=["onClick"],xt={__name:"autencidade",props:{ato_token:{type:String,required:!0}},emits:["ato-created"],async setup(j,{emit:D}){let _,y;const m=j,k=D,c=be(),p=xe(),v=Me(),{$toast:q}=Ce(),P=`${v.public.managemant}/listarEscrevente`,f=`${v.public.managemant}/pesquisarPessoas`,r=`${v.public.managemant}/atoReconhecimento`,w=`${v.public.managemant}/etiquetaAutenticidade`,ee=`${v.public.managemant}/download`,te=`${v.public.envioDoc}/print`,M=l(C("user-data").value.cartorio_token),oe=l(C("user-service").value.token).value||l(C("user-service").value).value,ae=C("auth_token").value,B=l([]),K=l([]),b=l([]),T=l(!1),U=l(!1),A=l(!1),F=l(null),Z=l(null),I=l(""),E=l(!1),H=[{title:"Documento",align:"start",key:"documento"},{title:"Pessoa",align:"start",key:"nome"},{value:"actions"}],i=$e({quantidade:1,escrevente:null,nome:null,documento:null}),{data:se}=([_,y]=qe(()=>V(P,{method:"POST",body:{cartorio_token:M}},"$qpB20nOlUE")),_=await _,y(),_);K.value=se.value[0].func_json_escreventes;async function ne(){try{const{data:s,error:e}=await V(f,{method:"POST",body:{cartorio_token:M.value,documento:i.documento,nome:i.nome}},"$CfpM9wZnUE");s.value.length>0?(k("ato-created"),B.value=s.value):B.value=[]}catch(s){console.error("Erro na requisição",s)}}const le=()=>{U.value=!0};function re(s){b.value.push(s)}const ie=async s=>{F.value=s,A.value=!0;const{data:e}=await V(ee,{method:"POST",body:{bucket:C("user-data").value.cartorio_token,path:s.link_ficha}},"$LrKAtpxZwH");Z.value=e.value};function ue(s){b.value=b.value.filter(e=>e.token!==s.token)}function de(){E.value=!0}function me(){E.value=!1,ce()}async function ce(){if(!i.escrevente){q.error("Por favor selecione um Escrevente");return}try{const s=b.value.map(d=>({pessoa_token:d.token})),{data:e,error:S,status:x}=await V(r,{method:"POST",body:{pessoas:s,cartorio_token:M.value,ordemserv_token:oe,quantidade:i.quantidade,usuario_token:ae,ato_tipo_token:m.ato_token}},"$EE94jKo1pQ");x.value==="success"&&e.value[0].status==="OK"?(pe(e.value[0].token),L()):(T.value=!0,I.value=ato_token.value.status_mensagem||S.value.data.details)}catch(s){T.value=!0,I.value=s,console.error("Erro na requisição",s)}}async function pe(s){try{const{data:e,error:S,status:x}=await V(w,{method:"POST",body:{ato_token:s,cartorio_token:M.value,escrevente_token:i.escrevente}},"$KyoIzBxZyr");if(x.value==="success"){if(e.value[0].tipo_etiqueta==="html"){const d=window.open("","_blank");d.document.open(),d.document.write(e.value[0].etiqueta),d.document.close()}else if(e.value[0].tipo_etiqueta==="zpl"){const{status:d}=await V(`${te}`,{method:"POST",body:{zpl:atob(e.value[0].etiqueta)}},"$Vem9mHWYqw");if(d.value!=="success"){q.error("Não foi possivel fazer a impressao da etiqueta");return}}}}catch(e){console.error("Erro na requisição",e)}}const L=()=>{const s=p.query.origem||"criar",e=p.query.id;s==="atualizar"?c.push(`/os/atualizar/${e}`):c.push("/os/criar-registro")};return(s,e)=>{const S=ke,x=Ve,d=ge,ve=Ie,fe=Oe;return h(),N(Pe,null,[t(O,{class:"mt-5"},{default:a(()=>[t(g,{cols:"5"},{default:a(()=>[t(je,{label:"Tabelião/escrevente",modelValue:o(i).escrevente,"onUpdate:modelValue":e[0]||(e[0]=n=>o(i).escrevente=n),items:o(K),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"])]),_:1}),t(g,{cols:"2"},{default:a(()=>[t(z,{label:"Quantidade",type:"number",modelValue:o(i).quantidade,"onUpdate:modelValue":e[1]||(e[1]=n=>o(i).quantidade=n)},null,8,["modelValue"])]),_:1})]),_:1}),t(O,null,{default:a(()=>[t(g,{cols:"3"},{default:a(()=>[t(z,{label:"Documento",modelValue:o(i).documento,"onUpdate:modelValue":e[2]||(e[2]=n=>o(i).documento=n)},null,8,["modelValue"])]),_:1}),t(g,{cols:"4"},{default:a(()=>[t(z,{label:"Pessoa",modelValue:o(i).nome,"onUpdate:modelValue":e[3]||(e[3]=n=>o(i).nome=n)},null,8,["modelValue"])]),_:1}),u("div",null,[u("img",{class:"btn-pointer mt-1",src:X,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:ne})]),u("div",null,[u("img",{class:"btn-pointer mt-1 ml-2",src:ze,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:le})])]),_:1}),t(O,null,{default:a(()=>[t(g,{class:"mr-10"},{default:a(()=>[t(G,{style:{height:"465px"},headers:H,items:o(B)},{"item.actions":a(({item:n})=>[u("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:_e=>ie(n),title:"Visualizar Ficha"},[n.link_ficha?(h(),N("img",Ze)):(h(),N("img",He))],8,Ke)]),_:1},8,["items"])]),_:1}),t(g,null,{default:a(()=>[t(G,{headers:H,items:o(b),style:{height:"465px"},"item-key":"id"},{"item.actions":a(({item:n})=>[u("div",{style:{display:"flex","justify-content":"flex-end"},onClick:_e=>ue(n),title:"Remover"},e[9]||(e[9]=[u("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:Re,alt:"Remover"},null,-1)]),8,Le)]),_:1},8,["items"])]),_:1})]),_:1}),t(S,{show:o(U),onClose:e[4]||(e[4]=n=>U.value=!1)},null,8,["show"]),o(A)?(h(),J(x,{key:0,show:o(A),item:o(F),"pessoa-obj":o(F),"link-view":o(Z),onConfirmar:e[5]||(e[5]=n=>re(o(F))),onClose:e[6]||(e[6]=n=>A.value=!1)},null,8,["show","item","pessoa-obj","link-view"])):Y("",!0),t(d,{show:o(T),errorMessage:o(I),onClose:e[7]||(e[7]=n=>T.value=!1)},null,8,["show","errorMessage"]),t(ve,{show:o(E),onClose:e[8]||(e[8]=n=>E.value=!1),onConfirm:me},null,8,["show"]),t(O,null,{default:a(()=>[t(fe,{onClick:L},{default:a(()=>[t(R,{size:"large",color:"red"},{default:a(()=>e[10]||(e[10]=[$("Voltar")])),_:1})]),_:1}),t(R,{class:"ml-5",onClick:de,size:"large",color:"green"},{default:a(()=>e[11]||(e[11]=[$("Salvar")])),_:1})]),_:1})],64)}}};export{xt as default};
