import{_ as se}from"./NyPbfQDu.js";import{c as $e,r as we,u as Ce}from"./D1CjC34e.js";import{H as Me,C as H,J as Q,u as re,r as s,e as O,f as ce,s as de,o as P,j as X,w as o,b as e,i as t,V as ae,v as K,d as F,l as ee,y as De,a as v,c as W,k as pe,M as Re,N as je,F as Ve,O as ke,t as oe}from"./BC05QRph.js";import{u as $}from"./s-GuSyzV.js";import{V as T}from"./B50vjHNf.js";import{V as N}from"./p_ShAbG9.js";import{V as le}from"./_o8pHgIy.js";import{V as me}from"./CcPMdTm7.js";import{_ as Ne,b as Ue,c as Ie,a as Be}from"./DiT_Shgv.js";import{_ as Fe,a as Le,b as We,T as Je,W as Ke,D as Pe,c as Ge,d as Ye}from"./B7y2anaU.js";import{_ as Xe,r as Ee}from"./Cn-vRF0g.js";import{_ as ie}from"./BTpk9Bc9.js";import{_ as ue}from"./BVz1G1IN.js";import{_ as Ze}from"./BqNORJWK.js";import{_ as ye,a as he}from"./DJvq3mCv.js";import{V as be}from"./CwEHmZcG.js";import{_ as He}from"./D5RYScuq.js";import{V as Qe}from"./BUX4HHc6.js";import{f as xe}from"./B0IxRygJ.js";const Ut={__name:"Dados",props:{ato_token:{type:String,required:!0},ato_tipo_id:{type:Number}},emits:["saved"],async setup(J,{emit:V}){let h,y;const b=J;Me(()=>b.ato_tipo_id,m=>{w.value={id:m}});const A=V,C=H(),E=Q(),L=ee(),{$toast:q}=re(),U=`${L.public.managemant}/listarSituacoes`,R=`${L.public.managemant}/createAtos`;`${L.public.managemant}`;const j=s(O("user-data").value.cartorio_token),f=s(O("user-service").value.id).value||s(O("user-service").value).value,I=s([]),w=s(b.ato_tipo_id?{id:b.ato_tipo_id}:null),g=ce({dt_abertura:null,status:"EM EDIÇÃO",mne:null}),z={status:{required:$e.withMessage("O campo é obrigatorio",we)}},n=Ce(z,g);async function l(){if(await n.value.$validate()){const{data:m,error:p,status:r}=await $(R,{method:"POST",body:{ato_tipo_id:w.value.id,cartorio_id:O("user-data").value.cartorio_id,ordemserv_id:f,status:g.status,dt_abertura:g.dt_abertura,mne:g.mne,user_id:O("user-data").value.usuario_id,user_alteracao_id:O("user-data").value.usuario_id}},"$9ZmTYsLk0K");r.value==="success"&&(q.success("Ato registrado com sucesso!"),A("saved",{id:m.value.id,token:m.value.token}))}else q.error("Preencha os campos obrigatorios.")}const{data:i}=([h,y]=de(()=>$(U,{method:"POST",body:{cartorio_token:j.value}},"$hyq5YcBEjF")),h=await h,y(),h);I.value=i.value;const k=()=>{const m=E.query.origem||"criar",p=E.query.id;m==="atualizar"?C.push(`/os/atualizar/${p}`):C.push("/os/criar-registro")};return(m,p)=>{const r=se;return P(),X(me,null,{default:o(()=>[e(T,{class:"mt-5"},{default:o(()=>[e(N,{cols:"3"},{default:o(()=>[e(le,{label:"Situação",modelValue:t(g).status,"onUpdate:modelValue":p[0]||(p[0]=u=>t(g).status=u),items:t(I),"item-title":"descricao","item-value":"descricao",required:"","error-messages":t(n).status.$errors.map(u=>u.$message),onBlur:t(n).status.$touch,onInput:t(n).status.$touch},null,8,["modelValue","items","error-messages","onBlur","onInput"])]),_:1})]),_:1}),e(T,null,{default:o(()=>[e(N,{cols:"5"},{default:o(()=>[e(ae,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:t(g).mne,"onUpdate:modelValue":p[1]||(p[1]=u=>t(g).mne=u)},null,8,["modelValue"])]),_:1})]),_:1}),e(T,null,{default:o(()=>[e(N,{cols:"2"},{default:o(()=>[e(ae,{modelValue:t(g).dt_abertura,"onUpdate:modelValue":p[2]||(p[2]=u=>t(g).dt_abertura=u),type:"date",label:"Data Lavratura",disabled:"",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(T,{class:"mb-3"},{default:o(()=>[e(r,{onClick:k},{default:o(()=>[e(K,{size:"large",color:"red"},{default:o(()=>p[3]||(p[3]=[F("Voltar")])),_:1})]),_:1}),e(K,{class:"ml-10",onClick:l,size:"large",color:"green"},{default:o(()=>p[4]||(p[4]=[F("Salvar")])),_:1})]),_:1})]),_:1})}}},et=["onClick"],tt=["onClick"],ot=["onClick"],at={key:0,style:{width:"30px",height:"30px"},src:ye,alt:"Visualizar",title:"Reativar"},st={key:1,src:he,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},rt=["onClick"],It={__name:"Partes",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},async setup(J){let V,h;const y=J,b=H(),A=Q(),C=ee(),{$toast:E}=re(),L=`${C.public.managemant}/pesquisarPessoas`,q=`${C.public.managemant}/listarPapeis`,U=`${C.public.managemant}/download`,R=`${C.public.managemant}/createAtosPessoa`,j=`${C.public.managemant}/getAtosPessoaById`,f=`${C.public.managemant}/updateAtosPessoa`,I=s(O("user-data").value.cartorio_token),w=s([]),g=s({}),z=s([]),n=s([]),l=s(!1),i=s(!1),k=s(!1),m=s(!1),p=s(null),r=s(null),u=s(null),_=s(null);s(null);const x=s(null),S=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"400px"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome"},{value:"actions"}],c=ce({papeis:null,nome:null,pessoa:null,documento:null});De(()=>{var d;return((d=c.pessoa)==null?void 0:d.link_ficha)||!1});const{data:Y}=([V,h]=de(()=>$(q,{method:"POST",body:{tipo_ato_token:y.ato_token}},"$fFKndZhA4W")),V=await V,h(),V);n.value=Y.value;async function G(){try{const{data:d,error:a}=await $(L,{method:"POST",body:{cartorio_token:I.value,documento:c.documento,nome:c.nome}},"$o3ZL1rvYrY");d.value.length>0?(w.value=d.value,c.pessoa=w.value[0]):w.value=[]}catch(d){console.error("Erro na requisição",d)}}const B=()=>{i.value=!0},te=d=>{z.value=z.value.map(a=>a.id===u.value?{...a,papel:{...a.papel,descricao:d}}:a)},Z=d=>{const a=z.value.find(M=>M.pessoa.id===_.value);a.representante.nome=d},ne=async()=>{const d={pessoa:c.pessoa,papel:n.value.find(M=>M.id===c.papeis),representante:{nome:null}},a=await $(`${j}/${y.ato_id}`,{method:"GET"},"$kXSxUa4grs");for(const M of a.data.value)if(M.pessoa_id===c.pessoa.id&&M.ato_id===y.ato_id&&M.tipo_parte_id===c.papeis){E.error("Pessoa Já Registrada Com Esse Papel!");return}try{const{data:M,error:ve,status:fe}=await $(R,{method:"POST",body:{ato_id:Number(y.ato_id),pessoa_id:c.pessoa.id,tipo_parte_id:c.papeis,user_id:Number(O("user-data").value.usuario_id)}},"$So3qnQu7ek");fe.value==="success"?(d.id=M.value.id,E.success("Pessoa Registrada com Sucesso!"),z.value.push(d)):E.error(ve.value.message)}catch{E.error("Erro no servidor. Tente novamente.")}},_e=async d=>{k.value=!0;const{data:a}=await $(U,{method:"POST",body:{bucket:O("user-data").value.cartorio_token,path:d.pessoa.link_ficha}},"$Q3kbIwtd9t");x.value=a.value,g.value=d.pessoa},Ae=d=>{const a=z.value.filter(M=>M.pessoa.id!==d.pessoa.id).map(M=>({id:M.pessoa.id,nome:M.pessoa.nome}));u.value=d.id,p.value=a,l.value=!0,r.value=d.pessoa.nome,_.value=d.pessoa.id},Se=d=>{u.value=d.id,m.value=!0,r.value=d.pessoa.nome};async function Oe(d){d.excluido=!d.excluido;try{await $(`${f}/${u.value}`,{method:"PUT",body:JSON.stringify({excluido:d.excluido})},"$9xStKwGd7o")}catch(a){console.error("Erro ao excluir pessoa:",a)}}const Te=()=>{const d=A.query.origem||"criar",a=A.query.id;d==="atualizar"?b.push(`/os/atualizar/${a}`):b.push("/os/criar-registro")};return(d,a)=>{const M=Ne,ve=Le,fe=We,qe=Xe,ze=se;return P(),X(me,null,{default:o(()=>[e(T,{class:"mt-5"},{default:o(()=>[e(N,{cols:"3"},{default:o(()=>[e(ae,{label:"Documento",modelValue:t(c).documento,"onUpdate:modelValue":a[0]||(a[0]=D=>t(c).documento=D)},null,8,["modelValue"])]),_:1}),e(N,{cols:"4"},{default:o(()=>[e(ae,{label:"Pessoa",modelValue:t(c).nome,"onUpdate:modelValue":a[1]||(a[1]=D=>t(c).nome=D)},null,8,["modelValue"])]),_:1}),v("div",null,[v("img",{class:"mt-3",src:ie,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:G})]),v("div",null,[v("img",{class:"mt-3 ml-2",src:ue,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:B})])]),_:1}),e(T,null,{default:o(()=>[e(N,{cols:"4"},{default:o(()=>[e(le,{label:"Selecione a Pessoa",modelValue:t(c).pessoa,"onUpdate:modelValue":a[2]||(a[2]=D=>t(c).pessoa=D),items:t(w),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),e(N,{cols:"3"},{default:o(()=>[e(le,{label:"Papel",modelValue:t(c).papeis,"onUpdate:modelValue":a[3]||(a[3]=D=>t(c).papeis=D),items:t(n),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),v("div",null,[v("img",{class:"mt-3",src:ue,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:ne})])]),_:1}),e(T,null,{default:o(()=>[e(N,null,{default:o(()=>[e(be,{style:{height:"465px"},headers:S,items:t(z)},{"item.actions":o(({item:D})=>[e(T,null,{default:o(()=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ge=>_e(D),title:"Visualizar Ficha"},a[8]||(a[8]=[v("img",{style:{width:"30px",height:"30px"},src:ie,alt:"Visualizar"},null,-1)]),8,et),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ge=>Se(D),class:"mr-2",title:"Alterar Papel"},a[9]||(a[9]=[v("img",{style:{width:"30px",height:"30px"},src:Ze,alt:"Visualizar"},null,-1)]),8,tt),v("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ge=>Oe(D),title:"Deletar Pessoa"},[D.excluido?(P(),W("img",at)):(P(),W("img",st))],8,ot),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ge=>Ae(D),title:"Selecionar Representante"},a[10]||(a[10]=[v("img",{style:{width:"30px",height:"30px"},src:Fe,alt:"Visualizar"},null,-1)]),8,rt)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),e(M,{show:t(i),onClose:a[4]||(a[4]=D=>i.value=!1)},null,8,["show"]),e(ve,{representante_nome:t(r),representantes:t(p),ato_id:t(u),show:t(l),onClose:a[5]||(a[5]=D=>l.value=!1),onUpdateRepresentante:Z},null,8,["representante_nome","representantes","ato_id","show"]),e(fe,{representante_nome:t(r),ato_token:y.ato_token,ato_id:t(u),show:t(m),onClose:a[6]||(a[6]=D=>m.value=!1),onUpdatePapel:te},null,8,["representante_nome","ato_token","ato_id","show"]),t(k)?(P(),X(qe,{key:0,show:t(k),"link-view":t(x),"pessoa-obj":t(g),"is-view":!0,onClose:a[7]||(a[7]=D=>k.value=!1)},null,8,["show","link-view","pessoa-obj"])):pe("",!0),e(T,null,{default:o(()=>[e(ze,{onClick:Te},{default:o(()=>[e(K,{size:"large",color:"red"},{default:o(()=>a[11]||(a[11]=[F("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},nt={key:0,class:"loading-overlay"},lt="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",Bt={__name:"Minuta",props:{ato_token:{type:String,required:!0}},emits:["page","doc"],setup(J,{emit:V}){const h=J;Re("DocumentEditorContainer",[Je,Ke]);const y=ee(),{$toast:b}=re(),A=H(),C=Q(),E=V;Ee(`${y.public.docEditor}`);const L=`${y.public.managemant}/upload`,q=s(null),U=s(!1),R=async()=>{const l=await q.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),i=new FileReader;i.onload=()=>{const k=i.result;E("doc",k)},i.readAsText(l)},j=async()=>{U.value=!0;try{const l=await q.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),i=new FormData;i.append("file",l,"anexo.docx"),i.append("cartorio_token",O("user-data").value.cartorio_token),i.append("token",h.ato_token),i.append("tipo","ato_minuta");const{data:k,status:m}=await $(L,{method:"POST",body:i},"$071xxdqs20");if(m.value==="success"){b.success("Documento enviado!");const r=q.value.ej2Instances.documentEditor.pageCount;R(),E("page",r)}else b.error("Erro ao enviar documento para o sistema.")}catch(n){b.error("Erro ao salvar documento."),console.error(n)}finally{U.value=!1}},f=async()=>{g(!0);try{await I(),g(!0);const{data:n,status:l}=await $(substituirModelo,{method:"POST",body:{ato_token:h.ato_token}},"$0ktpWliD4l");n.value&&w(n.value)}catch(n){console.error("Erro ao gerar a minuta:",n),b.error("Ocorreu um erro ao gerar a minuta.")}finally{g(!1)}},I=async()=>{try{const{data:n}=await $(baixarDocumento,{method:"POST",body:{bucket:O("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$jXVvQjEE6u"),l=await fetchBlobFromMinIO(n.value);if(l){const i=new FileReader;i.onload=()=>{const k=i.result;q.value.ej2Instances.documentEditor.open(k),E("doc",k)},i.readAsText(l)}}catch(n){console.error("Erro ao carregar o modelo de minuta:",n),b.error("Falha ao carregar o modelo de minuta.")}},w=n=>{const l=q.value.ej2Instances.documentEditor,i=k=>{for(const[m,p]of Object.entries(k))if(/^<<.+>>$/.test(m))try{l.search.findAll(m),l.search.searchResults.length>0&&l.search.searchResults.replaceAll(p)}catch(r){console.error(`Erro ao substituir o marcador ${m}:`,r)}else if(m==="partes"&&Array.isArray(p)&&p.length>0)for(const r of p)typeof r=="object"&&i(r)};i(n)},g=n=>{U.value=n},z=()=>{const n=C.query.origem||"criar",l=C.query.id;n==="atualizar"?A.push(`/os/atualizar/${l}`):A.push("/os/criar-registro")};return(n,l)=>{const i=se;return P(),W(Ve,null,[e(t(Pe),{height:"900px",ref_key:"documentEditorContainer",ref:q,serviceUrl:lt,enableToolbar:!0,enableWordExport:!0},null,512),t(U)?(P(),W("div",nt,[e(je,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):pe("",!0),e(T,{class:"ml-4 mt-4 mb-4"},{default:o(()=>[e(i,{class:"mr-4"},{default:o(()=>[e(K,{size:"large",onClick:z,color:"red"},{default:o(()=>l[0]||(l[0]=[F("Voltar")])),_:1})]),_:1}),e(K,{size:"large",color:"green",onClick:j,disabled:t(U)},{default:o(()=>l[1]||(l[1]=[F("Salvar")])),_:1},8,["disabled"]),e(K,{class:"ml-4",size:"large",color:"blue",onClick:f},{default:o(()=>l[2]||(l[2]=[F("Gerar Minuta")])),_:1})]),_:1})],64)}}},it=["innerHTML"],Ft={__name:"Livro",props:{ato_token:{type:String,required:!0},pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(J){let V,h;const y=J,b=ee();Ee(`${b.public.docEditor}`);const{$toast:A}=re(),C=H(),E=Q(),L=`${b.public.managemant}/listarEscrevente`,q=`${b.public.managemant}/lavrarAto`,U=`${b.public.managemant}/valida_lavratura`,R=s("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),j=s(!1),f=s(null),I=s(null),w=s(null),g=s(O("user-data").value.cartorio_token),z=O("auth_token").value,n=s([]),l=s({}),i=s(null),k=s(""),m=ce({escrevente:null}),p=async(G=!1)=>{if(!G){const{data:Z}=await $(U,{method:"POST",body:{ato_token:y.ato_token}},"$ZKnVBNYxp9"),ne=Z.value[0].status,_e=Z.value[0].status_mensagem;if(ne!=="OK"){i.value=ne,k.value=_e,l.value=null,j.value=!0,R.value="O ato apresenta inconsistências, deseja prosseguir?";return}}const{data:B,status:te}=await $(q,{method:"POST",body:{ato_token:y.ato_token,qtd_paginas:y.pages,escrevente_token:m.escrevente,usuario_token:z,cartorio_token:g}},"$XouuxOFIWh");te.value==="success"?(f.value=B.value,I.value=B.value[0].selo,A.success("Ato lavrado com sucesso!")):A.error("Falha ao lavrar o ato.")},r=()=>{j.value=!1,i.value=null,k.value="",l.value={}},u=async()=>{const{data:G,status:B}=await $(calculaAto,{method:"POST",body:{ato_token:E.query.ato_token_edit,cartorio_token:g,quantidade:1,usuario_token:z,escrevente_token:m.escrevente,qtd_paginas:y.pages}},"$R51FaaSzOI");B.value==="success"?l.value=G.value[0]:A.error("Falha ao calcular o ato.")},_=async()=>{j.value=!1,i.value&&i.value!=="OK"?(await p(!0),i.value=null,k.value=""):await p()},x=async()=>{j.value=!0,await u()},{data:S}=([V,h]=de(()=>$(L,{method:"POST",body:{cartorio_token:g}},"$JCPnpnnRzP")),V=await V,h(),V);n.value=S.value[0].func_json_escreventes;const c=function(){w.value.ej2Instances.documentEditor.open(y.document)},Y=()=>{const G=E.query.origem||"criar",B=E.query.id;G==="atualizar"?C.push(`/os/atualizar/${B}`):C.push("/os/criar-registro")};return(G,B)=>{const te=He;return P(),W(Ve,null,[e(T,null,{default:o(()=>[e(N,null,{default:o(()=>[(P(),X(t(Pe),{restrictEditing:!0,enableToolbar:!1,created:y.document?c:null,ref_key:"documentEditorContainer",ref:w,height:"850px",width:"850px",key:y.document},null,8,["created"]))]),_:1}),e(N,null,{default:o(()=>[e(le,{class:"mt-15",label:"Tabelião/escrevente",modelValue:t(m).escrevente,"onUpdate:modelValue":B[0]||(B[0]=Z=>t(m).escrevente=Z),items:t(n),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),v("div",null,[v("div",null,[v("img",{onClick:B[1]||(B[1]=Z=>x()),class:"ml-2",style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:Ge}),t(f)?(P(),X(Qe,{key:0,class:"mr-16"},{default:o(()=>[e(T,{"no-gutters":""},{default:o(()=>[e(N,null,{default:o(()=>[e(ke,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:o(()=>[e(N,null,{default:o(()=>[F(" Livro: "+oe(t(f)[0].livro_numero),1)]),_:1}),e(N,null,{default:o(()=>[F(" Protocolo: "+oe(t(f)[0].protocolo?t(f)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),e(N,null,{default:o(()=>[e(ke,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:o(()=>[F(" Folhas : "+oe(t(f)[0].pagina_inicial)+" A "+oe(t(f)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),v("div",{innerHTML:t(I)},null,8,it)]),_:1})):pe("",!0)])])]),_:1})]),_:1}),e(K,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:Y},{default:o(()=>B[2]||(B[2]=[F("Voltar")])),_:1}),e(te,{show:t(j),condMessage:t(R),valor:t(l),description:t(k),onClose:r,onConfirm:_},null,8,["show","condMessage","valor","description"])],64)}}},ut=["onClick"],ct=["onClick"],dt={key:0,style:{width:"30px",height:"30px"},src:ye,alt:"Visualizar",title:"Reativar"},pt={key:1,src:he,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Lt={__name:"Observacao",props:{ato_id:{type:Number,required:!0}},async setup(J){let V,h;const y=J,b=H(),A=Q(),C=ee(),E=`${C.public.managemant}/listarEscrevente`,L=`${C.public.managemant}/atos_observacao`,q=`${C.public.managemant}/atos_observacao`,U=s(O("user-data").value.cartorio_token),R=s([]),j=s([]),f=s(!1),I=s(!1),w=s(""),g=[{title:"Data",align:"start",key:"data"},{title:"Escrevente",align:"start",key:"escrevente"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}];function z(r){w.value=r.observacao,I.value=!0,f.value=!0}const n=()=>{I.value=!1,f.value=!0,w.value=""};async function l(r){r.excluido=!r.excluido;try{await $(`${L}/${r.id}`,{method:"PUT",body:JSON.stringify({excluido:r.excluido})},"$aJM1TL1buW")}catch(u){console.error("Erro ao excluir observacao:",u)}}const i=async()=>{f.value=!1,await k()};async function k(){const{data:r}=await $(`${q}/${y.ato_id}`,{method:"GET"},"$dMg99jeUNP");Array.isArray(r.value)?R.value=r.value.map(u=>({...u,created:xe(u.created,"dd/mm/yyyy hh:mm")})):r.value&&typeof r.value=="object"&&(R.value=[{...r.value,created:xe(r.value.created,"dd/mm/yyyy hh:mm")}])}const{data:m}=([V,h]=de(()=>$(E,{method:"POST",body:{cartorio_token:U}},"$B6PdRx8Gp4")),V=await V,h(),V);j.value=m.value[0].func_json_escreventes;const p=()=>{const r=A.query.origem||"criar",u=A.query.id;r==="atualizar"?b.push(`/os/atualizar/${u}`):b.push("/os/criar-registro")};return(r,u)=>{const _=Ye,x=se;return P(),X(me,null,{default:o(()=>[e(T,{class:"mt-5"},{default:o(()=>[e(K,{class:"mb-4 ml-8",onClick:n,size:"large",color:"green"},{default:o(()=>u[1]||(u[1]=[F("Novo")])),_:1}),v("div",null,[v("img",{class:"btn-pointer ml-2",src:ue,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:u[0]||(u[0]=(...S)=>r.onSubmit&&r.onSubmit(...S))})])]),_:1}),e(T,null,{default:o(()=>[e(N,null,{default:o(()=>[e(be,{style:{height:"465px"},headers:g,items:t(R)},{"item.observacao":o(({item:S})=>[F(oe(S.observacao.length>100?S.observacao.slice(0,100)+"...":S.observacao),1)]),"item.actions":o(({item:S})=>[e(T,null,{default:o(()=>[v("div",{onClick:c=>z(S)},u[2]||(u[2]=[v("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ie,alt:"Visualizar"},null,-1)]),8,ut),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:c=>l(S),title:"Deletar Observação"},[S.excluido?(P(),W("img",dt)):(P(),W("img",pt))],8,ct)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),t(f)?(P(),X(_,{key:0,show:t(f),observacao:t(w),visualizar:t(I),onClose:i},null,8,["show","observacao","visualizar"])):pe("",!0),e(T,null,{default:o(()=>[e(x,{onClick:p},{default:o(()=>[e(K,{size:"large",color:"red"},{default:o(()=>u[3]||(u[3]=[F("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},mt={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ue,alt:"Criar"},_t={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ie,alt:"Criar"},vt={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Be,alt:"Criar"},ft=["onClick"],gt=["onClick"],yt=["onClick"],ht={key:0,style:{width:"30px",height:"30px"},src:ye,alt:"Visualizar",title:"Reativar"},bt={key:1,src:he,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Wt={__name:"Anexos",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},setup(J){const V=J,h=ee(),{$toast:y}=re(),b=H(),A=Q(),C=`${h.public.biometria}/run-scanner`,E=`${h.public.managemant}/atos_anexos`,L=`${h.public.managemant}/atos_anexos`,q=`${h.public.managemant}/download`;`${h.public.managemant}`,`${h.public.managemant}`;const U=s(!1),R=s(null),j=s([]);O("pessoa_token");const f=ce({descricao:"",fileEvent:null}),I={descricao:{required:$e.withMessage("O campo é obrigatório",we)}},w=Ce(I,f,{$autoDirty:!0}),g=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}];async function z(){try{await n(),await l()}catch(_){console.error("Erro ao executar scanner ou listar arquivos:",_)}}async function n(){try{const{data:_}=await $(C,{method:"GET"},"$WazoKp68Tw")}catch(_){y.error("Erro ao acionar o scanner:",_)}}async function l(){try{const{data:_,status:x}=await $("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:A.query.ato_token_edit,cartorio_token:O("user-data").value.cartorio_token}},"$03Wxiia3aI")}catch(_){console.error("Erro ao enviar o arquivo:",_)}}const i=async()=>{U.value=!0};function k(_){return _?!0:(console.error("Erro: Nenhum arquivo foi selecionado!"),R.value=!1,!1)}const m=async()=>{if(w.value.$touch(),!w.value.$invalid&&k(f.fileEvent)){const{data:_,error:x,status:S}=await $(E,{method:"POST",body:{ato_id:V.ato_id,descricao:f.descricao,user_id:O("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$WyW0hasRPI");S.value==="success"&&(y.success("Anexo registrado com sucesso!"),j.value.push(_.value))}};async function p(_){_.excluido=!_.excluido;try{await $(`${L}/${_.id}`,{method:"PUT",body:JSON.stringify({excluido:_.excluido})},"$Y3y6TjqbSV")}catch(x){console.error("Erro ao excluir pessoa:",x)}}async function r(_){try{const x=await $(`${q}`,{method:"POST",body:{bucket:O("user-data").value.cartorio_token,path:_.link}},"$bkXJSi7s76"),c=await(await fetch(x.data.value)).blob(),Y=URL.createObjectURL(c);window.open(Y,"_blank")}catch(x){console.error("Erro ao excluir pessoa:",x)}}const u=()=>{const _=A.query.origem||"criar",x=A.query.id;_==="atualizar"?b.push(`/os/atualizar/${x}`):b.push("/os/criar-registro")};return(_,x)=>{const S=se;return P(),X(me,null,{default:o(()=>[e(T,null,{default:o(()=>[e(N,{cols:"5",class:"mt-2"},{default:o(()=>[e(ae,{modelValue:t(f).descricao,"onUpdate:modelValue":[x[0]||(x[0]=c=>t(f).descricao=c),t(w).descricao.$touch],"error-messages":t(w).descricao.$errors.map(c=>c.$message),onBlur:t(w).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"])]),_:1}),v("div",{onClick:z,title:"Criar",style:{"padding-right":"10px"}},[t(R)===!1?(P(),W("img",mt)):t(R)===!0?(P(),W("img",_t)):(P(),W("img",vt))]),v("div",{onClick:m,title:"Criar"},x[1]||(x[1]=[v("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:ue,alt:"Escanear"},null,-1)]))]),_:1}),e(be,{headers:g,items:t(j),style:{height:"465px","max-width":"600px"}},{"item.actions":o(({item:c})=>[e(T,null,{default:o(()=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:Y=>i(c),title:"Visualizar Anexo"},[v("img",{style:{width:"30px",height:"30px"},onClick:Y=>r(c),src:ie,alt:"Visualizar"},null,8,gt)],8,ft),v("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:Y=>p(c),title:"Deletar Pessoa"},[c.excluido?(P(),W("img",ht)):(P(),W("img",bt))],8,yt)]),_:2},1024)]),_:1},8,["items"]),e(S,{onClick:u},{default:o(()=>[e(K,{size:"large",color:"red"},{default:o(()=>x[2]||(x[2]=[F("Voltar")])),_:1})]),_:1})]),_:1})}}};export{Ut as _,It as a,Bt as b,Ft as c,Lt as d,Wt as e};
