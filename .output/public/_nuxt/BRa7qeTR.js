import{_ as ge}from"./3a0L5QML.js";import{u as he,L as de,M as me,r as s,n as ke,o as u,x as I,w as t,b as a,v as e,V as fe,E as te,d as W,y as R,z as pe,m as K,H as Se,D as ye,a as A,c as j,O as je,p as Re,P as Ue,F as qe,g as Fe,Q as Pe,t as ve}from"./tcrHOaPz.js";import{u as _}from"./CW3yZnkU.js";import{V as U}from"./BRwZv5Qo.js";import{V as B}from"./sIuKJzQL.js";import{V as be}from"./DTyA0Wwd.js";import{V as xe}from"./CC6F-Ne7.js";import{_ as Ie}from"./MLaEifXp.js";import{_ as Ne,a as Be,b as Le,T as Ge,W as He,S as Ke,D as Oe,c as Je,d as We,e as Xe,f as Qe,g as Ye}from"./CZIZDmBm.js";import{_ as Ze,r as Te}from"./Dlnx8-H4.js";import{_ as $e}from"./CmY36I1Y.js";import{_ as ze}from"./BVz1G1IN.js";import{_ as ea}from"./DIZavr5w.js";import{_ as aa}from"./DhZAEAD-.js";import{_ as Ce,a as Ee}from"./DJvq3mCv.js";import{V as Ve}from"./CbMOxflt.js";import{_ as Me}from"./Cszf8JGD.js";import{V as ta}from"./BEeJnW2Q.js";import{f as Ae}from"./B0IxRygJ.js";import{_ as oa}from"./-zgYk4Vu.js";import{c as sa,r as ra,u as na}from"./bXi2XgPk.js";const Ya={__name:"Dados",props:{item_dados:{type:Array,required:!0},item_situacoes:{type:Array,required:!0}},setup(ie){const v=ie,{$toast:E}=he(),k=pe(),i=de(),m=me(),x=`${k.public.managemant}/updateAtos`,V=s(v.item_situacoes),ee=s(m.query.origem==="vizualizar"),O=ke({dt_abertura:v.item_dados[0].dt_abertura||null,status:v.item_dados[0].status||null,mne:v.item_dados[0].mne||null});async function Z(){const{data:T,error:b,status:P}=await _(`${x}/${m.query.ato_id}`,{method:"PUT",body:{status:O.status,mne:O.mne,dt_abertura:O.dt_abertura}},"$EIT5jtTUdX");P.value==="success"&&E.success("Ato Atualizado com sucesso")}const z=()=>{const T=m.query.origem||"criar",b=m.query.id;switch(T){case"atualizar":case"vizualizar":i.push(`/os/atualizar/${b}`);break;case"atualizar-lista":case"vizualizar-lista":i.push("/atos/lista");break;default:i.push("/os/criar-registro");break}};return(T,b)=>{const P=ge;return u(),I(xe,null,{default:t(()=>[a(U,{class:"mt-5"},{default:t(()=>[a(B,{cols:"3"},{default:t(()=>[a(be,{label:"Situação",modelValue:e(O).status,"onUpdate:modelValue":b[0]||(b[0]=f=>e(O).status=f),items:e(V),"item-title":"descricao","item-value":"descricao",required:""},null,8,["modelValue","items"])]),_:1})]),_:1}),a(U,null,{default:t(()=>[a(B,{cols:"5"},{default:t(()=>[a(fe,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:e(O).mne,"onUpdate:modelValue":b[1]||(b[1]=f=>e(O).mne=f)},null,8,["modelValue"])]),_:1})]),_:1}),a(U,null,{default:t(()=>[a(B,{cols:"2"},{default:t(()=>[a(fe,{modelValue:e(O).dt_abertura,"onUpdate:modelValue":b[2]||(b[2]=f=>e(O).dt_abertura=f),type:"date",label:"Data Lavratura",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),a(U,{class:"mb-3"},{default:t(()=>[a(P,{onClick:z},{default:t(()=>[a(te,{size:"large",color:"red"},{default:t(()=>b[3]||(b[3]=[W("Voltar")])),_:1})]),_:1}),e(ee)?R("",!0):(u(),I(te,{key:0,class:"ml-10",onClick:Z,size:"large",color:"green"},{default:t(()=>b[4]||(b[4]=[W("Atualizar")])),_:1}))]),_:1})]),_:1})}}},la={key:0},ia=["onClick"],ca={key:0,style:{width:"30px",height:"30px"},src:$e,alt:"Visualizar"},ua={key:1,style:{width:"30px",height:"30px"},src:ea,alt:"Visualizar"},da=["onClick"],ma=["onClick"],pa={key:0,style:{width:"30px",height:"30px"},src:Ce,alt:"Visualizar",title:"Reativar"},_a={key:1,src:Ee,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},va=["onClick"],Za={__name:"Partes",async setup(ie){let v,E;const k=de(),i=me(),m=pe(),{$toast:x}=he(),V=`${m.public.managemant}/pesquisarPessoas`,ee=`${m.public.managemant}/listarPapeis`,O=`${m.public.managemant}/createAtosPessoa`,Z=`${m.public.managemant}/updateAtosPessoa`,z=`${m.public.managemant}/getAtosPessoaById`,T=`${m.public.managemant}/download`,b=s(K("user-data").value.cartorio_token),P=s(i.query.origem==="vizualizar"),f=s([]),L=s({}),$=s([]),J=s([]),q=s(!1),M=s(!1),X=s(!1),ae=s(!1),Q=s(null),y=s(null),h=s(null),Y=s(null),l=s(null),r=s(i.query.tipo_ato_token),p=s(null),D=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"320px"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome",width:"320px"},{value:"actions"}],c=ke({papeis:null,nome:null,pessoa:null,documento:null});Se(()=>{var d;return((d=c.pessoa)==null?void 0:d.link_ficha)||!1});const{data:F}=([v,E]=ye(()=>_(ee,{method:"POST",body:{tipo_ato_token:i.query.tipo_ato_token}},"$acoiTIUp00")),v=await v,E(),v);J.value=F.value;const o=async()=>{const{data:d}=await _(`${z}/${i.query.ato_id}`,{method:"GET"},"$ypnU9hCpVn"),H=(_e=>_e.map(le=>({...le,pessoa:{...le.pessoa,documento:le.pessoa.doc_identificacao},papel:{...le.partes_tipos}})))(d.value);$.value=H};o();async function g(){try{const{data:d,error:n}=await _(V,{method:"POST",body:{cartorio_token:b.value,documento:c.documento,nome:c.nome}},"$pr30MyPXfY");d.value.length>0?(f.value=d.value,c.pessoa=f.value[0]):f.value=[]}catch(d){console.error("Erro na requisição",d)}}const G=()=>{M.value=!0},N=async()=>{await o()},w=async()=>{await o()},C=async()=>{const d={pessoa:c.pessoa,papel:J.value.find(ce=>ce.id===c.papeis),representante:{nome:null}},n=await _(`${z}/${i.query.ato_id}`,{method:"GET"},"$scHdIvxj2D");for(const ce of n.data.value)if(ce.pessoa_id===c.pessoa.id&&ce.ato_id===Number(i.query.ato_id)&&ce.tipo_parte_id===c.papeis){x.error("Pessoa Já Registrada Com Esse Papel!");return}const{data:H,error:_e,status:le}=await _(O,{method:"POST",body:{ato_id:Number(i.query.ato_id),pessoa_id:c.pessoa.id,tipo_parte_id:c.papeis,user_id:K("user-data").value.usuario_id}},"$18isAgOJxG");le.value==="success"?(d.id=H.value.id,x.success("Pessoa Registrada com Sucesso!"),$.value.push(d)):x.error(_e.value.message)},oe=async d=>{X.value=!0;const{data:n}=await _(T,{method:"POST",body:{bucket:K("user-data").value.cartorio_token,path:d.pessoa.link_ficha}},"$hmDzSF3F61");p.value=n.value,L.value=d.pessoa},re=d=>{const n=$.value.filter(H=>H.pessoa.id!==d.pessoa.id&&!H.excluido).map(H=>({id:H.pessoa.id,nome:H.pessoa.nome}));h.value=d.id,Q.value=n,q.value=!0,y.value=d.pessoa.nome,l.value=d.pessoa.id},ue=d=>{ae.value=!0,Y.value=d.id,y.value=d.pessoa.nome};async function se(d){d.excluido=!d.excluido;try{await _(`${Z}/${d.id}`,{method:"PUT",body:JSON.stringify({excluido:d.excluido})},"$l09I6nLRfk")}catch(n){console.error("Erro ao excluir pessoa:",n)}}const ne=()=>{const d=i.query.origem||"criar",n=i.query.id;switch(d){case"atualizar":case"vizualizar":k.push(`/os/atualizar/${n}`);break;case"atualizar-lista":case"vizualizar-lista":k.push("/atos/lista");break;default:k.push("/os/criar-registro");break}};return(d,n)=>{const H=Ie,_e=Be,le=Le,ce=Ze,De=ge;return u(),I(xe,null,{default:t(()=>[e(P)?R("",!0):(u(),I(U,{key:0,class:"mt-5"},{default:t(()=>[a(B,{cols:"3"},{default:t(()=>[a(fe,{label:"Documento",modelValue:e(c).documento,"onUpdate:modelValue":n[0]||(n[0]=S=>e(c).documento=S)},null,8,["modelValue"])]),_:1}),a(B,{cols:"4"},{default:t(()=>[a(fe,{label:"Pessoa",modelValue:e(c).nome,"onUpdate:modelValue":n[1]||(n[1]=S=>e(c).nome=S)},null,8,["modelValue"])]),_:1}),A("div",null,[A("img",{class:"mt-1",src:$e,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:g})]),A("div",null,[A("img",{class:"mt-1 ml-2",src:ze,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:G})])]),_:1})),e(P)?R("",!0):(u(),I(U,{key:1},{default:t(()=>[a(B,{cols:"4"},{default:t(()=>[a(be,{label:"Selecione a Pessoa",modelValue:e(c).pessoa,"onUpdate:modelValue":n[2]||(n[2]=S=>e(c).pessoa=S),items:e(f),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),a(B,{cols:"3"},{default:t(()=>[a(be,{label:"Papel",modelValue:e(c).papeis,"onUpdate:modelValue":n[3]||(n[3]=S=>e(c).papeis=S),items:e(J),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),e(P)?R("",!0):(u(),j("div",la,[A("img",{class:"mt-1",src:ze,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:C})]))]),_:1})),a(U,null,{default:t(()=>[a(B,null,{default:t(()=>[a(Ve,{style:{height:"465px"},headers:D,items:e($)},{"item.actions":t(({item:S})=>[e(P)?R("",!0):(u(),I(U,{key:0},{default:t(()=>[A("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-1",onClick:we=>oe(S),title:"Visualizar Ficha"},[S.pessoa.link_ficha?(u(),j("img",ca)):(u(),j("img",ua))],8,ia),A("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:we=>ue(S),class:"mr-1",title:"Alterar Papel"},n[8]||(n[8]=[A("img",{style:{width:"30px",height:"30px"},src:aa,alt:"Visualizar"},null,-1)]),8,da),A("div",{class:"mr-1",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:we=>se(S),title:"Deletar Pessoa"},[S.excluido?(u(),j("img",pa)):(u(),j("img",_a))],8,ma),A("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-1",onClick:we=>re(S),title:"Selecionar Representante"},n[9]||(n[9]=[A("img",{style:{width:"30px",height:"30px"},src:Ne,alt:"Visualizar"},null,-1)]),8,va)]),_:2},1024))]),_:1},8,["items"])]),_:1})]),_:1}),a(H,{show:e(M),onClose:n[4]||(n[4]=S=>M.value=!1)},null,8,["show"]),a(_e,{representante_nome:e(y),representantes:e(Q),ato_id:e(h),show:e(q),onClose:n[5]||(n[5]=S=>q.value=!1),onUpdateRepresentante:w},null,8,["representante_nome","representantes","ato_id","show"]),a(le,{representante_nome:e(y),ato_token:e(r),ato_id:e(Y),show:e(ae),onClose:n[6]||(n[6]=S=>ae.value=!1),onUpdatePapel:N},null,8,["representante_nome","ato_token","ato_id","show"]),e(X)?(u(),I(ce,{key:2,show:e(X),"link-view":e(p),"pessoa-obj":e(L),"is-view":!0,onClose:n[7]||(n[7]=S=>X.value=!1)},null,8,["show","link-view","pessoa-obj"])):R("",!0),a(U,null,{default:t(()=>[a(De,{onClick:ne},{default:t(()=>[a(te,{size:"large",color:"red"},{default:t(()=>n[10]||(n[10]=[W("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},fa={key:0,class:"loading-overlay"},ya="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",et={__name:"Minuta",emits:["page","doc"],setup(ie,{emit:v}){je("DocumentEditorContainer",[Ge,He,Ke]);const E=pe(),{$toast:k}=he(),i=de(),m=me(),x=v;Te(`${E.public.docEditor}`);const V=`${E.public.managemant}/download`,ee=`${E.public.managemant}/atos/files`,O=`${E.public.managemant}/subitituirModelo`,Z=`${E.public.managemant}/upload`,z=s(null),T=s(!1),b=s("Ao executar a geração, a minuta atual será substituída e não poderá ser recuperada.Confirma ?"),P=s(m.query.origem==="vizualizar"),f=s(!1),L=async l=>{try{const r=await fetch(l);if(!r.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await r.blob()}catch(r){return console.error(r),null}},$=async()=>{try{const{data:l}=await _(`${ee}/${m.query.ato_token_edit}`,{method:"GET"},"$5jxI4TvFse");return l.value.link_ato}catch(l){console.error("Erro ao carregar o documento:",l),k.error(l)}},J=async()=>{f.value=!0;try{const l=await $(),{data:r,status:p}=await _(V,{method:"POST",body:{bucket:K("user-data").value.cartorio_token,path:l}},"$dvNFfvmIJC"),D=r.value,c=await L(D);if(c){const F=new FileReader;F.onload=()=>{const o=F.result;z.value.ej2Instances.documentEditor.open(o),x("doc",o)},F.readAsText(c)}}catch{console.error("Erro ao carregar o documento.")}finally{f.value=!1}},q=async()=>{const r=await z.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),p=new FileReader;p.onload=()=>{const D=p.result,F=z.value.ej2Instances.documentEditor.pageCount;x("page",F),x("doc",D)},p.readAsText(r)},M=async()=>{f.value=!0;try{const r=await z.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),p=new FormData;p.append("file",r,"anexo.sfdt"),p.append("cartorio_token",K("user-data").value.cartorio_token),p.append("token",m.query.ato_token_edit),p.append("tipo","ato_minuta");const{data:D,status:c}=await _(Z,{method:"POST",body:p},"$xv11VtUdMy");if(c.value==="success"){k.success("Documento enviado!");const o=z.value.ej2Instances.documentEditor.pageCount;q(),x("page",o)}else k.error("Erro ao enviar documento para o sistema.")}catch(l){k.error("Erro ao salvar documento."),console.error(l)}finally{f.value=!1}},X=()=>{T.value=!1,ae()},ae=async()=>{h(!0);try{await Q(),h(!0);const{data:l,status:r}=await _(O,{method:"POST",body:{ato_token:m.query.ato_token_edit}},"$zyzWHTXTBW");l.value&&y(l.value)}catch(l){console.error("Erro ao gerar a minuta:",l),k.error("Ocorreu um erro ao gerar a minuta.")}finally{h(!1)}},Q=async()=>{try{const{data:l}=await _(V,{method:"POST",body:{bucket:K("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$KreLE0Ys81"),r=await L(l.value);if(r){const p=new FileReader;p.onload=()=>{const D=p.result;z.value.ej2Instances.documentEditor.open(D),x("doc",D)},p.readAsText(r)}}catch(l){console.error("Erro ao carregar o modelo de minuta:",l)}},y=l=>{const r=z.value.ej2Instances.documentEditor,p=D=>{for(const[c,F]of Object.entries(D))if(/^<<.+>>$/.test(c))try{r.search.findAll(c),r.search.searchResults.length>0&&r.search.searchResults.replaceAll(F)}catch(o){console.error(`Erro ao substituir o marcador ${c}:`,o)}else if(c==="partes"&&Array.isArray(F)&&F.length>0)for(const o of F)typeof o=="object"&&p(o)};p(l)},h=l=>{f.value=l},Y=()=>{const l=m.query.origem||"criar",r=m.query.id;switch(l){case"atualizar":case"vizualizar":i.push(`/os/atualizar/${r}`);break;case"atualizar-lista":case"vizualizar-lista":i.push("/atos/lista");break;default:i.push("/os/criar-registro");break}};return Re(async()=>{await J(),q()}),(l,r)=>{const p=ge,D=Me;return u(),j(qe,null,[a(e(Oe),{height:"900px",ref_key:"documentEditorContainer",ref:z,serviceUrl:ya,enableToolbar:!0,enableWordExport:!0},null,512),e(f)?(u(),j("div",fa,[a(Ue,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):R("",!0),a(U,{class:"ml-4 mt-4 mb-4"},{default:t(()=>[a(p,{class:"mr-4"},{default:t(()=>[a(te,{size:"large",onClick:Y,color:"red"},{default:t(()=>r[2]||(r[2]=[W("Voltar")])),_:1})]),_:1}),e(P)?R("",!0):(u(),I(te,{key:0,size:"large",color:"green",onClick:M,disabled:e(f)},{default:t(()=>r[3]||(r[3]=[W("Atualizar")])),_:1},8,["disabled"])),e(P)?R("",!0):(u(),I(te,{key:1,class:"ml-4",size:"large",color:"blue",onClick:r[0]||(r[0]=c=>T.value=!0)},{default:t(()=>r[4]||(r[4]=[W("Gerar Minuta")])),_:1}))]),_:1}),a(D,{onConfirm:X,condMessage:e(b),show:e(T),onClose:r[1]||(r[1]=c=>T.value=!1)},null,8,["condMessage","show"])],64)}}},ga=["innerHTML"],at={__name:"Livro",props:{pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(ie){let v,E;const k=ie,i=pe();Te(`${i.public.docEditor}`);const{$toast:m}=he(),x=de(),V=me(),ee=`${i.public.managemant}/download`,O=`${i.public.managemant}/atos/files`,Z=`${i.public.managemant}/lavrarAto`,z=`${i.public.managemant}/valida_lavratura`,T=`${i.public.managemant}/listarEscrevente`,b=`${i.public.managemant}/ato_calcular`,P=s(K("user-data").value.cartorio_token),f=K("auth_token").value,L=s("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),$=s(null),J=s(""),q=s(!1),M=s(null),X=s(null),ae=s(V.query.origem==="vizualizar"),Q=s(null),y=s([]),h=s({}),Y=ke({escrevente:null}),l=async w=>{try{const C=await fetch(w);if(!C.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await C.blob()}catch(C){return console.error(C),null}},r=async()=>{try{const{data:w}=await _(`${O}/${V.query.ato_token_edit}`,{method:"GET"},"$FnEbAJEARP");return w.value.link_ato}catch(w){console.error("Erro ao carregar o documento:",w),m.error(w)}},p=async()=>{try{const w=await r(),{data:C,status:oe}=await _(ee,{method:"POST",body:{bucket:K("user-data").value.cartorio_token,path:w}},"$7ljqltMqa0"),re=C.value,ue=await l(re);if(ue){const se=new FileReader;se.onload=()=>{const ne=se.result;Q.value.ej2Instances.documentEditor.open(ne)},se.readAsText(ue)}}catch{m.error("Erro ao carregar o documento.")}};p();const D=async(w=!1)=>{const C=Q.value.ej2Instances.documentEditor.pageCount;if(!w){const{data:se,error:ne,status:d}=await _(z,{method:"POST",body:{ato_token:V.query.ato_token_edit}},"$OWxZSQkyX8");let n,H;if(d.value==="success"&&se.value?(n=se.value[0].status,H=se.value[0].status_mensagem):ne.value&&ne.value.data&&(n=ne.value.data[0].status,H=ne.value.data[0].status_mensagem),n!=="OK"){$.value=n,J.value=H,h.value=null,q.value=!0,L.value=" O ato apresenta inconsistências, deseja prosseguir?";return}}const{data:oe,status:re,error:ue}=await _(Z,{method:"POST",body:{ato_token:V.query.ato_token_edit,qtd_paginas:C,escrevente_token:Y.escrevente,usuario_token:f,cartorio_token:P}},"$sMqfUUQcBM");re.value==="success"?(M.value=oe.value,X.value=oe.value[0].selo,m.success("Ato lavrado com sucesso!")):m.error(ue.value.data[0].status_mensagem||"Falha ao lavrar o ato.")},c=()=>{q.value=!1,$.value=null,J.value="",h.value={}},F=async()=>{const w=Q.value.ej2Instances.documentEditor.pageCount,{data:C,status:oe}=await _(b,{method:"POST",body:{ato_token:V.query.ato_token_edit,cartorio_token:P,quantidade:1,usuario_token:f,escrevente_token:Y.escrevente,qtd_paginas:w}},"$OVwiKSwcOE");oe.value==="success"?h.value=C.value[0]:m.error("Falha ao calcular o ato.")},o=async()=>{q.value=!1,$.value&&$.value!=="OK"?(await D(!0),$.value=null,J.value=""):await D()},g=async()=>{q.value=!0,L.value="Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?",await F()},{data:G}=([v,E]=ye(()=>_(T,{method:"POST",body:{cartorio_token:P}},"$iv1N3XD6We")),v=await v,E(),v);y.value=G.value[0].func_json_escreventes;const N=()=>{const w=V.query.origem||"criar",C=V.query.id;switch(w){case"atualizar":case"vizualizar":x.push(`/os/atualizar/${C}`);break;case"atualizar-lista":case"vizualizar-lista":x.push("/atos/lista");break;default:x.push("/os/criar-registro");break}};return Fe(()=>k.document,(w,C)=>{p()}),(w,C)=>{const oe=Me;return u(),j(qe,null,[a(U,null,{default:t(()=>[a(B,null,{default:t(()=>[a(e(Oe),{restrictEditing:!0,enableToolbar:!1,ref_key:"documentEditorContainer",ref:Q,height:"850px",width:"850px"},null,512)]),_:1}),e(ae)?R("",!0):(u(),I(B,{key:0},{default:t(()=>[a(be,{class:"mt-15",label:"Tabelião/escrevente",modelValue:e(Y).escrevente,"onUpdate:modelValue":C[0]||(C[0]=re=>e(Y).escrevente=re),items:e(y),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),A("img",{onClick:C[1]||(C[1]=re=>g()),style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:Je}),e(M)?(u(),I(ta,{key:0,width:"360"},{default:t(()=>[a(U,null,{default:t(()=>[a(B,null,{default:t(()=>[a(Pe,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:t(()=>[a(B,null,{default:t(()=>[W(" Livro: "+ve(e(M)[0].livro_numero),1)]),_:1}),a(B,null,{default:t(()=>[W(" Protocolo: "+ve(e(M)[0].protocolo?e(M)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),a(B,null,{default:t(()=>[a(Pe,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:t(()=>[W(" Folhas : "+ve(e(M)[0].pagina_inicial)+" A "+ve(e(M)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),A("div",{style:{"margin-left":"10px","padding-bottom":"20px","margin-top":"-10px"},innerHTML:e(X)},null,8,ga)]),_:1})):R("",!0)]),_:1}))]),_:1}),a(te,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:N},{default:t(()=>C[2]||(C[2]=[W("Voltar")])),_:1}),a(oe,{show:e(q),condMessage:e(L),description:e(J),valor:e(h),onClose:c,onConfirm:o},null,8,["show","condMessage","description","valor"])],64)}}},ha=["onClick"],ba=["onClick"],ka={key:0,style:{width:"30px",height:"30px"},src:Ce,alt:"Visualizar",title:"Reativar"},xa={key:1,src:Ee,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},tt={__name:"Observacao",async setup(ie){let v,E;const k=de(),i=me(),m=pe(),x=`${m.public.managemant}/listarEscrevente`,V=`${m.public.managemant}/atos_observacao`,ee=`${m.public.managemant}/atos_observacao`,O=s(K("user-data").value.cartorio_token),Z=s(i.query.origem==="vizualizar"),z=s(!1),T=s(!1),b=s(""),P=s([]),f=s([]);function L(y){b.value=y.observacao,T.value=!0,z.value=!0}const $=()=>{T.value=!1,z.value=!0,b.value=""},J=[{title:"Data",align:"start",key:"created"},{title:"Escrevente",align:"start",key:"users.nome"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}],q=async()=>{z.value=!1,await M()};async function M(){const{data:y}=await _(`${ee}/${i.query.ato_id}`,{method:"GET"},"$HyzoO40swN");Array.isArray(y.value)?P.value=y.value.map(h=>({...h,created:Ae(h.created,"dd/mm/yyyy hh:mm")})):y.value&&typeof y.value=="object"&&(P.value=[{...y.value,created:Ae(y.value.created,"dd/mm/yyyy hh:mm")}])}[v,E]=ye(()=>M()),await v,E();async function X(y){y.excluido=!y.excluido;try{await _(`${V}/${y.id}`,{method:"PUT",body:JSON.stringify({excluido:y.excluido})},"$gnHMo4uCXD")}catch(h){console.error("Erro ao excluir observação:",h)}}const{data:ae}=([v,E]=ye(()=>_(x,{method:"POST",body:{cartorio_token:O}},"$sP9AKdd3Ky")),v=await v,E(),v);f.value=ae.value[0].func_json_escreventes;const Q=()=>{const y=i.query.origem||"criar",h=i.query.id;switch(y){case"atualizar":case"vizualizar":k.push(`/os/atualizar/${h}`);break;case"atualizar-lista":case"vizualizar-lista":k.push("/atos/lista");break;default:k.push("/os/criar-registro");break}};return(y,h)=>{const Y=We,l=ge;return u(),I(xe,null,{default:t(()=>[e(Z)?R("",!0):(u(),I(U,{key:0,class:"mt-5"},{default:t(()=>[e(Z)?R("",!0):(u(),I(te,{key:0,class:"mb-4 ml-8",onClick:$,size:"large",color:"green"},{default:t(()=>h[0]||(h[0]=[W("Novo")])),_:1}))]),_:1})),a(U,null,{default:t(()=>[a(B,null,{default:t(()=>[a(Ve,{style:{height:"465px"},headers:J,items:e(P)},{"item.observacao":t(({item:r})=>[W(ve(r.observacao.length>100?r.observacao.slice(0,100)+"...":r.observacao),1)]),"item.actions":t(({item:r})=>[a(U,null,{default:t(()=>[A("div",{onClick:p=>L(r)},h[1]||(h[1]=[A("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:$e,alt:"Visualizar"},null,-1)]),8,ha),A("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end","margin-left":"5px"},onClick:p=>X(r),title:"Deletar Observação"},[r.excluido?(u(),j("img",ka)):(u(),j("img",xa))],8,ba)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),e(z)?(u(),I(Y,{key:1,show:e(z),observacao:e(b),visualizar:e(T),onClose:q},null,8,["show","observacao","visualizar"])):R("",!0),a(U,null,{default:t(()=>[a(l,{onClick:Q},{default:t(()=>[a(te,{size:"large",color:"red"},{default:t(()=>h[2]||(h[2]=[W("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},$a={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Qe,alt:"Criar"},wa={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ye,alt:"Criar"},za={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:oa,alt:"Criar"},Ca=["onClick"],Ea=["onClick"],Va=["onClick"],Pa={key:0,style:{width:"30px",height:"30px"},src:Ce,alt:"Visualizar",title:"Reativar"},Aa={key:1,src:Ee,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},ot={__name:"Anexos",async setup(ie){let v,E;const k=pe(),{$toast:i}=he(),m=de(),x=me(),V=s(x.query.origem==="vizualizar"),ee=`${k.public.biometria}/run-scanner`,O=`${k.public.managemant}/atos_anexos`,Z=`${k.public.managemant}/atos_anexos`,z=`${k.public.managemant}/download`,T=`${k.public.managemant}/atos_anexos`,b=`${k.public.managemant}/upload`,P=s(!1),f=s(null),L=s([]);K("pessoa_token");const $=ke({descricao:"",fileEvent:null}),J={descricao:{required:sa.withMessage("O campo é obrigatório",ra)}},q=na(J,$,{$autoDirty:!0}),M=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}],{data:X}=([v,E]=ye(()=>_(`${T}/${x.query.ato_id}`,{method:"GET"},"$AOZpbz65MA")),v=await v,E(),v);L.value=X.value;async function ae(){try{await Q(),await y()}catch(o){console.error("Erro ao executar scanner ou listar arquivos:",o)}}async function Q(){try{const{data:o}=await _(ee,{method:"GET"},"$KttjFhHivJ")}catch(o){i.error("Erro ao acionar o scanner:",o)}}async function y(){try{const{data:o,status:g}=await _("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:x.query.ato_token_edit,cartorio_token:K("user-data").value.cartorio_token}},"$TqQrsgxUkd")}catch(o){console.error("Erro ao enviar o arquivo:",o)}}async function h(){try{const o=document.createElement("input");o.type="file",o.accept="*/*",o.onchange=async g=>{$.fileEvent=g,g.target.files[0]&&(f.value=!0)},o.click()}catch(o){console.error("Erro ao abrir o explorador de arquivos:",o)}}const Y=async()=>{P.value=!0};function l(o){return o?!0:(f.value=!1,!1)}const r=async o=>{if(!$.fileEvent||!$.fileEvent.target.files.length){i.error("Nenhum arquivo selecionado.");return}const g=$.fileEvent.target.files[0],G=new FormData;G.append("file",g),G.append("cartorio_token",K("user-data").value.cartorio_token),G.append("token",o),G.append("tipo","ato_anexo");try{const N=await _(b,{method:"POST",body:G},"$KDhIYzGKzM");i.success("Anexo registrado com sucesso!")}catch{i.error("Erro ao enviar o arquivo.")}},p=async()=>{if(q.value.$touch(),!q.value.$invalid&&l($.fileEvent)){const{data:o,error:g,status:G}=await _(O,{method:"POST",body:{ato_id:x.query.ato_id,descricao:$.descricao,user_id:K("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$cdoFBGO0Ti");G.value==="success"&&(i.success("Anexo registrado com sucesso!"),L.value.push(o.value),r(o.value.token))}};async function D(o){o.excluido=!o.excluido;try{await _(`${Z}/${o.id}`,{method:"PUT",body:JSON.stringify({excluido:o.excluido})},"$WLSrgYRoHq")}catch(g){console.error("Erro ao excluir pessoa:",g)}}async function c(o){try{const g=await _(`${z}`,{method:"POST",body:{bucket:K("user-data").value.cartorio_token,path:o.link}},"$NdgRjioizH"),N=await(await fetch(g.data.value)).blob(),w=URL.createObjectURL(N);window.open(w,"_blank")}catch(g){console.error("Erro ao excluir pessoa:",g)}}const F=()=>{const o=x.query.origem||"criar",g=x.query.id;switch(o){case"atualizar":case"vizualizar":m.push(`/os/atualizar/${g}`);break;case"atualizar-lista":case"vizualizar-lista":m.push("/atos/lista");break;default:m.push("/os/criar-registro");break}};return(o,g)=>{const G=ge;return u(),I(xe,null,{default:t(()=>[a(U,null,{default:t(()=>[a(B,{cols:"5",class:"mt-2"},{default:t(()=>[e(V)?R("",!0):(u(),I(fe,{key:0,modelValue:e($).descricao,"onUpdate:modelValue":[g[0]||(g[0]=N=>e($).descricao=N),e(q).descricao.$touch],"error-messages":e(q).descricao.$errors.map(N=>N.$message),onBlur:e(q).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"]))]),_:1}),e(V)?R("",!0):(u(),j("div",{key:0,onClick:ae,title:"Escanear"},g[1]||(g[1]=[A("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:Xe,alt:"Escanear"},null,-1)]))),e(V)?R("",!0):(u(),j("div",{key:1,onClick:h,title:"Criar"},[e(f)===!1?(u(),j("img",$a)):e(f)===!0?(u(),j("img",wa)):(u(),j("img",za))])),e(V)?R("",!0):(u(),j("div",{key:2,onClick:p,title:"Criar"},g[2]||(g[2]=[A("img",{class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:ze,alt:"Criar"},null,-1)])))]),_:1}),a(Ve,{headers:M,items:e(L),style:{height:"465px","max-width":"600px"}},{"item.actions":t(({item:N})=>[a(U,null,{default:t(()=>[A("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:w=>Y(N),title:"Visualizar Anexo"},[A("img",{style:{width:"30px",height:"30px"},onClick:w=>c(N),src:$e,alt:"Visualizar"},null,8,Ea)],8,Ca),A("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:w=>D(N),title:"Deletar Pessoa"},[N.excluido?(u(),j("img",Pa)):(u(),j("img",Aa))],8,Va)]),_:2},1024)]),_:1},8,["items"]),a(G,{onClick:F},{default:t(()=>[a(te,{size:"large",color:"red"},{default:t(()=>g[3]||(g[3]=[W("Voltar")])),_:1})]),_:1})]),_:1})}}};export{Ya as _,Za as a,et as b,at as c,tt as d,ot as e};
