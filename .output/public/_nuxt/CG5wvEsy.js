import{u as U,r as _,E as Z,p as j,c as J,s as l,C as I,J as M,b as o,w as r,F as X,A as Y,m as G,o as z,O as h,V as C,z as H,d as x,v as Q,t as q}from"./DWgrBppU.js";import{u as V}from"./BCM1h7yI.js";import{f as K}from"./B0IxRygJ.js";import{V as W}from"./N9Geqejo.js";import{V as ee}from"./CbBA5moI.js";import{V as b}from"./DjOMB91Y.js";import{V as ae}from"./DsZlH1QY.js";import{b as oe}from"./BPRiKK4L.js";import"./CUWM9CBk.js";import"./DHFgpDzC.js";import"./D8bdZDWZ.js";const pe={__name:"index",setup(se){const d=Y(),{$toast:i}=U(),D=`${d.public.managemant}/lista_selos_transmitir`,T=`${d.public.managemant}/integra_selos`,$=`${d.public.ws}/enviar_ato`,N=`${d.public.managemant}/marcar_selos_enviado`,m=_([]),f=_(!1),y=_([]),g=_(!1),s=Z({data_utilizacao:"",descricao:"",numero:""}),R=[{title:"Data",value:"data_utilizacao"},{title:"Descrição",value:"descricao"},{title:"Número",value:"numero"},{title:"Resultado",value:"resultado"}],L=async()=>{g.value=!0;try{const{data:t,error:e,status:a}=await V(D,{method:"POST",body:{cartorio_token:G("user-data").value.cartorio_token}},"$Xe0bfknJZY");a.value==="success"?y.value=Array.isArray(t.value)?t.value.map(v=>({...v,data_utilizacao:v.data_utilizacao?K(v.data_utilizacao,"dd/mm/yyyy hh:mm"):null,resultado:null})):[]:console.error(e)}catch(t){console.error("Erro ao buscar selos:",t)}finally{g.value=!1}},O=async()=>{f.value=!0;let t=null;try{const e=m.value.map(n=>({selo_token:n})),{data:a,error:v,status:B}=await V(T,{method:"POST",body:e,onResponseError({response:n}){var E;const u=((E=n._data)==null?void 0:E.details)||"Erro ao buscar lote de selos.";i.error(u)}},"$Bhrd8mFcH5");if(B.value==="success"){const n=a.value,{data:u,error:E,status:F}=await V($,{method:"POST",body:{user:"56415451472",pass:"Ra961206",xmlData:n},onResponseError({response:c}){var S,k;const p=((S=c._data)==null?void 0:S.result)||"Erro ao enviar os selos.",w=((k=c._data)==null?void 0:k.result[0].error)||"Erro ao enviar os selos.";t=p,i.error(w)}},"$QOGY8cy73o");F.value==="success"&&u.value&&u.value.forEach(c=>{const p=y.value.find(w=>w.token===c.selo_token);p&&(p.resultado=c.error||"TRANSMITIDO")});const{status:P}=await V(N,{method:"PUT",body:t||u.value},"$ZZswjXVZN8");P.value==="success"?i.success("Selos marcados como enviados com sucesso"):i.error("Erro ao marcar os selos como enviados")}}catch(e){console.error("Erro ao enviar selos:",e),i.error("Erro inesperado ao enviar selos.")}finally{f.value=!1}},A=j(()=>y.value.filter(t=>(!s.data_utilizacao||t.data_utilizacao.toLowerCase().includes(s.data_utilizacao.toLowerCase()))&&(!s.numero||t.numero.toLowerCase().includes(s.numero.toLowerCase()))&&(!s.descricao||t.descricao.toLowerCase().includes(s.descricao.toLowerCase()))));return L(),(t,e)=>(z(),J(X,null,[l(g)?(z(),I(h,{key:0,class:"d-flex justify-center align-center",indeterminate:"",size:"64",style:{position:"absolute",top:"40%",left:"50%"}})):M("",!0),o(W,{class:"mt-5"},{default:r(()=>[o(ee,{class:"d-flex align-center"},{default:r(()=>[o(b,{cols:"12",md:"2"},{default:r(()=>[o(C,{modelValue:l(s).data_utilizacao,"onUpdate:modelValue":e[0]||(e[0]=a=>l(s).data_utilizacao=a),label:"Data",variant:"outlined","hide-details":"",class:"mb-4"},null,8,["modelValue"])]),_:1}),o(b,{cols:"12",md:"3"},{default:r(()=>[o(C,{modelValue:l(s).descricao,"onUpdate:modelValue":e[1]||(e[1]=a=>l(s).descricao=a),label:"Descrição",variant:"outlined","hide-details":"",class:"mb-4"},null,8,["modelValue"])]),_:1}),o(b,{cols:"12",md:"2"},{default:r(()=>[o(C,{modelValue:l(s).numero,"onUpdate:modelValue":e[2]||(e[2]=a=>l(s).numero=a),label:"Número",variant:"outlined","hide-details":"",class:"mb-4"},null,8,["modelValue"])]),_:1}),o(b,{cols:"12",md:"5",class:"d-flex justify-end mb-2"},{default:r(()=>[o(H,{color:"green",size:"large",onClick:O,loading:l(f),disabled:l(f)},{loader:r(()=>[o(h,{indeterminate:"",color:"white",size:"24"})]),default:r(()=>[e[4]||(e[4]=x(" Enviar Selos "))]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),o(ae,{"show-select":"",density:"compact",headers:R,items:l(A),"item-key":"token","item-value":"token",modelValue:l(m),"onUpdate:modelValue":e[3]||(e[3]=a=>Q(m)?m.value=a:null)},{"item.situacao":r(({item:a})=>[o(oe,{color:"green","text-color":"white",outlined:""},{default:r(()=>[x(q(a.situacao),1)]),_:2},1024)]),_:1},8,["items","modelValue"])]),_:1})],64))}};export{pe as default};
