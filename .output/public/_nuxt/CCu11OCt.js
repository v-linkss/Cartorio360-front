import{c as B,r as S,u as ne}from"./GezEq5rA.js";import{D as ue,K as me,u as ce,e as y,r as pe,f as fe,y as _e,l as ve,m as Ve,o as C,c as O,i as o,h as z,N as be,t as ge,p as A,w as i,b as t,s as n,q as $,V as R,d as q,F as ye,k as Ce}from"./mdyzx23d.js";import{$ as V,f as U}from"./D8gtaWLQ.js";import{f as $e,a as j}from"./B0IxRygJ.js";import{u as Pe}from"./Cn-6y6M6.js";import"./ChpaUqCj.js";import{u as ke}from"./B6LjWyvH.js";import{V as _}from"./Bl5QLEkU.js";import{V as d}from"./D0vCAOjD.js";import{V as x}from"./JbJ4AFdN.js";import{V as Ie}from"./CtpcHMqz.js";import{V as Ue}from"./BwhnVZYP.js";const xe={key:1},qe={__name:"DadosEstrangeira",props:{isModal:{type:Boolean,default:!1}},emits:["saved","close-modal"],async setup(G,{emit:L}){let b,E;const w=G,P=L,D=ue(),W=me(),{$toast:m}=ce(),u=Ce(),h=`${u.public.auth}/service/gerencia/getPessoaById`,J=`${u.public.auth}/service/gerencia/createPessoa`,K=`${u.public.auth}/service/gerencia/updatePessoa`,H=`${u.public.auth}/service/gerencia/listarEstadoCivil`,Q=`${u.public.auth}/service/gerencia/listarCapacidadeCivil`,X=`${u.public.auth}/service/gerencia/listarCidades`,Y=`${u.public.auth}/service/gerencia/listarSexo`,Z=`${u.public.auth}/service/gerencia/listarPais`,ee=`${u.public.managemant}/validarCpf`,{id:F}=W.params,ae={nome:null,nome_pai:null,nome_mae:null,profissao:null,local_trabalho:null,data_nascimento:null,doc_identificacao:null,fone_celular:null,cpf_pai:null,cpf_mae:null,tipo_pessoa:"ESTRANGEIRA",tabvalores_estadocivil_id:null,tabvalores_capacidadecivil_id:null,tabvalores_nacionalidade_id:null,tabvalores_sexo_id:null,cidade_nascimento_estrangeiro:null,cartorio_id:y("user-data").value.cartorio_id,user_id:y("user-data").value.usuario_id},k=pe(!1);let I=!1;const M=y("pessoa-id"),a=fe({...ae});function v(s){if(s)return s.replace(/[.\-]/g,"");s=null}const oe=async()=>{const{data:s,error:e}=await U(`${h}/${F}`,{method:"GET"});s.value&&(s.value.data_nascimento=s.value.data_nascimento?$e(s.value.data_nascimento,"dd/mm/yyyy"):null),Object.assign(a,s.value)},{data:g,status:Ee,pending:N,error:T}=([b,E]=_e(async()=>Pe("cliente-dados",async()=>{const[s,e,r,l,p]=await Promise.all([V(H),V(Q),V(X),V(Y),V(Z)]);return{estadoCivilItems:s,capacidadeCivilItems:e,cidadeNascimentoItems:r,sexoItems:l,paisItems:p}})),b=await b,E(),b),le={nome:{required:B.withMessage("O campo é obrigatorio",S)},nome_mae:{required:B.withMessage("O campo é obrigatorio",S)}},c=ne(le,a);async function te(){if(await c.value.$validate()){const s={...a};for(const f in s)s[f]===""&&(s[f]=null);const e={...s,doc_identificacao:v(a.doc_identificacao),cpf_pai:v(a.cpf_pai),cpf_mae:v(a.cpf_mae),data_nascimento:j(a.data_nascimento),fone_celular:a.fone_celular?a.fone_celular.replace(/[^0-9]/g,""):null},{data:r,error:l,status:p}=await U(J,{method:"POST",body:e});if(p.value==="error"&&l.value.statusCode===500)m.error("Erro ao cadastrar pessoa,o CPF já está cadastrado.");else{m.success("Pessoa cadastrada com sucesso!");const f=r.value.id;M.value=f;const re=y("pessoa_token");re.value=r.value.token,k.value=!0,P("saved")}}else m.error("Erro ao cadastrar pessoa, preencha os campos obrigatorios.")}async function se(){const s={...a};for(const f in s)s[f]===""&&(s[f]=null);const e={...s,doc_identificacao:v(a.doc_identificacao),cpf_mae:v(a.cpf_mae),fone_celular:a.fone_celular?a.fone_celular.replace(/[^0-9]/g,""):"",data_nascimento:j(a.data_nascimento)},{data:r,error:l,status:p}=await U(`${K}/${M.value}`,{method:"PUT",body:e});if(p.value==="success"){if(w.isModal===!0){m.success("Pessoa atualizada com sucesso!"),P("close-modal");return}m.success("Pessoa atualizada com sucesso!"),D.push("/pessoas/lista")}else m.error("Erro ao atualizar Pessoa Estrangeira")}async function ie(s){if(!I){I=!0;const e={cpf:s};try{const{data:r,error:l,status:p}=await ke(ee,{method:"POST",body:e},"$v6PRsIAPdv");if(p.value==="error"&&l.value.statusCode===500){m.error(" o DOCUMENTO já está cadastrado.");return}r.value.cpfValidation&&m.error("Já existe uma pessoa cadastrada com o DOCUMENTO digitado.")}catch(r){console.error("Erro ao validar CPF:",r)}finally{I=!1}}}const de=()=>{if(w.isModal===!0){P("close-modal");return}D.push("/pessoas/lista")};return ve(()=>{F&&(oe(),k.value=!0)}),(s,e)=>{const r=Ve("mask");return C(),O(ye,null,[o(N)?(C(),z(be,{key:0,class:"loading-spinner",indeterminate:"",size:"64"})):o(T)?(C(),O("div",xe,ge(o(T).message),1)):A("",!0),o(N)?A("",!0):(C(),z(Ue,{key:2},{default:i(()=>[t(_,null,{default:i(()=>[t(d,{md:"3"},{default:i(()=>[t(n,{modelValue:o(a).doc_identificacao,"onUpdate:modelValue":e[0]||(e[0]=l=>o(a).doc_identificacao=l),label:"Documento",onBlur:e[1]||(e[1]=l=>ie(o(a).doc_identificacao))},null,8,["modelValue"])]),_:1}),t(d,{md:"3"},{default:i(()=>[t(x,{label:"País",modelValue:o(a).tabvalores_nacionalidade_id,"onUpdate:modelValue":e[2]||(e[2]=l=>o(a).tabvalores_nacionalidade_id=l),items:o(g).paisItems,"item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1}),t(d,{md:"4"},{default:i(()=>[t(n,{modelValue:o(a).nome,"onUpdate:modelValue":e[3]||(e[3]=l=>o(a).nome=l),"error-messages":o(c).nome.$errors.map(l=>l.$message),label:"Nome",required:"",onBlur:o(c).nome.$touch,onInput:o(c).nome.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1}),t(d,{md:"2"},{default:i(()=>[t(Ie,{label:"Sexo",modelValue:o(a).tabvalores_sexo_id,"onUpdate:modelValue":e[4]||(e[4]=l=>o(a).tabvalores_sexo_id=l),items:o(g).sexoItems,"item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1})]),_:1}),t(_,null,{default:i(()=>[t(d,{md:"4"},{default:i(()=>[t(x,{modelValue:o(a).tabvalores_estadocivil_id,"onUpdate:modelValue":e[5]||(e[5]=l=>o(a).tabvalores_estadocivil_id=l),items:o(g).estadoCivilItems,"item-title":"descricao","item-value":"id",label:"Estado Civil"},null,8,["modelValue","items"])]),_:1}),t(d,{md:"4"},{default:i(()=>[t(n,{modelValue:o(a).profissao,"onUpdate:modelValue":e[6]||(e[6]=l=>o(a).profissao=l),label:"Profissão"},null,8,["modelValue"])]),_:1}),t(d,{md:"4"},{default:i(()=>[t(n,{modelValue:o(a).local_trabalho,"onUpdate:modelValue":e[7]||(e[7]=l=>o(a).local_trabalho=l),label:"Local de trabalho"},null,8,["modelValue"])]),_:1})]),_:1}),t(_,null,{default:i(()=>[t(d,{md:"2"},{default:i(()=>[$(t(n,{modelValue:o(a).data_nascimento,"onUpdate:modelValue":e[8]||(e[8]=l=>o(a).data_nascimento=l),label:"Data de nascimento",placeholder:"dd/mm/yyyy"},null,8,["modelValue"]),[[r,"##/##/####"]])]),_:1}),t(d,{md:"2"},{default:i(()=>[$(t(n,{modelValue:o(a).fone_celular,"onUpdate:modelValue":e[9]||(e[9]=l=>o(a).fone_celular=l),label:"Celular",placeholder:"'(99) 99999-9999'"},null,8,["modelValue"]),[[r,"(##) #####-####"]])]),_:1}),t(d,{md:"4"},{default:i(()=>[t(x,{modelValue:o(a).tabvalores_capacidadecivil_id,"onUpdate:modelValue":e[10]||(e[10]=l=>o(a).tabvalores_capacidadecivil_id=l),items:o(g).capacidadeCivilItems,label:"Capacidade Civil","item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1}),t(d,{md:"4"},{default:i(()=>[t(n,{modelValue:o(a).cidade_nascimento_estrangeiro,"onUpdate:modelValue":e[11]||(e[11]=l=>o(a).cidade_nascimento_estrangeiro=l),label:"Cidade de nascimento"},null,8,["modelValue"])]),_:1})]),_:1}),t(_,null,{default:i(()=>[t(d,{md:"4"},{default:i(()=>[$(t(n,{modelValue:o(a).cpf_pai,"onUpdate:modelValue":e[12]||(e[12]=l=>o(a).cpf_pai=l),label:"CPF do Pai"},null,8,["modelValue"]),[[r,"###.###.###-##"]])]),_:1}),t(d,{md:"4"},{default:i(()=>[t(n,{modelValue:o(a).nome_pai,"onUpdate:modelValue":e[13]||(e[13]=l=>o(a).nome_pai=l),label:"Nome do Pai"},null,8,["modelValue"])]),_:1})]),_:1}),t(_,null,{default:i(()=>[t(d,{md:"4"},{default:i(()=>[$(t(n,{modelValue:o(a).cpf_mae,"onUpdate:modelValue":e[14]||(e[14]=l=>o(a).cpf_mae=l),label:"CPF da Mãe"},null,8,["modelValue"]),[[r,"###.###.###-##"]])]),_:1}),t(d,{md:"4"},{default:i(()=>[t(n,{modelValue:o(a).nome_mae,"onUpdate:modelValue":e[15]||(e[15]=l=>o(a).nome_mae=l),modelModifiers:{date:!0},"error-messages":o(c).nome_mae.$errors.map(l=>l.$message),label:"Nome da Mãe",required:"",onBlur:o(c).nome_mae.$touch,onInput:o(c).nome_mae.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1})]),_:1}),t(_,{class:"mb-3"},{default:i(()=>[t(R,{onClick:de,size:"large",color:"red"},{default:i(()=>e[17]||(e[17]=[q("Voltar")])),_:1}),t(R,{onClick:e[16]||(e[16]=l=>o(k)?se():te()),class:"ml-4",size:"large",color:"green"},{default:i(()=>e[18]||(e[18]=[q("Salvar")])),_:1})]),_:1})]),_:1}))],64)}}};export{qe as _};
