import{_ as le}from"./ClD36q83.js";import{c as Ve,r as ze,u as Ee}from"./Fsjn0wK4.js";import{g as De,D as ee,K as ae,u as ie,r as l,e as T,f as pe,y as me,o as V,h as Z,w as t,b as e,i as a,s as ne,V as G,d as B,k as te,A as Re,a as m,c as W,p as ve,M as je,N as Ne,F as Pe,O as we,t as re}from"./czsslhLh.js";import{u as h}from"./jCyskkpA.js";import{V as q}from"./CZhpwwnu.js";import{V as I}from"./CpY2pdlu.js";import{V as ue}from"./DxXialVn.js";import{V as _e}from"./BiVaMwpv.js";import{_ as Ie,a as Ue,b as Be}from"./CVDZtJr5.js";import{_ as Fe,a as Le,b as We,T as Ke,W as Je,D as Ae,c as Ge,d as Ye}from"./jUPHS8PY.js";import{_ as Xe,r as Se}from"./CnLGw_oF.js";import{_ as ce}from"./JF78NSSV.js";import{_ as de}from"./BVz1G1IN.js";import{_ as Ze}from"./CV6r6dNV.js";import{_ as ke,a as xe}from"./DJvq3mCv.js";import{V as $e}from"./BI4o55M4.js";import{_ as Qe}from"./BX0P_1bI.js";import{V as He}from"./DpLnPnSw.js";import{f as Ce}from"./B0IxRygJ.js";import{_ as ea}from"./BcKnJfRX.js";const Ba={__name:"Dados",props:{ato_token:{type:String,required:!0},ato_tipo_id:{type:Number}},emits:["saved"],async setup(K,{emit:$}){let g,v;const _=K;De(()=>_.ato_tipo_id,o=>{k.value={id:o}});const z=$,y=ee(),P=ae(),F=te(),{$toast:L}=ie(),J=`${F.public.managemant}/listarSituacoes`,w=`${F.public.managemant}/createAtos`;`${F.public.managemant}`;const A=l(T("user-data").value.cartorio_token),b=l(T("user-service").value.id).value||l(T("user-service").value).value,C=l([]),k=l(_.ato_tipo_id?{id:_.ato_tipo_id}:null),x=pe({dt_abertura:null,status:"EM EDIÇÃO",mne:null}),S={status:{required:Ve.withMessage("O campo é obrigatorio",ze)}},M=Ee(S,x);async function R(){if(await M.value.$validate()){const{data:o,error:s,status:i}=await h(w,{method:"POST",body:{ato_tipo_id:k.value.id,cartorio_id:T("user-data").value.cartorio_id,ordemserv_id:b,status:x.status,dt_abertura:x.dt_abertura,mne:x.mne,user_id:T("user-data").value.usuario_id,user_alteracao_id:T("user-data").value.usuario_id}},"$9ZmTYsLk0K");i.value==="success"&&(L.success("Ato registrado com sucesso!"),z("saved",{id:o.value.id,token:o.value.token}))}else L.error("Preencha os campos obrigatorios.")}const{data:j}=([g,v]=me(()=>h(J,{method:"POST",body:{cartorio_token:A.value}},"$hyq5YcBEjF")),g=await g,v(),g);C.value=j.value;const u=()=>{const o=P.query.origem||"criar",s=P.query.id;switch(o){case"atualizar":case"vizualizar":y.push(`/os/atualizar/${s}`);break;case"atualizar-lista":case"vizualizar-lista":y.push("/atos/lista");break;default:y.push("/os/criar-registro");break}};return(o,s)=>{const i=le;return V(),Z(_e,null,{default:t(()=>[e(q,{class:"mt-5"},{default:t(()=>[e(I,{cols:"3"},{default:t(()=>[e(ue,{label:"Situação",modelValue:a(x).status,"onUpdate:modelValue":s[0]||(s[0]=r=>a(x).status=r),items:a(C),"item-title":"descricao","item-value":"descricao",required:"","error-messages":a(M).status.$errors.map(r=>r.$message),onBlur:a(M).status.$touch,onInput:a(M).status.$touch},null,8,["modelValue","items","error-messages","onBlur","onInput"])]),_:1})]),_:1}),e(q,null,{default:t(()=>[e(I,{cols:"5"},{default:t(()=>[e(ne,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:a(x).mne,"onUpdate:modelValue":s[1]||(s[1]=r=>a(x).mne=r)},null,8,["modelValue"])]),_:1})]),_:1}),e(q,null,{default:t(()=>[e(I,{cols:"2"},{default:t(()=>[e(ne,{modelValue:a(x).dt_abertura,"onUpdate:modelValue":s[2]||(s[2]=r=>a(x).dt_abertura=r),type:"date",label:"Data Lavratura",disabled:"",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(q,{class:"mb-3"},{default:t(()=>[e(i,{onClick:u},{default:t(()=>[e(G,{size:"large",color:"red"},{default:t(()=>s[3]||(s[3]=[B("Voltar")])),_:1})]),_:1}),e(G,{class:"ml-10",onClick:R,size:"large",color:"green"},{default:t(()=>s[4]||(s[4]=[B("Salvar")])),_:1})]),_:1})]),_:1})}}},aa=["onClick"],ta=["onClick"],oa=["onClick"],sa={key:0,style:{width:"30px",height:"30px"},src:ke,alt:"Visualizar",title:"Reativar"},ra={key:1,src:xe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},na=["onClick"],Fa={__name:"Partes",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},async setup(K){let $,g;const v=K,_=ee(),z=ae(),y=te(),{$toast:P}=ie(),F=`${y.public.managemant}/pesquisarPessoas`,L=`${y.public.managemant}/listarPapeis`,J=`${y.public.managemant}/download`,w=`${y.public.managemant}/createAtosPessoa`,A=`${y.public.managemant}/getAtosPessoaById`,b=`${y.public.managemant}/updateAtosPessoa`,C=l(T("user-data").value.cartorio_token),k=l([]),x=l({}),S=l([]),M=l([]),R=l(!1),j=l(!1),u=l(!1),o=l(!1),s=l(null),i=l(null),r=l(null),c=l(null);l(null);const p=l(null),E=l(null),N=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"400px"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome"},{value:"actions"}],f=pe({papeis:null,nome:null,pessoa:null,documento:null});Re(()=>{var d;return((d=f.pessoa)==null?void 0:d.link_ficha)||!1});const{data:fe}=([$,g]=me(()=>h(L,{method:"POST",body:{tipo_ato_token:v.ato_token}},"$fFKndZhA4W")),$=await $,g(),$);M.value=fe.value;async function Y(){try{const{data:d,error:n}=await h(F,{method:"POST",body:{cartorio_token:C.value,documento:f.documento,nome:f.nome}},"$o3ZL1rvYrY");d.value.length>0?(k.value=d.value,f.pessoa=k.value[0]):k.value=[]}catch(d){console.error("Erro na requisição",d)}}const U=()=>{j.value=!0},oe=d=>{S.value=S.value.map(n=>n.id===r.value?{...n,papel:{...n.papel,descricao:d}}:n)},X=d=>{const n=S.value.find(O=>O.pessoa.id===c.value);n.representante.nome=d},Q=async()=>{const d={pessoa:f.pessoa,papel:M.value.find(O=>O.id===f.papeis),representante:""},n=await h(`${A}/${v.ato_id}`,{method:"GET"},"$kXSxUa4grs");for(const O of n.data.value)if(O.pessoa_id===f.pessoa.id&&O.ato_id===v.ato_id&&O.tipo_parte_id===f.papeis){P.error("Pessoa Já Registrada Com Esse Papel!");return}try{const{data:O,error:ye,status:be}=await h(w,{method:"POST",body:{ato_id:Number(v.ato_id),pessoa_id:f.pessoa.id,tipo_parte_id:f.papeis,user_id:Number(T("user-data").value.usuario_id)}},"$So3qnQu7ek");be.value==="success"?(d.id=O.value.id,P.success("Pessoa Registrada com Sucesso!"),S.value.push(d)):P.error(ye.value.message)}catch{P.error("Erro no servidor. Tente novamente.")}},ge=async d=>{u.value=!0;const{data:n}=await h(J,{method:"POST",body:{bucket:T("user-data").value.cartorio_token,path:d.pessoa.link_ficha}},"$Q3kbIwtd9t");E.value=n.value,x.value=d.pessoa},H=d=>{const n=S.value.filter(O=>O.pessoa.id!==d.pessoa.id).map(O=>({id:O.pessoa.id,nome:O.pessoa.nome,token:O.pessoa.token}));r.value=d.id,p.value=d.token,s.value=n,R.value=!0,i.value=d.pessoa.nome,c.value=d.pessoa.id},se=d=>{r.value=d.id,o.value=!0,i.value=d.pessoa.nome};async function Oe(d){d.excluido=!d.excluido;try{await h(`${b}/${r.value}`,{method:"PUT",body:JSON.stringify({excluido:d.excluido})},"$9xStKwGd7o")}catch(n){console.error("Erro ao excluir pessoa:",n)}}const Te=()=>{const d=z.query.origem||"criar",n=z.query.id;switch(d){case"atualizar":case"vizualizar":_.push(`/os/atualizar/${n}`);break;case"atualizar-lista":case"vizualizar-lista":_.push("/atos/lista");break;default:_.push("/os/criar-registro");break}};return(d,n)=>{const O=Ie,ye=Le,be=We,qe=Xe,Me=le;return V(),Z(_e,null,{default:t(()=>[e(q,{class:"mt-5"},{default:t(()=>[e(I,{cols:"3"},{default:t(()=>[e(ne,{label:"Documento",modelValue:a(f).documento,"onUpdate:modelValue":n[0]||(n[0]=D=>a(f).documento=D)},null,8,["modelValue"])]),_:1}),e(I,{cols:"4"},{default:t(()=>[e(ne,{label:"Pessoa",modelValue:a(f).nome,"onUpdate:modelValue":n[1]||(n[1]=D=>a(f).nome=D)},null,8,["modelValue"])]),_:1}),m("div",null,[m("img",{class:"mt-3",src:ce,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:Y})]),m("div",null,[m("img",{class:"mt-3 ml-2",src:de,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:U})])]),_:1}),e(q,null,{default:t(()=>[e(I,{cols:"4"},{default:t(()=>[e(ue,{label:"Selecione a Pessoa",modelValue:a(f).pessoa,"onUpdate:modelValue":n[2]||(n[2]=D=>a(f).pessoa=D),items:a(k),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),e(I,{cols:"3"},{default:t(()=>[e(ue,{label:"Papel",modelValue:a(f).papeis,"onUpdate:modelValue":n[3]||(n[3]=D=>a(f).papeis=D),items:a(M),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),m("div",null,[m("img",{class:"mt-3",src:de,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:Q})])]),_:1}),e(q,null,{default:t(()=>[e(I,null,{default:t(()=>[e($e,{style:{height:"465px"},headers:N,items:a(S)},{"item.actions":t(({item:D})=>[e(q,null,{default:t(()=>[m("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:he=>ge(D),title:"Visualizar Ficha"},n[8]||(n[8]=[m("img",{style:{width:"30px",height:"30px"},src:ce,alt:"Visualizar"},null,-1)]),8,aa),m("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:he=>se(D),class:"mr-2",title:"Alterar Papel"},n[9]||(n[9]=[m("img",{style:{width:"30px",height:"30px"},src:Ze,alt:"Visualizar"},null,-1)]),8,ta),m("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:he=>Oe(D),title:"Deletar Pessoa"},[D.excluido?(V(),W("img",sa)):(V(),W("img",ra))],8,oa),m("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:he=>H(D),title:"Selecionar Representante"},n[10]||(n[10]=[m("img",{style:{width:"30px",height:"30px"},src:Fe,alt:"Visualizar"},null,-1)]),8,na)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),e(O,{show:a(j),onClose:n[4]||(n[4]=D=>j.value=!1)},null,8,["show"]),e(ye,{representante_nome:a(i),representantes:a(s),ato_id:a(r),ato_pessoa_token:a(p),show:a(R),onClose:n[5]||(n[5]=D=>R.value=!1),onUpdateRepresentante:X},null,8,["representante_nome","representantes","ato_id","ato_pessoa_token","show"]),e(be,{representante_nome:a(i),ato_token:v.ato_token,ato_id:a(r),show:a(o),onClose:n[6]||(n[6]=D=>o.value=!1),onUpdatePapel:oe},null,8,["representante_nome","ato_token","ato_id","show"]),a(u)?(V(),Z(qe,{key:0,show:a(u),"link-view":a(E),"pessoa-obj":a(x),"is-view":!0,onClose:n[7]||(n[7]=D=>u.value=!1)},null,8,["show","link-view","pessoa-obj"])):ve("",!0),e(q,null,{default:t(()=>[e(Me,{onClick:Te},{default:t(()=>[e(G,{size:"large",color:"red"},{default:t(()=>n[11]||(n[11]=[B("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},la={key:0,class:"loading-overlay"},ia="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",La={__name:"Minuta",props:{ato_token:{type:String,required:!0}},emits:["page","doc"],setup(K,{emit:$}){const g=K;je("DocumentEditorContainer",[Ke,Je]);const v=te(),{$toast:_}=ie(),z=ee(),y=ae(),P=$;Se(`${v.public.docEditor}`);const F=`${v.public.managemant}/upload`,L=`${v.public.managemant}/subitituirModelo`,J=`${v.public.managemant}/download`,w=l(null),A=l(!1),b=async u=>{try{const o=await fetch(u);if(!o.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await o.blob()}catch(o){return console.error(o),null}},C=async()=>{const o=await w.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),s=new FileReader;s.onload=()=>{const i=s.result;P("doc",i)},s.readAsText(o)},k=async()=>{A.value=!0;try{const o=await w.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),s=new FormData;s.append("file",o,"anexo.docx"),s.append("cartorio_token",T("user-data").value.cartorio_token),s.append("token",g.ato_token),s.append("tipo","ato_minuta");const{data:i,status:r}=await h(F,{method:"POST",body:s},"$071xxdqs20");if(r.value==="success"){_.success("Documento enviado!");const p=w.value.ej2Instances.documentEditor.pageCount;C(),P("page",p)}else _.error("Erro ao enviar documento para o sistema.")}catch(u){_.error("Erro ao salvar documento."),console.error(u)}finally{A.value=!1}},x=async()=>{R(!0);try{await S(),R(!0);const{data:u,status:o}=await h(L,{method:"POST",body:{ato_token:g.ato_token}},"$0ktpWliD4l");u.value&&M(u.value)}catch(u){console.error("Erro ao gerar a minuta:",u),_.error("Ocorreu um erro ao gerar a minuta.")}finally{R(!1)}},S=async()=>{try{const{data:u}=await h(J,{method:"POST",body:{bucket:T("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$jXVvQjEE6u"),o=await b(u.value);if(o){const s=new FileReader;s.onload=()=>{const i=s.result;w.value.ej2Instances.documentEditor.open(i),P("doc",i)},s.readAsText(o)}}catch(u){console.error("Erro ao carregar o modelo de minuta:",u),_.error("Falha ao carregar o modelo de minuta.")}},M=u=>{const o=w.value.ej2Instances.documentEditor,s=i=>{for(const[r,c]of Object.entries(i))if(/^<<.+>>$/.test(r))try{o.search.findAll(r),o.search.searchResults.length>0&&o.search.searchResults.replaceAll(c)}catch(p){console.error(`Erro ao substituir o marcador ${r}:`,p)}else if(r==="partes"&&Array.isArray(c)&&c.length>0)for(const p of c)typeof p=="object"&&s(p)};s(u)},R=u=>{A.value=u},j=()=>{const u=y.query.origem||"criar",o=y.query.id;switch(u){case"atualizar":case"vizualizar":z.push(`/os/atualizar/${o}`);break;case"atualizar-lista":case"vizualizar-lista":z.push("/atos/lista");break;default:z.push("/os/criar-registro");break}};return(u,o)=>{const s=le;return V(),W(Pe,null,[e(a(Ae),{height:"900px",ref_key:"documentEditorContainer",ref:w,serviceUrl:ia,enableToolbar:!0,enableWordExport:!0},null,512),a(A)?(V(),W("div",la,[e(Ne,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):ve("",!0),e(q,{class:"ml-4 mt-4 mb-4"},{default:t(()=>[e(s,{class:"mr-4"},{default:t(()=>[e(G,{size:"large",onClick:j,color:"red"},{default:t(()=>o[0]||(o[0]=[B("Voltar")])),_:1})]),_:1}),e(G,{size:"large",color:"green",onClick:k,disabled:a(A)},{default:t(()=>o[1]||(o[1]=[B("Salvar")])),_:1},8,["disabled"]),e(G,{class:"ml-4",size:"large",color:"blue",onClick:x},{default:t(()=>o[2]||(o[2]=[B("Gerar Minuta")])),_:1})]),_:1})],64)}}},ua=["innerHTML"],Wa={__name:"Livro",props:{ato_token:{type:String,required:!0},pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(K){let $,g;const v=K,_=te();Se(`${_.public.docEditor}`);const{$toast:z}=ie(),y=ee(),P=ae(),F=`${_.public.managemant}/listarEscrevente`,L=`${_.public.managemant}/lavrarAto`,J=`${_.public.managemant}/valida_lavratura`,w=`${_.public.managemant}/ato_calcular`,A=l("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),b=l(!1),C=l(null),k=l(null),x=l(null),S=l(T("user-data").value.cartorio_token),M=T("auth_token").value,R=l([]),j=l({}),u=l(null),o=l(""),s=pe({escrevente:null}),i=async(Y=!1)=>{if(!Y){const{data:X,error:Q,status:ge}=await h(J,{method:"POST",body:{ato_token:v.ato_token}},"$ZKnVBNYxp9");let H,se;if(ge.value==="success"&&X.value?(H=X.value[0].status,se=X.value[0].status_mensagem):Q.value&&Q.value.data&&(H=Q.value.data[0].status,se=Q.value.data[0].status_mensagem),H!=="OK"){u.value=H,o.value=se,j.value=null,b.value=!0,A.value=" O ato apresenta inconsistências, deseja prosseguir?";return}}const{data:U,status:oe}=await h(L,{method:"POST",body:{ato_token:v.ato_token,qtd_paginas:v.pages,escrevente_token:s.escrevente,usuario_token:M,cartorio_token:S}},"$XouuxOFIWh");oe.value==="success"?(C.value=U.value,k.value=U.value[0].selo,z.success("Ato lavrado com sucesso!")):z.error("Falha ao lavrar o ato.")},r=()=>{b.value=!1,u.value=null,o.value="",j.value={}},c=async()=>{const{data:Y,status:U}=await h(w,{method:"POST",body:{ato_token:v.ato_token,cartorio_token:S,quantidade:1,usuario_token:M,escrevente_token:s.escrevente,qtd_paginas:v.pages}},"$R51FaaSzOI");U.value==="success"?j.value=Y.value[0]:z.error("Falha ao calcular o ato.")},p=async()=>{b.value=!1,u.value&&u.value!=="OK"?(await i(!0),u.value=null,o.value=""):await i()},E=async()=>{b.value=!0,A.value="Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?",await c()},{data:N}=([$,g]=me(()=>h(F,{method:"POST",body:{cartorio_token:S}},"$JCPnpnnRzP")),$=await $,g(),$);R.value=N.value[0].func_json_escreventes;const f=function(){x.value.ej2Instances.documentEditor.open(v.document)},fe=()=>{const Y=P.query.origem||"criar",U=P.query.id;switch(Y){case"atualizar":case"vizualizar":y.push(`/os/atualizar/${U}`);break;case"atualizar-lista":case"vizualizar-lista":y.push("/atos/lista");break;default:y.push("/os/criar-registro");break}};return(Y,U)=>{const oe=Qe;return V(),W(Pe,null,[e(q,null,{default:t(()=>[e(I,null,{default:t(()=>[(V(),Z(a(Ae),{restrictEditing:!0,enableToolbar:!1,created:v.document?f:null,ref_key:"documentEditorContainer",ref:x,height:"850px",width:"850px",key:v.document},null,8,["created"]))]),_:1}),e(I,null,{default:t(()=>[e(ue,{class:"mt-15",label:"Tabelião/escrevente",modelValue:a(s).escrevente,"onUpdate:modelValue":U[0]||(U[0]=X=>a(s).escrevente=X),items:a(R),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),m("div",null,[m("div",null,[m("img",{onClick:U[1]||(U[1]=X=>E()),class:"ml-2",style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:Ge}),a(C)?(V(),Z(He,{key:0,class:"mr-16"},{default:t(()=>[e(q,{"no-gutters":""},{default:t(()=>[e(I,null,{default:t(()=>[e(we,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:t(()=>[e(I,null,{default:t(()=>[B(" Livro: "+re(a(C)[0].livro_numero),1)]),_:1}),e(I,null,{default:t(()=>[B(" Protocolo: "+re(a(C)[0].protocolo?a(C)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),e(I,null,{default:t(()=>[e(we,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:t(()=>[B(" Folhas : "+re(a(C)[0].pagina_inicial)+" A "+re(a(C)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),m("div",{innerHTML:a(k)},null,8,ua)]),_:1})):ve("",!0)])])]),_:1})]),_:1}),e(G,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:fe},{default:t(()=>U[2]||(U[2]=[B("Voltar")])),_:1}),e(oe,{show:a(b),condMessage:a(A),valor:a(j),description:a(o),onClose:r,onConfirm:p},null,8,["show","condMessage","valor","description"])],64)}}},ca=["onClick"],da=["onClick"],pa={key:0,style:{width:"30px",height:"30px"},src:ke,alt:"Visualizar",title:"Reativar"},ma={key:1,src:xe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Ka={__name:"Observacao",props:{ato_id:{type:Number,required:!0}},async setup(K){let $,g;const v=K,_=ee(),z=ae(),y=te(),P=`${y.public.managemant}/listarEscrevente`,F=`${y.public.managemant}/atos_observacao`,L=`${y.public.managemant}/atos_observacao`,J=l(T("user-data").value.cartorio_token),w=l([]),A=l([]),b=l(!1),C=l(!1),k=l(""),x=[{title:"Data",align:"start",key:"data"},{title:"Escrevente",align:"start",key:"escrevente"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}];function S(i){k.value=i.observacao,C.value=!0,b.value=!0}const M=()=>{C.value=!1,b.value=!0,k.value=""};async function R(i){i.excluido=!i.excluido;try{await h(`${F}/${i.id}`,{method:"PUT",body:JSON.stringify({excluido:i.excluido})},"$aJM1TL1buW")}catch(r){console.error("Erro ao excluir observacao:",r)}}const j=async()=>{b.value=!1,await u()};async function u(){const{data:i}=await h(`${L}/${v.ato_id}`,{method:"GET"},"$dMg99jeUNP");Array.isArray(i.value)?w.value=i.value.map(r=>({...r,created:Ce(r.created,"dd/mm/yyyy hh:mm")})):i.value&&typeof i.value=="object"&&(w.value=[{...i.value,created:Ce(i.value.created,"dd/mm/yyyy hh:mm")}])}const{data:o}=([$,g]=me(()=>h(P,{method:"POST",body:{cartorio_token:J}},"$B6PdRx8Gp4")),$=await $,g(),$);A.value=o.value[0].func_json_escreventes;const s=()=>{const i=z.query.origem||"criar",r=z.query.id;i==="atualizar"?_.push(`/os/atualizar/${r}`):_.push("/os/criar-registro")};return(i,r)=>{const c=Ye,p=le;return V(),Z(_e,null,{default:t(()=>[e(q,{class:"mt-5"},{default:t(()=>[e(G,{class:"mb-4 ml-8",onClick:M,size:"large",color:"green"},{default:t(()=>r[1]||(r[1]=[B("Novo")])),_:1}),m("div",null,[m("img",{class:"btn-pointer ml-2",src:de,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:r[0]||(r[0]=(...E)=>i.onSubmit&&i.onSubmit(...E))})])]),_:1}),e(q,null,{default:t(()=>[e(I,null,{default:t(()=>[e($e,{style:{height:"465px"},headers:x,items:a(w)},{"item.observacao":t(({item:E})=>[B(re(E.observacao.length>100?E.observacao.slice(0,100)+"...":E.observacao),1)]),"item.actions":t(({item:E})=>[e(q,null,{default:t(()=>[m("div",{onClick:N=>S(E)},r[2]||(r[2]=[m("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ce,alt:"Visualizar"},null,-1)]),8,ca),m("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:N=>R(E),title:"Deletar Observação"},[E.excluido?(V(),W("img",pa)):(V(),W("img",ma))],8,da)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),a(b)?(V(),Z(c,{key:0,show:a(b),observacao:a(k),visualizar:a(C),onClose:j},null,8,["show","observacao","visualizar"])):ve("",!0),e(q,null,{default:t(()=>[e(p,{onClick:s},{default:t(()=>[e(G,{size:"large",color:"red"},{default:t(()=>r[3]||(r[3]=[B("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},va={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ue,alt:"Criar"},_a={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Be,alt:"Criar"},fa={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:ea,alt:"Criar"},ga=["onClick"],ya=["onClick"],ba=["onClick"],ha={key:0,style:{width:"30px",height:"30px"},src:ke,alt:"Visualizar",title:"Reativar"},ka={key:1,src:xe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Ja={__name:"Anexos",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},setup(K){const $=K,g=te(),{$toast:v}=ie(),_=ee(),z=ae(),y=`${g.public.biometria}/run-scanner`,P=`${g.public.managemant}/atos_anexos`,F=`${g.public.managemant}/atos_anexos`,L=`${g.public.managemant}/download`;`${g.public.managemant}`,`${g.public.managemant}`;const J=l(!1),w=l(null),A=l([]);T("pessoa_token");const b=pe({descricao:"",fileEvent:null}),C={descricao:{required:Ve.withMessage("O campo é obrigatório",ze)}},k=Ee(C,b,{$autoDirty:!0}),x=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}];async function S(){try{await M(),await R()}catch(c){console.error("Erro ao executar scanner ou listar arquivos:",c)}}async function M(){try{const{data:c}=await h(y,{method:"GET"},"$WazoKp68Tw")}catch(c){v.error("Erro ao acionar o scanner:",c)}}async function R(){try{const{data:c,status:p}=await h("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:z.query.ato_token_edit,cartorio_token:T("user-data").value.cartorio_token}},"$03Wxiia3aI")}catch(c){console.error("Erro ao enviar o arquivo:",c)}}const j=async()=>{J.value=!0};function u(c){return c?!0:(console.error("Erro: Nenhum arquivo foi selecionado!"),w.value=!1,!1)}const o=async()=>{if(k.value.$touch(),!k.value.$invalid&&u(b.fileEvent)){const{data:c,error:p,status:E}=await h(P,{method:"POST",body:{ato_id:$.ato_id,descricao:b.descricao,user_id:T("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$WyW0hasRPI");E.value==="success"&&(v.success("Anexo registrado com sucesso!"),A.value.push(c.value))}};async function s(c){c.excluido=!c.excluido;try{await h(`${F}/${c.id}`,{method:"PUT",body:JSON.stringify({excluido:c.excluido})},"$Y3y6TjqbSV")}catch(p){console.error("Erro ao excluir pessoa:",p)}}async function i(c){try{const p=await h(`${L}`,{method:"POST",body:{bucket:T("user-data").value.cartorio_token,path:c.link}},"$bkXJSi7s76"),N=await(await fetch(p.data.value)).blob(),f=URL.createObjectURL(N);window.open(f,"_blank")}catch(p){console.error("Erro ao excluir pessoa:",p)}}const r=()=>{const c=z.query.origem||"criar",p=z.query.id;switch(c){case"atualizar":case"vizualizar":_.push(`/os/atualizar/${p}`);break;case"atualizar-lista":case"vizualizar-lista":_.push("/atos/lista");break;default:_.push("/os/criar-registro");break}};return(c,p)=>{const E=le;return V(),Z(_e,null,{default:t(()=>[e(q,null,{default:t(()=>[e(I,{cols:"5",class:"mt-2"},{default:t(()=>[e(ne,{modelValue:a(b).descricao,"onUpdate:modelValue":[p[0]||(p[0]=N=>a(b).descricao=N),a(k).descricao.$touch],"error-messages":a(k).descricao.$errors.map(N=>N.$message),onBlur:a(k).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"])]),_:1}),m("div",{onClick:S,title:"Criar",style:{"padding-right":"10px"}},[a(w)===!1?(V(),W("img",va)):a(w)===!0?(V(),W("img",_a)):(V(),W("img",fa))]),m("div",{onClick:o,title:"Criar"},p[1]||(p[1]=[m("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:de,alt:"Escanear"},null,-1)]))]),_:1}),e($e,{headers:x,items:a(A),style:{height:"465px","max-width":"600px"}},{"item.actions":t(({item:N})=>[e(q,null,{default:t(()=>[m("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:f=>j(N),title:"Visualizar Anexo"},[m("img",{style:{width:"30px",height:"30px"},onClick:f=>i(N),src:ce,alt:"Visualizar"},null,8,ya)],8,ga),m("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:f=>s(N),title:"Deletar Pessoa"},[N.excluido?(V(),W("img",ha)):(V(),W("img",ka))],8,ba)]),_:2},1024)]),_:1},8,["items"]),e(E,{onClick:r},{default:t(()=>[e(G,{size:"large",color:"red"},{default:t(()=>p[2]||(p[2]=[B("Voltar")])),_:1})]),_:1})]),_:1})}}};export{Ba as _,Fa as a,La as b,Wa as c,Ka as d,Ja as e};
