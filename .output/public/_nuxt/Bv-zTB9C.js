import{_ as ee}from"./BwoOglyv.js";import{_ as te}from"./CikoERET.js";import{n as ae,r as d,D as s,F as oe,G as re,o as m,A as f,w as n,x as se,H as ne,b as i,a as l,t as ie,q as a,I as le,s as $,C as N,K as ue,L as de,c as D,J as ce}from"./CtDV-ous.js";import{u as w}from"./CD94D2s7.js";import"./DnauDJCz.js";import{c as I,r as P,u as me,_ as pe}from"./5dVDj7iE.js";import{_ as _e,a as ve,b as fe,c as ge}from"./CBYd86re.js";import{_ as he}from"./DmmIIbRx.js";import{_ as be}from"./ToPptOUL.js";import{V as ye}from"./CWiJ1Bav.js";import{V as h}from"./lKL4zjLk.js";import{V as b}from"./DnovXfEg.js";import{V as ke}from"./qPaL_Swk.js";import"./BK2ApIgh.js";const Ce=l("h1",null,"Ordem de Serviço nº",-1),Ve={style:{color:"red","margin-left":"30px"}},xe=l("h1",{class:"ml-5"},"Atos",-1),$e=l("img",{style:{width:"45px",height:"45px",cursor:"pointer"},src:ve,alt:"novo"},null,-1),we=l("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:he,alt:"Reimprimir"},null,-1),Se=[we],Oe=["onClick","title"],Ee=["disabled","onClick"],Re={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:fe,alt:"Visualizar",title:"Reativar"},Te={key:1,src:ge,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px",cursor:"pointer"},title:"Excluir"},je={__name:"criar-registro",async setup(Ae){var T,A,F,q;let g,S;const{$toast:_}=ae(),y=se(),U=`${y.public.managemant}/createOrdensServico`,L=`${y.public.managemant}/validarCpf`,M=`${y.public.managemant}/listarAtos`,z=d(s("user-data").value.cartorio_id),G=d(s("user-data").value.usuario_id),H=d((T=s("user-service").value)==null?void 0:T.token).value||null,J=d(s("user-data").value.cartorio_token).value;let O=d(!!((A=s("user-service").value)!=null&&A.numero)),k=d(s("ordem-button").value),C=!1;const V=d(!1),x=d([]),o=oe({nacionalidade:"brasileiro",apresentante_nome:(F=s("user-service").value)==null?void 0:F.apresentante_nome,apresentante_cpf:(q=s("user-service").value)==null?void 0:q.apresentante_cpf,documento:null}),j=[{title:"Protocolo",value:"protocolo"},{title:"Usuario",value:"usuario_nome"},{title:"Situação",value:"situacao"},{title:"Valor",value:"valor"},{title:"Tipo",value:"tipo"},{value:"actions"}],K=[{title:"BRASILEIRO",value:"brasileiro"},{title:"ESTRANGEIRO",value:"estrangeiro"}],Q={apresentante_nome:{required:I.withMessage("O campo é obrigatorio",P)},apresentante_cpf:{required:I.withMessage("O campo é obrigatorio",P)}},c=me(Q,o);function E(r){if(r)return r.replace(/[.\-]/g,"");r=null}function Y(){const r=s("user-service"),t=s("ordem-button");r.value=null,t.value=null}const W=()=>{V.value=!0};async function X(){const r={apresentante_cpf:E(o.apresentante_cpf),apresentante_nome:o.apresentante_nome,user_id:G.value,cartorio_id:z.value};if(await c.value.$validate()){const{data:t,error:p,status:u}=await w(U,{method:"POST",body:r},"$omLGvLxYlw");if(u.value==="error"&&p.value.statusCode===500)_.error("Erro ao cadastrar ordem,erro no sistema.");else{_.success("Ordem registrada com sucesso!"),O.value=!0,k.value=!1;const v=s("ordem-button");v.value=k.value;const e=s("user-service");e.value=e.value=JSON.stringify({numero:t.value.numero,apresentante_cpf:t.value.apresentante_cpf,apresentante_nome:t.value.apresentante_nome,token:t.value.token})}}}async function Z(r){const t=E(r);if(t.length===11&&!C){C=!0;const p={cpf:t};try{const{data:u,error:v,status:e}=await w(L,{method:"POST",body:p},"$e6ybTA3ect");e.value==="error"&&v.value.statusCode===500?_.error("Erro ao cadastrar pessoa, o CPF já está cadastrado."):u.value.cpfValidation===!0?(o.apresentante_nome=u.value.nome,_.success("Cpf autenticado com sucesso!")):u.value.cpfValidation===!1&&_.error("Cpf não cadastrado!")}catch(u){console.error("Erro ao validar CPF:",u)}finally{C=!1}}}const{data:R}=([g,S]=re(()=>w(M,{method:"POST",body:{cartorio_token:J,ordemserv_token:H}},"$Q1qkHbHde0")),g=await g,S(),g);return R.value.length>0?x.value=R.value:x.value=[],(r,t)=>{const p=ee,u=te,v=ne("mask");return m(),f(ye,{class:"mt-5"},{default:n(()=>[i(h,{class:"mb-5"},{default:n(()=>{var e;return[Ce,l("h1",Ve,ie((e=("useCookie"in r?r.useCookie:a(s))("user-service").value)==null?void 0:e.numero),1)]}),_:1}),i(h,null,{default:n(()=>[i(b,{md:"3"},{default:n(()=>[i(ke,{label:"Nacionalidade",items:K,modelValue:a(o).nacionalidade,"onUpdate:modelValue":t[0]||(t[0]=e=>a(o).nacionalidade=e)},null,8,["modelValue"])]),_:1}),i(b,{md:"2"},{default:n(()=>[a(o).nacionalidade==="brasileiro"?le((m(),f($,{key:0,autofocus:"",modelValue:a(o).apresentante_cpf,"onUpdate:modelValue":t[1]||(t[1]=e=>a(o).apresentante_cpf=e),label:"CPF",required:"","error-messages":a(c).apresentante_cpf.$errors.map(e=>e.$message),onBlur:a(c).apresentante_cpf.$touch,onInput:t[2]||(t[2]=e=>Z(a(o).apresentante_cpf))},null,8,["modelValue","error-messages","onBlur"])),[[v,"###.###.###-##"]]):(m(),f($,{key:1,autofocus:"",modelValue:a(o).apresentante_cpf,"onUpdate:modelValue":t[3]||(t[3]=e=>a(o).apresentante_cpf=e),label:"Documento",required:"","error-messages":a(c).apresentante_cpf.$errors.map(e=>e.$message),onBlur:a(c).apresentante_cpf.$touch},null,8,["modelValue","error-messages","onBlur"]))]),_:1}),i(b,{md:"4"},{default:n(()=>[i($,{modelValue:a(o).apresentante_nome,"onUpdate:modelValue":t[4]||(t[4]=e=>a(o).apresentante_nome=e),label:"Nome Apresentante",required:"","error-messages":a(c).apresentante_nome.$errors.map(e=>e.$message),onInput:a(c).apresentante_nome.$touch},null,8,["modelValue","error-messages","onInput"])]),_:1}),a(k)?(m(),f(b,{key:0},{default:n(()=>[l("div",null,[l("img",{style:{width:"40px",height:"40px",cursor:"pointer"},src:pe,alt:"Salvar",onClick:t[5]||(t[5]=e=>X())})])]),_:1})):N("",!0)]),_:1}),a(O)?(m(),f(h,{key:0,style:{display:"flex","margin-bottom":"10px",gap:"2rem"}},{default:n(()=>[xe,i(p,{to:{path:"/ordens-servicos/criar-ato",query:{origem:"criar"}}},{default:n(()=>[$e]),_:1}),i(ce,{headers:j,items:a(x),"item-key":"id"},{"item.actions":n(({item:e})=>[i(h,{style:{display:"flex",gap:"10px","margin-top":"-5px"}},{default:n(()=>[l("div",{onClick:t[6]||(t[6]=B=>W()),title:"Reimprimir"},Se),l("div",{class:de({disabled:!e.btn_editar}),onClick:B=>e.btn_editar?r.redirectToUpdate(e.id):null,title:e.btn_editar?"Editar":"Desabilitado"},[l("img",{style:ue({cursor:e.btn_editar?"pointer":"default",width:"30px",height:"30px"}),src:_e,alt:"Editar"},null,4)],10,Oe),l("div",{disabled:!e.btn_cancelar,onClick:B=>e.btn_cancelar?r.deleteEndereco(e):null,title:"Excluir"},[e.excluido?(m(),D("img",Re)):(m(),D("img",Te))],8,Ee)]),_:2},1024)]),_:1},8,["items"]),i(u,{show:a(V),onClose:t[7]||(t[7]=e=>V.value=!1)},null,8,["show"])]),_:1})):N("",!0),i(p,{to:"/ordens-servicos"},{default:n(()=>[l("img",{class:"btn-pointer mt-5",src:be,alt:"Sair",onClick:Y})]),_:1})]),_:1})}}};export{je as default};
