import{_,M as E,r as l,h as w,c as i,a as n,F as f,N as C,B as L,O as M,H as N,o as u,D as R,d as S,t as B,y as O}from"./DP3qcOMz.js";const D={class:"chat-container"},U=["onClick"],T={__name:"index",setup($){const v=E(),c=l(""),b=l([{from:"server",text:"Por favor, me informe seu nome"}]),m=l(),d=l(null),h=l();let a=null;const p=v.query.cartorio_token;function r(o,t){b.value.push({from:o,text:t}),O(()=>{d.value&&(d.value.scrollTop=d.value.scrollHeight)})}function g(){if(m.value||(m.value=c.value,k()),!c.value.trim())return;const o=x(c.value);r("user",o);const t={type:"chat_bot_message",message:o,cartorio_token:p};c.value="",a.send(JSON.stringify(t))}function k(){a=new WebSocket(`ws://157.230.216.74:3452?user_name=${m.value}`),a.addEventListener("open",()=>{console.log("✅ Conectado ao servidor")}),a.addEventListener("message",o=>{var t;try{const e=JSON.parse(o.data),s=(t=e==null?void 0:e.message)==null?void 0:t.state;switch(s){case"ExibirResposta":console.log("📥 ExibirResposta"),h.value=e.message,r("button",e.message);break;case"Fim":console.log("📴 Chat encerrado pelo servidor"),a.close(1e3,"Chat encerrado pelo servidor");break;case void 0:e.type==="connection_info"?console.log("🔗 Informações de conexão recebidas"):(console.log("📩 Mensagem desconhecida:",e),r("server",JSON.stringify(e)));break;default:console.log(`📨 Mensagem com estado "${s}"`),r("server",e.message);break}}catch(e){console.error("❌ Erro ao processar mensagem:",e),r("server",o.data)}}),a.addEventListener("close",()=>{console.log("❌ Conexão encerrada"),r("system","⚠️ Chat encerrado")}),a.addEventListener("error",o=>{console.error("⚠️ Erro na conexão:",o),r("system","⚠️ Erro na conexão")})}function y(o){fetch(o).then(t=>{if(!t.ok)throw new Error("Erro ao baixar o arquivo");return t.blob()}).then(t=>{const e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download="documento.pdf",s.click(),URL.revokeObjectURL(e)})}function x(o){const t=typeof o=="object"?o.message:o,e=/(https?:\/\/[^\s]+)/g;return t.replace(e,s=>`<a href="${s}" target="_blank" class="chat-link">${s}</a>`)}return w(()=>{a&&a.readyState===WebSocket.OPEN&&a.close()}),(o,t)=>(u(),i("div",D,[t[2]||(t[2]=n("div",{class:"chat-header"},[n("span",{class:"chat-title"},"Chat"),n("button",{class:"chat-close"},"×")],-1)),n("div",{ref_key:"chatHistory",ref:d,class:"chat-history"},[(u(!0),i(f,null,C(b.value,(e,s)=>(u(),i("div",{key:s,class:R(["chat-bubble",e.from==="user"?"user-bubble":e.from==="system"?"system-bubble":"server-bubble"])},[e.from==="button"?(u(),i("button",{key:0,class:"chat-button",onClick:H=>y(e.text.message)}," 📎 Baixar documento ",8,U)):(u(),i(f,{key:1},[S(B(e.text.message||e.text),1)],64))],2))),128))],512),n("form",{onSubmit:N(g,["prevent"]),class:"chat-input-area"},[L(n("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),type:"text",placeholder:"Digite sua mensagem...",class:"chat-input"},null,512),[[M,c.value]]),t[1]||(t[1]=n("button",{type:"submit",class:"chat-send-button"},"➤",-1))],32)]))}},F=_(T,[["__scopeId","data-v-c1d8a58b"]]);export{F as default};
