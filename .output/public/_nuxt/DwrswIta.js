import{_ as E,D as w,r as l,E as C,c as i,a as r,F as f,G as L,p as R,H as S,y as M,o as u,q as N,d as B,t as D,m as O,n as U}from"./B1Gnx4Lp.js";const $={class:"chat-container"},T=["onClick"],H={__name:"index",setup(j){const v=O(),p=w(),c=l(""),b=l([{from:"server",text:"Por favor, me informe seu nome"}]),m=l(),d=l(null),h=l();let a=null;const g=p.query.cartorio_token;function n(o,t){b.value.push({from:o,text:t}),U(()=>{d.value&&(d.value.scrollTop=d.value.scrollHeight)})}function k(){if(m.value||(m.value=c.value,y()),!c.value.trim())return;const o=_(c.value);n("user",o);const t={type:"chat_bot_message",message:o,cartorio_token:g};c.value="",a.send(JSON.stringify(t))}function y(){a=new WebSocket(`${v.public.chat_bot}?user_name=${m.value}`),a.addEventListener("open",()=>{console.log("✅ Conectado ao servidor")}),a.addEventListener("message",o=>{var t;try{const e=JSON.parse(o.data),s=(t=e==null?void 0:e.message)==null?void 0:t.state;switch(s){case"ExibirResposta":console.log("📥 ExibirResposta"),h.value=e.message,n("button",e.message);break;case"Fim":console.log("📴 Chat encerrado pelo servidor"),a.close(1e3,"Chat encerrado pelo servidor");break;case void 0:e.type==="connection_info"?console.log("🔗 Informações de conexão recebidas"):(console.log("📩 Mensagem desconhecida:",e),n("server",JSON.stringify(e)));break;default:console.log(`📨 Mensagem com estado "${s}"`),n("server",e.message);break}}catch(e){console.error("❌ Erro ao processar mensagem:",e),n("server",o.data)}}),a.addEventListener("close",()=>{console.log("❌ Conexão encerrada"),n("system","⚠️ Chat encerrado")}),a.addEventListener("error",o=>{console.error("⚠️ Erro na conexão:",o),n("system","⚠️ Erro na conexão")})}function x(o){fetch(o).then(t=>{if(!t.ok)throw new Error("Erro ao baixar o arquivo");return t.blob()}).then(t=>{const e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download="documento.pdf",s.click(),URL.revokeObjectURL(e)})}function _(o){const t=typeof o=="object"?o.message:o,e=/(https?:\/\/[^\s]+)/g;return t.replace(e,s=>`<a href="${s}" target="_blank" class="chat-link">${s}</a>`)}return C(()=>{a&&a.readyState===WebSocket.OPEN&&a.close()}),(o,t)=>(u(),i("div",$,[t[2]||(t[2]=r("div",{class:"chat-header"},[r("span",{class:"chat-title"},"Chat"),r("button",{class:"chat-close"},"×")],-1)),r("div",{ref_key:"chatHistory",ref:d,class:"chat-history"},[(u(!0),i(f,null,L(b.value,(e,s)=>(u(),i("div",{key:s,class:N(["chat-bubble",e.from==="user"?"user-bubble":e.from==="system"?"system-bubble":"server-bubble"])},[e.from==="button"?(u(),i("button",{key:0,class:"chat-button",onClick:q=>x(e.text.message)}," 📎 Baixar documento ",8,T)):(u(),i(f,{key:1},[B(D(e.text.message||e.text),1)],64))],2))),128))],512),r("form",{onSubmit:M(k,["prevent"]),class:"chat-input-area"},[R(r("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),type:"text",placeholder:"Digite sua mensagem...",class:"chat-input"},null,512),[[S,c.value]]),t[1]||(t[1]=r("button",{type:"submit",class:"chat-send-button"},"➤",-1))],32)]))}},J=E(H,[["__scopeId","data-v-368172da"]]);export{J as default};
