import{c as A,r as T,u as ue}from"./CfrG4VdT.js";import{C as X,u as Y,r as E,m as p,I as Z,D as ee,o as b,c as K,v as e,G as q,M as ie,t as de,K as F,w as u,b as a,V as c,A as P,d as U,F as se,s as ae,a as ne,x as Q}from"./DQhxv2KM.js";import{u as oe,V as M}from"./D6muoYhM.js";import{f as le}from"./02CDnTra.js";import{V as n}from"./CmzAYpe3.js";import{V as x}from"./0GB9KLVP.js";import{V as te}from"./Ddk49kjL.js";import{V as ce}from"./C8tR1VP2.js";import{a as H,V as me,c as J,b as pe}from"./D1w27NJb.js";import"./2l0y23Gb.js";import"./DrQLnPGh.js";import"./C-k8K03Q.js";import"./CEHMAnYj.js";import"./BiuKny3r.js";const _e={key:1},fe={__name:"DadosMatricula",emits:["saved","close-modal"],async setup(G,{emit:V}){let _,$;const B=V,h=X(),d=ae(),{$toast:v}=Y(),I=E(!1),g=p("Matricula-id"),S=`${d.public.auth}/service/gerencia/listar_situacao_matriculas`,L=`${d.public.auth}/service/gerencia/natureza_imoveis`,O=`${d.public.auth}/service/gerencia/tipo_logradouros`,D=`${d.public.auth}/service/gerencia/listarCidades`,N=`${d.public.auth}/service/gerencia/livro`,{data:z,status:re,pending:R,error:W}=([_,$]=Z(async()=>oe("cliente-dados",async()=>{const l=p("auth_token");try{const[r,t,f,w,C]=await Promise.all([$fetch(`${S}`,{method:"POST",body:{cartorio_token:p("user-data").value.cartorio_token},headers:{Authorization:`Bearer ${l.value}`}}),$fetch(`${L}`,{headers:{Authorization:`Bearer ${l.value}`}}),$fetch(`${O}`,{headers:{Authorization:`Bearer ${l.value}`}}),$fetch(`${D}`,{headers:{Authorization:`Bearer ${l.value}`}}),$fetch(`${N}`,{headers:{Authorization:`Bearer ${l.value}`}})]);return{situacaoItens:r,naturezaImoveisItens:t,tipoLogradouroItens:f,cidadesItens:w,livroItens:C}}catch(r){return console.error("Erro ao carregar dados:",r),{situacaoItens:[],naturezaImoveisItens:[],tipoLogradouroItens:[],cidadesItens:[],livroItens:[]}}})),_=await _,$(),_),o=ee({numero:null,protocolo:null,livro:null,folhas:null,data:null,descricao:null,cnm:null,livro_id:null,observacao:null,inscricao_municipal:null,situacao_id:null,tabvalores_natureza_id:null,tabvalores_tipologradouro_id:null,end_logradouro:null,end_logradouro_numero:null,end_bairro:null,end_cidade_id:null,end_cep:null,end_complemento:null,end_quadra:null,end_lote:null,folha_inicial:null,folha_final:null,cartorio_id:p("user-data").value.cartorio_id,user_id:p("user-data").value.usuario_id}),y={numero:{required:A.withMessage("O campo é obrigatório",T)},data:{required:A.withMessage("O campo é obrigatório",T)},situacao_id:{required:A.withMessage("O campo é obrigatório",T)},tabvalores_natureza_id:{required:A.withMessage("O campo é obrigatório",T)},livro_id:{required:A.withMessage("O campo é obrigatório",T)}},m=ue(y,o);function k(l){if(l)return l.replace(/[.\-]/g,"");l=null}async function j(){if(await m.value.$validate()){const l={...o};for(const t in l)l[t]===""&&(l[t]=null);const r={...l,doc_identificacao:k(o.doc_identificacao),cpf_pai:k(o.cpf_pai),cpf_mae:k(o.cpf_mae)};try{const t=p("auth_token"),f=await $fetch(`${d.public.auth}/service/gerencia/matriculas`,{method:"POST",body:r,headers:{Authorization:`Bearer ${t.value}`}});if(f.statusCode===500)v.error("Erro ao cadastrar Matricula, o CPF já está cadastrado.");else{v.success("Matricula cadastrada com sucesso!");const w=f.id;g.value=w;const C=p("Matricula_token");C.value=f.token,I.value=!0,B("saved")}}catch(t){console.log("Erro ao cadastrar:",t),v.error("Erro ao cadastrar. Tente novamente.")}}}async function s(){const l={...o};for(const C in l)l[C]===""&&(l[C]=null);const r={...l,doc_identificacao:k(o.doc_identificacao),cpf_mae:k(o.cpf_mae)},{data:t,error:f,status:w}=await le(`${updateMatricula}/${g.value}`,{method:"PUT",body:r});if(w.value==="success"){v.success("Matricula atualizada com sucesso!"),h.push("/Matriculas/lista");return}}function i(){h.push("/matriculas/lista")}return(l,r)=>(b(),K(se,null,[e(R)?(b(),q(ie,{key:0,class:"loading-spinner",indeterminate:"",size:"64"})):e(W)?(b(),K("div",_e,de(e(W).message),1)):F("",!0),e(R)?F("",!0):(b(),q(te,{key:2},{default:u(()=>[a(M,null,{default:u(()=>[a(n,{md:"6"},{default:u(()=>[a(c,{modelValue:e(o).numero,"onUpdate:modelValue":r[0]||(r[0]=t=>e(o).numero=t),"error-messages":e(m).numero.$errors.map(t=>t.$message),label:"Matrícula",required:"",onBlur:e(m).numero.$touch,onInput:e(m).numero.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1}),a(n,{md:"4"},{default:u(()=>[a(c,{modelValue:e(o).protocolo,"onUpdate:modelValue":r[1]||(r[1]=t=>e(o).protocolo=t),label:"Protocolo",required:""},null,8,["modelValue"])]),_:1}),a(n,{md:"4"},{default:u(()=>[a(x,{modelValue:e(o).livro_id,"onUpdate:modelValue":r[2]||(r[2]=t=>e(o).livro_id=t),"error-messages":e(m).situacao_id.$errors.map(t=>t.$message),items:e(z).livroItens.data,label:"Livro",required:"","item-title":"descricao","item-value":"id"},null,8,["modelValue","error-messages","items"])]),_:1}),a(n,{md:"4"},{default:u(()=>[a(c,{modelValue:e(o).folha_inicial,"onUpdate:modelValue":r[3]||(r[3]=t=>e(o).folha_inicial=t),modelModifiers:{number:!0},label:"Folha inicial",type:"number",required:"",min:"0"},null,8,["modelValue"])]),_:1}),a(n,{md:"4"},{default:u(()=>[a(c,{modelValue:e(o).folha_final,"onUpdate:modelValue":r[4]||(r[4]=t=>e(o).folha_final=t),modelModifiers:{number:!0},label:"Folha Final",type:"number",required:"",min:"0"},null,8,["modelValue"])]),_:1}),a(n,{md:"4"},{default:u(()=>[a(c,{modelValue:e(o).data,"onUpdate:modelValue":r[5]||(r[5]=t=>e(o).data=t),"error-messages":e(m).situacao_id.$errors.map(t=>t.$message),onBlur:e(m).numero.$touch,onInput:e(m).numero.$touch,type:"date",label:"Data"},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1}),a(n,{md:"4"},{default:u(()=>[a(x,{modelValue:e(o).situacao_id,"onUpdate:modelValue":r[6]||(r[6]=t=>e(o).situacao_id=t),"error-messages":e(m).situacao_id.$errors.map(t=>t.$message),items:e(z).situacaoItens,label:"Situação",required:"",onBlur:e(m).situacao_id.$touch,onInput:e(m).situacao_id.$touch,"item-title":"descricao","item-value":"id"},null,8,["modelValue","error-messages","items","onBlur","onInput"])]),_:1}),a(n,{md:"4"},{default:u(()=>[a(c,{modelValue:e(o).descricao,"onUpdate:modelValue":r[7]||(r[7]=t=>e(o).descricao=t),"error-messages":e(m).situacao_id.$errors.map(t=>t.$message),label:"Descrição",required:""},null,8,["modelValue","error-messages"])]),_:1}),a(n,{md:"4"},{default:u(()=>[a(c,{modelValue:e(o).cnm,"onUpdate:modelValue":r[8]||(r[8]=t=>e(o).cnm=t),label:"CNM",required:""},null,8,["modelValue"])]),_:1}),a(n,{md:"4"},{default:u(()=>[a(c,{modelValue:e(o).observacao,"onUpdate:modelValue":r[9]||(r[9]=t=>e(o).observacao=t),label:"Observação",required:""},null,8,["modelValue"])]),_:1})]),_:1}),a(M,{class:"mb-3"},{default:u(()=>[a(P,{onClick:i,size:"large",color:"red"},{default:u(()=>r[11]||(r[11]=[U("Voltar")])),_:1}),a(P,{onClick:r[10]||(r[10]=t=>e(I)?s():j()),class:"ml-4",size:"large",color:"green"},{default:u(()=>r[12]||(r[12]=[U("Salvar")])),_:1})]),_:1})]),_:1}))],64))}},ve={__name:"EnderecoMatricula",emits:["saved","close-modal"],async setup(G,{emit:V}){let _,$;const B=V,h=X(),d=ae(),{$toast:v}=Y(),I=E(!1),g=p("Matricula-id"),S=`${d.public.auth}/service/gerencia/listar_situacao_matriculas`,L=`${d.public.auth}/service/gerencia/natureza_imoveis`,O=`${d.public.auth}/service/gerencia/tipo_logradouros`,D=`${d.public.auth}/service/gerencia/listarCidades`,N=`${d.public.auth}/service/gerencia/livro`,{data:z,status:re,pending:R,error:W}=([_,$]=Z(async()=>oe("cliente-dados",async()=>{const s=p("auth_token");try{const[i,l,r,t,f]=await Promise.all([$fetch(`${S}`,{method:"POST",body:{cartorio_token:p("user-data").value.cartorio_token},headers:{Authorization:`Bearer ${s.value}`}}),$fetch(`${L}`,{headers:{Authorization:`Bearer ${s.value}`}}),$fetch(`${O}`,{headers:{Authorization:`Bearer ${s.value}`}}),$fetch(`${D}`,{headers:{Authorization:`Bearer ${s.value}`}}),$fetch(`${N}`,{headers:{Authorization:`Bearer ${s.value}`}})]);return{situacaoItens:i,naturezaImoveisItens:l,tipoLogradouroItens:r,cidadesItens:t,livroItens:f}}catch(i){return console.error("Erro ao carregar dados:",i),{situacaoItens:[],naturezaImoveisItens:[],tipoLogradouroItens:[],cidadesItens:[],livroItens:[]}}})),_=await _,$(),_),o=ee({inscricao_municipal:null,situacao_id:null,tabvalores_natureza_id:null,tabvalores_tipologradouro_id:null,end_logradouro:null,end_logradouro_numero:null,end_bairro:null,end_cidade_id:null,end_cep:null,end_complemento:null,end_quadra:null,end_lote:null,folha_inicial:null,folha_final:null,cartorio_id:p("user-data").value.cartorio_id,user_id:p("user-data").value.usuario_id});function y(s){if(s)return s.replace(/[.\-]/g,"");s=null}async function m(){const s={...o};for(const l in s)s[l]===""&&(s[l]=null);const i={...s,doc_identificacao:y(o.doc_identificacao),cpf_pai:y(o.cpf_pai),cpf_mae:y(o.cpf_mae)};try{const l=p("auth_token"),r=await $fetch(`${d.public.auth}/service/gerencia/matriculas`,{method:"POST",body:i,headers:{Authorization:`Bearer ${l.value}`}});if(r.statusCode===500)v.error("Erro ao cadastrar Matricula, o CPF já está cadastrado.");else{v.success("Matricula cadastrada com sucesso!");const t=r.id;g.value=t;const f=p("Matricula_token");f.value=r.token,I.value=!0,B("saved")}}catch(l){console.log("Erro ao cadastrar:",l),v.error("Erro ao cadastrar. Tente novamente.")}}async function k(){const s={...o};for(const f in s)s[f]===""&&(s[f]=null);const i={...s,doc_identificacao:y(o.doc_identificacao),cpf_mae:y(o.cpf_mae)},{data:l,error:r,status:t}=await le(`${updateMatricula}/${g.value}`,{method:"PUT",body:i});if(t.value==="success"){v.success("Matricula atualizada com sucesso!"),h.push("/Matriculas/lista");return}}function j(){h.push("/matriculas/lista")}return(s,i)=>(b(),q(te,null,{default:u(()=>[a(M,null,{default:u(()=>[a(n,{md:"4"},{default:u(()=>[a(c,{modelValue:e(o).inscricao_municipal,"onUpdate:modelValue":i[0]||(i[0]=l=>e(o).inscricao_municipal=l),label:"Inscrição Municipal",required:""},null,8,["modelValue"])]),_:1}),a(n,{md:"4"},{default:u(()=>[a(x,{modelValue:e(o).tabvalores_natureza_id,"onUpdate:modelValue":i[1]||(i[1]=l=>e(o).tabvalores_natureza_id=l),items:e(z).naturezaImoveisItens,label:"Natureza Imovel","item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1}),a(n,{md:"4"},{default:u(()=>[a(x,{modelValue:e(o).tabvalores_tipologradouro_id,"onUpdate:modelValue":i[2]||(i[2]=l=>e(o).tabvalores_tipologradouro_id=l),items:e(z).tipoLogradouroItens,label:"Tipo de Logradouro","item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1})]),_:1}),a(M,null,{default:u(()=>[a(n,{md:"4"},{default:u(()=>[a(c,{modelValue:e(o).end_logradouro,"onUpdate:modelValue":i[3]||(i[3]=l=>e(o).end_logradouro=l),label:"Endereço",required:""},null,8,["modelValue"])]),_:1}),a(n,{md:"4"},{default:u(()=>[a(c,{modelValue:e(o).end_logradouro_numero,"onUpdate:modelValue":i[4]||(i[4]=l=>e(o).end_logradouro_numero=l),label:"Numero",required:""},null,8,["modelValue"])]),_:1}),a(n,{md:"4"},{default:u(()=>[a(c,{modelValue:e(o).end_bairro,"onUpdate:modelValue":i[5]||(i[5]=l=>e(o).end_bairro=l),label:"Bairro",required:""},null,8,["modelValue"])]),_:1})]),_:1}),a(M,null,{default:u(()=>[a(n,{md:"4"},{default:u(()=>[a(x,{modelValue:e(o).end_cidade_id,"onUpdate:modelValue":i[6]||(i[6]=l=>e(o).end_cidade_id=l),items:e(z).cidadesItens,label:"Cidade","item-title":"descricao","item-value":"id"},null,8,["modelValue","items"])]),_:1}),a(n,{md:"4"},{default:u(()=>[a(c,{modelValue:e(o).end_cep,"onUpdate:modelValue":i[7]||(i[7]=l=>e(o).end_cep=l),label:"CEP",required:""},null,8,["modelValue"])]),_:1}),a(n,{md:"4"},{default:u(()=>[a(c,{modelValue:e(o).end_complemento,"onUpdate:modelValue":i[8]||(i[8]=l=>e(o).end_complemento=l),label:"Complemento",required:""},null,8,["modelValue"])]),_:1})]),_:1}),a(M,null,{default:u(()=>[a(n,{md:"4"},{default:u(()=>[a(c,{modelValue:e(o).end_quadra,"onUpdate:modelValue":i[9]||(i[9]=l=>e(o).end_quadra=l),label:"Quadra",required:""},null,8,["modelValue"])]),_:1}),a(n,{md:"4"},{default:u(()=>[a(c,{modelValue:e(o).end_lote,"onUpdate:modelValue":i[10]||(i[10]=l=>e(o).end_lote=l),label:"Lote",required:""},null,8,["modelValue"])]),_:1})]),_:1}),a(M,{class:"mb-3"},{default:u(()=>[a(P,{onClick:j,size:"large",color:"red"},{default:u(()=>i[12]||(i[12]=[U("Voltar")])),_:1}),a(P,{onClick:i[11]||(i[11]=l=>e(I)?k():m()),class:"ml-4",size:"large",color:"green"},{default:u(()=>i[13]||(i[13]=[U("Salvar")])),_:1})]),_:1})]),_:1}))}},we={__name:"index",setup(G){const V=E("dados"),_=E(!1),$=E(!1),B=()=>{_.value=!0,$.value=!0};return(h,d)=>{const v=fe,I=ve;return b(),q(ce,{width:"1300"},{default:u(()=>[d[4]||(d[4]=ne("h1",{style:{"background-color":"#f5f2f2",color:"#525050",padding:"5px 0px 0px 20px"}}," Cadastramento de Matriculas ",-1)),a(me,{modelValue:e(V),"onUpdate:modelValue":d[0]||(d[0]=g=>Q(V)?V.value=g:null),"bg-color":"#f5f2f2"},{default:u(()=>[a(H,{value:"dados"},{default:u(()=>d[2]||(d[2]=[U("Dados")])),_:1}),e(_)?(b(),q(H,{key:0,value:"endereco"},{default:u(()=>d[3]||(d[3]=[U("Endereços")])),_:1})):F("",!0)]),_:1},8,["modelValue"]),a(pe,{modelValue:e(V),"onUpdate:modelValue":d[1]||(d[1]=g=>Q(V)?V.value=g:null)},{default:u(()=>[a(J,{value:"dados"},{default:u(()=>[a(v,{onSaved:B})]),_:1}),e(_)?(b(),q(J,{key:0,value:"endereco"},{default:u(()=>[a(I)]),_:1})):F("",!0)]),_:1},8,["modelValue"])]),_:1})}}};export{we as default};
