import{_ as se}from"./Df6DVINn.js";import{c as $e,r as we,u as Ce}from"./CddAVvPI.js";import{g as Re,L as Q,P as H,u as re,r as l,m as O,n as ce,G as de,o as V,p as X,w as a,b as e,q as t,C as oe,V as K,d as B,v as ee,I as De,a as m,c as W,A as pe,R as je,S as Ne,F as Ve,T as ke,t as ae}from"./CNgMOleP.js";import{u as k}from"./DECIjsaj.js";import{V as q}from"./7l_mb_88.js";import{V as N}from"./BsV7LNdI.js";import{V as le}from"./DYegQF_t.js";import{V as me}from"./BArmsOLP.js";import{_ as Ie}from"./DJPGFKoI.js";import{_ as Ue,a as Be,b as Fe,T as Le,W as We,D as ze,c as Ge,d as Je,e as Ke,f as Ye}from"./_HIY8ljI.js";import{_ as Xe,r as Ee}from"./UlntslQW.js";import{_ as ie}from"./B0391hns.js";import{_ as ue}from"./BVz1G1IN.js";import{_ as Ze}from"./BZXePxHU.js";import{_ as ye,a as he}from"./DJvq3mCv.js";import{V as be}from"./hR8wdNB7.js";import{_ as Qe}from"./B0yJfbgt.js";import{V as He}from"./BP9yIB0r.js";import{f as xe}from"./B0IxRygJ.js";import{_ as et}from"./DByY-dFt.js";const Bt={__name:"Dados",props:{ato_token:{type:String,required:!0},ato_tipo_id:{type:Number}},emits:["saved"],async setup(G,{emit:w}){let y,v;const _=G;Re(()=>_.ato_tipo_id,o=>{x.value={id:o}});const z=w,h=Q(),E=H(),F=ee(),{$toast:L}=re(),J=`${F.public.managemant}/listarSituacoes`,$=`${F.public.managemant}/createAtos`;`${F.public.managemant}`;const C=l(O("user-data").value.cartorio_token),f=l(O("user-service").value.id).value||l(O("user-service").value).value,I=l([]),x=l(_.ato_tipo_id?{id:_.ato_tipo_id}:null),b=ce({dt_abertura:null,status:"EM EDIÇÃO",mne:null}),T={status:{required:$e.withMessage("O campo é obrigatorio",we)}},M=Ce(T,b);async function A(){if(await M.value.$validate()){const{data:o,error:s,status:i}=await k($,{method:"POST",body:{ato_tipo_id:x.value.id,cartorio_id:O("user-data").value.cartorio_id,ordemserv_id:f,status:b.status,dt_abertura:b.dt_abertura,mne:b.mne,user_id:O("user-data").value.usuario_id,user_alteracao_id:O("user-data").value.usuario_id}},"$9ZmTYsLk0K");i.value==="success"&&(L.success("Ato registrado com sucesso!"),z("saved",{id:o.value.id,token:o.value.token}))}else L.error("Preencha os campos obrigatorios.")}const{data:R}=([y,v]=de(()=>k(J,{method:"POST",body:{cartorio_token:C.value}},"$hyq5YcBEjF")),y=await y,v(),y);I.value=R.value;const u=()=>{const o=E.query.origem||"criar",s=E.query.id;switch(o){case"atualizar":case"vizualizar":h.push(`/os/atualizar/${s}`);break;case"atualizar-lista":case"vizualizar-lista":h.push("/atos/lista");break;default:h.push("/os/criar-registro");break}};return(o,s)=>{const i=se;return V(),X(me,null,{default:a(()=>[e(q,{class:"mt-5"},{default:a(()=>[e(N,{cols:"3"},{default:a(()=>[e(le,{label:"Situação",modelValue:t(b).status,"onUpdate:modelValue":s[0]||(s[0]=r=>t(b).status=r),items:t(I),"item-title":"descricao","item-value":"descricao",required:"","error-messages":t(M).status.$errors.map(r=>r.$message),onBlur:t(M).status.$touch,onInput:t(M).status.$touch},null,8,["modelValue","items","error-messages","onBlur","onInput"])]),_:1})]),_:1}),e(q,null,{default:a(()=>[e(N,{cols:"5"},{default:a(()=>[e(oe,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:t(b).mne,"onUpdate:modelValue":s[1]||(s[1]=r=>t(b).mne=r)},null,8,["modelValue"])]),_:1})]),_:1}),e(q,null,{default:a(()=>[e(N,{cols:"2"},{default:a(()=>[e(oe,{modelValue:t(b).dt_abertura,"onUpdate:modelValue":s[2]||(s[2]=r=>t(b).dt_abertura=r),type:"date",label:"Data Lavratura",disabled:"",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(q,{class:"mb-3"},{default:a(()=>[e(i,{onClick:u},{default:a(()=>[e(K,{size:"large",color:"red"},{default:a(()=>s[3]||(s[3]=[B("Voltar")])),_:1})]),_:1}),e(K,{class:"ml-10",onClick:A,size:"large",color:"green"},{default:a(()=>s[4]||(s[4]=[B("Salvar")])),_:1})]),_:1})]),_:1})}}},tt=["onClick"],at=["onClick"],ot=["onClick"],st={key:0,style:{width:"30px",height:"30px"},src:ye,alt:"Visualizar",title:"Reativar"},rt={key:1,src:he,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},nt=["onClick"],Ft={__name:"Partes",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},async setup(G){let w,y;const v=G,_=Q(),z=H(),h=ee(),{$toast:E}=re(),F=`${h.public.managemant}/pesquisarPessoas`,L=`${h.public.managemant}/listarPapeis`,J=`${h.public.managemant}/download`,$=`${h.public.managemant}/createAtosPessoa`,C=`${h.public.managemant}/getAtosPessoaById`,f=`${h.public.managemant}/updateAtosPessoa`,I=l(O("user-data").value.cartorio_token),x=l([]),b=l({}),T=l([]),M=l([]),A=l(!1),R=l(!1),u=l(!1),o=l(!1),s=l(null),i=l(null),r=l(null),c=l(null);l(null);const p=l(null),P=l(null),j=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"400px"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome"},{value:"actions"}],g=ce({papeis:null,nome:null,pessoa:null,documento:null});De(()=>{var d;return((d=g.pessoa)==null?void 0:d.link_ficha)||!1});const{data:Y}=([w,y]=de(()=>k(L,{method:"POST",body:{tipo_ato_token:v.ato_token}},"$fFKndZhA4W")),w=await w,y(),w);M.value=Y.value;async function U(){try{const{data:d,error:n}=await k(F,{method:"POST",body:{cartorio_token:I.value,documento:g.documento,nome:g.nome}},"$o3ZL1rvYrY");d.value.length>0?(x.value=d.value,g.pessoa=x.value[0]):x.value=[]}catch(d){console.error("Erro na requisição",d)}}const te=()=>{R.value=!0},Z=d=>{T.value=T.value.map(n=>n.id===r.value?{...n,papel:{...n.papel,descricao:d}}:n)},ne=d=>{const n=T.value.find(S=>S.pessoa.id===c.value);n.representante.nome=d},ve=async()=>{const d={pessoa:g.pessoa,papel:M.value.find(S=>S.id===g.papeis),representante:""},n=await k(`${C}/${v.ato_id}`,{method:"GET"},"$kXSxUa4grs");for(const S of n.data.value)if(S.pessoa_id===g.pessoa.id&&S.ato_id===v.ato_id&&S.tipo_parte_id===g.papeis){E.error("Pessoa Já Registrada Com Esse Papel!");return}try{const{data:S,error:_e,status:fe}=await k($,{method:"POST",body:{ato_id:Number(v.ato_id),pessoa_id:g.pessoa.id,tipo_parte_id:g.papeis,user_id:Number(O("user-data").value.usuario_id)}},"$So3qnQu7ek");fe.value==="success"?(d.id=S.value.id,E.success("Pessoa Registrada com Sucesso!"),T.value.push(d)):E.error(_e.value.message)}catch{E.error("Erro no servidor. Tente novamente.")}},Pe=async d=>{u.value=!0;const{data:n}=await k(J,{method:"POST",body:{bucket:O("user-data").value.cartorio_token,path:d.pessoa.link_ficha}},"$Q3kbIwtd9t");P.value=n.value,b.value=d.pessoa},Ae=d=>{const n=T.value.filter(S=>S.pessoa.id!==d.pessoa.id).map(S=>({id:S.pessoa.id,nome:S.pessoa.nome,token:S.pessoa.token}));r.value=d.id,p.value=d.token,s.value=n,A.value=!0,i.value=d.pessoa.nome,c.value=d.pessoa.id},Se=d=>{r.value=d.id,o.value=!0,i.value=d.pessoa.nome};async function Oe(d){d.excluido=!d.excluido;try{await k(`${f}/${r.value}`,{method:"PUT",body:JSON.stringify({excluido:d.excluido})},"$9xStKwGd7o")}catch(n){console.error("Erro ao excluir pessoa:",n)}}const qe=()=>{const d=z.query.origem||"criar",n=z.query.id;switch(d){case"atualizar":case"vizualizar":_.push(`/os/atualizar/${n}`);break;case"atualizar-lista":case"vizualizar-lista":_.push("/atos/lista");break;default:_.push("/os/criar-registro");break}};return(d,n)=>{const S=Ie,_e=Be,fe=Fe,Te=Xe,Me=se;return V(),X(me,null,{default:a(()=>[e(q,{class:"mt-5"},{default:a(()=>[e(N,{cols:"3"},{default:a(()=>[e(oe,{label:"Documento",modelValue:t(g).documento,"onUpdate:modelValue":n[0]||(n[0]=D=>t(g).documento=D)},null,8,["modelValue"])]),_:1}),e(N,{cols:"4"},{default:a(()=>[e(oe,{label:"Pessoa",modelValue:t(g).nome,"onUpdate:modelValue":n[1]||(n[1]=D=>t(g).nome=D)},null,8,["modelValue"])]),_:1}),m("div",null,[m("img",{class:"mt-3",src:ie,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:U})]),m("div",null,[m("img",{class:"mt-3 ml-2",src:ue,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:te})])]),_:1}),e(q,null,{default:a(()=>[e(N,{cols:"4"},{default:a(()=>[e(le,{label:"Selecione a Pessoa",modelValue:t(g).pessoa,"onUpdate:modelValue":n[2]||(n[2]=D=>t(g).pessoa=D),items:t(x),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),e(N,{cols:"3"},{default:a(()=>[e(le,{label:"Papel",modelValue:t(g).papeis,"onUpdate:modelValue":n[3]||(n[3]=D=>t(g).papeis=D),items:t(M),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),m("div",null,[m("img",{class:"mt-3",src:ue,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:ve})])]),_:1}),e(q,null,{default:a(()=>[e(N,null,{default:a(()=>[e(be,{style:{height:"465px"},headers:j,items:t(T)},{"item.actions":a(({item:D})=>[e(q,null,{default:a(()=>[m("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ge=>Pe(D),title:"Visualizar Ficha"},n[8]||(n[8]=[m("img",{style:{width:"30px",height:"30px"},src:ie,alt:"Visualizar"},null,-1)]),8,tt),m("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ge=>Se(D),class:"mr-2",title:"Alterar Papel"},n[9]||(n[9]=[m("img",{style:{width:"30px",height:"30px"},src:Ze,alt:"Visualizar"},null,-1)]),8,at),m("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ge=>Oe(D),title:"Deletar Pessoa"},[D.excluido?(V(),W("img",st)):(V(),W("img",rt))],8,ot),m("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ge=>Ae(D),title:"Selecionar Representante"},n[10]||(n[10]=[m("img",{style:{width:"30px",height:"30px"},src:Ue,alt:"Visualizar"},null,-1)]),8,nt)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),e(S,{show:t(R),onClose:n[4]||(n[4]=D=>R.value=!1)},null,8,["show"]),e(_e,{representante_nome:t(i),representantes:t(s),ato_id:t(r),ato_pessoa_token:t(p),show:t(A),onClose:n[5]||(n[5]=D=>A.value=!1),onUpdateRepresentante:ne},null,8,["representante_nome","representantes","ato_id","ato_pessoa_token","show"]),e(fe,{representante_nome:t(i),ato_token:v.ato_token,ato_id:t(r),show:t(o),onClose:n[6]||(n[6]=D=>o.value=!1),onUpdatePapel:Z},null,8,["representante_nome","ato_token","ato_id","show"]),t(u)?(V(),X(Te,{key:0,show:t(u),"link-view":t(P),"pessoa-obj":t(b),"is-view":!0,onClose:n[7]||(n[7]=D=>u.value=!1)},null,8,["show","link-view","pessoa-obj"])):pe("",!0),e(q,null,{default:a(()=>[e(Me,{onClick:qe},{default:a(()=>[e(K,{size:"large",color:"red"},{default:a(()=>n[11]||(n[11]=[B("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},lt={key:0,class:"loading-overlay"},it="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",Lt={__name:"Minuta",props:{ato_token:{type:String,required:!0}},emits:["page","doc"],setup(G,{emit:w}){const y=G;je("DocumentEditorContainer",[Le,We]);const v=ee(),{$toast:_}=re(),z=Q(),h=H(),E=w;Ee(`${v.public.docEditor}`);const F=`${v.public.managemant}/upload`,L=`${v.public.managemant}/subitituirModelo`,J=`${v.public.managemant}/download`,$=l(null),C=l(!1),f=async u=>{try{const o=await fetch(u);if(!o.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await o.blob()}catch(o){return console.error(o),null}},I=async()=>{const o=await $.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),s=new FileReader;s.onload=()=>{const i=s.result;E("doc",i)},s.readAsText(o)},x=async()=>{C.value=!0;try{const o=await $.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),s=new FormData;s.append("file",o,"anexo.docx"),s.append("cartorio_token",O("user-data").value.cartorio_token),s.append("token",y.ato_token),s.append("tipo","ato_minuta");const{data:i,status:r}=await k(F,{method:"POST",body:s},"$071xxdqs20");if(r.value==="success"){_.success("Documento enviado!");const p=$.value.ej2Instances.documentEditor.pageCount;I(),E("page",p)}else _.error("Erro ao enviar documento para o sistema.")}catch(u){_.error("Erro ao salvar documento."),console.error(u)}finally{C.value=!1}},b=async()=>{A(!0);try{await T(),A(!0);const{data:u,status:o}=await k(L,{method:"POST",body:{ato_token:y.ato_token}},"$0ktpWliD4l");u.value&&M(u.value)}catch(u){console.error("Erro ao gerar a minuta:",u),_.error("Ocorreu um erro ao gerar a minuta.")}finally{A(!1)}},T=async()=>{try{const{data:u}=await k(J,{method:"POST",body:{bucket:O("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$jXVvQjEE6u"),o=await f(u.value);if(o){const s=new FileReader;s.onload=()=>{const i=s.result;$.value.ej2Instances.documentEditor.open(i),E("doc",i)},s.readAsText(o)}}catch(u){console.error("Erro ao carregar o modelo de minuta:",u),_.error("Falha ao carregar o modelo de minuta.")}},M=u=>{const o=$.value.ej2Instances.documentEditor,s=i=>{for(const[r,c]of Object.entries(i))if(/^<<.+>>$/.test(r))try{o.search.findAll(r),o.search.searchResults.length>0&&o.search.searchResults.replaceAll(c)}catch(p){console.error(`Erro ao substituir o marcador ${r}:`,p)}else if(r==="partes"&&Array.isArray(c)&&c.length>0)for(const p of c)typeof p=="object"&&s(p)};s(u)},A=u=>{C.value=u},R=()=>{const u=h.query.origem||"criar",o=h.query.id;switch(u){case"atualizar":case"vizualizar":z.push(`/os/atualizar/${o}`);break;case"atualizar-lista":case"vizualizar-lista":z.push("/atos/lista");break;default:z.push("/os/criar-registro");break}};return(u,o)=>{const s=se;return V(),W(Ve,null,[e(t(ze),{height:"900px",ref_key:"documentEditorContainer",ref:$,serviceUrl:it,enableToolbar:!0,enableWordExport:!0},null,512),t(C)?(V(),W("div",lt,[e(Ne,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):pe("",!0),e(q,{class:"ml-4 mt-4 mb-4"},{default:a(()=>[e(s,{class:"mr-4"},{default:a(()=>[e(K,{size:"large",onClick:R,color:"red"},{default:a(()=>o[0]||(o[0]=[B("Voltar")])),_:1})]),_:1}),e(K,{size:"large",color:"green",onClick:x,disabled:t(C)},{default:a(()=>o[1]||(o[1]=[B("Salvar")])),_:1},8,["disabled"]),e(K,{class:"ml-4",size:"large",color:"blue",onClick:b},{default:a(()=>o[2]||(o[2]=[B("Gerar Minuta")])),_:1})]),_:1})],64)}}},ut=["innerHTML"],Wt={__name:"Livro",props:{ato_token:{type:String,required:!0},pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(G){let w,y;const v=G,_=ee();Ee(`${_.public.docEditor}`);const{$toast:z}=re(),h=Q(),E=H(),F=`${_.public.managemant}/listarEscrevente`,L=`${_.public.managemant}/lavrarAto`,J=`${_.public.managemant}/valida_lavratura`,$=l("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),C=l(!1),f=l(null),I=l(null),x=l(null),b=l(O("user-data").value.cartorio_token),T=O("auth_token").value,M=l([]),A=l({}),R=l(null),u=l(""),o=ce({escrevente:null}),s=async(Y=!1)=>{if(!Y){const{data:Z}=await k(J,{method:"POST",body:{ato_token:v.ato_token}},"$ZKnVBNYxp9"),ne=Z.value[0].status,ve=Z.value[0].status_mensagem;if(ne!=="OK"){R.value=ne,u.value=ve,A.value=null,C.value=!0,$.value="O ato apresenta inconsistências, deseja prosseguir?";return}}const{data:U,status:te}=await k(L,{method:"POST",body:{ato_token:v.ato_token,qtd_paginas:v.pages,escrevente_token:o.escrevente,usuario_token:T,cartorio_token:b}},"$XouuxOFIWh");te.value==="success"?(f.value=U.value,I.value=U.value[0].selo,z.success("Ato lavrado com sucesso!")):z.error("Falha ao lavrar o ato.")},i=()=>{C.value=!1,R.value=null,u.value="",A.value={}},r=async()=>{const{data:Y,status:U}=await k(calculaAto,{method:"POST",body:{ato_token:E.query.ato_token_edit,cartorio_token:b,quantidade:1,usuario_token:T,escrevente_token:o.escrevente,qtd_paginas:v.pages}},"$R51FaaSzOI");U.value==="success"?A.value=Y.value[0]:z.error("Falha ao calcular o ato.")},c=async()=>{C.value=!1,R.value&&R.value!=="OK"?(await s(!0),R.value=null,u.value=""):await s()},p=async()=>{C.value=!0,await r()},{data:P}=([w,y]=de(()=>k(F,{method:"POST",body:{cartorio_token:b}},"$JCPnpnnRzP")),w=await w,y(),w);M.value=P.value[0].func_json_escreventes;const j=function(){x.value.ej2Instances.documentEditor.open(v.document)},g=()=>{const Y=E.query.origem||"criar",U=E.query.id;switch(Y){case"atualizar":case"vizualizar":h.push(`/os/atualizar/${U}`);break;case"atualizar-lista":case"vizualizar-lista":h.push("/atos/lista");break;default:h.push("/os/criar-registro");break}};return(Y,U)=>{const te=Qe;return V(),W(Ve,null,[e(q,null,{default:a(()=>[e(N,null,{default:a(()=>[(V(),X(t(ze),{restrictEditing:!0,enableToolbar:!1,created:v.document?j:null,ref_key:"documentEditorContainer",ref:x,height:"850px",width:"850px",key:v.document},null,8,["created"]))]),_:1}),e(N,null,{default:a(()=>[e(le,{class:"mt-15",label:"Tabelião/escrevente",modelValue:t(o).escrevente,"onUpdate:modelValue":U[0]||(U[0]=Z=>t(o).escrevente=Z),items:t(M),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),m("div",null,[m("div",null,[m("img",{onClick:U[1]||(U[1]=Z=>p()),class:"ml-2",style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:Ge}),t(f)?(V(),X(He,{key:0,class:"mr-16"},{default:a(()=>[e(q,{"no-gutters":""},{default:a(()=>[e(N,null,{default:a(()=>[e(ke,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:a(()=>[e(N,null,{default:a(()=>[B(" Livro: "+ae(t(f)[0].livro_numero),1)]),_:1}),e(N,null,{default:a(()=>[B(" Protocolo: "+ae(t(f)[0].protocolo?t(f)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),e(N,null,{default:a(()=>[e(ke,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:a(()=>[B(" Folhas : "+ae(t(f)[0].pagina_inicial)+" A "+ae(t(f)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),m("div",{innerHTML:t(I)},null,8,ut)]),_:1})):pe("",!0)])])]),_:1})]),_:1}),e(K,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:g},{default:a(()=>U[2]||(U[2]=[B("Voltar")])),_:1}),e(te,{show:t(C),condMessage:t($),valor:t(A),description:t(u),onClose:i,onConfirm:c},null,8,["show","condMessage","valor","description"])],64)}}},ct=["onClick"],dt=["onClick"],pt={key:0,style:{width:"30px",height:"30px"},src:ye,alt:"Visualizar",title:"Reativar"},mt={key:1,src:he,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Gt={__name:"Observacao",props:{ato_id:{type:Number,required:!0}},async setup(G){let w,y;const v=G,_=Q(),z=H(),h=ee(),E=`${h.public.managemant}/listarEscrevente`,F=`${h.public.managemant}/atos_observacao`,L=`${h.public.managemant}/atos_observacao`,J=l(O("user-data").value.cartorio_token),$=l([]),C=l([]),f=l(!1),I=l(!1),x=l(""),b=[{title:"Data",align:"start",key:"data"},{title:"Escrevente",align:"start",key:"escrevente"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}];function T(i){x.value=i.observacao,I.value=!0,f.value=!0}const M=()=>{I.value=!1,f.value=!0,x.value=""};async function A(i){i.excluido=!i.excluido;try{await k(`${F}/${i.id}`,{method:"PUT",body:JSON.stringify({excluido:i.excluido})},"$aJM1TL1buW")}catch(r){console.error("Erro ao excluir observacao:",r)}}const R=async()=>{f.value=!1,await u()};async function u(){const{data:i}=await k(`${L}/${v.ato_id}`,{method:"GET"},"$dMg99jeUNP");Array.isArray(i.value)?$.value=i.value.map(r=>({...r,created:xe(r.created,"dd/mm/yyyy hh:mm")})):i.value&&typeof i.value=="object"&&($.value=[{...i.value,created:xe(i.value.created,"dd/mm/yyyy hh:mm")}])}const{data:o}=([w,y]=de(()=>k(E,{method:"POST",body:{cartorio_token:J}},"$B6PdRx8Gp4")),w=await w,y(),w);C.value=o.value[0].func_json_escreventes;const s=()=>{const i=z.query.origem||"criar",r=z.query.id;i==="atualizar"?_.push(`/os/atualizar/${r}`):_.push("/os/criar-registro")};return(i,r)=>{const c=Je,p=se;return V(),X(me,null,{default:a(()=>[e(q,{class:"mt-5"},{default:a(()=>[e(K,{class:"mb-4 ml-8",onClick:M,size:"large",color:"green"},{default:a(()=>r[1]||(r[1]=[B("Novo")])),_:1}),m("div",null,[m("img",{class:"btn-pointer ml-2",src:ue,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:r[0]||(r[0]=(...P)=>i.onSubmit&&i.onSubmit(...P))})])]),_:1}),e(q,null,{default:a(()=>[e(N,null,{default:a(()=>[e(be,{style:{height:"465px"},headers:b,items:t($)},{"item.observacao":a(({item:P})=>[B(ae(P.observacao.length>100?P.observacao.slice(0,100)+"...":P.observacao),1)]),"item.actions":a(({item:P})=>[e(q,null,{default:a(()=>[m("div",{onClick:j=>T(P)},r[2]||(r[2]=[m("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ie,alt:"Visualizar"},null,-1)]),8,ct),m("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:j=>A(P),title:"Deletar Observação"},[P.excluido?(V(),W("img",pt)):(V(),W("img",mt))],8,dt)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),t(f)?(V(),X(c,{key:0,show:t(f),observacao:t(x),visualizar:t(I),onClose:R},null,8,["show","observacao","visualizar"])):pe("",!0),e(q,null,{default:a(()=>[e(p,{onClick:s},{default:a(()=>[e(K,{size:"large",color:"red"},{default:a(()=>r[3]||(r[3]=[B("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},vt={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ke,alt:"Criar"},_t={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ye,alt:"Criar"},ft={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:et,alt:"Criar"},gt=["onClick"],yt=["onClick"],ht=["onClick"],bt={key:0,style:{width:"30px",height:"30px"},src:ye,alt:"Visualizar",title:"Reativar"},kt={key:1,src:he,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Jt={__name:"Anexos",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},setup(G){const w=G,y=ee(),{$toast:v}=re(),_=Q(),z=H(),h=`${y.public.biometria}/run-scanner`,E=`${y.public.managemant}/atos_anexos`,F=`${y.public.managemant}/atos_anexos`,L=`${y.public.managemant}/download`;`${y.public.managemant}`,`${y.public.managemant}`;const J=l(!1),$=l(null),C=l([]);O("pessoa_token");const f=ce({descricao:"",fileEvent:null}),I={descricao:{required:$e.withMessage("O campo é obrigatório",we)}},x=Ce(I,f,{$autoDirty:!0}),b=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}];async function T(){try{await M(),await A()}catch(c){console.error("Erro ao executar scanner ou listar arquivos:",c)}}async function M(){try{const{data:c}=await k(h,{method:"GET"},"$WazoKp68Tw")}catch(c){v.error("Erro ao acionar o scanner:",c)}}async function A(){try{const{data:c,status:p}=await k("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:z.query.ato_token_edit,cartorio_token:O("user-data").value.cartorio_token}},"$03Wxiia3aI")}catch(c){console.error("Erro ao enviar o arquivo:",c)}}const R=async()=>{J.value=!0};function u(c){return c?!0:(console.error("Erro: Nenhum arquivo foi selecionado!"),$.value=!1,!1)}const o=async()=>{if(x.value.$touch(),!x.value.$invalid&&u(f.fileEvent)){const{data:c,error:p,status:P}=await k(E,{method:"POST",body:{ato_id:w.ato_id,descricao:f.descricao,user_id:O("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$WyW0hasRPI");P.value==="success"&&(v.success("Anexo registrado com sucesso!"),C.value.push(c.value))}};async function s(c){c.excluido=!c.excluido;try{await k(`${F}/${c.id}`,{method:"PUT",body:JSON.stringify({excluido:c.excluido})},"$Y3y6TjqbSV")}catch(p){console.error("Erro ao excluir pessoa:",p)}}async function i(c){try{const p=await k(`${L}`,{method:"POST",body:{bucket:O("user-data").value.cartorio_token,path:c.link}},"$bkXJSi7s76"),j=await(await fetch(p.data.value)).blob(),g=URL.createObjectURL(j);window.open(g,"_blank")}catch(p){console.error("Erro ao excluir pessoa:",p)}}const r=()=>{const c=z.query.origem||"criar",p=z.query.id;switch(c){case"atualizar":case"vizualizar":_.push(`/os/atualizar/${p}`);break;case"atualizar-lista":case"vizualizar-lista":_.push("/atos/lista");break;default:_.push("/os/criar-registro");break}};return(c,p)=>{const P=se;return V(),X(me,null,{default:a(()=>[e(q,null,{default:a(()=>[e(N,{cols:"5",class:"mt-2"},{default:a(()=>[e(oe,{modelValue:t(f).descricao,"onUpdate:modelValue":[p[0]||(p[0]=j=>t(f).descricao=j),t(x).descricao.$touch],"error-messages":t(x).descricao.$errors.map(j=>j.$message),onBlur:t(x).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"])]),_:1}),m("div",{onClick:T,title:"Criar",style:{"padding-right":"10px"}},[t($)===!1?(V(),W("img",vt)):t($)===!0?(V(),W("img",_t)):(V(),W("img",ft))]),m("div",{onClick:o,title:"Criar"},p[1]||(p[1]=[m("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:ue,alt:"Escanear"},null,-1)]))]),_:1}),e(be,{headers:b,items:t(C),style:{height:"465px","max-width":"600px"}},{"item.actions":a(({item:j})=>[e(q,null,{default:a(()=>[m("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:g=>R(j),title:"Visualizar Anexo"},[m("img",{style:{width:"30px",height:"30px"},onClick:g=>i(j),src:ie,alt:"Visualizar"},null,8,yt)],8,gt),m("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:g=>s(j),title:"Deletar Pessoa"},[j.excluido?(V(),W("img",bt)):(V(),W("img",kt))],8,ht)]),_:2},1024)]),_:1},8,["items"]),e(P,{onClick:r},{default:a(()=>[e(K,{size:"large",color:"red"},{default:a(()=>p[2]||(p[2]=[B("Voltar")])),_:1})]),_:1})]),_:1})}}};export{Bt as _,Ft as a,Lt as b,Wt as c,Gt as d,Jt as e};
