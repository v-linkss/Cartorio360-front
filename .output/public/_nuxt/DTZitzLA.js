import{_ as ge}from"./Ds09Wel9.js";import{_ as he}from"./9JufoEdw.js";import{c as we,r as xe,u as $e}from"./IrCsQgMH.js";import{r as d,m as C,n as ee,g as X,o as I,p as j,w as r,b as t,a as m,t as ne,d as z,q as o,V as G,s as se,v as te,u as ie,C as y,A as Ce,L as Se,x as Oe,y as Ue,z as Re,B as L,E as J,D as H,c as re}from"./D7ENO5AD.js";import{u as O}from"./5esaczZp.js";import{V as Z,a as De,c as Ae}from"./BRSUoOBh.js";import{V as K}from"./B2A0rb-z.js";import{V as A}from"./CfMx6KlI.js";import{V as Te}from"./D-8tGulk.js";import{V as ue}from"./Ds1d2W4B.js";import{V as c}from"./CEvvklSZ.js";import{_ as Be}from"./BVz1G1IN.js";import{_ as Ie}from"./BvsrtV93.js";import{_ as qe}from"./B6_C6AM5.js";import{_ as ze}from"./D8KEJPgO.js";import{_ as Ne}from"./B16moC2y.js";import{_ as Ee,a as Me}from"./DJvq3mCv.js";import{f as F}from"./B0IxRygJ.js";import{V as Q}from"./Bv_dzn0g.js";import{V as Pe}from"./D8EBDzaJ.js";import"./Cx2_1k0M.js";import"./D3WrJDqK.js";import"./jAxziKPi.js";import"./B7WBkq8M.js";import"./Cmy3_6E3.js";import"./I7ClkghD.js";import"./C9NLORQb.js";import"./B5dUHZgd.js";import"./BJNQpbcT.js";const Le={style:{color:"red","margin-left":"18px"}},Je={class:"mb-5",style:{display:"flex","justify-content":"flex-start"}},Fe={class:"ml-6"},je={class:"ml-6"},Ge={__name:"Ordem",props:{show:Boolean,numero_os:Number,ordemserv_token:String},emits:["close"],setup(U,{emit:w}){const _=U,u=d(_.show),R=te();d(C("user-data").value.cartorio_token).value;const x=C("auth_token").value,T=`${R.public.managemant}/analisaCancelamento`,N=`${R.public.managemant}/cancelaOs`,k=ee({motivo:null}),V=d(null),g=w,v={motivo:{required:we.withMessage("O campo é obrigatorio",xe)}},s=$e(v,k);X(()=>_.show,b=>{u.value=b});const p=()=>{u.value=!1,g("close")};(async()=>{const{data:b,error:f}=await O(`${T}`,{method:"POST",body:{ordemserv_token:_.ordemserv_token}},"$1fnrIk2fgs");V.value=b.value.mensagem})();const D=async()=>{if(await s.value.$validate()){const{status:b}=await O(`${N}`,{method:"POST",body:{usuario_token:x,motivo:k.motivo,ordemserv_token:_.ordemserv_token}},"$21WlhUNXeM");b.value==="success"&&(window.location.reload(),p())}};return(b,f)=>(I(),j(ue,{persistent:"",modelValue:o(u),"onUpdate:modelValue":f[1]||(f[1]=h=>se(u)?u.value=h:null),"max-width":"650"},{default:r(()=>[t(Z,null,{default:r(()=>[t(K,null,{default:r(()=>[t(A,{class:"mb-5 mt-1 ml-2"},{default:r(()=>[f[2]||(f[2]=m("h1",null,"Cancelamento da OS nº",-1)),m("h1",Le,ne(_.numero_os),1)]),_:1}),t(K,null,{default:r(()=>[t(Z,{variant:"outlined",class:"mb-5"},{default:r(()=>[t(De,null,{default:r(()=>[z(ne(o(V)),1)]),_:1})]),_:1}),t(Te,{label:"Motivo",modelValue:o(k).motivo,"onUpdate:modelValue":f[0]||(f[0]=h=>o(k).motivo=h),required:"","error-messages":o(s).motivo.$errors.map(h=>h.$message),onBlur:o(s).motivo.$touch,onInput:o(s).motivo.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1})]),_:1}),m("div",Je,[m("div",Fe,[t(G,{size:"large",color:"red",onClick:p},{default:r(()=>f[3]||(f[3]=[z("Fechar")])),_:1})]),m("div",je,[t(G,{size:"large",color:"green",onClick:D},{default:r(()=>f[4]||(f[4]=[z("Salvar")])),_:1})])])]),_:1})]),_:1},8,["modelValue"]))}},Ke={__name:"ImprecaoRecibo",props:{show:Boolean,apresentante_nome:String,apresentante_cpf:String,visualizar:Boolean,token:String},emits:["close"],setup(U,{emit:w}){const _=U,u=ee({apresentante_nome:_.apresentante_nome,apresentante_cpf:_.apresentante_cpf,token:_.token,usuario_token:C("auth_token").value}),R=w,x=d(_.show),{$toast:T}=ie(),k=`${te().public.auth}/service/gerencia/emitir_recibo`;X(()=>_.show,v=>{x.value=v},{immediate:!0}),X(()=>_,v=>{u.apresentante_nome=v.apresentante_nome,u.apresentante_cpf=v.apresentante_cpf,u.token=v.token},{deep:!0,immediate:!0});const V=()=>{x.value=!1,R("close")};async function g(){var v,s;try{const{data:p,error:S}=await O(k,{method:"POST",body:{nome_recibo:u.apresentante_nome,doc_recibo:u.apresentante_cpf,usuario_token:u.usuario_token,os_token:u.token},headers:{Authorization:`Bearer ${u.usuario_token}`}},"$26dgQHax0q");if(p.value){const D=new Blob([p.value],{type:"text/html"}),b=URL.createObjectURL(D);window.open(b,"_blank")}else T.error(((s=(v=S==null?void 0:S.value)==null?void 0:v.data)==null?void 0:s.details)||"Erro ao emitir recibo");V()}catch{T.error("Erro inesperado")}}return(v,s)=>(I(),j(ue,{persistent:"",modelValue:o(x),"onUpdate:modelValue":s[2]||(s[2]=p=>se(x)?x.value=p:null),"max-width":"600"},{default:r(()=>[t(Z,null,{default:r(()=>[t(K,null,{default:r(()=>[t(A,{class:"mt-1 mb-3",style:{"justify-content":"space-between"}},{default:r(()=>s[3]||(s[3]=[m("h1",{class:"ml-4"},"Emitir Recibo",-1)])),_:1}),t(A,null,{default:r(()=>[t(c,{cols:"12",md:"6"},{default:r(()=>[t(y,{label:"Destinatário",modelValue:o(u).apresentante_nome,"onUpdate:modelValue":s[0]||(s[0]=p=>o(u).apresentante_nome=p),readonly:U.visualizar},null,8,["modelValue","readonly"])]),_:1}),t(c,{cols:"12",md:"6"},{default:r(()=>[t(y,{label:"Documento",modelValue:o(u).apresentante_cpf,"onUpdate:modelValue":s[1]||(s[1]=p=>o(u).apresentante_cpf=p),readonly:U.visualizar},null,8,["modelValue","readonly"])]),_:1})]),_:1})]),_:1}),t(Ae,null,{default:r(()=>[t(G,{style:{"background-color":"red",color:"white"},onClick:V},{default:r(()=>s[4]||(s[4]=[z(" Voltar ")])),_:1}),U.visualizar?Ce("",!0):(I(),j(G,{key:0,style:{"background-color":"green",color:"white"},onClick:g},{default:r(()=>s[5]||(s[5]=[z(" Imprimir ")])),_:1}))]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},We=["title","onClick"],Ye=["onClick","title"],He=["onClick","title"],Qe=["disabled","onClick"],Xe={key:0,style:{width:"30px",height:"30px"},src:Ee,alt:"Visualizar",title:"Reativar"},Ze={key:1,src:Me,alt:"Cancelamento",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Ut={__name:"index",setup(U){const w=te(),{$toast:_}=ie(),u=`${w.public.managemant}/listarUsuarios`,R=`${w.public.managemant}/listarOrdensServico`,x=`${w.public.managemant}/tipoAtos`,T=`${w.public.auth}/service/gerencia/lista_sit_os`;`${w.public.auth}`;const N=Se(),k=d(C("auth_token").value)||null,V=d(C("user-data").value.cartorio_token)||null,g=d([]),v=d([]),s=d([]),p=d([]),S=d(!1),D=d(!1),b=d(!1),f=d(null),h=d(null),E=d(null),ae=d({}),M=d({}),de=C("auth_token"),l=ee({numero:null,data_inicio:W(),data_fim:W(),data_lavratura_inicio:null,data_lavratura_fim:null,protocolo:null,livro:null,folha:null,situacao:null,usuario_token:k.value,selo:null,ato_tipo_token:null,apresentante:null}),me=[{title:"Data Abertura",value:"dt_abertura",width:"100px"},{title:"Data Recebimento",value:"data",width:"100px"},{title:"Número",value:"numero",width:"10px"},{title:"Situação",value:"situacao",width:"115px"},{title:"CPF",value:"apresentante_cpf",width:"100px"},{title:"Apresentante",value:"apresentante_nome",width:"228px"},{title:"Usuario",value:"usuario_nome",width:"30px"},{title:"Valor",value:"valor",width:"50px"},{title:"A Receber",value:"valor_a_receber",width:"50px"},{value:"actions"}];function W(){const n=new Date,e=n.getFullYear(),i=String(n.getMonth()+1).padStart(2,"0");return`${String(n.getDate()).padStart(2,"0")}-${i}-${e}`}function B(n){if(!n)return null;const[e,i,$]=n.split("/");return`${$}-${i}-${e}`}async function ce(){const{data:n}=await O(u,{method:"POST",body:{cartorio_token:V.value}},"$pAAptWJdb1");v.value=n.value}async function pe(){try{sessionStorage.setItem("pesquisaOS",JSON.stringify(l));const{data:n,error:e}=await O(R,{method:"POST",body:{cartorio_token:V.value,numero:l.numero||null,data_inicio:B(l.data_inicio)||null,data_fim:B(l.data_fim)||null,data_lavratura_inicio:B(l.data_lavratura_inicio)||null,data_lavratura_fim:B(l.data_lavratura_fim)||null,protocolo:l.protocolo||null,livro:l.livro||null,folha:l.folha||null,situacao:l.situacao||null,usuario_token:l.usuario_token,selo:l.selo||null,ato_tipo_token:l.ato_tipo_token,apresentante:l.apresentante||null}},"$IO02J210Z9");n.value.length>0?g.value=n.value.map(i=>({...i,data:i.data?F(i.data,"dd/mm/yyyy"):null,dt_abertura:i.dt_abertura?F(i.dt_abertura,"dd/mm/yyyy"):null})):(g.value=[],_.error("Não existe Ordem de Serviço Registrada!"))}catch(n){console.error("Erro na requisição",n)}}async function _e(){const{data:n,error:e}=await O(x,{method:"POST",body:{cartorio_token:V.value,usuario_token:k.value}},"$YgUhKRJlsV");s.value=n.value}async function ve(){const{data:n,error:e}=await O(T,{method:"GET",headers:{Authorization:`Bearer ${de.value}`}},"$xKnfARCL4G");p.value=n.value}const oe=async()=>{try{const n=W(),e=sessionStorage.getItem("pesquisaOS"),i=JSON.parse(e),{data:$,error:le}=await O(R,{method:"POST",body:{cartorio_token:V.value,usuario_token:i.usuario_token||k.value,data_fim:B(i==null?void 0:i.data_fim)||n,data_inicio:B(i==null?void 0:i.data_inicio)||n}},"$u0iMyzSv4b");$.value.length>0?g.value=$.value.map(q=>({...q,data:F(q.data,"dd/mm/yyyy"),dt_abertura:F(q.dt_abertura,"dd/mm/yyyy")})):g.value=[]}catch(n){console.error("Erro ao buscar serviços",n)}};function fe(n){E.value=n.numero,h.value=n.token,D.value=!0}function be(n){h.value=n.token,M.value.apresentante_nome=n.apresentante_nome,M.value.apresentante_cpf=n.apresentante_cpf,b.value=!0}function ye(n){const e=C("user-service"),i=g.value.find($=>$.id===n);e.value=e.value=JSON.stringify({id:i.id,token:i.token}),N.push({path:`/os/atualizar/${n}`})}function ke(n,e){E.value=n,ae.value={token:e.token,numero:e.numero,valor:e.valor,valor_pago:e.valor_pago},S.value=!0}const Ve=()=>{const n=C("user-service"),e=C("ordem-button");n.value=null,f.value=!0,e.value=f.value};return Oe(()=>{Ue(async()=>{const n=sessionStorage.getItem("pesquisaOS");if(n){const e=JSON.parse(n);Object.assign(l,e)}await oe()})}),ce(),_e(),ve(),(n,e)=>{const i=ge,$=he,le=Ge,q=Ke,P=Re("mask");return I(),j(K,{class:"mt-5",style:{width:"100%"}},{default:r(()=>[t(A,{class:"mb-5"},{default:r(()=>[e[17]||(e[17]=m("h1",null,"Ordens de Serviço",-1)),t(i,{to:"/os/criar-registro"},{default:r(()=>[m("img",{style:{width:"60px",height:"60px",cursor:"pointer","margin-left":"70px"},src:Be,alt:"novo",onClick:Ve})]),_:1})]),_:1}),t(A,{style:{"margin-bottom":"-35px"}},{default:r(()=>[t(c,null,{default:r(()=>[t(y,{modelValue:o(l).numero,"onUpdate:modelValue":e[0]||(e[0]=a=>o(l).numero=a),label:"Número"},null,8,["modelValue"])]),_:1}),t(c,null,{default:r(()=>[L(t(y,{modelValue:o(l).data_inicio,"onUpdate:modelValue":e[1]||(e[1]=a=>o(l).data_inicio=a),label:"Abertura de",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[P,"##/##/####"]])]),_:1}),t(c,null,{default:r(()=>[L(t(y,{modelValue:o(l).data_fim,"onUpdate:modelValue":e[2]||(e[2]=a=>o(l).data_fim=a),label:"Abertura até",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[P,"##/##/####"]])]),_:1}),t(c,null,{default:r(()=>[L(t(y,{modelValue:o(l).data_lavratura_inicio,"onUpdate:modelValue":e[3]||(e[3]=a=>o(l).data_lavratura_inicio=a),label:"Lavratura de",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[P,"##/##/####"]])]),_:1}),t(c,null,{default:r(()=>[L(t(y,{modelValue:o(l).data_lavratura_fim,"onUpdate:modelValue":e[4]||(e[4]=a=>o(l).data_lavratura_fim=a),label:"Lavratura até",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[P,"##/##/####"]])]),_:1}),t(c,null,{default:r(()=>[t(y,{modelValue:o(l).protocolo,"onUpdate:modelValue":e[5]||(e[5]=a=>o(l).protocolo=a),label:"Protocolo"},null,8,["modelValue"])]),_:1}),t(c,{md:"1"},{default:r(()=>[t(y,{modelValue:o(l).livro,"onUpdate:modelValue":e[6]||(e[6]=a=>o(l).livro=a),label:"Livro"},null,8,["modelValue"])]),_:1}),t(c,{md:"1"},{default:r(()=>[t(y,{modelValue:o(l).folha,"onUpdate:modelValue":e[7]||(e[7]=a=>o(l).folha=a),label:"Folha"},null,8,["modelValue"])]),_:1})]),_:1}),t(A,null,{default:r(()=>[t(c,{md:"3"},{default:r(()=>[t(Q,{modelValue:o(l).situacao,"onUpdate:modelValue":e[8]||(e[8]=a=>o(l).situacao=a),items:o(p),"item-title":"descricao","item-value":"descricao",label:"Situação"},null,8,["modelValue","items"])]),_:1}),t(c,{md:"2"},{default:r(()=>[t(Q,{items:o(v),modelValue:o(l).usuario_token,"onUpdate:modelValue":e[9]||(e[9]=a=>o(l).usuario_token=a),"item-title":"user_nome","item-value":"user_token",label:"Usuario"},null,8,["items","modelValue"])]),_:1}),t(c,{md:"1"},{default:r(()=>[t(y,{modelValue:o(l).selo,"onUpdate:modelValue":e[10]||(e[10]=a=>o(l).selo=a),label:"Selo"},null,8,["modelValue"])]),_:1}),t(c,{md:"3"},{default:r(()=>[t(Q,{modelValue:o(l).ato_tipo_token,"onUpdate:modelValue":e[11]||(e[11]=a=>o(l).ato_tipo_token=a),items:o(s),"item-title":"descricao","item-value":"token",label:"Serviço"},null,8,["modelValue","items"])]),_:1}),t(c,{md:"2"},{default:r(()=>[t(y,{modelValue:o(l).apresentante,"onUpdate:modelValue":e[12]||(e[12]=a=>o(l).apresentante=a),label:"Apresentante"},null,8,["modelValue"])]),_:1}),t(c,null,{default:r(()=>[m("div",null,[m("img",{onClick:pe,style:{width:"40px",height:"40px",cursor:"pointer"},src:Ie,alt:"Pesquisar"})])]),_:1})]),_:1}),e[18]||(e[18]=m("hr",{class:"mt-5 mb-5"},null,-1)),t(Pe,{headers:me,style:{"min-width":"1230px","font-size":"12px"},items:o(g),"item-key":"id"},{"item.actions":r(({item:a})=>[t(A,{style:{display:"flex",gap:"2px","margin-top":"-5px"}},{default:r(()=>[m("div",{class:H({disabled:!a.btn_receber}),title:a.btn_receber?"Receber":"Bloqueado",onClick:Y=>a.btn_receber?ke(a.numero,a):null},[m("img",{style:J({cursor:a.btn_receber?"pointer":"default",width:"30px",height:"30px"}),src:qe,alt:"Receber"},null,4)],10,We),m("div",{class:H({disabled:!a.btn_editar}),onClick:Y=>a.btn_editar?ye(a.id):null,title:a.btn_editar?"Editar":"Bloqueado"},[m("img",{style:J({cursor:a.btn_editar?"pointer":"default",width:"30px",height:"30px"}),src:ze,alt:"Editar"},null,4)],10,Ye),m("div",{class:H({disabled:!a.btn_recibo}),onClick:Y=>a.btn_recibo?be(a):null,title:a.btn_recibo?"Emitir Recibo":"Bloqueado"},[m("img",{style:J({cursor:a.btn_recibo?"pointer":"default",width:"30px",height:"30px"}),src:Ne,alt:"Emitir Recibo"},null,4)],10,He),m("div",{disabled:!a.btn_cancelar,onClick:Y=>a.btn_cancelar?fe(a):null,title:"Cancelamento",style:J({opacity:a.btn_cancelar?1:.5,cursor:a.btn_cancelar?"pointer":"not-allowed"})},[a.excluido?(I(),re("img",Xe)):(I(),re("img",Ze))],12,Qe)]),_:2},1024)]),_:1},8,["items"]),t($,{show:o(S),numero_os:o(E),ordem:o(ae),onClose:e[13]||(e[13]=a=>S.value=!1),onRefreshValue:e[14]||(e[14]=a=>oe())},null,8,["show","numero_os","ordem"]),t(le,{show:o(D),numero_os:o(E),ordemserv_token:o(h),onClose:e[15]||(e[15]=a=>D.value=!1)},null,8,["show","numero_os","ordemserv_token"]),t(q,{show:o(b),apresentante_nome:o(M).apresentante_nome,apresentante_cpf:o(M).apresentante_cpf,token:o(h),onClose:e[16]||(e[16]=a=>b.value=!1)},null,8,["show","apresentante_nome","apresentante_cpf","token"])]),_:1})}}};export{Ut as default};
