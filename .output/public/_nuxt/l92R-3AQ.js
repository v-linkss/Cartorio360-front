import{_ as pe}from"./C9lSdrro.js";import{a as ce,_ as me}from"./To7iloqP.js";import{u as ve,r as u,m as r,n as fe,G as _e,z as ge,p as _,w as i,v as be,o as g,b as l,a as n,t as ke,q as a,B as Ce,C as T,A as G,E as D,D as Ve,V as ye,d as xe}from"./jRkUikiC.js";import{_ as $e}from"./XMFURPAk.js";import{_ as he}from"./BVz1G1IN.js";import{_ as we}from"./B7lm-OZt.js";import{_ as Oe}from"./z63zwKV9.js";import{_ as Se}from"./sv1UUvBt.js";import{c as H,r as J,u as Te}from"./D9Z8bBNQ.js";import{u as A}from"./DxXGoBKc.js";import"./Cpoq91My.js";import{f as De}from"./D4tEB8Mb.js";import{V as Ae}from"./Cb7YLZYh.js";import{V as y}from"./B78qr18H.js";import{V as x}from"./ZH0S8k4I.js";import{V as Ne}from"./DDNyJM8-.js";import{V as Be}from"./akE6UwAb.js";import"./BXA021dZ.js";import"./BUTfWeNL.js";import"./C6cXfWQ_.js";import"./C3_VzyCm.js";import"./B3V2gHeI.js";import"./N3w0tUIo.js";import"./BuumOr0x.js";import"./Cy-7bklF.js";import"./C0230nXg.js";import"./BVz6DytO.js";const Ee={style:{color:"red","margin-left":"30px"}},Re=["onClick"],qe=["onClick"],ze=["onClick","title"],Fe=["onClick"],Pe=["title"],vt={__name:"criar-registro",async setup(Ie){var z,F,P,I,U,L,M;let b,N;const{$toast:m}=ve(),k=be(),W=`${k.public.managemant}/createOrdensServico`,j=`${k.public.managemant}/validarCpf`,X=`${k.public.managemant}/listarAtos`,K=`${k.public.managemant}/updateAtos`,Q=u(r("user-data").value.cartorio_id),Y=u(r("user-data").value.usuario_id),Z=u((z=r("user-service").value)==null?void 0:z.token).value||null,ee=u(r("user-data").value.cartorio_token).value,C=u((F=r("user-service").value)==null?void 0:F.numero),V=u((P=r("user-service").value)==null?void 0:P.isDisabled);let B=u(!!((I=r("user-service").value)!=null&&I.numero)),$=u(r("ordem-button").value),h=!1;const E=u(null),w=u(!1),O=u([]),s=fe({nacionalidade:((U=r("user-service").value)==null?void 0:U.estrangeiro)||!1,apresentante_nome:(L=r("user-service").value)==null?void 0:L.apresentante_nome,apresentante_cpf:(M=r("user-service").value)==null?void 0:M.apresentante_cpf}),v=u(!1),te=[{title:"ID",value:"id"},{title:"Protocolo",value:"protocolo"},{title:"Usuario",value:"usuario_nome"},{title:"Situação",value:"situacao"},{title:"Valor",value:"valor"},{title:"Tipo",value:"tipo"},{value:"actions"}],ae=[{title:"BRASILEIRO",value:!1},{title:"ESTRANGEIRO",value:!0}],oe={apresentante_nome:{required:H.withMessage("O campo é obrigatorio",J)},apresentante_cpf:{required:H.withMessage("O campo é obrigatorio",J)}},p=Te(oe,s);function R(o){if(o)return o.replace(/[.\-]/g,"");o=null}const re=o=>{redirectTo({item:o,id:r("user-service").value.id,numeroOs:C.value,origem:"vizualizar"})},se=o=>{redirectTo({item:o,id:r("user-service").value.id,numeroOs:C.value,origem:"atualizar"})};function ne(){const o=r("user-service"),t=r("ordem-button");o.value=null,t.value=null}const ie=o=>{E.value=o,w.value=!0};async function le(){const o={apresentante_cpf:R(s.apresentante_cpf),apresentante_nome:s.apresentante_nome,user_id:Y.value,cartorio_id:Q.value,estrangeiro:s.nacionalidade};if(await p.value.$validate()){const{data:t,error:c,status:d}=await A(W,{method:"POST",body:o},"$HqnOwnLBio");if(d.value==="error"&&c.value.statusCode===500)m.error("Erro ao cadastrar ordem,erro no sistema.");else{m.success("Ordem registrada com sucesso!"),B.value=!0,$.value=!1,C.value=t.value.numero;const f=r("ordem-button");f.value=$.value;const e=r("user-service");e.value=e.value=JSON.stringify({numero:t.value.numero,id:t.value.id,apresentante_cpf:t.value.apresentante_cpf,apresentante_nome:t.value.apresentante_nome,estrangeiro:t.value.estrangeiro,token:t.value.token,isDisabled:!0}),v.value=!0}}}async function ue(o){const t=R(o);if(t.length===11&&!h){h=!0;const c={cpf:t};try{const{data:d,error:f,status:e}=await A(j,{method:"POST",body:c},"$DfuVr7OuaN");e.value==="error"&&f.value.statusCode===500?m.error("Erro ao cadastrar pessoa, o CPF já está cadastrado."):d.value.cpfValidation===!0?(s.apresentante_nome=d.value.nome,m.success("Cpf autenticado com sucesso!")):d.value.cpfValidation===!1&&m.error("Cpf não cadastrado!")}catch(d){console.error("Erro ao validar CPF:",d)}finally{h=!1}}}async function de(o){o.excluido=!o.excluido;try{await De(`${K}/${o.id}`,{method:"PUT",body:{excluido:o.excluido}})}catch(t){console.error("Erro ao excluir pessoa:",t)}}const{data:q}=([b,N]=_e(()=>A(X,{method:"POST",body:{cartorio_token:ee,ordemserv_token:Z}},"$bJ1XcDsWLH")),b=await b,N(),b);return q.value.length>0?O.value=q.value:O.value=[],(o,t)=>{const c=pe,d=me,f=ge("mask");return g(),_(Ae,{class:"mt-5"},{default:i(()=>[l(y,{class:"mb-5"},{default:i(()=>{var e;return[t[7]||(t[7]=n("h1",null,"Ordem de Serviço nº",-1)),n("h1",Ee,ke(a(C)||((e=("useCookie"in o?o.useCookie:a(r))("user-service").value)==null?void 0:e.numero)),1)]}),_:1}),l(y,null,{default:i(()=>[l(x,{md:"3"},{default:i(()=>[l(Ne,{label:"Nacionalidade",items:ae,modelValue:a(s).nacionalidade,"onUpdate:modelValue":t[0]||(t[0]=e=>a(s).nacionalidade=e),disabled:a(V)||a(v)},null,8,["modelValue","disabled"])]),_:1}),l(x,{md:"2"},{default:i(()=>[a(s).nacionalidade===!1?Ce((g(),_(T,{key:0,autofocus:"",modelValue:a(s).apresentante_cpf,"onUpdate:modelValue":t[1]||(t[1]=e=>a(s).apresentante_cpf=e),label:"CPF",required:"","error-messages":a(p).apresentante_cpf.$errors.map(e=>e.$message),onBlur:a(p).apresentante_cpf.$touch,onInput:t[2]||(t[2]=e=>ue(a(s).apresentante_cpf)),disabled:a(V)||a(v)},null,8,["modelValue","error-messages","onBlur","disabled"])),[[f,"###.###.###-##"]]):(g(),_(T,{key:1,autofocus:"",modelValue:a(s).apresentante_cpf,"onUpdate:modelValue":t[3]||(t[3]=e=>a(s).apresentante_cpf=e),label:"Documento",required:"","error-messages":a(p).apresentante_cpf.$errors.map(e=>e.$message),onBlur:a(p).apresentante_cpf.$touch,disabled:a(V)||a(v)},null,8,["modelValue","error-messages","onBlur","disabled"]))]),_:1}),l(x,{md:"4"},{default:i(()=>[l(T,{modelValue:a(s).apresentante_nome,"onUpdate:modelValue":t[4]||(t[4]=e=>a(s).apresentante_nome=e),label:"Nome Apresentante",required:"","error-messages":a(p).apresentante_nome.$errors.map(e=>e.$message),onInput:a(p).apresentante_nome.$touch,disabled:a(V)||a(v)},null,8,["modelValue","error-messages","onInput","disabled"])]),_:1}),a($)?(g(),_(x,{key:0},{default:i(()=>[n("div",null,[n("img",{style:{width:"40px",height:"40px",cursor:"pointer"},src:$e,alt:"Salvar",onClick:t[5]||(t[5]=e=>le())})])]),_:1})):G("",!0)]),_:1}),a(B)?(g(),_(y,{key:0,style:{display:"flex","margin-bottom":"10px",gap:"2rem"}},{default:i(()=>[t[11]||(t[11]=n("h1",{class:"ml-5"},"Atos",-1)),l(c,{to:{path:"/os/criar-ato",query:{origem:"criar"}}},{default:i(()=>t[8]||(t[8]=[n("img",{style:{width:"45px",height:"45px",cursor:"pointer"},src:he,alt:"novo"},null,-1)])),_:1}),l(Be,{headers:te,items:a(O),"item-key":"id"},{"item.actions":i(({item:e})=>[l(y,{style:{display:"flex",gap:"2px","margin-top":"-5px"}},{default:i(()=>[n("div",{onClick:S=>re(e),title:"Visualizar"},t[9]||(t[9]=[n("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:we,alt:"Visualizar"},null,-1)]),8,Re),n("div",{onClick:S=>ie(e.token),title:"Reimprimir"},t[10]||(t[10]=[n("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ce,alt:"Reimprimir"},null,-1)]),8,qe),n("div",{class:Ve({disabled:!e.btn_editar}),onClick:S=>e.btn_editar?se({id:e.id,tipo:e.tipo,token:e.token,tipo_token:e.tipo_token,rota:e.rota}):null,title:e.btn_editar?"Editar":"Desabilitado"},[n("img",{style:D({cursor:e.btn_editar?"pointer":"default",width:"30px",height:"30px"}),src:Oe,alt:"Editar"},null,4)],10,ze),n("div",{onClick:S=>e.btn_cancelar?de(e):null,title:"Excluir",style:D({cursor:e.btn_cancelar?"pointer":"not-allowed"})},[n("img",{style:D({width:"30px",height:"30px",cursor:e.btn_cancelar?"pointer":"not-allowed",opacity:e.btn_cancelar?"1":"0.5"}),src:Se,alt:"Cancelar",title:e.btn_cancelar?"Cancelar":"Não permitido"},null,12,Pe)],12,Fe)]),_:2},1024)]),_:1},8,["items"]),l(d,{show:a(w),ato_token:a(E),onClose:t[6]||(t[6]=e=>w.value=!1)},null,8,["show","ato_token"])]),_:1})):G("",!0),l(c,{to:"/os/lista"},{default:i(()=>[l(ye,{size:"large",color:"red",onClick:ne},{default:i(()=>t[12]||(t[12]=[xe("Voltar")])),_:1})]),_:1})]),_:1})}}};export{vt as default};
