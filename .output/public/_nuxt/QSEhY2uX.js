import{_ as q}from"./Dz38DW6e.js";import{_ as T}from"./khLhsHx5.js";import{_ as E}from"./Bfz2WLTB.js";import{_ as L,u as R,r,e as k,f as U,c as B,b as t,w as u,i as s,F as H,k as j,o as z,a as n,d as f,s as _}from"./CTSKgcpy.js";import{u as b}from"./UQj70cFG.js";import{f as w}from"./B0IxRygJ.js";import{V as J}from"./DZBSS2Se.js";import{V as h}from"./BrJ484OA.js";import{V as y}from"./BTvRjNMB.js";import{V as K}from"./f9FoYqAA.js";import"./CyJrbUUE.js";import"./C8v71UOG.js";import"./Hp46IEy0.js";import"./EYlFtN6H.js";import"./DI_l3su2.js";import"./DzCMmmeP.js";import"./BiVz7D4h.js";import"./DpMCEPiN.js";import"./8g4DeN--.js";import"./CtVdu2Od.js";const X={style:{display:"flex",gap:"4px","justify-content":"center"}},Y=["onClick"],Z={__name:"index",setup(G){const x=j(),{$toast:v}=R(),$=`${x.public.managemant}/cancela_lavratura`,A=`${x.public.managemant}/pesquisaAtos`,D=r(k("auth_token").value)||null,N=r(k("user-data").value.cartorio_token)||null,m=r([]),i=r(!1),p=r(""),V=r(null),S=r(null),d=r(!1),g=r(""),l=U({id:null,selo_numero:null}),P=[{title:"Protocolo",value:"protocolo"},{title:"Data lavratura/Parte",value:"dt_lavratura"},{title:"Situação/Serviço",key:"situacaoServico",value:e=>e.situacao?`${e.situacao}
${e.ato_servico}`:`${e.ato_servico}`,cellProps:{style:{whiteSpace:"pre-line",lineHeight:"2"}}},{title:"Livro",value:"livro_numero"},{title:"Folha",value:"folha"},{title:"Valor",value:"valor"},{title:"Ações",value:"actions"}];async function F(){try{if(l.id===null){v.error("Informe o ID do ato!");return}sessionStorage.setItem("pesquisaAto",JSON.stringify(l));const{data:e}=await b(A,{method:"POST",body:{cartorio_token:N.value,ato_id:Number(l.id)||null}},"$xahYxgiURx");e.value.length>0?m.value=e.value.map(a=>({...a,dt_lavratura:a.dt_lavratura?w(a.dt_lavratura,"dd/mm/yyyy hh:mm"):null,dt_abertura:a.dt_abertura?w(a.dt_abertura,"dd/mm/yyyy"):null})):(m.value=[],v.error("Não existe ato Registrado!"))}catch(e){console.error("Erro na requisição",e)}}const I=(e,a)=>{V.value=e,a.value=a,p.value="O cancelamento de lavratura é definitivo e não poderá ser revertido. Confirma o cancelamento da lavratura deste ato?",d.value=!1,i.value=!0},M=async()=>{if(d.value){await C(!0);return}await C(!1)},C=async e=>{i.value=!1;const{data:a,status:c,error:o}=await b($,{method:"POST",body:{ato_token:V.value,user_token:D.value,selo_numero:S.value,forcar_cancelamento:e}},"$0XhtmZH7s8");i.value=!1,c.value==="success"&&a.value&&a.value[0]?a.value[0].status==="OK"&&(v.success("Lavratura cancelada com sucesso!"),m.value=[],l.id=null,d.value=!1):c.value==="error"&&o.value&&(g.value=`${o.value.data[0].status_mensagem} Confirma o cancelamento?`,p.value=g.value,d.value=!0,i.value=!0)};return(e,a)=>{const c=q;return z(),B(H,null,[t(J,null,{default:u(()=>[t(h,{class:"mb-5"},{default:u(()=>a[4]||(a[4]=[n("h1",null,"Cancelamento de Lavratura",-1)])),_:1}),t(h,null,{default:u(()=>[t(y,{cols:"2"},{default:u(()=>[a[5]||(a[5]=f(" <<<<<<< HEAD ")),t(_,{modelValue:s(l).id,"onUpdate:modelValue":a[0]||(a[0]=o=>s(l).id=o),label:"ID"},null,8,["modelValue"]),a[6]||(a[6]=f(" ======= ")),t(_,{modelValue:s(l).id,"onUpdate:modelValue":a[1]||(a[1]=o=>s(l).id=o),label:"ID do ato"},null,8,["modelValue"])]),_:1}),t(y,{cols:"2"},{default:u(()=>[t(_,{modelValue:s(l).selo_numero,"onUpdate:modelValue":a[2]||(a[2]=o=>s(l).selo_numero=o),label:"Numero do selo"},null,8,["modelValue"]),a[7]||(a[7]=f(" >>>>>>> lavratura-cancela-um-selo "))]),_:1}),t(y,null,{default:u(()=>[n("div",null,[n("img",{onClick:F,style:{width:"40px",height:"40px",cursor:"pointer"},src:T,alt:"Pesquisar"})])]),_:1})]),_:1}),n("div",null,[a[9]||(a[9]=n("hr",{class:"mt-5 mb-5"},null,-1)),t(K,{headers:P,items:s(m),style:{"font-size":"12px"},"item-key":"id"},{"item.actions":u(({item:o})=>[n("div",X,[n("div",{onClick:O=>I(o.token,o.selo_numero),title:"Excluir"},a[8]||(a[8]=[n("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:E,alt:"Cancelar",title:"Cancelar"},null,-1)]),8,Y)])]),_:1},8,["items"])])]),_:1}),t(c,{show:s(i),condMessage:s(p),onClose:a[3]||(a[3]=o=>i.value=!1),onConfirm:M},null,8,["show","condMessage"])],64)}}},xa=L(Z,[["__scopeId","data-v-ff19ab3c"]]);export{xa as default};
