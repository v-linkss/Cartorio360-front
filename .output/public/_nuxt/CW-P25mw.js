import{_ as q}from"./CnLwtIe4.js";import{_ as Y}from"./BWpqHIw-.js";import{_ as j}from"./CTw4MbE8.js";import{_ as G}from"./C5XdndeX.js";import{u as H,m as b,r as s,n as J,p as K,q as w,c as Q,b as t,w as n,F as W,s as X,o as Z,a as i,t as O,v as r,V as S,x as $,y as ee,z as h,A as oe,d as ae,B as te}from"./_r0buiq6.js";import{V as re}from"./DZ7dwQ-G.js";import{V as g}from"./CKpRPa9w.js";import{V as k}from"./DZ43vLtX.js";import{V as ne}from"./DZtIdLKj.js";import"./D8Y2YL9I.js";import"./DIvgk8Rv.js";import"./B9ggQIHO.js";import"./ByLLN6-o.js";import"./BVz1G1IN.js";import"./CAV8IhS3.js";import"./CrG_BPbt.js";import"./egcGx8ld.js";const se=["title","onClick"],le=["onClick"],$e={__name:"index",setup(ie){const C=X(),{$toast:c}=H(),M=`${C.public.managemant}/listarOSCaixas`,A=`${C.public.managemant}/updateOrdensServico`,R=b("caixa-service").value.usuario_nome,T=b("caixa-service").value.data,x=s([]),m=s(""),d=s(""),p=s({}),y=s(null),N=s("O encerramento de OS não poderá ser revertido. Confirma o encerramento?"),f=s(!1),v=s(!1),B=()=>{te("/caixas/lista")},D=[{title:"Data Recebimento",value:"data"},{title:"Número",value:"numero"},{title:"Situação",value:"situacao"},{title:"CPF",value:"apresentante_cpf"},{title:"Apresentante",value:"apresentante_nome"},{title:"Usuário",value:"usuario_nome"},{title:"Valor",value:"valor"},{title:"Ações",value:"actions"}];async function V(){try{const o=await $fetch(M,{method:"POST",body:{caixa_token:b("caixa-service").value.caixa_token}});o&&Array.isArray(o)?x.value=o:c.error("Nenhum dado retornado da API.")}catch(o){const e=o.message||"Erro ao buscar dados da API. Tente novamente.";c.error(e)}}function P(){const o=new Date,e=o.getFullYear(),l=String(o.getMonth()+1).padStart(2,"0"),u=String(o.getDate()).padStart(2,"0");return`${e}-${l}-${u}`}const E=o=>{p.value=o,v.value=!0};async function F(o){try{await $fetch(`${A}/${o}`,{method:"PUT",body:{dt_pagto:P()}})?(c.success("Ordem de Serviço encerrada com sucesso!"),v.value=!1,V()):c.error("Erro ao encerrar OS. Tente novamente.")}catch(e){const l=e.message||"Erro ao buscar dados da API. Tente novamente.";c.error(l)}}J(()=>{V()});const I=K(()=>x.value.filter(o=>{const e=o.numero?o.numero.toString().toLowerCase():"",l=o.apresentante_nome?o.apresentante_nome.toLowerCase():"",u=e.includes(m.value.toLowerCase()),_=l.includes(d.value.toLowerCase());return u&&_}));function z(o,e){y.value=o,p.value={token:e.token,numero:e.numero,valor:e.valor,valor_pago:e.valor_pago},f.value=!0}return(o,e)=>{const l=q,u=Y,_=w("v-cols"),L=w("v-rows");return Z(),Q(W,null,[t(re,{class:"mt-5"},{default:n(()=>[t(g,{class:"mb-5"},{default:n(()=>[i("h1",null," Recebimento de Ordens de Serviço - Caixa "+O(r(T))+" - "+O(r(R)),1)]),_:1}),t(g,null,{default:n(()=>[t(k,{cols:"2"},{default:n(()=>[t(S,{modelValue:r(m),"onUpdate:modelValue":e[0]||(e[0]=a=>$(m)?m.value=a:null),type:"text",label:"Número"},null,8,["modelValue"])]),_:1}),t(k,{md:"3"},{default:n(()=>[t(S,{modelValue:r(d),"onUpdate:modelValue":e[1]||(e[1]=a=>$(d)?d.value=a:null),label:"Apresentante"},null,8,["modelValue"])]),_:1})]),_:1}),e[6]||(e[6]=i("hr",{class:"mt-5 mb-5"},null,-1)),t(ne,{headers:D,items:r(I),"item-key":"id"},{"item.actions":n(({item:a})=>[t(g,{style:{display:"flex",gap:"10px","margin-top":"-5px"}},{default:n(()=>[i("div",{class:h({disabled:!a.btn_receber}),title:a.btn_receber?"Bloqueado":"Receber",onClick:U=>a.btn_receber?null:z(a.numero,a)},[i("img",{style:ee({cursor:a.btn_receber?"default":"pointer",width:"30px",height:"30px"}),src:j,alt:"Receber"},null,4)],10,se),i("div",{class:h({disabled:!a.btn_encerrar}),onClick:U=>a.btn_encerrar?!1:E(a.id),title:"Cancelamento"},e[5]||(e[5]=[i("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:G,alt:"Encerrar",title:"Encerrar"},null,-1)]),10,le)]),_:2},1024)]),_:1},8,["items"]),t(l,{show:r(f),numero_os:r(y),ordem:r(p),onClose:e[2]||(e[2]=a=>f.value=!1)},null,8,["show","numero_os","ordem"]),t(u,{onConfirm:e[3]||(e[3]=a=>F(r(p))),condMessage:r(N),show:r(v),onClose:e[4]||(e[4]=a=>v.value=!1)},null,8,["condMessage","show"])]),_:1}),t(L,null,{default:n(()=>[t(_,null,{default:n(()=>[t(oe,{class:"ml-8",size:"large",onClick:B,color:"red"},{default:n(()=>e[7]||(e[7]=[ae("Voltar ")])),_:1})]),_:1})]),_:1})],64)}}};export{$e as default};
