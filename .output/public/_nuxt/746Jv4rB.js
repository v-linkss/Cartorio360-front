import{_ as re}from"./BfCZ9veE.js";import{_ as ie}from"./B-nvWSxh.js";import{c as ue,r as de,u as me}from"./zw4pTOWY.js";import{r as u,m as g,D as X,g as ce,o as T,G as Z,w as s,b as a,a as d,t as L,d as M,v as o,A as F,x as pe,s as H,u as _e,C as ve,n as fe,E as Ve,V as c,y as j,z as G,c as K}from"./psD5v9Aa.js";import{u as h}from"./D7I0HSn_.js";import{V as W,b as be}from"./DKPObH57.js";import{V as B}from"./D_yIk9YR.js";import{V as $}from"./CbFK0tUQ.js";import{V as ke}from"./NW6Sjds5.js";import{V as ge}from"./nY7GJPxJ.js";import{_ as ye,a as xe,b as he}from"./BP1uhy__.js";import{_ as we}from"./CjvhRF_V.js";import{_ as Ce}from"./BvdMdkEn.js";import{_ as Se}from"./Da_YaqZn.js";import{_ as Y}from"./CdP3NN9a.js";import{V as m}from"./kWh9bG3K.js";import{V as P}from"./DWuUDru_.js";import{V as $e}from"./BnGW_sxD.js";import"./BhN9cSlE.js";import"./CPMyhSY2.js";import"./FEgE0B4v.js";import"./CbCVfO8w.js";import"./BBalbJSD.js";const Oe={style:{color:"red","margin-left":"18px"}},Ue={class:"mb-5",style:{display:"flex","justify-content":"flex-start"}},Ae={class:"ml-6"},De={class:"ml-6"},Te={__name:"Ordem",props:{show:Boolean,numero_os:Number,ordemserv_token:String},emits:["close"],setup(E,{emit:w}){const b=E,k=u(b.show),C=H();u(g("user-data").value.cartorio_token).value;const N=g("auth_token").value,R=`${C.public.managemant}/analisaCancelamento`,S=`${C.public.managemant}/cancelaOs`,p=X({motivo:null}),_=u(null),O=w,U={motivo:{required:ue.withMessage("O campo é obrigatorio",de)}},y=me(U,p);ce(()=>b.show,v=>{k.value=v});const x=()=>{k.value=!1,O("close")};(async()=>{const{data:v,error:i}=await h(`${R}`,{method:"POST",body:{ordemserv_token:b.ordemserv_token}},"$1fnrIk2fgs");_.value=v.value.mensagem})();const D=async()=>{if(await y.value.$validate()){const{status:v}=await h(`${S}`,{method:"POST",body:{usuario_token:N,motivo:p.motivo,ordemserv_token:b.ordemserv_token}},"$21WlhUNXeM");v.value==="success"&&(window.location.reload(),x())}};return(v,i)=>(T(),Z(ge,{persistent:"",modelValue:o(k),"onUpdate:modelValue":i[1]||(i[1]=f=>pe(k)?k.value=f:null),"max-width":"650"},{default:s(()=>[a(W,null,{default:s(()=>[a(B,null,{default:s(()=>[a($,{class:"mb-5 mt-1 ml-2"},{default:s(()=>[i[2]||(i[2]=d("h1",null,"Cancelamento da OS nº",-1)),d("h1",Oe,L(b.numero_os),1)]),_:1}),a(B,null,{default:s(()=>[a(W,{variant:"outlined",class:"mb-5"},{default:s(()=>[a(be,null,{default:s(()=>[M(L(o(_)),1)]),_:1})]),_:1}),a(ke,{label:"Motivo",modelValue:o(p).motivo,"onUpdate:modelValue":i[0]||(i[0]=f=>o(p).motivo=f),required:"","error-messages":o(y).motivo.$errors.map(f=>f.$message),onBlur:o(y).motivo.$touch,onInput:o(y).motivo.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1})]),_:1}),d("div",Ue,[d("div",Ae,[a(F,{size:"large",color:"red",onClick:x},{default:s(()=>i[3]||(i[3]=[M("Fechar")])),_:1})]),d("div",De,[a(F,{size:"large",color:"green",onClick:D},{default:s(()=>i[4]||(i[4]=[M("Salvar")])),_:1})])])]),_:1})]),_:1},8,["modelValue"]))}},Ne=["title","onClick"],Re=["onClick","title"],qe=["disabled","onClick"],Me={key:0,style:{width:"30px",height:"30px"},src:xe,alt:"Visualizar",title:"Bloqueado"},Pe={key:1,src:he,alt:"Cancelamento",class:"trash-icon",style:{width:"30px",height:"30px",cursor:"pointer"},title:"Cancelamento"},rt={__name:"index",setup(E){const w=H(),{$toast:b}=_e(),k=`${w.public.managemant}/listarUsuarios`,C=`${w.public.managemant}/listarOrdensServico`,N=`${w.public.managemant}/tipoAtos`,R=ve(),S=u(g("auth_token").value)||null,p=u(g("user-data").value.cartorio_token)||null,_=u([]),O=u([]),U=u([]),y=u(["PENDENTE","EM ANDAMENTO","CONCLUÍDA","LAVRADA"]),x=u(!1),A=u(!1),D=u(null),v=u(null),i=u(null),f=u({}),l=X({numero:null,data_inicio:q(),data_fim:q(),data_lavratura_inicio:null,data_lavratura_fim:null,protocolo:null,livro:null,folha:null,situacao:null,usuario_token:S.value,selo:null,ato_tipo_token:null,apresentante:null}),Q=[{title:"Data Recebimento",value:"data",width:"140px"},{title:"Número",value:"numero",width:"120px"},{title:"Situação",value:"situacao",width:"120px"},{title:"CPF",value:"apresentante_cpf",width:"120px"},{title:"Apresentante",value:"apresentante_nome",width:"120px"},{title:"Usuario",value:"usuario_nome",width:"120px"},{title:"Valor",value:"valor",width:"100px"},{title:"A Receber",value:"valor_a_receber",width:"100px"},{value:"actions"}];function q(){const n=new Date,e=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),V=String(n.getDate()).padStart(2,"0");return`${e}-${r}-${V}`}async function ee(){const{data:n}=await h(k,{method:"POST",body:{cartorio_token:p.value}},"$pAAptWJdb1");O.value=n.value}async function te(){try{sessionStorage.setItem("pesquisaOS",JSON.stringify(l));const{data:n,error:e}=await h(C,{method:"POST",body:{cartorio_token:p.value,numero:l.numero||null,data_inicio:l.data_inicio||null,data_fim:l.data_fim||null,data_lavratura_inicio:l.data_lavratura_inicio||null,data_lavratura_fim:l.data_lavratura_fim||null,protocolo:l.protocolo||null,livro:l.livro||null,folha:l.folha||null,situacao:l.situacao||null,usuario_token:l.usuario_token,selo:l.selo||null,ato_tipo_token:l.ato_tipo_token,apresentante:l.apresentante||null}},"$IO02J210Z9");n.value.length>0?_.value=n.value.map(r=>({...r,data:r.data?Y(r.data,"dd/mm/yyyy"):null})):(_.value=[],b.error("Não existe Ordem de Serviço Registrada!"))}catch(n){console.error("Erro na requisição",n)}}async function ae(){const{data:n,error:e}=await h(N,{method:"POST",body:{cartorio_token:p.value,usuario_token:S.value}},"$YgUhKRJlsV");U.value=n.value}const I=async()=>{try{const n=q(),e=sessionStorage.getItem("pesquisaOS"),r=JSON.parse(e),{data:V,error:z}=await h(C,{method:"POST",body:{cartorio_token:p.value,usuario_token:S.value,data_fim:(r==null?void 0:r.data_fim)||n,data_inicio:(r==null?void 0:r.data_inicio)||n}},"$xKnfARCL4G");V.value.length>0?_.value=V.value.map(t=>({...t,data:Y(t.data,"dd/mm/yyyy")})):_.value=[]}catch(n){console.error("Erro ao buscar serviços",n)}};function oe(n){i.value=n.numero,v.value=n.token,A.value=!0}function le(n){const e=g("user-service"),r=_.value.find(V=>V.id===n);e.value=e.value=JSON.stringify({id:r.id,token:r.token}),R.push({path:`/os/atualizar/${n}`})}function ne(n,e){i.value=n,f.value={token:e.token,numero:e.numero,valor:e.valor,valor_pago:e.valor_pago},x.value=!0}const se=()=>{const n=g("user-service"),e=g("ordem-button");n.value=null,D.value=!0,e.value=D.value};return ee(),ae(),fe(()=>{Ve(async()=>{const n=sessionStorage.getItem("pesquisaOS");if(n){const e=JSON.parse(n);Object.assign(l,e)}await I()})}),(n,e)=>{const r=re,V=ie,z=Te;return T(),Z(B,{class:"mt-5",style:{width:"100%"}},{default:s(()=>[a($,{class:"mb-5"},{default:s(()=>[e[16]||(e[16]=d("h1",null,"Ordens de Serviço",-1)),a(r,{to:"/os/criar-registro"},{default:s(()=>[d("img",{style:{width:"60px",height:"60px",cursor:"pointer","margin-left":"70px"},src:ye,alt:"novo",onClick:se})]),_:1})]),_:1}),a($,{style:{"margin-bottom":"-35px"}},{default:s(()=>[a(m,null,{default:s(()=>[a(c,{modelValue:o(l).numero,"onUpdate:modelValue":e[0]||(e[0]=t=>o(l).numero=t),label:"Número"},null,8,["modelValue"])]),_:1}),a(m,null,{default:s(()=>[a(c,{modelValue:o(l).data_inicio,"onUpdate:modelValue":e[1]||(e[1]=t=>o(l).data_inicio=t),type:"date",label:"Abertura de",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),a(m,null,{default:s(()=>[a(c,{modelValue:o(l).data_fim,"onUpdate:modelValue":e[2]||(e[2]=t=>o(l).data_fim=t),type:"date",label:"Abertura até",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),a(m,null,{default:s(()=>[a(c,{modelValue:o(l).data_lavratura_inicio,"onUpdate:modelValue":e[3]||(e[3]=t=>o(l).data_lavratura_inicio=t),type:"date",label:"Lavratura de",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),a(m,null,{default:s(()=>[a(c,{modelValue:o(l).data_lavratura_fim,"onUpdate:modelValue":e[4]||(e[4]=t=>o(l).data_lavratura_fim=t),type:"date",label:"Lavratura até",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),a(m,null,{default:s(()=>[a(c,{modelValue:o(l).protocolo,"onUpdate:modelValue":e[5]||(e[5]=t=>o(l).protocolo=t),label:"Protocolo"},null,8,["modelValue"])]),_:1}),a(m,{md:"1"},{default:s(()=>[a(c,{modelValue:o(l).livro,"onUpdate:modelValue":e[6]||(e[6]=t=>o(l).livro=t),label:"Livro"},null,8,["modelValue"])]),_:1}),a(m,{md:"1"},{default:s(()=>[a(c,{modelValue:o(l).folha,"onUpdate:modelValue":e[7]||(e[7]=t=>o(l).folha=t),label:"Folha"},null,8,["modelValue"])]),_:1})]),_:1}),a($,null,{default:s(()=>[a(m,{md:"3"},{default:s(()=>[a(P,{modelValue:o(l).situacao,"onUpdate:modelValue":e[8]||(e[8]=t=>o(l).situacao=t),items:o(y),label:"Situação"},null,8,["modelValue","items"])]),_:1}),a(m,{md:"2"},{default:s(()=>[a(P,{items:o(O),modelValue:o(l).usuario_token,"onUpdate:modelValue":e[9]||(e[9]=t=>o(l).usuario_token=t),"item-title":"user_nome","item-value":"user_token",label:"Usuario"},null,8,["items","modelValue"])]),_:1}),a(m,{md:"1"},{default:s(()=>[a(c,{modelValue:o(l).selo,"onUpdate:modelValue":e[10]||(e[10]=t=>o(l).selo=t),label:"Selo"},null,8,["modelValue"])]),_:1}),a(m,{md:"3"},{default:s(()=>[a(P,{modelValue:o(l).ato_tipo_token,"onUpdate:modelValue":e[11]||(e[11]=t=>o(l).ato_tipo_token=t),items:o(U),"item-title":"descricao","item-value":"token",label:"Serviço"},null,8,["modelValue","items"])]),_:1}),a(m,{md:"2"},{default:s(()=>[a(c,{modelValue:o(l).apresentante,"onUpdate:modelValue":e[12]||(e[12]=t=>o(l).apresentante=t),label:"Apresentante"},null,8,["modelValue"])]),_:1}),a(m,null,{default:s(()=>[d("div",null,[d("img",{onClick:te,style:{width:"40px",height:"40px",cursor:"pointer"},src:we,alt:"Pesquisar"})])]),_:1})]),_:1}),e[17]||(e[17]=d("hr",{class:"mt-5 mb-5"},null,-1)),a($e,{headers:Q,items:o(_),"item-key":"id"},{"item.actions":s(({item:t})=>[a($,{style:{display:"flex",gap:"4px","margin-top":"-5px"}},{default:s(()=>[d("div",{class:G({disabled:!t.btn_receber}),title:t.btn_receber?"Receber":"Bloqueado",onClick:J=>t.btn_receber?ne(t.numero,t):null},[d("img",{style:j({cursor:t.btn_receber?"pointer":"default",width:"30px",height:"30px"}),src:Ce,alt:"Receber"},null,4)],10,Ne),d("div",{class:G({disabled:!t.btn_editar}),onClick:J=>t.btn_editar?le(t.id):null,title:t.btn_editar?"Editar":"Bloqueado"},[d("img",{style:j({cursor:t.btn_editar?"pointer":"default",width:"30px",height:"30px"}),src:Se,alt:"Editar"},null,4)],10,Re),d("div",{disabled:!t.btn_cancelar,onClick:J=>t.btn_cancelar?oe(t):null,title:"Cancelamento"},[t.excluido?(T(),K("img",Me)):(T(),K("img",Pe))],8,qe)]),_:2},1024)]),_:1},8,["items"]),a(V,{show:o(x),numero_os:o(i),ordem:o(f),onClose:e[13]||(e[13]=t=>x.value=!1),onRefreshValue:e[14]||(e[14]=t=>I())},null,8,["show","numero_os","ordem"]),a(z,{show:o(A),numero_os:o(i),ordemserv_token:o(v),onClose:e[15]||(e[15]=t=>A.value=!1)},null,8,["show","numero_os","ordemserv_token"])]),_:1})}}};export{rt as default};
