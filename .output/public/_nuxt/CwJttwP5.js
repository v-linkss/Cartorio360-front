import{r as f,m as i,E as N,p as q,c as y,a as A,b as c,v,F,w as p,L as n,I as T,s as $,o as r,bi as D,H as P,d as I,q as m,V as k}from"./C37mvZMd.js";import{u as _}from"./BQtPGJ2x.js";import{V as U}from"./B58H72Sz.js";import{V as O}from"./CQDwlInY.js";import{V as S}from"./CjpZKBGp.js";import{V as H}from"./Dgh8vK29.js";import"./CQABLkk8.js";import"./D6MNJxhQ.js";import"./ChW5Q-Ke.js";import"./CcmBROQv.js";const Q={key:0},ae={__name:"lista",async setup(G){let d,R;const V=$(),w=`${V.public.managemant}/getRelatorios`,B=`${V.public.managemant}/gerarRelatorioPessoa`,C=`${V.public.managemant}/listaQuery`,b=f([]),s=f(null),u=f([]),g={user_token:i("auth_token").value,cartorio_token:i("user-data").value.cartorio_token,user_name:i("user-data").value.nome},{data:E}=([d,R]=N(()=>_(w,{method:"POST",body:g},"$53NFRNGH7x")),d=await d,R(),d);b.value=Array.isArray(E.value)?E.value:[];const h=q(()=>b.value.every(o=>!o.codigo&&!o.value&&!o.parametros)?[]:b.value.map(o=>({label:o.codigo,value:o.codigo,parametros:o.parametros}))),L=async o=>{const a=h.value.find(e=>e.value===o);if(a){u.value=a.parametros.map(e=>({...e,value:null,showDatePicker:!1,items:[]}));for(const e of u.value)if(e.tipo==="TABLE"&&e.dominio)try{const{data:t}=await _(C,{method:"POST",body:{cartorio_token:g.cartorio_token,parametros:e.dominio}},"$c4psqRQWRs");e.items=Array.isArray(t.value)?t.value.map(l=>({label:l.nome,value:l.token})):[]}catch(t){console.error("Erro ao buscar dados para TABLE:",t)}}else u.value=[]},x=async()=>{const o=u.value.reduce((a,e)=>(a[e.parametro]=e.value,a),{});try{const a={...o,atos:null,cartorio_token:i("user-data").value.cartorio_token,consulta:s},{data:e}=await _(B,{method:"POST",body:a},"$6CLQJHdzNf"),t=new Blob([e.value],{type:"text/html"}),l=URL.createObjectURL(t);window.open(l,"_blank"),u.value=[],s.value=null}catch(a){console.error("Erro ao criar o relatório:",a)}};return(o,a)=>(r(),y(T,null,[a[2]||(a[2]=A("h1",null,"Relatórios",-1)),A("div",null,[c(U,{modelValue:v(s),"onUpdate:modelValue":a[0]||(a[0]=e=>F(s)?s.value=e:null),items:v(h),class:"mb-5","item-title":"label","item-value":"value",label:"Selecione o relatório",required:"","onUpdate:search":L},null,8,["modelValue","items"])]),v(s)?(r(),y("div",Q,[c(O,null,{default:p(()=>[(r(!0),y(T,null,D(v(u),(e,t)=>(r(),m(S,{key:t},{default:p(()=>[c(H,{cols:"4"},{default:p(()=>[e.tipo!=="DATE"&&e.tipo!=="TABLE"?(r(),m(k,{key:0,modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,label:e.label,required:e.obrigatorio},null,8,["modelValue","onUpdate:modelValue","label","required"])):n("",!0),e.tipo==="INTEGER"?(r(),m(k,{key:1,modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,type:"number",outlined:""},null,8,["modelValue","onUpdate:modelValue"])):n("",!0),e.tipo==="DATE"?(r(),m(k,{key:2,modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,type:"date"},null,8,["modelValue","onUpdate:modelValue"])):n("",!0),e.tipo==="TABLE"?(r(),m(U,{key:3,modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,items:e.items,"item-title":"label","item-value":"value",label:e.label,required:e.obrigatorio},null,8,["modelValue","onUpdate:modelValue","items","label","required"])):n("",!0)]),_:2},1024)]),_:2},1024))),128)),c(P,{color:"green",class:"mt-4",onClick:x},{default:p(()=>a[1]||(a[1]=[I("Enviar")])),_:1})]),_:1})])):n("",!0)],64))}};export{ae as default};
