import{_ as q}from"./-95mjwHR.js";import{P as T,Q as N,R as E,b as e,S as R,T as G,U as B,W as I,X as F,A as L,Y as j,Z as J,$,F as M,a0 as W,u as Y,e as D,f as z,r as H,m as Q,h as X,w as l,k as Z,o as P,a as u,q as x,s as w,i as r,c as K,d as A,a1 as ee,t as ae,p as oe}from"./BByDlLmN.js";import{V as te}from"./KYmhQMWN.js";import{V as b}from"./BR4JYKwL.js";import{V as i}from"./Dla0_UEN.js";import{V as O}from"./Dq9YuW5U.js";import{m as le,V as U,a as se,b as ne}from"./BVhmQuk8.js";const re=T({...le({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),V=N()({name:"VRadio",props:re(),setup(s,p){let{slots:m}=p;return E(()=>e(U,R(s,{class:["v-radio",s.class],style:s.style,type:"radio"}),m)),{}}}),ie=T({height:{type:[Number,String],default:"auto"},...G(),...B(se(),["multiple"]),trueIcon:{type:I,default:"$radioOn"},falseIcon:{type:I,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),de=N()({name:"VRadioGroup",inheritAttrs:!1,props:ie(),emits:{"update:modelValue":s=>!0},setup(s,p){let{attrs:m,slots:v}=p;const h=F(),y=L(()=>s.id||`radio-group-${h}`),o=j(s,"modelValue");return E(()=>{const[_,g]=J(m),C=$.filterProps(s),S=U.filterProps(s),t=v.label?v.label({label:s.label,props:{for:y.value}}):s.label;return e($,R({class:["v-radio-group",s.class],style:s.style},_,C,{modelValue:o.value,"onUpdate:modelValue":a=>o.value=a,id:y.value}),{...v,default:a=>{let{id:n,messagesId:c,isDisabled:d,isReadonly:k}=a;return e(M,null,[t&&e(W,{id:n.value},{default:()=>[t]}),e(ne,R(S,{id:n.value,"aria-describedby":c.value,defaultsTarget:"VRadio",trueIcon:s.trueIcon,falseIcon:s.falseIcon,type:s.type,disabled:d.value,readonly:k.value,"aria-labelledby":t?n.value:void 0,multiple:!1},g,{modelValue:o.value,"onUpdate:modelValue":f=>o.value=f}),v)])}})}),{}}}),ue={class:"mb-6"},ce={class:"mb-6"},me={class:"mb-4"},fe={key:0,class:"mt-6"},pe={class:"bg-success text-white pa-4 mb-4 rounded"},ve={class:"bg-grey-lighten-4 pa-4 rounded"},Se={__name:"censec",setup(s){const p=Z(),{$toast:m}=Y(),v=`${p.public.auth}/service/gerencia/integra_censec`;`${p.public.ws}`;const y=D("auth_token").value,o=z({data_inicio:g(),data_fim:g(),validar:null,file_name:""}),_=H(null);function g(){const t=new Date,a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0");return`${String(t.getDate()).padStart(2,"0")}-${n}-${a}`}function C(t){if(!t)return null;const[a,n,c]=t.split("/");return`${c}-${n}-${a}`}const S=async()=>{if(console.log("Token:",y),!o.validar){m.warning("Selecione um tipo de validação antes de enviar!");return}try{const t=await fetch(`${v}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`},body:JSON.stringify({cartorio_token:D("user-data").value.cartorio_token,data_inicio:C(o.data_inicio),data_fim:C(o.data_fim),validar:o.validar,file_name:o.file_name})});if(!t.ok)throw new Error(`Erro ao gerar dados (HTTP ${t.status})`);if(o.validar==="ATOS"){const a=await t.text(),n=window.open("","_blank");n?(n.document.open(),n.document.write(a),n.document.close()):m.warning("Não foi possível abrir a nova aba (bloqueador de pop-up?).")}else{if(!o.file_name){m.warning("Digite o nome do arquivo!");return}const a=await t.blob(),n=t.headers.get("Content-Disposition"),c=n&&n.match(/filename="(.+)"/),d=c?c[1]:`${o.file_name}.json`,k=window.URL.createObjectURL(a),f=document.createElement("a");f.href=k,f.download=d,document.body.appendChild(f),f.click(),f.remove(),window.URL.revokeObjectURL(k),m.success("Arquivo baixado com sucesso!")}}catch(t){console.error(t),m.error("Erro ao processar a requisição.")}};return(t,a)=>{const n=q,c=Q("mask");return P(),X(te,{class:"mt-5"},{default:l(()=>[e(b,{class:"mb-10"},{default:l(()=>a[4]||(a[4]=[u("h1",null,"Integração CENSEC",-1)])),_:1}),u("div",null,[u("div",ue,[a[5]||(a[5]=u("h3",{class:"text-h6 mb-2"},"Período de Consulta",-1)),e(b,null,{default:l(()=>[e(i,{cols:"12",md:"2"},{default:l(()=>[x(e(w,{modelValue:r(o).data_inicio,"onUpdate:modelValue":a[0]||(a[0]=d=>r(o).data_inicio=d),label:"Data Inicio",placeholder:"dd/mm/yyyy"},null,8,["modelValue"]),[[c,"##/##/####"]])]),_:1}),e(i,{cols:"12",md:"2"},{default:l(()=>[x(e(w,{modelValue:r(o).data_fim,"onUpdate:modelValue":a[1]||(a[1]=d=>r(o).data_fim=d),label:"Data Fim",placeholder:"dd/mm/yyyy"},null,8,["modelValue"]),[[c,"##/##/####"]])]),_:1})]),_:1})]),e(O,{class:"my-6"}),u("div",ce,[e(b,null,{default:l(()=>[e(i,{cols:"12",",":"",sm:"6",md:"4"}),e(i,{cols:"12",",":"",sm:"6",md:"4"},{default:l(()=>a[6]||(a[6]=[u("h3",{class:"text-h6 mb-4"},"Gerar Arquivo",-1)])),_:1})]),_:1}),e(de,{modelValue:r(o).validar,"onUpdate:modelValue":a[2]||(a[2]=d=>r(o).validar=d),class:"mt-2"},{default:l(()=>[e(b,null,{default:l(()=>[e(i,{cols:"12",sm:"6",md:"4",lg:"2-4"},{default:l(()=>[e(V,{label:"VALIDAR ATOS",value:"ATOS",color:"primary"})]),_:1}),e(i,{cols:"12",sm:"6",md:"4",lg:"2-4"},{default:l(()=>[e(V,{label:"CESDI",value:"CESDI",color:"primary"})]),_:1}),e(i,{cols:"12",sm:"6",md:"4",lg:"2-4"},{default:l(()=>[e(V,{label:"CEP",value:"CEP",color:"primary"})]),_:1}),e(i,{cols:"12",sm:"6",md:"4",lg:"2-4"}),e(i,{cols:"12",sm:"6",md:"4",lg:"2-4"},{default:l(()=>[e(V,{label:"RCTO",value:"RCTO",color:"primary"})]),_:1}),e(i,{cols:"12",sm:"6",md:"4",lg:"2-4"},{default:l(()=>[e(V,{label:"CCN",value:"CCN",color:"primary"})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),e(O,{class:"my-6"}),u("div",me,[a[7]||(a[7]=u("h3",{class:"text-h6 mb-4"},"Arquivo",-1)),e(b,{align:"center"},{default:l(()=>[e(i,{cols:"12",md:"8"},{default:l(()=>[e(w,{label:"Nome do arquivo",modelValue:r(o).file_name,"onUpdate:modelValue":a[3]||(a[3]=d=>r(o).file_name=d),disabled:!r(o).validar||r(o).validar==="ATOS"},null,8,["modelValue","disabled"])]),_:1}),e(i,{cols:"12",md:"4",class:"d-flex justify-end"},{default:l(()=>[e(n,{text:"Enviar",onSave:S,class:"px-8"})]),_:1})]),_:1})])]),r(_)?(P(),K("div",fe,[u("div",pe,[e(ee,{class:"mr-2"},{default:l(()=>a[8]||(a[8]=[A("mdi-check-circle")])),_:1}),a[9]||(a[9]=A(" Dados CENSEC Retornados "))]),u("div",ve,[u("pre",null,ae(JSON.stringify(r(_),null,2)),1)])])):oe("",!0)]),_:1})}}};export{Se as default};
