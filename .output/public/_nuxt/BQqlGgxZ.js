import{_ as ne}from"./b3bmC0Eh.js";import{_ as ie,a as le}from"./DTK4rYTu.js";import{n as ue,r as u,D as o,F as de,G as ce,o as m,A as g,w as n,x as me,H as pe,b as i,a as l,t as _e,q as a,I as ve,s as S,C as M,d as fe,K as ge,L as be,c as z,J as he}from"./ji4POp3g.js";import{u as O}from"./C8nIubHS.js";import"./7MvDD4y0.js";import{c as G,r as H,u as ke,V as ye,_ as Ce}from"./BTbb00U-.js";import{_ as Ve,a as xe}from"./CrE-eFFQ.js";import{_ as $e,a as we}from"./qu7Wfn_m.js";import{_ as Se}from"./ToPptOUL.js";import{V as Oe}from"./BQJa6PPA.js";import{V as k}from"./KdV-cXDd.js";import{V as y}from"./BOsM5CDP.js";import"./CvFUYNQE.js";const Ee=l("h1",null,"Ordem de Serviço nº ",-1),Te={style:{color:"red","margin-left":"30px"}},De=l("h1",{class:"ml-5"},"Atos",-1),Re=l("img",{style:{width:"45px",height:"45px",cursor:"pointer"},src:Ve,alt:"novo"},null,-1),Ae=l("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:le,alt:"Reimprimir"},null,-1),Ne=[Ae],Fe=["onClick","title"],qe=["disabled","onClick"],Be={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:we,alt:"Visualizar",title:"Reativar"},Ie={key:1,src:xe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px",cursor:"pointer"},title:"Excluir"},Ze={__name:"criar-registro",async setup(Pe){var N,F,q,B,I,P,U;let b,E;const{$toast:_}=ue(),C=me(),J=`${C.public.managemant}/createOrdensServico`,j=`${C.public.managemant}/validarCpf`,K=`${C.public.managemant}/listarAtos`,Q=u(o("user-data").value.cartorio_id),Y=u(o("user-data").value.usuario_id),W=u((N=o("user-service").value)==null?void 0:N.token).value||null,X=u(o("user-data").value.cartorio_token).value,T=u((F=o("user-service").value)==null?void 0:F.numero),h=u((q=o("user-service").value)==null?void 0:q.isDisabled);let D=u(!!((B=o("user-service").value)!=null&&B.numero)),V=u(o("ordem-button").value),x=!1;const $=u(!1),w=u([]),s=de({nacionalidade:(I=o("user-service").value)==null?void 0:I.estrangeiro,apresentante_nome:(P=o("user-service").value)==null?void 0:P.apresentante_nome,apresentante_cpf:(U=o("user-service").value)==null?void 0:U.apresentante_cpf}),v=u(!1),Z=[{title:"Protocolo",value:"protocolo"},{title:"Usuario",value:"usuario_nome"},{title:"Situação",value:"situacao"},{title:"Valor",value:"valor"},{title:"Tipo",value:"tipo"},{value:"actions"}],ee=[{title:"BRASILEIRO",value:!1},{title:"ESTRANGEIRO",value:!0}],ae={apresentante_nome:{required:G.withMessage("O campo é obrigatorio",H)},apresentante_cpf:{required:G.withMessage("O campo é obrigatorio",H)}},c=ke(ae,s);function R(r){if(r)return r.replace(/[.\-]/g,"");r=null}function te(){const r=o("user-service"),t=o("ordem-button");r.value=null,t.value=null}const oe=()=>{$.value=!0};async function se(){const r={apresentante_cpf:R(s.apresentante_cpf),apresentante_nome:s.apresentante_nome,user_id:Y.value,cartorio_id:Q.value,estrangeiro:s.nacionalidade};if(await c.value.$validate()){const{data:t,error:p,status:d}=await O(J,{method:"POST",body:r},"$omLGvLxYlw");if(d.value==="error"&&p.value.statusCode===500)_.error("Erro ao cadastrar ordem,erro no sistema.");else{_.success("Ordem registrada com sucesso!"),D.value=!0,V.value=!1,T.value=t.value.numero;const f=o("ordem-button");f.value=V.value;const e=o("user-service");e.value=e.value=JSON.stringify({numero:t.value.numero,apresentante_cpf:t.value.apresentante_cpf,apresentante_nome:t.value.apresentante_nome,estrangeiro:t.value.estrangeiro,token:t.value.token,isDisabled:!0}),v.value=!0}}}async function re(r){const t=R(r);if(t.length===11&&!x){x=!0;const p={cpf:t};try{const{data:d,error:f,status:e}=await O(j,{method:"POST",body:p},"$e6ybTA3ect");e.value==="error"&&f.value.statusCode===500?_.error("Erro ao cadastrar pessoa, o CPF já está cadastrado."):d.value.cpfValidation===!0?(s.apresentante_nome=d.value.nome,_.success("Cpf autenticado com sucesso!")):d.value.cpfValidation===!1&&_.error("Cpf não cadastrado!")}catch(d){console.error("Erro ao validar CPF:",d)}finally{x=!1}}}const{data:A}=([b,E]=ce(()=>O(K,{method:"POST",body:{cartorio_token:X,ordemserv_token:W}},"$Q1qkHbHde0")),b=await b,E(),b);return A.value.length>0?w.value=A.value:w.value=[],(r,t)=>{const p=ne,d=ie,f=pe("mask");return m(),g(Oe,{class:"mt-5"},{default:n(()=>[i(k,{class:"mb-5"},{default:n(()=>{var e;return[Ee,l("h1",Te,_e(a(T)||((e=("useCookie"in r?r.useCookie:a(o))("user-service").value)==null?void 0:e.numero)),1)]}),_:1}),i(k,null,{default:n(()=>[i(y,{md:"3"},{default:n(()=>[i(ye,{label:"Nacionalidade",items:ee,modelValue:a(s).nacionalidade,"onUpdate:modelValue":t[0]||(t[0]=e=>a(s).nacionalidade=e),disabled:a(h)||a(v)},null,8,["modelValue","disabled"])]),_:1}),i(y,{md:"2"},{default:n(()=>[a(s).nacionalidade===!1?ve((m(),g(S,{key:0,autofocus:"",modelValue:a(s).apresentante_cpf,"onUpdate:modelValue":t[1]||(t[1]=e=>a(s).apresentante_cpf=e),label:"CPF",required:"","error-messages":a(c).apresentante_cpf.$errors.map(e=>e.$message),onBlur:a(c).apresentante_cpf.$touch,onInput:t[2]||(t[2]=e=>re(a(s).apresentante_cpf)),disabled:a(h)||a(v)},null,8,["modelValue","error-messages","onBlur","disabled"])),[[f,"###.###.###-##"]]):(m(),g(S,{key:1,autofocus:"",modelValue:a(s).apresentante_cpf,"onUpdate:modelValue":t[3]||(t[3]=e=>a(s).apresentante_cpf=e),label:"Documento",required:"","error-messages":a(c).apresentante_cpf.$errors.map(e=>e.$message),onBlur:a(c).apresentante_cpf.$touch,disabled:a(h)||a(v)},null,8,["modelValue","error-messages","onBlur","disabled"]))]),_:1}),i(y,{md:"4"},{default:n(()=>[i(S,{modelValue:a(s).apresentante_nome,"onUpdate:modelValue":t[4]||(t[4]=e=>a(s).apresentante_nome=e),label:"Nome Apresentante",required:"","error-messages":a(c).apresentante_nome.$errors.map(e=>e.$message),onInput:a(c).apresentante_nome.$touch,disabled:a(h)||a(v)},null,8,["modelValue","error-messages","onInput","disabled"])]),_:1}),a(V)?(m(),g(y,{key:0},{default:n(()=>[l("div",null,[l("img",{style:{width:"40px",height:"40px",cursor:"pointer"},src:Ce,alt:"Salvar",onClick:t[5]||(t[5]=e=>se())})])]),_:1})):M("",!0)]),_:1}),a(D)?(m(),g(k,{key:0,style:{display:"flex","margin-bottom":"10px",gap:"2rem"}},{default:n(()=>[De,i(p,{to:{path:"/ordens-servicos/criar-ato",query:{origem:"criar"}}},{default:n(()=>[Re]),_:1}),fe(),i(he,{headers:Z,items:a(w),"item-key":"id"},{"item.actions":n(({item:e})=>[i(k,{style:{display:"flex",gap:"10px","margin-top":"-5px"}},{default:n(()=>[l("div",{onClick:t[6]||(t[6]=L=>oe()),title:"Reimprimir"},Ne),l("div",{class:be({disabled:!e.btn_editar}),onClick:L=>e.btn_editar?r.redirectToUpdate(e.id):null,title:e.btn_editar?"Editar":"Desabilitado"},[l("img",{style:ge({cursor:e.btn_editar?"pointer":"default",width:"30px",height:"30px"}),src:$e,alt:"Editar"},null,4)],10,Fe),l("div",{disabled:!e.btn_cancelar,onClick:L=>e.btn_cancelar?r.deleteEndereco(e):null,title:"Excluir"},[e.excluido?(m(),z("img",Be)):(m(),z("img",Ie))],8,qe)]),_:2},1024)]),_:1},8,["items"]),i(d,{show:a($),onClose:t[7]||(t[7]=e=>$.value=!1)},null,8,["show"])]),_:1})):M("",!0),i(p,{to:"/ordens-servicos"},{default:n(()=>[l("img",{class:"btn-pointer mt-5",src:Se,alt:"Sair",onClick:te})]),_:1})]),_:1})}}};export{Ze as default};
