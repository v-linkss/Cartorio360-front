import{_ as we}from"./BhXdtt8G.js";import{_ as xe}from"./DUFir9OT.js";import{c as $e,r as Se,u as Ce}from"./VYaNzKs5.js";import{r as c,e as V,f as oe,g as Z,o as E,h as K,w as r,b as t,a as d,t as ee,d as N,i as a,V as W,j as ie,k as ae,u as ue,s as y,p as Oe,D as De,l as Ue,n as Ae,m as Re,q as J,x as j,v as Q,c as se}from"./BmNTIIJ7.js";import{u as x}from"./D4mFQLWq.js";import{V as te,a as Te,c as qe}from"./PymNcehO.js";import{V as Y}from"./DrYU_EIX.js";import{V as A}from"./DaoQRp90.js";import{V as Ee}from"./D9TOO8Uu.js";import{V as de}from"./BwlwVvi2.js";import{V as v}from"./CuCaVKY2.js";import{_ as Ne}from"./BVz1G1IN.js";import{_ as Ie}from"./D5mDHA92.js";import{_ as Be}from"./Bydcb975.js";import{_ as Me}from"./DvBH9ikW.js";import{_ as Pe}from"./B16moC2y.js";import{_ as ze}from"./Cin7ic8v.js";import{_ as Le,a as Fe}from"./DJvq3mCv.js";import{f as G}from"./B0IxRygJ.js";import{V as X}from"./BLIeWCvD.js";import{V as Je}from"./B613H02_.js";import"./CKvV_-Ho.js";import"./BNKUZkCc.js";import"./2FzWWeTY.js";import"./CMTGoPSW.js";import"./CFBQg8Sf.js";import"./2fSfXmAa.js";import"./Ck4bI0BH.js";import"./j_Z2jkA0.js";import"./CuHAIhU3.js";const je={style:{color:"red","margin-left":"18px"}},Ge={class:"mb-5",style:{display:"flex","justify-content":"flex-start"}},Ke={class:"ml-6"},We={class:"ml-6"},Ye={__name:"Ordem",props:{show:Boolean,numero_os:Number,ordemserv_token:String},emits:["close"],setup(O,{emit:k}){const p=O,u=c(p.show),D=ae();c(V("user-data").value.cartorio_token).value;const g=V("auth_token").value,R=`${D.public.managemant}/analisaCancelamento`,M=`${D.public.managemant}/cancelaOs`,$=oe({motivo:null}),h=c(null),S=k,m={motivo:{required:$e.withMessage("O campo é obrigatorio",Se)}},s=Ce(m,$);Z(()=>p.show,b=>{u.value=b});const _=()=>{u.value=!1,S("close")};(async()=>{const{data:b,error:f}=await x(`${R}`,{method:"POST",body:{ordemserv_token:p.ordemserv_token}},"$1fnrIk2fgs");h.value=b.value.mensagem})();const U=async()=>{if(await s.value.$validate()){const{status:b}=await x(`${M}`,{method:"POST",body:{usuario_token:g,motivo:$.motivo,ordemserv_token:p.ordemserv_token}},"$21WlhUNXeM");b.value==="success"&&(window.location.reload(),_())}};return(b,f)=>(E(),K(de,{persistent:"",modelValue:a(u),"onUpdate:modelValue":f[1]||(f[1]=C=>ie(u)?u.value=C:null),"max-width":"650"},{default:r(()=>[t(te,null,{default:r(()=>[t(Y,null,{default:r(()=>[t(A,{class:"mb-5 mt-1 ml-2"},{default:r(()=>[f[2]||(f[2]=d("h1",null,"Cancelamento da OS nº",-1)),d("h1",je,ee(p.numero_os),1)]),_:1}),t(Y,null,{default:r(()=>[t(te,{variant:"outlined",class:"mb-5"},{default:r(()=>[t(Te,null,{default:r(()=>[N(ee(a(h)),1)]),_:1})]),_:1}),t(Ee,{label:"Motivo",modelValue:a($).motivo,"onUpdate:modelValue":f[0]||(f[0]=C=>a($).motivo=C),required:"","error-messages":a(s).motivo.$errors.map(C=>C.$message),onBlur:a(s).motivo.$touch,onInput:a(s).motivo.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1})]),_:1}),d("div",Ge,[d("div",Ke,[t(W,{size:"large",color:"red",onClick:_},{default:r(()=>f[3]||(f[3]=[N("Fechar")])),_:1})]),d("div",We,[t(W,{size:"large",color:"green",onClick:U},{default:r(()=>f[4]||(f[4]=[N("Salvar")])),_:1})])])]),_:1})]),_:1},8,["modelValue"]))}},He={__name:"ImprecaoRecibo",props:{show:Boolean,apresentante_nome:String,apresentante_cpf:String,visualizar:Boolean,token:String},emits:["close"],setup(O,{emit:k}){const p=O,u=oe({apresentante_nome:p.apresentante_nome,apresentante_cpf:p.apresentante_cpf,token:p.token,usuario_token:V("auth_token").value}),D=k,g=c(p.show),{$toast:R}=ue(),$=`${ae().public.auth}/service/gerencia/emitir_recibo`;Z(()=>p.show,m=>{g.value=m},{immediate:!0}),Z(()=>p,m=>{u.apresentante_nome=m.apresentante_nome,u.apresentante_cpf=m.apresentante_cpf,u.token=m.token},{deep:!0,immediate:!0});const h=()=>{g.value=!1,D("close")};async function S(){var m,s;try{const{data:_,error:T}=await x($,{method:"POST",body:{nome_recibo:u.apresentante_nome,doc_recibo:u.apresentante_cpf,usuario_token:u.usuario_token,os_token:u.token},headers:{Authorization:`Bearer ${u.usuario_token}`}},"$26dgQHax0q");if(console.log(_),_.value){const U=new Blob([_.value],{type:"text/html"}),b=URL.createObjectURL(U);window.open(b,"_blank")}else R.error(((s=(m=T==null?void 0:T.value)==null?void 0:m.data)==null?void 0:s.details)||"Erro ao emitir recibo");h()}catch{R.error("Erro inesperado")}}return(m,s)=>(E(),K(de,{persistent:"",modelValue:a(g),"onUpdate:modelValue":s[2]||(s[2]=_=>ie(g)?g.value=_:null),"max-width":"600"},{default:r(()=>[t(te,null,{default:r(()=>[t(Y,null,{default:r(()=>[t(A,{class:"mt-1 mb-3",style:{"justify-content":"space-between"}},{default:r(()=>s[3]||(s[3]=[d("h1",{class:"ml-4"}," Emitir Recibo ",-1)])),_:1}),t(A,null,{default:r(()=>[t(v,{cols:"12",md:"6"},{default:r(()=>[t(y,{label:"Destinatário",modelValue:a(u).apresentante_nome,"onUpdate:modelValue":s[0]||(s[0]=_=>a(u).apresentante_nome=_),readonly:O.visualizar},null,8,["modelValue","readonly"])]),_:1}),t(v,{cols:"12",md:"6"},{default:r(()=>[t(y,{label:"Documento",modelValue:a(u).apresentante_cpf,"onUpdate:modelValue":s[1]||(s[1]=_=>a(u).apresentante_cpf=_),readonly:O.visualizar},null,8,["modelValue","readonly"])]),_:1})]),_:1})]),_:1}),t(qe,null,{default:r(()=>[t(W,{style:{"background-color":"red",color:"white"},onClick:h},{default:r(()=>s[4]||(s[4]=[N(" Voltar ")])),_:1}),O.visualizar?Oe("",!0):(E(),K(W,{key:0,style:{"background-color":"green",color:"white"},onClick:S},{default:r(()=>s[5]||(s[5]=[N(" Imprimir ")])),_:1}))]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Qe=["title","onClick"],Xe=["onClick","title"],Ze=["onClick","title"],et=["onClick"],tt=["disabled","onClick"],ot={key:0,style:{width:"30px",height:"30px"},src:Le,alt:"Visualizar",title:"Reativar"},at={key:1,src:Fe,alt:"Cancelamento",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},qt={__name:"index",setup(O){const k=ae(),{$toast:p}=ue(),u=`${k.public.managemant}/listarUsuarios`,D=`${k.public.managemant}/listarOrdensServico`,g=`${k.public.managemant}/tipoAtos`;`${k.public.auth}`;const R=`${k.public.biometria}/run-scanner?format=pdf`,M=`${k.public.envioDoc}/upload`,$=De(),h=c(V("auth_token").value)||null,S=c(V("user-data").value.cartorio_token)||null,m=c([]),s=c([]),_=c([]),T=c(["PENDENTE","EM ANDAMENTO","CONCLUÍDA","LAVRADA"]),U=c(!1),b=c(!1),f=c(!1),C=c(null),I=c(null),P=c(null),le=c({}),z=c({});V("auth_token");const n=oe({numero:null,data_inicio:H(),data_fim:H(),data_lavratura_inicio:null,data_lavratura_fim:null,protocolo:null,livro:null,folha:null,situacao:null,usuario_token:h.value,selo:null,ato_tipo_token:null,apresentante:null}),me=[{title:"Data Abertura",value:"dt_abertura",width:"100px"},{title:"Data Recebimento",value:"data",width:"100px"},{title:"Número",value:"numero",width:"10px"},{title:"Situação",value:"situacao",width:"115px"},{title:"CPF",value:"apresentante_cpf",width:"100px"},{title:"Apresentante",value:"apresentante_nome",width:"228px"},{title:"Usuario",value:"usuario_nome",width:"30px"},{title:"Valor",value:"valor",width:"50px"},{title:"A Receber",value:"valor_a_receber",width:"50px"},{value:"actions"}];function H(){const l=new Date,e=l.getFullYear(),i=String(l.getMonth()+1).padStart(2,"0");return`${String(l.getDate()).padStart(2,"0")}-${i}-${e}`}function q(l){if(!l)return null;const[e,i,w]=l.split("/");return`${w}-${i}-${e}`}async function ce(){const{data:l}=await x(u,{method:"POST",body:{cartorio_token:S.value}},"$pAAptWJdb1");s.value=l.value}async function pe(){try{const{data:l}=await x(R,{method:"GET"},"$IO02J210Z9")}catch(l){p.error("Erro ao acionar o scanner:",l)}}async function _e(l){try{const{status:e,data:i}=await x(M,{method:"POST",body:{tipo:"ato_livro",token:l,cartorio_token:V("user-data").value.cartorio_token}},"$YgUhKRJlsV");e.value==="success"&&p.success("Arquivo enviado com sucesso!")}catch(e){p.error(e),console.error("Erro ao enviar o arquivo:",e)}}const ve=async l=>{try{await pe(),await _e(l)}catch(e){console.error("Erro ao executar scanner ou listar arquivos:",e)}};async function fe(){try{sessionStorage.setItem("pesquisaOS",JSON.stringify(n));const{data:l,error:e}=await x(D,{method:"POST",body:{cartorio_token:S.value,numero:n.numero||null,data_inicio:q(n.data_inicio)||null,data_fim:q(n.data_fim)||null,data_lavratura_inicio:q(n.data_lavratura_inicio)||null,data_lavratura_fim:q(n.data_lavratura_fim)||null,protocolo:n.protocolo||null,livro:n.livro||null,folha:n.folha||null,situacao:n.situacao||null,usuario_token:n.usuario_token,selo:n.selo||null,ato_tipo_token:n.ato_tipo_token,apresentante:n.apresentante||null}},"$xKnfARCL4G");l.value.length>0?m.value=l.value.map(i=>({...i,data:i.data?G(i.data,"dd/mm/yyyy"):null,dt_abertura:i.dt_abertura?G(i.dt_abertura,"dd/mm/yyyy"):null})):(m.value=[],p.error("Não existe Ordem de Serviço Registrada!"))}catch(l){console.error("Erro na requisição",l)}}async function be(){const{data:l,error:e}=await x(g,{method:"POST",body:{cartorio_token:S.value,usuario_token:h.value}},"$u0iMyzSv4b");_.value=l.value}const ne=async()=>{try{const l=H(),e=sessionStorage.getItem("pesquisaOS"),i=JSON.parse(e),{data:w,error:re}=await x(D,{method:"POST",body:{cartorio_token:S.value,usuario_token:i.usuario_token||h.value,data_fim:q(i==null?void 0:i.data_fim)||l,data_inicio:q(i==null?void 0:i.data_inicio)||l}},"$F7cqPDSFMb");w.value.length>0?m.value=w.value.map(B=>({...B,data:G(B.data,"dd/mm/yyyy"),dt_abertura:G(B.dt_abertura,"dd/mm/yyyy")})):m.value=[]}catch(l){console.error("Erro ao buscar serviços",l)}};function ye(l){P.value=l.numero,I.value=l.token,b.value=!0}function ke(l){I.value=l.token,z.value.apresentante_nome=l.apresentante_nome,z.value.apresentante_cpf=l.apresentante_cpf,f.value=!0}function Ve(l){const e=V("user-service"),i=m.value.find(w=>w.id===l);e.value=e.value=JSON.stringify({id:i.id,token:i.token}),$.push({path:`/os/atualizar/${l}`})}function ge(l,e){P.value=l,le.value={token:e.token,numero:e.numero,valor:e.valor,valor_pago:e.valor_pago},U.value=!0}const he=()=>{const l=V("user-service"),e=V("ordem-button");l.value=null,C.value=!0,e.value=C.value};return Ue(()=>{Ae(async()=>{const l=sessionStorage.getItem("pesquisaOS");if(l){const e=JSON.parse(l);Object.assign(n,e)}await ne()})}),ce(),be(),(l,e)=>{const i=we,w=xe,re=Ye,B=He,L=Re("mask");return E(),K(Y,{class:"mt-5",style:{width:"100%"}},{default:r(()=>[t(A,{class:"mb-5"},{default:r(()=>[e[17]||(e[17]=d("h1",null,"Ordens de Serviço",-1)),N(" "+ee(a(I))+" ",1),t(i,{to:"/os/criar-registro"},{default:r(()=>[d("img",{style:{width:"60px",height:"60px",cursor:"pointer","margin-left":"70px"},src:Ne,alt:"novo",onClick:he})]),_:1})]),_:1}),t(A,{style:{"margin-bottom":"-35px"}},{default:r(()=>[t(v,null,{default:r(()=>[t(y,{modelValue:a(n).numero,"onUpdate:modelValue":e[0]||(e[0]=o=>a(n).numero=o),label:"Número"},null,8,["modelValue"])]),_:1}),t(v,null,{default:r(()=>[J(t(y,{modelValue:a(n).data_inicio,"onUpdate:modelValue":e[1]||(e[1]=o=>a(n).data_inicio=o),label:"Abertura de",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[L,"##/##/####"]])]),_:1}),t(v,null,{default:r(()=>[J(t(y,{modelValue:a(n).data_fim,"onUpdate:modelValue":e[2]||(e[2]=o=>a(n).data_fim=o),label:"Abertura até",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[L,"##/##/####"]])]),_:1}),t(v,null,{default:r(()=>[J(t(y,{modelValue:a(n).data_lavratura_inicio,"onUpdate:modelValue":e[3]||(e[3]=o=>a(n).data_lavratura_inicio=o),label:"Lavratura de",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[L,"##/##/####"]])]),_:1}),t(v,null,{default:r(()=>[J(t(y,{modelValue:a(n).data_lavratura_fim,"onUpdate:modelValue":e[4]||(e[4]=o=>a(n).data_lavratura_fim=o),label:"Lavratura até",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[L,"##/##/####"]])]),_:1}),t(v,null,{default:r(()=>[t(y,{modelValue:a(n).protocolo,"onUpdate:modelValue":e[5]||(e[5]=o=>a(n).protocolo=o),label:"Protocolo"},null,8,["modelValue"])]),_:1}),t(v,{md:"1"},{default:r(()=>[t(y,{modelValue:a(n).livro,"onUpdate:modelValue":e[6]||(e[6]=o=>a(n).livro=o),label:"Livro"},null,8,["modelValue"])]),_:1}),t(v,{md:"1"},{default:r(()=>[t(y,{modelValue:a(n).folha,"onUpdate:modelValue":e[7]||(e[7]=o=>a(n).folha=o),label:"Folha"},null,8,["modelValue"])]),_:1})]),_:1}),t(A,null,{default:r(()=>[t(v,{md:"3"},{default:r(()=>[t(X,{modelValue:a(n).situacao,"onUpdate:modelValue":e[8]||(e[8]=o=>a(n).situacao=o),items:a(T),label:"Situação"},null,8,["modelValue","items"])]),_:1}),t(v,{md:"2"},{default:r(()=>[t(X,{items:a(s),modelValue:a(n).usuario_token,"onUpdate:modelValue":e[9]||(e[9]=o=>a(n).usuario_token=o),"item-title":"user_nome","item-value":"user_token",label:"Usuario"},null,8,["items","modelValue"])]),_:1}),t(v,{md:"1"},{default:r(()=>[t(y,{modelValue:a(n).selo,"onUpdate:modelValue":e[10]||(e[10]=o=>a(n).selo=o),label:"Selo"},null,8,["modelValue"])]),_:1}),t(v,{md:"3"},{default:r(()=>[t(X,{modelValue:a(n).ato_tipo_token,"onUpdate:modelValue":e[11]||(e[11]=o=>a(n).ato_tipo_token=o),items:a(_),"item-title":"descricao","item-value":"token",label:"Serviço"},null,8,["modelValue","items"])]),_:1}),t(v,{md:"2"},{default:r(()=>[t(y,{modelValue:a(n).apresentante,"onUpdate:modelValue":e[12]||(e[12]=o=>a(n).apresentante=o),label:"Apresentante"},null,8,["modelValue"])]),_:1}),t(v,null,{default:r(()=>[d("div",null,[d("img",{onClick:fe,style:{width:"40px",height:"40px",cursor:"pointer"},src:Ie,alt:"Pesquisar"})])]),_:1})]),_:1}),e[19]||(e[19]=d("hr",{class:"mt-5 mb-5"},null,-1)),t(Je,{headers:me,style:{"min-width":"1230px","font-size":"12px"},items:a(m),"item-key":"id"},{"item.actions":r(({item:o})=>[t(A,{style:{display:"flex",gap:"2px","margin-top":"-5px"}},{default:r(()=>[d("div",{class:Q({disabled:!o.btn_receber}),title:o.btn_receber?"Receber":"Bloqueado",onClick:F=>o.btn_receber?ge(o.numero,o):null},[d("img",{style:j({cursor:o.btn_receber?"pointer":"default",width:"30px",height:"30px"}),src:Be,alt:"Receber"},null,4)],10,Qe),d("div",{class:Q({disabled:!o.btn_editar}),onClick:F=>o.btn_editar?Ve(o.id):null,title:o.btn_editar?"Editar":"Bloqueado"},[d("img",{style:j({cursor:o.btn_editar?"pointer":"default",width:"30px",height:"30px"}),src:Me,alt:"Editar"},null,4)],10,Xe),d("div",{class:Q({disabled:!o.btn_recibo}),onClick:F=>o.btn_recibo?ke(o):null,title:o.btn_recibo?"Emitir Recibo":"Bloqueado"},[d("img",{style:j({cursor:o.btn_recibo?"pointer":"default",width:"30px",height:"30px"}),src:Pe,alt:"Emitir Recibo"},null,4)],10,Ze),d("div",{onClick:F=>ve(o.token)},e[18]||(e[18]=[d("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ze,alt:"escanear",title:"escanear"},null,-1)]),8,et),d("div",{disabled:!o.btn_cancelar,onClick:F=>o.btn_cancelar?ye(o):null,title:"Cancelamento",style:j({opacity:o.btn_cancelar?1:.5,cursor:o.btn_cancelar?"pointer":"not-allowed"})},[o.excluido?(E(),se("img",ot)):(E(),se("img",at))],12,tt)]),_:2},1024)]),_:1},8,["items"]),t(w,{show:a(U),numero_os:a(P),ordem:a(le),onClose:e[13]||(e[13]=o=>U.value=!1),onRefreshValue:e[14]||(e[14]=o=>ne())},null,8,["show","numero_os","ordem"]),t(re,{show:a(b),numero_os:a(P),ordemserv_token:a(I),onClose:e[15]||(e[15]=o=>b.value=!1)},null,8,["show","numero_os","ordemserv_token"]),t(B,{show:a(f),apresentante_nome:a(z).apresentante_nome,apresentante_cpf:a(z).apresentante_cpf,token:a(I),onClose:e[16]||(e[16]=o=>f.value=!1)},null,8,["show","apresentante_nome","apresentante_cpf","token"])]),_:1})}}};export{qt as default};
