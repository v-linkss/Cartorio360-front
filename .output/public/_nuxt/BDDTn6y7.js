import{_ as ce}from"./B_iQQDW6.js";import{_ as me}from"./BbsWu7kM.js";import{_ as de}from"./DPSw-VpV.js";import{_ as pe}from"./OsaHXbyH.js";import{_ as ve}from"./CMOoCs5U.js";import{_ as U}from"./BYgeyS6P.js";import{_ as _e}from"./BVz1G1IN.js";import{_ as fe}from"./WkXpL2yA.js";import{a as ke}from"./DJvq3mCv.js";import{D as he,K as ye,u as ge,r as l,e as y,f as Ve,y as be,c as F,b as t,w as r,i as o,h as we,p as $e,F as xe,k as Pe,o as x,s as T,a as c,V as qe,d as D}from"./CJCWj7KA.js";import{u as v}from"./FRt9fJ3-.js";import{V as P}from"./cv3oliht.js";import{V as _}from"./BhFRe4eS.js";import{V as Ce}from"./C4RgyTQw.js";import{V as I}from"./D2sMbNnM.js";import"./BlZ2gKk2.js";import"./Dlp75PJh.js";import"./DgtUKctJ.js";import"./Bd9ZfPaH.js";import"./B0IxRygJ.js";import"./DaoRTHsy.js";import"./CDD_ornJ.js";import"./BTmYb_yU.js";import"./DUF9hLAZ.js";import"./DvybOB9S.js";import"./5KhuJDLv.js";import"./CUfe1w2D.js";import"./B8q3QhLm.js";import"./Bb5pHQjT.js";import"./CWBJMDfC.js";import"./CS37ATUy.js";import"./CpUxg3O1.js";import"./C0u19z2c.js";const Se=["onClick"],Fe={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:U,alt:"Possui Ficha",title:"Possui Ficha"},Te={key:1,style:{width:"30px",height:"30px",cursor:"pointer"},src:fe,alt:"Visualizar",title:"Não Possui Ficha"},Ee=["onClick"],dt={__name:"semelhanca",props:{ato_token:{type:String,required:!0}},emits:["ato-created"],async setup(K,{emit:L}){var j;let g,E;const W=K,Q=L,z=he(),A=ye(),m=Pe(),{$toast:V}=ge(),Z=`${m.public.managemant}/listarEscrevente`,G=`${m.public.managemant}/pesquisarPessoas`,H=`${m.public.managemant}/atoReconhecimento`,Y=`${m.public.managemant}/etiquetaReconhecimento`,J=`${m.public.managemant}/download`,X=`${m.public.envioDoc}/print`,b=l(y("user-data").value.cartorio_token),ee=l(y("user-service").value.token).value||l(y("user-service").value).value,te=y("auth_token").value,q=l([]),M=l([]),f=l([]),C=l(!1),S=l(!1),w=l(!1),$=l(null),O=l(null),R=l(""),N=[{title:"Documento",align:"start",key:"documento"},{title:"Pessoa",align:"start",key:"nome"},{value:"actions"}],n=Ve({quantidade:1,escrevente:null,nome:null,documento:null}),{data:B}=([g,E]=be(()=>v(Z,{method:"POST",body:{cartorio_token:b}},"$iEFsIjdWdW")),g=await g,E(),g);M.value=Array.isArray(B.value)&&((j=B.value[0])==null?void 0:j.func_json_escreventes)||[];async function oe(){try{const{data:a,error:e}=await v(G,{method:"POST",body:{cartorio_token:b.value,documento:n.documento,nome:n.nome}},"$uzKb8LPV3v");a.value.length>0?(q.value=a.value,Q("ato-created")):q.value=[]}catch(a){console.error("Erro na requisição",a)}}const ae=()=>{S.value=!0};function se(a){f.value.push(a)}const re=async a=>{$.value=a,w.value=!0;const{data:e}=await v(J,{method:"POST",body:{bucket:y("user-data").value.cartorio_token,path:a.link_ficha}},"$MulQmK1LAp");O.value=e.value};function ne(a){f.value=f.value.filter(e=>e.token!==a.token)}async function le(){var e,k,p,u;if(!n.escrevente){V.error("Por favor selecione um Escrevente");return}const a=f.value.map(i=>({pessoa_token:i.token}));try{const{data:i,error:h,status:s}=await v(H,{method:"POST",body:{pessoas:a,cartorio_token:b.value,ordemserv_token:ee,quantidade:n.quantidade,usuario_token:te,ato_tipo_token:W.ato_token}},"$fMGlIlw995");s.value==="success"&&Array.isArray(i.value)&&((e=i.value[0])==null?void 0:e.status)==="OK"?(ie(i.value[0].token),d()):(d(),C.value=!0,R.value=Array.isArray(i.value)&&((k=i.value[0])==null?void 0:k.status_mensagem)||((u=(p=h==null?void 0:h.value)==null?void 0:p.data)==null?void 0:u.details)||"Não foi possível concluir o reconhecimento")}catch(i){d(),V.error("Erro ao reconhecer o ato"),console.error("Erro na requisição",i)}}async function ie(a){try{const{data:e,error:k,status:p}=await v(Y,{method:"POST",body:{ato_token:a,cartorio_token:b.value,escrevente_token:n.escrevente}},"$oSnYNRtP6Z");if(p.value==="success"){if(e.value[0].tipo_etiqueta==="html"){const u=window.open("","_blank");u.document.open(),u.document.write(e.value[0].etiqueta),u.document.close()}else if(e.value[0].tipo_etiqueta==="zpl"){const{status:u}=await v(`${X}`,{method:"POST",body:{zpl:atob(e.value[0].etiqueta)}},"$BtUyHn78O6");if(u.value!=="success"){d(),V.error("Não foi possivel fazer a impressao da etiqueta");return}}}}catch(e){d(),V.error("Erro ao reconhecer a etiqueta"),console.error("Erro na requisição",e)}}const d=()=>{const a=A.query.origem||"criar",e=A.query.id;a==="atualizar"?z.push(`/os/atualizar/${e}`):z.push("/os/criar-registro")};return(a,e)=>{const k=ce,p=me,u=de,i=pe,h=ve;return x(),F(xe,null,[t(P,{class:"mt-5"},{default:r(()=>[t(_,{cols:"5"},{default:r(()=>[t(Ce,{label:"Tabelião/escrevente",modelValue:o(n).escrevente,"onUpdate:modelValue":e[0]||(e[0]=s=>o(n).escrevente=s),items:o(M),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"])]),_:1}),t(_,{cols:"2"},{default:r(()=>[t(T,{label:"Quantidade",type:"number",modelValue:o(n).quantidade,"onUpdate:modelValue":e[1]||(e[1]=s=>o(n).quantidade=s)},null,8,["modelValue"])]),_:1})]),_:1}),t(P,null,{default:r(()=>[t(_,{cols:"3"},{default:r(()=>[t(T,{label:"Documento",modelValue:o(n).documento,"onUpdate:modelValue":e[2]||(e[2]=s=>o(n).documento=s)},null,8,["modelValue"])]),_:1}),t(_,{cols:"4"},{default:r(()=>[t(T,{label:"Pessoa",modelValue:o(n).nome,"onUpdate:modelValue":e[3]||(e[3]=s=>o(n).nome=s)},null,8,["modelValue"])]),_:1}),c("div",null,[c("img",{class:"btn-pointer mt-3",src:U,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:oe})]),c("div",null,[c("img",{class:"btn-pointer mt-3 ml-2",src:_e,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:ae})])]),_:1}),t(P,null,{default:r(()=>[t(_,{class:"mr-10"},{default:r(()=>[t(I,{style:{height:"465px"},headers:N,items:o(q)},{"item.actions":r(({item:s})=>[c("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ue=>re(s),title:"Visualizar Ficha"},[s.link_ficha?(x(),F("img",Fe)):(x(),F("img",Te))],8,Se)]),_:1},8,["items"])]),_:1}),t(_,null,{default:r(()=>[t(I,{headers:N,items:o(f),style:{height:"465px"},"item-key":"id"},{"item.actions":r(({item:s})=>[c("div",{style:{display:"flex","justify-content":"flex-end"},onClick:ue=>ne(s),title:"Remover"},e[8]||(e[8]=[c("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ke,alt:"Remover"},null,-1)]),8,Ee)]),_:1},8,["items"])]),_:1})]),_:1}),t(k,{show:o(S),onClose:e[4]||(e[4]=s=>S.value=!1)},null,8,["show"]),o(w)?(x(),we(p,{key:0,show:o(w),item:o($),"pessoa-obj":o($),"link-view":o(O),onConfirmar:e[5]||(e[5]=s=>se(o($))),onClose:e[6]||(e[6]=s=>w.value=!1)},null,8,["show","item","pessoa-obj","link-view"])):$e("",!0),t(P,null,{default:r(()=>[t(u,{onClick:d},{default:r(()=>[t(qe,{size:"large",color:"red"},{default:r(()=>e[9]||(e[9]=[D("Voltar")])),_:1})]),_:1}),t(i,{class:"ml-5",onSave:le,size:"large",color:"green"},{default:r(()=>e[10]||(e[10]=[D("Salvar ")])),_:1})]),_:1}),t(h,{show:o(C),errorMessage:o(R),onClose:e[7]||(e[7]=s=>C.value=!1)},null,8,["show","errorMessage"])],64)}}};export{dt as default};
