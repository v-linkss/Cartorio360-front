import{_ as re}from"./D4gjJ9of.js";import{c as ge,r as ye,u as he}from"./Cem0PZaX.js";import{H as ze,C as Q,J as ee,u as te,r as n,e as E,f as ne,s as se,o as A,j as X,w as o,b as e,i as t,V as Z,v as G,d as L,l as oe,y as Me,a as v,c as F,k as be,M as De,N as Re,F as Ce,O as we,t as ie}from"./BW5HGLCA.js";import{u as h}from"./BFH9Peh9.js";import{V as M}from"./CafMK_aO.js";import{V as R}from"./CFwDmXSa.js";import{V as ue}from"./9gfQT1hF.js";import{V as de}from"./DFJKrlAb.js";import{_ as je,b as Ie,c as Ne,a as Be}from"./C93RBrBK.js";import{_ as Ue,a as Fe,b as Le,T as We,W as Je,D as Ve,c as Ge}from"./CtNDvqBe.js";import{_ as Ke,r as Pe}from"./BzghFu55.js";import{_ as fe}from"./Jd9P4Rdr.js";import{_ as ce}from"./BVz1G1IN.js";import{_ as Ye}from"./CL9H7gqW.js";import{_ as ke,a as xe}from"./DJvq3mCv.js";import{V as $e}from"./BO5iD1E3.js";import{_ as He}from"./CYipB22z.js";import{V as Xe}from"./USAmhd1w.js";import{f as Ze}from"./B0IxRygJ.js";const jt={__name:"Dados",props:{ato_token:{type:String,required:!0},ato_tipo_id:{type:Number}},emits:["saved"],async setup(W,{emit:y}){let f,g;const b=W;ze(()=>b.ato_tipo_id,_=>{P.value={id:_}});const S=y,x=Q(),V=ee(),B=oe(),{$toast:T}=te(),j=`${B.public.managemant}/listarSituacoes`,N=`${B.public.managemant}/createAtos`;`${B.public.managemant}`;const D=n(E("user-data").value.cartorio_token),$=n(E("user-service").value.id).value||n(E("user-service").value).value,U=n([]),P=n(b.ato_tipo_id?{id:b.ato_tipo_id}:null),p=ne({dt_abertura:null,status:"EM EDIÇÃO",mne:null}),q={status:{required:ge.withMessage("O campo é obrigatorio",ye)}},r=he(q,p);async function l(){if(await r.value.$validate()){const{data:_,error:s,status:m}=await h(N,{method:"POST",body:{ato_tipo_id:P.value.id,cartorio_id:E("user-data").value.cartorio_id,ordemserv_id:$,status:p.status,dt_abertura:p.dt_abertura,mne:p.mne,user_id:E("user-data").value.usuario_id,user_alteracao_id:E("user-data").value.usuario_id}},"$9ZmTYsLk0K");m.value==="success"&&(T.success("Ato registrado com sucesso!"),S("saved",{id:_.value.id,token:_.value.token}))}else T.error("Preencha os campos obrigatorios.")}const{data:i}=([f,g]=se(()=>h(j,{method:"POST",body:{cartorio_token:D.value}},"$hyq5YcBEjF")),f=await f,g(),f);U.value=i.value;const k=()=>{const _=V.query.origem||"criar",s=V.query.id;_==="atualizar"?x.push(`/os/atualizar/${s}`):x.push("/os/criar-registro")};return(_,s)=>{const m=re;return A(),X(de,null,{default:o(()=>[e(M,{class:"mt-5"},{default:o(()=>[e(R,{cols:"3"},{default:o(()=>[e(ue,{label:"Situação",modelValue:t(p).status,"onUpdate:modelValue":s[0]||(s[0]=w=>t(p).status=w),items:t(U),"item-title":"descricao","item-value":"descricao",required:"","error-messages":t(r).status.$errors.map(w=>w.$message),onBlur:t(r).status.$touch,onInput:t(r).status.$touch},null,8,["modelValue","items","error-messages","onBlur","onInput"])]),_:1})]),_:1}),e(M,null,{default:o(()=>[e(R,{cols:"5"},{default:o(()=>[e(Z,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:t(p).mne,"onUpdate:modelValue":s[1]||(s[1]=w=>t(p).mne=w)},null,8,["modelValue"])]),_:1})]),_:1}),e(M,null,{default:o(()=>[e(R,{cols:"2"},{default:o(()=>[e(Z,{modelValue:t(p).dt_abertura,"onUpdate:modelValue":s[2]||(s[2]=w=>t(p).dt_abertura=w),type:"date",label:"Data Lavratura",disabled:"",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(M,{class:"mb-3"},{default:o(()=>[e(m,{onClick:k},{default:o(()=>[e(G,{size:"large",color:"red"},{default:o(()=>s[3]||(s[3]=[L("Voltar")])),_:1})]),_:1}),e(G,{class:"ml-10",onClick:l,size:"large",color:"green"},{default:o(()=>s[4]||(s[4]=[L("Salvar")])),_:1})]),_:1})]),_:1})}}},Qe=["onClick"],et=["onClick"],tt=["onClick"],ot={key:0,style:{width:"30px",height:"30px"},src:ke,alt:"Visualizar",title:"Reativar"},at={key:1,src:xe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},st=["onClick"],It={__name:"Partes",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},async setup(W){let y,f;const g=W,b=Q(),S=ee(),x=oe(),{$toast:V}=te(),B=`${x.public.managemant}/pesquisarPessoas`,T=`${x.public.managemant}/listarPapeis`,j=`${x.public.managemant}/download`,N=`${x.public.managemant}/createAtosPessoa`,D=`${x.public.managemant}/getAtosPessoaById`,$=`${x.public.managemant}/updateAtosPessoa`,U=n(E("user-data").value.cartorio_token),P=n([]),p=n({}),q=n([]),r=n([]),l=n(!1),i=n(!1),k=n(!1),_=n(!1),s=n(null),m=n(null),w=n(null),u=n(null);n(null);const C=n(null),K=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"400px"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome"},{value:"actions"}],d=ne({papeis:null,nome:null,pessoa:null,documento:null});Me(()=>{var c;return((c=d.pessoa)==null?void 0:c.link_ficha)||!1});const{data:Y}=([y,f]=se(()=>h(T,{method:"POST",body:{tipo_ato_token:g.ato_token}},"$fFKndZhA4W")),y=await y,f(),y);r.value=Y.value;async function J(){try{const{data:c,error:a}=await h(B,{method:"POST",body:{cartorio_token:U.value,documento:d.documento,nome:d.nome}},"$o3ZL1rvYrY");c.value.length>0?(P.value=c.value,d.pessoa=P.value[0]):P.value=[]}catch(c){console.error("Erro na requisição",c)}}const I=()=>{i.value=!0},ae=c=>{q.value=q.value.map(a=>a.id===w.value?{...a,papel:{...a.papel,descricao:c}}:a)},H=c=>{const a=q.value.find(O=>O.pessoa.id===u.value);a.representante.nome=c},le=async()=>{const c={pessoa:d.pessoa,papel:r.value.find(O=>O.id===d.papeis),representante:{nome:null}},a=await h(`${D}/${g.ato_id}`,{method:"GET"},"$kXSxUa4grs");for(const O of a.data.value)if(O.pessoa_id===d.pessoa.id&&O.ato_id===g.ato_id&&O.tipo_parte_id===d.papeis){V.error("Pessoa Já Registrada Com Esse Papel!");return}try{const{data:O,error:pe,status:_e}=await h(N,{method:"POST",body:{ato_id:Number(g.ato_id),pessoa_id:d.pessoa.id,tipo_parte_id:d.papeis,user_id:Number(E("user-data").value.usuario_id)}},"$So3qnQu7ek");_e.value==="success"?(c.id=O.value.id,V.success("Pessoa Registrada com Sucesso!"),q.value.push(c)):V.error(pe.value.message)}catch{V.error("Erro no servidor. Tente novamente.")}},me=async c=>{k.value=!0;const{data:a}=await h(j,{method:"POST",body:{bucket:E("user-data").value.cartorio_token,path:c.pessoa.link_ficha}},"$Q3kbIwtd9t");C.value=a.value,p.value=c.pessoa},Ee=c=>{const a=q.value.filter(O=>O.pessoa.id!==c.pessoa.id).map(O=>({id:O.pessoa.id,nome:O.pessoa.nome}));w.value=c.id,s.value=a,l.value=!0,m.value=c.pessoa.nome,u.value=c.pessoa.id},Ae=c=>{w.value=c.id,_.value=!0,m.value=c.pessoa.nome};async function Se(c){c.excluido=!c.excluido;try{await h(`${$}/${w.value}`,{method:"PUT",body:JSON.stringify({excluido:c.excluido})},"$9xStKwGd7o")}catch(a){console.error("Erro ao excluir pessoa:",a)}}const Te=()=>{const c=S.query.origem||"criar",a=S.query.id;c==="atualizar"?b.push(`/os/atualizar/${a}`):b.push("/os/criar-registro")};return(c,a)=>{const O=je,pe=Fe,_e=Le,qe=Ke,Oe=re;return A(),X(de,null,{default:o(()=>[e(M,{class:"mt-5"},{default:o(()=>[e(R,{cols:"3"},{default:o(()=>[e(Z,{label:"Documento",modelValue:t(d).documento,"onUpdate:modelValue":a[0]||(a[0]=z=>t(d).documento=z)},null,8,["modelValue"])]),_:1}),e(R,{cols:"4"},{default:o(()=>[e(Z,{label:"Pessoa",modelValue:t(d).nome,"onUpdate:modelValue":a[1]||(a[1]=z=>t(d).nome=z)},null,8,["modelValue"])]),_:1}),v("div",null,[v("img",{class:"mt-3",src:fe,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:J})]),v("div",null,[v("img",{class:"mt-3 ml-2",src:ce,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:I})])]),_:1}),e(M,null,{default:o(()=>[e(R,{cols:"4"},{default:o(()=>[e(ue,{label:"Selecione a Pessoa",modelValue:t(d).pessoa,"onUpdate:modelValue":a[2]||(a[2]=z=>t(d).pessoa=z),items:t(P),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),e(R,{cols:"3"},{default:o(()=>[e(ue,{label:"Papel",modelValue:t(d).papeis,"onUpdate:modelValue":a[3]||(a[3]=z=>t(d).papeis=z),items:t(r),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),v("div",null,[v("img",{class:"mt-3",src:ce,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:le})])]),_:1}),e(M,null,{default:o(()=>[e(R,null,{default:o(()=>[e($e,{style:{height:"465px"},headers:K,items:t(q)},{"item.actions":o(({item:z})=>[e(M,null,{default:o(()=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ve=>me(z),title:"Visualizar Ficha"},a[8]||(a[8]=[v("img",{style:{width:"30px",height:"30px"},src:fe,alt:"Visualizar"},null,-1)]),8,Qe),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ve=>Ae(z),class:"mr-2",title:"Alterar Papel"},a[9]||(a[9]=[v("img",{style:{width:"30px",height:"30px"},src:Ye,alt:"Visualizar"},null,-1)]),8,et),v("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ve=>Se(z),title:"Deletar Pessoa"},[z.excluido?(A(),F("img",ot)):(A(),F("img",at))],8,tt),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ve=>Ee(z),title:"Selecionar Representante"},a[10]||(a[10]=[v("img",{style:{width:"30px",height:"30px"},src:Ue,alt:"Visualizar"},null,-1)]),8,st)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),e(O,{show:t(i),onClose:a[4]||(a[4]=z=>i.value=!1)},null,8,["show"]),e(pe,{representante_nome:t(m),representantes:t(s),ato_id:t(w),show:t(l),onClose:a[5]||(a[5]=z=>l.value=!1),onUpdateRepresentante:H},null,8,["representante_nome","representantes","ato_id","show"]),e(_e,{representante_nome:t(m),ato_token:g.ato_token,ato_id:t(w),show:t(_),onClose:a[6]||(a[6]=z=>_.value=!1),onUpdatePapel:ae},null,8,["representante_nome","ato_token","ato_id","show"]),t(k)?(A(),X(qe,{key:0,show:t(k),"link-view":t(C),"pessoa-obj":t(p),"is-view":!0,onClose:a[7]||(a[7]=z=>k.value=!1)},null,8,["show","link-view","pessoa-obj"])):be("",!0),e(M,null,{default:o(()=>[e(Oe,{onClick:Te},{default:o(()=>[e(G,{size:"large",color:"red"},{default:o(()=>a[11]||(a[11]=[L("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},rt={key:0,class:"loading-overlay"},nt="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",Nt={__name:"Minuta",props:{ato_token:{type:String,required:!0}},emits:["page","doc"],setup(W,{emit:y}){const f=W;De("DocumentEditorContainer",[We,Je]);const g=oe(),{$toast:b}=te(),S=Q(),x=ee(),V=y;Pe(`${g.public.docEditor}`);const B=`${g.public.managemant}/upload`,T=n(null),j=n(!1),N=async()=>{const l=await T.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),i=new FileReader;i.onload=()=>{const k=i.result;V("doc",k)},i.readAsText(l)},D=async()=>{j.value=!0;try{const l=await T.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),i=new FormData;i.append("file",l,"anexo.docx"),i.append("cartorio_token",E("user-data").value.cartorio_token),i.append("token",f.ato_token),i.append("tipo","ato_minuta");const{data:k,status:_}=await h(B,{method:"POST",body:i},"$071xxdqs20");if(_.value==="success"){b.success("Documento enviado!");const m=T.value.ej2Instances.documentEditor.pageCount;N(),V("page",m)}else b.error("Erro ao enviar documento para o sistema.")}catch(r){b.error("Erro ao salvar documento."),console.error(r)}finally{j.value=!1}},$=async()=>{p(!0);try{await U(),p(!0);const{data:r,status:l}=await h(substituirModelo,{method:"POST",body:{ato_token:f.ato_token}},"$0ktpWliD4l");r.value&&P(r.value)}catch(r){console.error("Erro ao gerar a minuta:",r),b.error("Ocorreu um erro ao gerar a minuta.")}finally{p(!1)}},U=async()=>{try{const{data:r}=await h(baixarDocumento,{method:"POST",body:{bucket:E("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$jXVvQjEE6u"),l=await fetchBlobFromMinIO(r.value);if(l){const i=new FileReader;i.onload=()=>{const k=i.result;T.value.ej2Instances.documentEditor.open(k),V("doc",k)},i.readAsText(l)}}catch(r){console.error("Erro ao carregar o modelo de minuta:",r),b.error("Falha ao carregar o modelo de minuta.")}},P=r=>{const l=T.value.ej2Instances.documentEditor,i=k=>{for(const[_,s]of Object.entries(k))if(/^<<.+>>$/.test(_))try{l.search.findAll(_),l.search.searchResults.length>0&&l.search.searchResults.replaceAll(s)}catch(m){console.error(`Erro ao substituir o marcador ${_}:`,m)}else if(_==="partes"&&Array.isArray(s)&&s.length>0)for(const m of s)typeof m=="object"&&i(m)};i(r)},p=r=>{j.value=r},q=()=>{const r=x.query.origem||"criar",l=x.query.id;r==="atualizar"?S.push(`/os/atualizar/${l}`):S.push("/os/criar-registro")};return(r,l)=>{const i=re;return A(),F(Ce,null,[e(t(Ve),{height:"900px",ref_key:"documentEditorContainer",ref:T,serviceUrl:nt,enableToolbar:!0,enableWordExport:!0},null,512),t(j)?(A(),F("div",rt,[e(Re,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):be("",!0),e(M,{class:"ml-4 mt-4 mb-4"},{default:o(()=>[e(i,{class:"mr-4"},{default:o(()=>[e(G,{size:"large",onClick:q,color:"red"},{default:o(()=>l[0]||(l[0]=[L("Voltar")])),_:1})]),_:1}),e(G,{size:"large",color:"green",onClick:D,disabled:t(j)},{default:o(()=>l[1]||(l[1]=[L("Salvar")])),_:1},8,["disabled"]),e(G,{class:"ml-4",size:"large",color:"blue",onClick:$},{default:o(()=>l[2]||(l[2]=[L("Gerar Minuta")])),_:1})]),_:1})],64)}}},lt=["innerHTML"],Bt={__name:"Livro",props:{ato_token:{type:String,required:!0},pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(W){let y,f;const g=W,b=oe();Pe(`${b.public.docEditor}`);const{$toast:S}=te(),x=Q(),V=ee(),B=`${b.public.managemant}/listarEscrevente`,T=`${b.public.managemant}/lavrarAto`,j=`${b.public.managemant}/valida_lavratura`,N=n("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),D=n(!1),$=n(null),U=n(null),P=n(null),p=n(E("user-data").value.cartorio_token),q=E("auth_token").value,r=n([]),l=n({}),i=n(null),k=n(""),_=ne({escrevente:null}),s=async(J=!1)=>{if(!J){const{data:H}=await h(j,{method:"POST",body:{ato_token:g.ato_token}},"$ZKnVBNYxp9"),le=H.value[0].status,me=H.value[0].status_mensagem;if(le!=="OK"){i.value=le,k.value=me,l.value=null,D.value=!0,N.value="O ato apresenta inconsistências, deseja prosseguir?";return}}const{data:I,status:ae}=await h(T,{method:"POST",body:{ato_token:g.ato_token,qtd_paginas:g.pages,escrevente_token:_.escrevente,usuario_token:q,cartorio_token:p}},"$XouuxOFIWh");ae.value==="success"?($.value=I.value,U.value=I.value[0].selo,S.success("Ato lavrado com sucesso!")):S.error("Falha ao lavrar o ato.")},m=()=>{D.value=!1,i.value=null,k.value="",l.value={}},w=async()=>{const{data:J,status:I}=await h(calculaAto,{method:"POST",body:{ato_token:V.query.ato_token_edit,cartorio_token:p,quantidade:1,usuario_token:q,escrevente_token:_.escrevente,qtd_paginas:g.pages}},"$R51FaaSzOI");I.value==="success"?l.value=J.value[0]:S.error("Falha ao calcular o ato.")},u=async()=>{D.value=!1,i.value&&i.value!=="OK"?(await s(!0),i.value=null,k.value=""):await s()},C=async()=>{D.value=!0,await w()},{data:K}=([y,f]=se(()=>h(B,{method:"POST",body:{cartorio_token:p}},"$JCPnpnnRzP")),y=await y,f(),y);r.value=K.value[0].func_json_escreventes;const d=function(){P.value.ej2Instances.documentEditor.open(g.document)},Y=()=>{const J=V.query.origem||"criar",I=V.query.id;J==="atualizar"?x.push(`/os/atualizar/${I}`):x.push("/os/criar-registro")};return(J,I)=>{const ae=He;return A(),F(Ce,null,[e(M,null,{default:o(()=>[e(R,null,{default:o(()=>[(A(),X(t(Ve),{restrictEditing:!0,enableToolbar:!1,created:g.document?d:null,ref_key:"documentEditorContainer",ref:P,height:"850px",width:"850px",key:g.document},null,8,["created"]))]),_:1}),e(R,null,{default:o(()=>[e(ue,{class:"mt-15",label:"Tabelião/escrevente",modelValue:t(_).escrevente,"onUpdate:modelValue":I[0]||(I[0]=H=>t(_).escrevente=H),items:t(r),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),v("div",null,[v("div",null,[v("img",{onClick:I[1]||(I[1]=H=>C()),class:"ml-2",style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:Ge}),t($)?(A(),X(Xe,{key:0,class:"mr-16"},{default:o(()=>[e(M,{"no-gutters":""},{default:o(()=>[e(R,null,{default:o(()=>[e(we,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:o(()=>[e(R,null,{default:o(()=>[L(" Livro: "+ie(t($)[0].livro_numero),1)]),_:1}),e(R,null,{default:o(()=>[L(" Protocolo: "+ie(t($)[0].protocolo?t($)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),e(R,null,{default:o(()=>[e(we,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:o(()=>[L(" Folhas : "+ie(t($)[0].pagina_inicial)+" A "+ie(t($)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),v("div",{innerHTML:t(U)},null,8,lt)]),_:1})):be("",!0)])])]),_:1})]),_:1}),e(G,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:Y},{default:o(()=>I[2]||(I[2]=[L("Voltar")])),_:1}),e(ae,{show:t(D),condMessage:t(N),valor:t(l),description:t(k),onClose:m,onConfirm:u},null,8,["show","condMessage","valor","description"])],64)}}},it=["onClick"],ut={key:0,style:{width:"30px",height:"30px"},src:ke,alt:"Visualizar",title:"Reativar"},ct={key:1,src:xe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Ut={__name:"Observacao",props:{ato_id:{type:Number,required:!0}},async setup(W){let y,f;const g=W,b=Q(),S=ee(),x=oe(),{$toast:V}=te(),B=`${x.public.managemant}/listarEscrevente`,T=`${x.public.managemant}/getAtosTiposByToken`,j=`${x.public.managemant}/atos_observacao`,N=`${x.public.managemant}/atos_observacao`,D=n(E("user-data").value.cartorio_token),$=n([]),U=n([]),P=[{title:"Data",align:"start",key:"data"},{title:"Escrevente",align:"start",key:"escrevente"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}],p=ne({observacao:null}),q={observacao:{required:ge.withMessage("O campo é obrigatorio",ye)}},r=he(q,p);[y,f]=se(()=>h(`${T}/${g.ato_token}`,{method:"GET"},"$aJM1TL1buW")),y=await y,f();async function l(){if(await r.value.$validate()){const{data:s,error:m,status:w}=await h(j,{method:"POST",body:{ato_id:g.ato_id,observacao:p.observacao,user_id:E("user-data").value.usuario_id}},"$dMg99jeUNP");w.value==="success"&&($.value.push({data:Ze(s.value.created,"dd/mm/yyyy hh:mm"),observacao:s.value.observacao,id:s.value.id,escrevente:E("user-data").value.nome}),V.success("Observação registrada com sucesso"))}else V.error("Preencha os campos obrigatorios.")}async function i(s){s.excluido=!s.excluido;try{await h(`${N}/${s.id}`,{method:"PUT",body:JSON.stringify({excluido:s.excluido})},"$B6PdRx8Gp4")}catch(m){console.error("Erro ao excluir observacao:",m)}}const{data:k}=([y,f]=se(()=>h(B,{method:"POST",body:{cartorio_token:D}},"$xFHPGua26S")),y=await y,f(),y);U.value=k.value[0].func_json_escreventes;const _=()=>{const s=S.query.origem||"criar",m=S.query.id;s==="atualizar"?b.push(`/os/atualizar/${m}`):b.push("/os/criar-registro")};return(s,m)=>{const w=re;return A(),X(de,null,{default:o(()=>[e(M,{class:"mt-5"},{default:o(()=>[e(Z,{label:"Observação",modelValue:t(p).observacao,"onUpdate:modelValue":m[0]||(m[0]=u=>t(p).observacao=u),required:"","error-messages":t(r).observacao.$errors.map(u=>u.$message),onBlur:t(r).observacao.$touch,onInput:t(r).observacao.$touch},null,8,["modelValue","error-messages","onBlur","onInput"]),v("div",null,[v("img",{class:"btn-pointer ml-2",src:ce,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:l})])]),_:1}),e(M,null,{default:o(()=>[e(R,null,{default:o(()=>[e($e,{style:{height:"465px"},headers:P,items:t($)},{"item.actions":o(({item:u})=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:C=>i(u),title:"Deletar Observação"},[u.excluido?(A(),F("img",ut)):(A(),F("img",ct))],8,it)]),_:1},8,["items"])]),_:1})]),_:1}),e(M,null,{default:o(()=>[e(w,{onClick:_},{default:o(()=>[e(G,{size:"large",color:"red"},{default:o(()=>m[1]||(m[1]=[L("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},dt={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ie,alt:"Criar"},mt={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ne,alt:"Criar"},pt={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Be,alt:"Criar"},_t=["onClick"],vt=["onClick"],ft=["onClick"],gt={key:0,style:{width:"30px",height:"30px"},src:ke,alt:"Visualizar",title:"Reativar"},yt={key:1,src:xe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Ft={__name:"Anexos",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},setup(W){const y=W,f=oe(),{$toast:g}=te(),b=Q(),S=ee(),x=`${f.public.biometria}/run-scanner`,V=`${f.public.managemant}/atos_anexos`,B=`${f.public.managemant}/atos_anexos`,T=`${f.public.managemant}/download`;`${f.public.managemant}`,`${f.public.managemant}`;const j=n(!1),N=n(null),D=n([]);E("pessoa_token");const $=ne({descricao:"",fileEvent:null}),U={descricao:{required:ge.withMessage("O campo é obrigatório",ye)}},P=he(U,$,{$autoDirty:!0}),p=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}];async function q(){try{await r(),await l()}catch(u){console.error("Erro ao executar scanner ou listar arquivos:",u)}}async function r(){try{const{data:u}=await h(x,{method:"GET"},"$WazoKp68Tw")}catch(u){g.error("Erro ao acionar o scanner:",u)}}async function l(){try{const{data:u,status:C}=await h("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:S.query.ato_token_edit,cartorio_token:E("user-data").value.cartorio_token}},"$03Wxiia3aI")}catch(u){console.error("Erro ao enviar o arquivo:",u)}}const i=async()=>{j.value=!0};function k(u){return u?!0:(console.error("Erro: Nenhum arquivo foi selecionado!"),N.value=!1,!1)}const _=async()=>{if(P.value.$touch(),!P.value.$invalid&&k($.fileEvent)){const{data:u,error:C,status:K}=await h(V,{method:"POST",body:{ato_id:y.ato_id,descricao:$.descricao,user_id:E("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$WyW0hasRPI");K.value==="success"&&(g.success("Anexo registrado com sucesso!"),D.value.push(u.value))}};async function s(u){u.excluido=!u.excluido;try{await h(`${B}/${u.id}`,{method:"PUT",body:JSON.stringify({excluido:u.excluido})},"$Y3y6TjqbSV")}catch(C){console.error("Erro ao excluir pessoa:",C)}}async function m(u){try{const C=await h(`${T}`,{method:"POST",body:{bucket:E("user-data").value.cartorio_token,path:u.link}},"$bkXJSi7s76"),d=await(await fetch(C.data.value)).blob(),Y=URL.createObjectURL(d);window.open(Y,"_blank")}catch(C){console.error("Erro ao excluir pessoa:",C)}}const w=()=>{const u=S.query.origem||"criar",C=S.query.id;u==="atualizar"?b.push(`/os/atualizar/${C}`):b.push("/os/criar-registro")};return(u,C)=>{const K=re;return A(),X(de,null,{default:o(()=>[e(M,null,{default:o(()=>[e(R,{cols:"5",class:"mt-2"},{default:o(()=>[e(Z,{modelValue:t($).descricao,"onUpdate:modelValue":[C[0]||(C[0]=d=>t($).descricao=d),t(P).descricao.$touch],"error-messages":t(P).descricao.$errors.map(d=>d.$message),onBlur:t(P).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"])]),_:1}),v("div",{onClick:q,title:"Criar",style:{"padding-right":"10px"}},[t(N)===!1?(A(),F("img",dt)):t(N)===!0?(A(),F("img",mt)):(A(),F("img",pt))]),v("div",{onClick:_,title:"Criar"},C[1]||(C[1]=[v("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:ce,alt:"Escanear"},null,-1)]))]),_:1}),e($e,{headers:p,items:t(D),style:{height:"465px","max-width":"600px"}},{"item.actions":o(({item:d})=>[e(M,null,{default:o(()=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:Y=>i(d),title:"Visualizar Anexo"},[v("img",{style:{width:"30px",height:"30px"},onClick:Y=>m(d),src:fe,alt:"Visualizar"},null,8,vt)],8,_t),v("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:Y=>s(d),title:"Deletar Pessoa"},[d.excluido?(A(),F("img",gt)):(A(),F("img",yt))],8,ft)]),_:2},1024)]),_:1},8,["items"]),e(K,{onClick:w},{default:o(()=>[e(G,{size:"large",color:"red"},{default:o(()=>C[2]||(C[2]=[L("Voltar")])),_:1})]),_:1})]),_:1})}}};export{jt as _,It as a,Nt as b,Bt as c,Ut as d,Ft as e};
