import{u as R,r as b,E as B,p as F,c as O,s as l,C as P,J as U,b as s,w as r,F as A,A as Z,m as j,o as k,O as J,V as y,z as X,d as z,v as Y,t as G}from"./DoeH222v.js";import{u as m}from"./D54izRXI.js";import{f as H}from"./B0IxRygJ.js";import{V as M}from"./D8rQi_Ev.js";import{V as Q}from"./hzZI-fNQ.js";import{V as f}from"./C2LQTfeI.js";import{V as q}from"./CuEEixuk.js";import{b as I}from"./CE8nxbfG.js";import"./dgcpfJyS.js";import"./DjNzDVgy.js";import"./GcBdd_TI.js";const ce={__name:"index",setup(K){const u=Z(),{$toast:c}=R(),x=`${u.public.managemant}/lista_selos_transmitir`,E=`${u.public.managemant}/integra_selos`,h=`${u.public.ws}/enviar_ato`,D=`${u.public.managemant}/marcar_selos_enviado`,d=b([]),g=b([]),p=b(!1),a=B({data_utilizacao:"",descricao:"",numero:""}),$=[{title:"Data",value:"data_utilizacao"},{title:"Descrição",value:"descricao"},{title:"Número",value:"numero"}],N=async()=>{p.value=!0;try{const{data:t,error:e,status:o}=await m(x,{method:"POST",body:{cartorio_token:j("user-data").value.cartorio_token}},"$Xe0bfknJZY");o.value==="success"?g.value=Array.isArray(t.value)?t.value.map(i=>({...i,data_utilizacao:i.data_utilizacao?H(i.data_utilizacao,"dd/mm/yyyy hh:mm"):null})):[]:console.error(e)}catch(t){console.error("Erro ao buscar selos:",t)}finally{p.value=!1}},T=async()=>{const t=d.value.map(n=>({selo_token:n})),{data:e,error:o,status:i}=await m(E,{method:"POST",body:t,onResponseError({response:n}){var V;const v=((V=n._data)==null?void 0:V.details)||"Erro ao buscar lote de selos.";c.error(v)}},"$Bhrd8mFcH5");if(i.value==="success"){const n=e.value,{data:v,error:V,status:w}=await m(h,{method:"POST",body:{user:"56415451472",pass:"Ra961206",xmlData:n,onResponseError({response:C}){var S;const _=((S=C._data)==null?void 0:S.details)||"Erro ao buscar lote de selos.";c.error(_)}}},"$QOGY8cy73o");if(w.value==="success"||w.value==="error"){const{error:C,status:_}=await m(D,{method:"PUT",body:v},"$ZZswjXVZN8");_.value==="success"?c.success("Selos marcados como enviados com sucesso"):c.error("Erro ao marcar os selos como enviados")}}},L=F(()=>g.value.filter(t=>(!a.data_utilizacao||t.data_utilizacao.toLowerCase().includes(a.data_utilizacao.toLowerCase()))&&(!a.numero||t.numero.toLowerCase().includes(a.numero.toLowerCase()))&&(!a.descricao||t.descricao.toLowerCase().includes(a.descricao.toLowerCase()))));return N(),(t,e)=>(k(),O(A,null,[l(p)?(k(),P(J,{key:0,class:"d-flex justify-center align-center",indeterminate:"",size:"64",style:{position:"absolute",top:"40%",left:"50%"}})):U("",!0),s(M,{class:"mt-5"},{default:r(()=>[s(Q,{class:"d-flex align-center"},{default:r(()=>[s(f,{cols:"12",md:"2"},{default:r(()=>[s(y,{modelValue:l(a).data_utilizacao,"onUpdate:modelValue":e[0]||(e[0]=o=>l(a).data_utilizacao=o),label:"Data",variant:"outlined","hide-details":"",class:"mb-4"},null,8,["modelValue"])]),_:1}),s(f,{cols:"12",md:"3"},{default:r(()=>[s(y,{modelValue:l(a).descricao,"onUpdate:modelValue":e[1]||(e[1]=o=>l(a).descricao=o),label:"Descrição",variant:"outlined","hide-details":"",class:"mb-4"},null,8,["modelValue"])]),_:1}),s(f,{cols:"12",md:"2"},{default:r(()=>[s(y,{modelValue:l(a).numero,"onUpdate:modelValue":e[2]||(e[2]=o=>l(a).numero=o),label:"Número",variant:"outlined","hide-details":"",class:"mb-4"},null,8,["modelValue"])]),_:1}),s(f,{cols:"12",md:"5",class:"d-flex justify-end mb-2"},{default:r(()=>[s(X,{color:"green",size:"large",onClick:T},{default:r(()=>e[4]||(e[4]=[z("Enviar Selos")])),_:1})]),_:1})]),_:1}),s(q,{"show-select":"",density:"compact",headers:$,items:l(L),"item-key":"token","item-value":"token",modelValue:l(d),"onUpdate:modelValue":e[3]||(e[3]=o=>Y(d)?d.value=o:null)},{"item.situacao":r(({item:o})=>[s(I,{color:"green","text-color":"white",outlined:""},{default:r(()=>[z(G(o.situacao),1)]),_:2},1024)]),_:1},8,["items","modelValue"])]),_:1})],64))}};export{ce as default};
