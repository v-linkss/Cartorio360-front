import{_ as ue}from"./CkUsz-A1.js";import{_ as ce}from"./sVOonfXt.js";import{_ as me}from"./BXGxpbH_.js";import{_ as de}from"./DOc5oAB_.js";import{_ as j}from"./TioMVpdk.js";import{_ as pe}from"./BVz1G1IN.js";import{_ as ve}from"./0SG5u-vv.js";import{a as _e}from"./DJvq3mCv.js";import{L as fe,M as ke,u as he,r as l,m as _,n as ye,D as ge,c as C,b as o,w as r,v as a,x as Ve,y as we,F as be,z as xe,o as w,V as P,a as u,E as R,d as B}from"./jNRvdYSc.js";import{u as m}from"./BXhetWJD.js";import{V as b}from"./CRIxyrsP.js";import{V as d}from"./BUfhigB7.js";import{V as $e}from"./B5LTd4UV.js";import{V as N}from"./CB_MsP2q.js";import"./A-JWE82C.js";import"./D3cOl09K.js";import"./xH0o6Zd0.js";import"./vxCqYvDh.js";import"./B0IxRygJ.js";import"./B-HEFmEe.js";import"./DIeteNUM.js";import"./BSzrTJU7.js";import"./G-FIzmQ3.js";import"./BMli1kaz.js";import"./C8yst81n.js";import"./DTk-1k_d.js";import"./Bjzi7n50.js";import"./LS_FHW_4.js";import"./C__bFiYR.js";const qe=["onClick"],Ce={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:j,alt:"Possui Ficha",title:"Possui Ficha"},Pe={key:1,style:{width:"30px",height:"30px",cursor:"pointer"},src:ve,alt:"Visualizar",title:"Não Possui Ficha"},Ee=["onClick"],rt={__name:"autencidade",props:{ato_token:{type:String,required:!0}},emits:["ato-created"],async setup(D,{emit:U}){let f,E;const I=D,K=U,F=fe(),T=ke(),c=xe(),{$toast:z}=he(),Z=`${c.public.managemant}/listarEscrevente`,L=`${c.public.managemant}/pesquisarPessoas`,H=`${c.public.managemant}/atoReconhecimento`,Q=`${c.public.managemant}/etiquetaAutenticidade`,W=`${c.public.managemant}/download`,Y=`${c.public.envioDoc}/print`,k=l(_("user-data").value.cartorio_token),G=l(_("user-service").value.token).value||l(_("user-service").value).value,J=_("auth_token").value,x=l([]),M=l([]),p=l([]),h=l(!1),$=l(!1),y=l(!1),g=l(null),O=l(null),q=l(""),S=[{title:"Documento",align:"start",key:"documento"},{title:"Pessoa",align:"start",key:"nome"},{value:"actions"}],n=ye({quantidade:1,escrevente:null,nome:null,documento:null}),{data:X}=([f,E]=ge(()=>m(Z,{method:"POST",body:{cartorio_token:k}},"$qpB20nOlUE")),f=await f,E(),f);M.value=X.value[0].func_json_escreventes;async function ee(){try{const{data:t,error:e}=await m(L,{method:"POST",body:{cartorio_token:k.value,documento:n.documento,nome:n.nome}},"$CfpM9wZnUE");t.value.length>0?(K("ato-created"),x.value=t.value):x.value=[]}catch(t){console.error("Erro na requisição",t)}}const te=()=>{$.value=!0};function oe(t){p.value.push(t)}const ae=async t=>{g.value=t,y.value=!0;const{data:e}=await m(W,{method:"POST",body:{bucket:_("user-data").value.cartorio_token,path:t.link_ficha}},"$LrKAtpxZwH");O.value=e.value};function se(t){p.value=p.value.filter(e=>e.token!==t.token)}async function re(){if(!n.escrevente){z.error("Por favor selecione um Escrevente");return}try{const t=p.value.map(i=>({pessoa_token:i.token})),{data:e,error:V,status:v}=await m(H,{method:"POST",body:{pessoas:t,cartorio_token:k.value,ordemserv_token:G,quantidade:n.quantidade,usuario_token:J,ato_tipo_token:I.ato_token}},"$EE94jKo1pQ");v.value==="success"&&e.value[0].status==="OK"?(ne(e.value[0].token),A()):(h.value=!0,q.value=ato_token.value.status_mensagem||V.value.data.details)}catch(t){h.value=!0,q.value=t,console.error("Erro na requisição",t)}}async function ne(t){try{const{data:e,error:V,status:v}=await m(Q,{method:"POST",body:{ato_token:t,cartorio_token:k.value,escrevente_token:n.escrevente}},"$KyoIzBxZyr");if(v.value==="success"){if(e.value[0].tipo_etiqueta==="html"){const i=window.open("","_blank");i.document.open(),i.document.write(e.value[0].etiqueta),i.document.close()}else if(e.value[0].tipo_etiqueta==="zpl"){const{status:i}=await m(`${Y}`,{method:"POST",body:{zpl:atob(e.value[0].selo)}},"$Vem9mHWYqw");if(i.value!=="success"){z.error("Não foi possivel fazer a impressao da etiqueta");return}}}}catch(e){console.error("Erro na requisição",e)}}const A=()=>{const t=T.query.origem||"criar",e=T.query.id;t==="atualizar"?F.push(`/os/atualizar/${e}`):F.push("/os/criar-registro")};return(t,e)=>{const V=ue,v=ce,i=me,le=de;return w(),C(be,null,[o(b,{class:"mt-5"},{default:r(()=>[o(d,{cols:"5"},{default:r(()=>[o($e,{label:"Tabelião/escrevente",modelValue:a(n).escrevente,"onUpdate:modelValue":e[0]||(e[0]=s=>a(n).escrevente=s),items:a(M),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"])]),_:1}),o(d,{cols:"2"},{default:r(()=>[o(P,{label:"Quantidade",type:"number",modelValue:a(n).quantidade,"onUpdate:modelValue":e[1]||(e[1]=s=>a(n).quantidade=s)},null,8,["modelValue"])]),_:1})]),_:1}),o(b,null,{default:r(()=>[o(d,{cols:"3"},{default:r(()=>[o(P,{label:"Documento",modelValue:a(n).documento,"onUpdate:modelValue":e[2]||(e[2]=s=>a(n).documento=s)},null,8,["modelValue"])]),_:1}),o(d,{cols:"4"},{default:r(()=>[o(P,{label:"Pessoa",modelValue:a(n).nome,"onUpdate:modelValue":e[3]||(e[3]=s=>a(n).nome=s)},null,8,["modelValue"])]),_:1}),u("div",null,[u("img",{class:"btn-pointer mt-1",src:j,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:ee})]),u("div",null,[u("img",{class:"btn-pointer mt-1 ml-2",src:pe,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:te})])]),_:1}),o(b,null,{default:r(()=>[o(d,{class:"mr-10"},{default:r(()=>[o(N,{style:{height:"465px"},headers:S,items:a(x)},{"item.actions":r(({item:s})=>[u("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ie=>ae(s),title:"Visualizar Ficha"},[s.link_ficha?(w(),C("img",Ce)):(w(),C("img",Pe))],8,qe)]),_:1},8,["items"])]),_:1}),o(d,null,{default:r(()=>[o(N,{headers:S,items:a(p),style:{height:"465px"},"item-key":"id"},{"item.actions":r(({item:s})=>[u("div",{style:{display:"flex","justify-content":"flex-end"},onClick:ie=>se(s),title:"Remover"},e[8]||(e[8]=[u("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:_e,alt:"Remover"},null,-1)]),8,Ee)]),_:1},8,["items"])]),_:1})]),_:1}),o(V,{show:a($),onClose:e[4]||(e[4]=s=>$.value=!1)},null,8,["show"]),a(y)?(w(),Ve(v,{key:0,show:a(y),item:a(g),"pessoa-obj":a(g),"link-view":a(O),onConfirmar:e[5]||(e[5]=s=>oe(a(g))),onClose:e[6]||(e[6]=s=>y.value=!1)},null,8,["show","item","pessoa-obj","link-view"])):we("",!0),o(i,{show:a(h),errorMessage:a(q),onClose:e[7]||(e[7]=s=>h.value=!1)},null,8,["show","errorMessage"]),o(b,null,{default:r(()=>[o(le,{onClick:A},{default:r(()=>[o(R,{size:"large",color:"red"},{default:r(()=>e[9]||(e[9]=[B("Voltar")])),_:1})]),_:1}),o(R,{class:"ml-5",onClick:re,size:"large",color:"green"},{default:r(()=>e[10]||(e[10]=[B("Salvar")])),_:1})]),_:1})],64)}}};export{rt as default};
