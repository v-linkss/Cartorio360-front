import{_ as se}from"./CavrBkXx.js";import{c as fe,r as ge,u as ye}from"./BNUXEuL6.js";import{H as ze,C as Z,J as Q,u as ee,r as n,e as E,f as re,s as ae,o as A,j as H,w as o,b as e,i as t,V as X,v as G,d as W,l as te,y as Me,a as v,c as L,k as he,M as De,N as Re,F as we,O as $e,t as le}from"./C3EzsdaB.js";import{u as h}from"./Baqe95jG.js";import{V as D}from"./Cs3frXH_.js";import{V as j}from"./CoaXqZL9.js";import{V as ie}from"./C8K3_UaD.js";import{V as ce}from"./mXMVbKbw.js";import{_ as je,b as Ie,c as Ne,a as Be}from"./D3mHWLNR.js";import{_ as Ue,a as Fe,b as Le,T as We,W as Je,D as Ce,c as Ge}from"./B891iuFX.js";import{_ as Ke,r as Ve}from"./C1g9yVux.js";import{_ as ve}from"./DTcumxPl.js";import{_ as ue}from"./BVz1G1IN.js";import{_ as Ye}from"./DHCjYq9T.js";import{_ as be,a as ke}from"./DJvq3mCv.js";import{V as xe}from"./BZZDYKC4.js";import{_ as He}from"./CUuOOHFY.js";import{V as Xe}from"./CtgG7iLN.js";import{f as Ze}from"./B0IxRygJ.js";const jt={__name:"Dados",props:{ato_token:{type:String,required:!0},ato_tipo_id:{type:Number}},emits:["saved"],async setup(J,{emit:y}){let f,g;const b=J;ze(()=>b.ato_tipo_id,_=>{P.value={id:_}});const S=y,k=Z(),V=Q(),U=te(),{$toast:T}=ee(),I=`${U.public.managemant}/listarSituacoes`,N=`${U.public.managemant}/createAtos`;`${U.public.managemant}`;const R=n(E("user-data").value.cartorio_token),x=n(E("user-service").value.id).value||n(E("user-service").value).value,F=n([]),P=n(b.ato_tipo_id?{id:b.ato_tipo_id}:null),p=re({dt_abertura:null,status:"EM EDIÇÃO",mne:null}),q={status:{required:fe.withMessage("O campo é obrigatorio",ge)}},r=ye(q,p);async function l(){if(await r.value.$validate()){const{data:_,error:s,status:m}=await h(N,{method:"POST",body:{ato_tipo_id:P.value.id,cartorio_id:E("user-data").value.cartorio_id,ordemserv_id:x,status:p.status,dt_abertura:p.dt_abertura,mne:p.mne,user_id:E("user-data").value.usuario_id,user_alteracao_id:E("user-data").value.usuario_id}},"$9ZmTYsLk0K");m.value==="success"&&(T.success("Ato registrado com sucesso!"),S("saved",{id:_.value.id,token:_.value.token}))}else T.error("Preencha os campos obrigatorios.")}const{data:i}=([f,g]=ae(()=>h(I,{method:"POST",body:{cartorio_token:R.value}},"$hyq5YcBEjF")),f=await f,g(),f);F.value=i.value;const $=()=>{const _=V.query.origem||"criar",s=V.query.id;_==="atualizar"?k.push(`/os/atualizar/${s}`):k.push("/os/criar-registro")};return(_,s)=>{const m=se;return A(),H(ce,null,{default:o(()=>[e(D,{class:"mt-5"},{default:o(()=>[e(j,{cols:"3"},{default:o(()=>[e(ie,{label:"Situação",modelValue:t(p).status,"onUpdate:modelValue":s[0]||(s[0]=w=>t(p).status=w),items:t(F),"item-title":"descricao","item-value":"descricao",required:"","error-messages":t(r).status.$errors.map(w=>w.$message),onBlur:t(r).status.$touch,onInput:t(r).status.$touch},null,8,["modelValue","items","error-messages","onBlur","onInput"])]),_:1})]),_:1}),e(D,null,{default:o(()=>[e(j,{cols:"5"},{default:o(()=>[e(X,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:t(p).mne,"onUpdate:modelValue":s[1]||(s[1]=w=>t(p).mne=w)},null,8,["modelValue"])]),_:1})]),_:1}),e(D,null,{default:o(()=>[e(j,{cols:"2"},{default:o(()=>[e(X,{modelValue:t(p).dt_abertura,"onUpdate:modelValue":s[2]||(s[2]=w=>t(p).dt_abertura=w),type:"date",label:"Data Lavratura",disabled:"",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(D,{class:"mb-3"},{default:o(()=>[e(m,{onClick:$},{default:o(()=>[e(G,{size:"large",color:"red"},{default:o(()=>s[3]||(s[3]=[W("Voltar")])),_:1})]),_:1}),e(G,{class:"ml-10",onClick:l,size:"large",color:"green"},{default:o(()=>s[4]||(s[4]=[W("Salvar")])),_:1})]),_:1})]),_:1})}}},Qe=["onClick"],et=["onClick"],tt=["onClick"],ot={key:0,style:{width:"30px",height:"30px"},src:be,alt:"Visualizar",title:"Reativar"},at={key:1,src:ke,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},st=["onClick"],It={__name:"Partes",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},async setup(J){let y,f;const g=J,b=Z(),S=Q(),k=te(),{$toast:V}=ee(),U=`${k.public.managemant}/pesquisarPessoas`,T=`${k.public.managemant}/listarPapeis`,I=`${k.public.managemant}/download`,N=`${k.public.managemant}/createAtosPessoa`,R=`${k.public.managemant}/getAtosPessoaById`,x=`${k.public.managemant}/updateAtosPessoa`,F=n(E("user-data").value.cartorio_token),P=n([]),p=n({}),q=n([]),r=n([]),l=n(!1),i=n(!1),$=n(!1),_=n(!1),s=n(null),m=n(null),w=n(null),u=n(null);n(null);const C=n(null),K=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"400px"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome"},{value:"actions"}],d=re({papeis:null,nome:null,pessoa:null,documento:null});Me(()=>{var c;return((c=d.pessoa)==null?void 0:c.link_ficha)||!1});const{data:B}=([y,f]=ae(()=>h(T,{method:"POST",body:{tipo_ato_token:g.ato_token}},"$fFKndZhA4W")),y=await y,f(),y);r.value=B.value;async function O(){try{const{data:c,error:a}=await h(U,{method:"POST",body:{cartorio_token:F.value,documento:d.documento,nome:d.nome}},"$o3ZL1rvYrY");c.value.length>0?(P.value=c.value,d.pessoa=P.value[0]):P.value=[]}catch(c){console.error("Erro na requisição",c)}}const oe=()=>{i.value=!0},Y=c=>{q.value=q.value.map(a=>a.id===w.value?{...a,papel:{...a.papel,descricao:c}}:a)},ne=c=>{const a=q.value.find(z=>z.pessoa.id===u.value);a.representante.nome=c},de=async()=>{const c={pessoa:d.pessoa,papel:r.value.find(z=>z.id===d.papeis),representante:{nome:null}},a=await h(`${R}/${g.ato_id}`,{method:"GET"},"$kXSxUa4grs");for(const z of a.data.value)if(z.pessoa_id===d.pessoa.id&&z.ato_id===g.ato_id&&z.tipo_parte_id===d.papeis){V.error("Pessoa Já Registrada Com Esse Papel!");return}try{const{data:z,error:me,status:pe}=await h(N,{method:"POST",body:{ato_id:Number(g.ato_id),pessoa_id:d.pessoa.id,tipo_parte_id:d.papeis,user_id:Number(E("user-data").value.usuario_id)}},"$So3qnQu7ek");pe.value==="success"?(c.id=z.value.id,V.success("Pessoa Registrada com Sucesso!"),q.value.push(c)):V.error(me.value.message)}catch{V.error("Erro no servidor. Tente novamente.")}},Pe=async c=>{$.value=!0;const{data:a}=await h(I,{method:"POST",body:{bucket:E("user-data").value.cartorio_token,path:c.pessoa.link_ficha}},"$Q3kbIwtd9t");C.value=a.value,p.value=c.pessoa},Ee=c=>{const a=q.value.filter(z=>z.pessoa.id!==c.pessoa.id).map(z=>({id:z.pessoa.id,nome:z.pessoa.nome}));w.value=c.id,s.value=a,l.value=!0,m.value=c.pessoa.nome,u.value=c.pessoa.id},Ae=c=>{w.value=c.id,_.value=!0,m.value=c.pessoa.nome};async function Se(c){c.excluido=!c.excluido;try{await h(`${x}/${w.value}`,{method:"PUT",body:JSON.stringify({excluido:c.excluido})},"$9xStKwGd7o")}catch(a){console.error("Erro ao excluir pessoa:",a)}}const Te=()=>{const c=S.query.origem||"criar",a=S.query.id;c==="atualizar"?b.push(`/os/atualizar/${a}`):b.push("/os/criar-registro")};return(c,a)=>{const z=je,me=Fe,pe=Le,qe=Ke,Oe=se;return A(),H(ce,null,{default:o(()=>[e(D,{class:"mt-5"},{default:o(()=>[e(j,{cols:"3"},{default:o(()=>[e(X,{label:"Documento",modelValue:t(d).documento,"onUpdate:modelValue":a[0]||(a[0]=M=>t(d).documento=M)},null,8,["modelValue"])]),_:1}),e(j,{cols:"4"},{default:o(()=>[e(X,{label:"Pessoa",modelValue:t(d).nome,"onUpdate:modelValue":a[1]||(a[1]=M=>t(d).nome=M)},null,8,["modelValue"])]),_:1}),v("div",null,[v("img",{class:"mt-3",src:ve,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:O})]),v("div",null,[v("img",{class:"mt-3 ml-2",src:ue,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:oe})])]),_:1}),e(D,null,{default:o(()=>[e(j,{cols:"4"},{default:o(()=>[e(ie,{label:"Selecione a Pessoa",modelValue:t(d).pessoa,"onUpdate:modelValue":a[2]||(a[2]=M=>t(d).pessoa=M),items:t(P),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),e(j,{cols:"3"},{default:o(()=>[e(ie,{label:"Papel",modelValue:t(d).papeis,"onUpdate:modelValue":a[3]||(a[3]=M=>t(d).papeis=M),items:t(r),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),v("div",null,[v("img",{class:"mt-3",src:ue,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:de})])]),_:1}),e(D,null,{default:o(()=>[e(j,null,{default:o(()=>[e(xe,{style:{height:"465px"},headers:K,items:t(q)},{"item.actions":o(({item:M})=>[e(D,null,{default:o(()=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:_e=>Pe(M),title:"Visualizar Ficha"},a[8]||(a[8]=[v("img",{style:{width:"30px",height:"30px"},src:ve,alt:"Visualizar"},null,-1)]),8,Qe),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:_e=>Ae(M),class:"mr-2",title:"Alterar Papel"},a[9]||(a[9]=[v("img",{style:{width:"30px",height:"30px"},src:Ye,alt:"Visualizar"},null,-1)]),8,et),v("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:_e=>Se(M),title:"Deletar Pessoa"},[M.excluido?(A(),L("img",ot)):(A(),L("img",at))],8,tt),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:_e=>Ee(M),title:"Selecionar Representante"},a[10]||(a[10]=[v("img",{style:{width:"30px",height:"30px"},src:Ue,alt:"Visualizar"},null,-1)]),8,st)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),e(z,{show:t(i),onClose:a[4]||(a[4]=M=>i.value=!1)},null,8,["show"]),e(me,{representante_nome:t(m),representantes:t(s),ato_id:t(w),show:t(l),onClose:a[5]||(a[5]=M=>l.value=!1),onUpdateRepresentante:ne},null,8,["representante_nome","representantes","ato_id","show"]),e(pe,{representante_nome:t(m),ato_token:g.ato_token,ato_id:t(w),show:t(_),onClose:a[6]||(a[6]=M=>_.value=!1),onUpdatePapel:Y},null,8,["representante_nome","ato_token","ato_id","show"]),t($)?(A(),H(qe,{key:0,show:t($),"link-view":t(C),"pessoa-obj":t(p),"is-view":!0,onClose:a[7]||(a[7]=M=>$.value=!1)},null,8,["show","link-view","pessoa-obj"])):he("",!0),e(D,null,{default:o(()=>[e(Oe,{onClick:Te},{default:o(()=>[e(G,{size:"large",color:"red"},{default:o(()=>a[11]||(a[11]=[W("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},rt={key:0,class:"loading-overlay"},nt="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",Nt={__name:"Minuta",props:{ato_token:{type:String,required:!0}},emits:["page","doc"],setup(J,{emit:y}){const f=J;De("DocumentEditorContainer",[We,Je]);const g=te(),{$toast:b}=ee(),S=Z(),k=Q(),V=y;Ve(`${g.public.docEditor}`);const U=`${g.public.managemant}/upload`,T=n(null),I=n(!1),N=async()=>{const l=await T.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),i=new FileReader;i.onload=()=>{const $=i.result;V("doc",$)},i.readAsText(l)},R=async()=>{I.value=!0;try{const l=await T.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),i=new FormData;i.append("file",l,"anexo.docx"),i.append("cartorio_token",E("user-data").value.cartorio_token),i.append("token",f.ato_token),i.append("tipo","ato_minuta");const{data:$,status:_}=await h(U,{method:"POST",body:i},"$071xxdqs20");if(_.value==="success"){b.success("Documento enviado!");const m=T.value.ej2Instances.documentEditor.pageCount;N(),V("page",m)}else b.error("Erro ao enviar documento para o sistema.")}catch(r){b.error("Erro ao salvar documento."),console.error(r)}finally{I.value=!1}},x=async()=>{p(!0);try{await F(),p(!0);const{data:r,status:l}=await h(substituirModelo,{method:"POST",body:{ato_token:f.ato_token}},"$0ktpWliD4l");r.value&&P(r.value)}catch(r){console.error("Erro ao gerar a minuta:",r),b.error("Ocorreu um erro ao gerar a minuta.")}finally{p(!1)}},F=async()=>{try{const{data:r}=await h(baixarDocumento,{method:"POST",body:{bucket:E("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$jXVvQjEE6u"),l=await fetchBlobFromMinIO(r.value);if(l){const i=new FileReader;i.onload=()=>{const $=i.result;T.value.ej2Instances.documentEditor.open($),V("doc",$)},i.readAsText(l)}}catch(r){console.error("Erro ao carregar o modelo de minuta:",r),b.error("Falha ao carregar o modelo de minuta.")}},P=r=>{const l=T.value.ej2Instances.documentEditor,i=$=>{for(const[_,s]of Object.entries($))if(/^<<.+>>$/.test(_))try{l.search.findAll(_),l.search.searchResults.length>0&&l.search.searchResults.replaceAll(s)}catch(m){console.error(`Erro ao substituir o marcador ${_}:`,m)}else if(_==="partes"&&Array.isArray(s)&&s.length>0)for(const m of s)typeof m=="object"&&i(m)};i(r)},p=r=>{I.value=r},q=()=>{const r=k.query.origem||"criar",l=k.query.id;r==="atualizar"?S.push(`/os/atualizar/${l}`):S.push("/os/criar-registro")};return(r,l)=>{const i=se;return A(),L(we,null,[e(t(Ce),{height:"900px",ref_key:"documentEditorContainer",ref:T,serviceUrl:nt,enableToolbar:!0,enableWordExport:!0},null,512),t(I)?(A(),L("div",rt,[e(Re,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):he("",!0),e(D,{class:"ml-4 mt-4 mb-4"},{default:o(()=>[e(i,{class:"mr-4"},{default:o(()=>[e(G,{size:"large",onClick:q,color:"red"},{default:o(()=>l[0]||(l[0]=[W("Voltar")])),_:1})]),_:1}),e(G,{size:"large",color:"green",onClick:R,disabled:t(I)},{default:o(()=>l[1]||(l[1]=[W("Salvar")])),_:1},8,["disabled"]),e(G,{class:"ml-4",size:"large",color:"blue",onClick:x},{default:o(()=>l[2]||(l[2]=[W("Gerar Minuta")])),_:1})]),_:1})],64)}}},lt=["innerHTML"],Bt={__name:"Livro",props:{ato_token:{type:String,required:!0},pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(J){let y,f;const g=J,b=te();Ve(`${b.public.docEditor}`);const{$toast:S}=ee(),k=Z(),V=Q(),U=`${b.public.managemant}/listarEscrevente`,T=`${b.public.managemant}/lavrarAto`,I=`${b.public.managemant}/valida_lavratura`,N=n("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),R=n(!1),x=n(null),F=n(null),P=n(null),p=n(E("user-data").value.cartorio_token),q=E("auth_token").value,r=n([]),l=n({}),i=n(null),$=n(""),_=re({escrevente:null}),s=async(B=!1)=>{if(!B){const{data:Y}=await h(I,{method:"POST",body:{ato_token:g.ato_token}},"$ZKnVBNYxp9"),ne=Y.value[0].status,de=Y.value[0].status_mensagem;if(ne!=="OK"){i.value=ne,$.value=de,l.value=null,R.value=!0,N.value="O ato apresenta inconsistências, deseja prosseguir?";return}}const{data:O,status:oe}=await h(T,{method:"POST",body:{ato_token:g.ato_token,qtd_paginas:g.pages,escrevente_token:_.escrevente,usuario_token:q,cartorio_token:p}},"$XouuxOFIWh");oe.value==="success"?(x.value=O.value,F.value=O.value[0].selo,S.success("Ato lavrado com sucesso!")):S.error("Falha ao lavrar o ato.")},m=async()=>{const{data:B,status:O}=await h(calculaAto,{method:"POST",body:{ato_token:V.query.ato_token_edit,cartorio_token:p,quantidade:1,usuario_token:q,escrevente_token:_.escrevente,qtd_paginas:g.pages}},"$R51FaaSzOI");O.value==="success"?l.value=B.value[0]:S.error("Falha ao calcular o ato.")},w=async()=>{R.value=!1,i.value&&i.value!=="OK"?(await s(!0),i.value=null,$.value=""):await s()},u=async()=>{R.value=!0,await m()},{data:C}=([y,f]=ae(()=>h(U,{method:"POST",body:{cartorio_token:p}},"$JCPnpnnRzP")),y=await y,f(),y);r.value=C.value[0].func_json_escreventes;const K=function(){P.value.ej2Instances.documentEditor.open(g.document)},d=()=>{const B=V.query.origem||"criar",O=V.query.id;B==="atualizar"?k.push(`/os/atualizar/${O}`):k.push("/os/criar-registro")};return(B,O)=>{const oe=He;return A(),L(we,null,[e(D,null,{default:o(()=>[e(j,null,{default:o(()=>[(A(),H(t(Ce),{restrictEditing:!0,enableToolbar:!1,created:g.document?K:null,ref_key:"documentEditorContainer",ref:P,height:"850px",width:"850px",key:g.document},null,8,["created"]))]),_:1}),e(j,null,{default:o(()=>[e(ie,{class:"mt-15",label:"Tabelião/escrevente",modelValue:t(_).escrevente,"onUpdate:modelValue":O[0]||(O[0]=Y=>t(_).escrevente=Y),items:t(r),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),v("div",null,[v("div",null,[v("img",{onClick:O[1]||(O[1]=Y=>u()),class:"ml-2",style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:Ge}),t(x)?(A(),H(Xe,{key:0,class:"mr-16"},{default:o(()=>[e(D,{"no-gutters":""},{default:o(()=>[e(j,null,{default:o(()=>[e($e,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:o(()=>[e(j,null,{default:o(()=>[W(" Livro: "+le(t(x)[0].livro_numero),1)]),_:1}),e(j,null,{default:o(()=>[W(" Protocolo: "+le(t(x)[0].protocolo?t(x)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),e(j,null,{default:o(()=>[e($e,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:o(()=>[W(" Folhas : "+le(t(x)[0].pagina_inicial)+" A "+le(t(x)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),v("div",{innerHTML:t(F)},null,8,lt)]),_:1})):he("",!0)])])]),_:1})]),_:1}),e(G,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:d},{default:o(()=>O[3]||(O[3]=[W("Voltar")])),_:1}),e(oe,{show:t(R),condMessage:t(N),valor:t(l),description:t($),onClose:O[2]||(O[2]=Y=>R.value=!1),onConfirm:w},null,8,["show","condMessage","valor","description"])],64)}}},it=["onClick"],ut={key:0,style:{width:"30px",height:"30px"},src:be,alt:"Visualizar",title:"Reativar"},ct={key:1,src:ke,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Ut={__name:"Observacao",props:{ato_id:{type:Number,required:!0}},async setup(J){let y,f;const g=J,b=Z(),S=Q(),k=te(),{$toast:V}=ee(),U=`${k.public.managemant}/listarEscrevente`,T=`${k.public.managemant}/getAtosTiposByToken`,I=`${k.public.managemant}/atos_observacao`,N=`${k.public.managemant}/atos_observacao`,R=n(E("user-data").value.cartorio_token),x=n([]),F=n([]),P=[{title:"Data",align:"start",key:"data"},{title:"Escrevente",align:"start",key:"escrevente"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}],p=re({observacao:null}),q={observacao:{required:fe.withMessage("O campo é obrigatorio",ge)}},r=ye(q,p);[y,f]=ae(()=>h(`${T}/${g.ato_token}`,{method:"GET"},"$aJM1TL1buW")),y=await y,f();async function l(){if(await r.value.$validate()){const{data:s,error:m,status:w}=await h(I,{method:"POST",body:{ato_id:g.ato_id,observacao:p.observacao,user_id:E("user-data").value.usuario_id}},"$dMg99jeUNP");w.value==="success"&&(x.value.push({data:Ze(s.value.created,"dd/mm/yyyy hh:mm"),observacao:s.value.observacao,id:s.value.id,escrevente:E("user-data").value.nome}),V.success("Observação registrada com sucesso"))}else V.error("Preencha os campos obrigatorios.")}async function i(s){s.excluido=!s.excluido;try{await h(`${N}/${s.id}`,{method:"PUT",body:JSON.stringify({excluido:s.excluido})},"$B6PdRx8Gp4")}catch(m){console.error("Erro ao excluir observacao:",m)}}const{data:$}=([y,f]=ae(()=>h(U,{method:"POST",body:{cartorio_token:R}},"$xFHPGua26S")),y=await y,f(),y);F.value=$.value[0].func_json_escreventes;const _=()=>{const s=S.query.origem||"criar",m=S.query.id;s==="atualizar"?b.push(`/os/atualizar/${m}`):b.push("/os/criar-registro")};return(s,m)=>{const w=se;return A(),H(ce,null,{default:o(()=>[e(D,{class:"mt-5"},{default:o(()=>[e(X,{label:"Observação",modelValue:t(p).observacao,"onUpdate:modelValue":m[0]||(m[0]=u=>t(p).observacao=u),required:"","error-messages":t(r).observacao.$errors.map(u=>u.$message),onBlur:t(r).observacao.$touch,onInput:t(r).observacao.$touch},null,8,["modelValue","error-messages","onBlur","onInput"]),v("div",null,[v("img",{class:"btn-pointer ml-2",src:ue,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:l})])]),_:1}),e(D,null,{default:o(()=>[e(j,null,{default:o(()=>[e(xe,{style:{height:"465px"},headers:P,items:t(x)},{"item.actions":o(({item:u})=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:C=>i(u),title:"Deletar Observação"},[u.excluido?(A(),L("img",ut)):(A(),L("img",ct))],8,it)]),_:1},8,["items"])]),_:1})]),_:1}),e(D,null,{default:o(()=>[e(w,{onClick:_},{default:o(()=>[e(G,{size:"large",color:"red"},{default:o(()=>m[1]||(m[1]=[W("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},dt={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ie,alt:"Criar"},mt={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ne,alt:"Criar"},pt={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Be,alt:"Criar"},_t=["onClick"],vt=["onClick"],ft=["onClick"],gt={key:0,style:{width:"30px",height:"30px"},src:be,alt:"Visualizar",title:"Reativar"},yt={key:1,src:ke,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Ft={__name:"Anexos",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},setup(J){const y=J,f=te(),{$toast:g}=ee(),b=Z(),S=Q(),k=`${f.public.biometria}/run-scanner`,V=`${f.public.managemant}/atos_anexos`,U=`${f.public.managemant}/atos_anexos`,T=`${f.public.managemant}/download`;`${f.public.managemant}`,`${f.public.managemant}`;const I=n(!1),N=n(null),R=n([]);E("pessoa_token");const x=re({descricao:"",fileEvent:null}),F={descricao:{required:fe.withMessage("O campo é obrigatório",ge)}},P=ye(F,x,{$autoDirty:!0}),p=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}];async function q(){try{await r(),await l()}catch(u){console.error("Erro ao executar scanner ou listar arquivos:",u)}}async function r(){try{const{data:u}=await h(k,{method:"GET"},"$WazoKp68Tw")}catch(u){g.error("Erro ao acionar o scanner:",u)}}async function l(){try{const{data:u,status:C}=await h("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:S.query.ato_token_edit,cartorio_token:E("user-data").value.cartorio_token}},"$03Wxiia3aI")}catch(u){console.error("Erro ao enviar o arquivo:",u)}}const i=async()=>{I.value=!0};function $(u){return u?!0:(console.error("Erro: Nenhum arquivo foi selecionado!"),N.value=!1,!1)}const _=async()=>{if(P.value.$touch(),!P.value.$invalid&&$(x.fileEvent)){const{data:u,error:C,status:K}=await h(V,{method:"POST",body:{ato_id:y.ato_id,descricao:x.descricao,user_id:E("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$WyW0hasRPI");K.value==="success"&&(g.success("Anexo registrado com sucesso!"),R.value.push(u.value))}};async function s(u){u.excluido=!u.excluido;try{await h(`${U}/${u.id}`,{method:"PUT",body:JSON.stringify({excluido:u.excluido})},"$Y3y6TjqbSV")}catch(C){console.error("Erro ao excluir pessoa:",C)}}async function m(u){try{const C=await h(`${T}`,{method:"POST",body:{bucket:E("user-data").value.cartorio_token,path:u.link}},"$bkXJSi7s76"),d=await(await fetch(C.data.value)).blob(),B=URL.createObjectURL(d);window.open(B,"_blank")}catch(C){console.error("Erro ao excluir pessoa:",C)}}const w=()=>{const u=S.query.origem||"criar",C=S.query.id;u==="atualizar"?b.push(`/os/atualizar/${C}`):b.push("/os/criar-registro")};return(u,C)=>{const K=se;return A(),H(ce,null,{default:o(()=>[e(D,null,{default:o(()=>[e(j,{cols:"5",class:"mt-2"},{default:o(()=>[e(X,{modelValue:t(x).descricao,"onUpdate:modelValue":[C[0]||(C[0]=d=>t(x).descricao=d),t(P).descricao.$touch],"error-messages":t(P).descricao.$errors.map(d=>d.$message),onBlur:t(P).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"])]),_:1}),v("div",{onClick:q,title:"Criar",style:{"padding-right":"10px"}},[t(N)===!1?(A(),L("img",dt)):t(N)===!0?(A(),L("img",mt)):(A(),L("img",pt))]),v("div",{onClick:_,title:"Criar"},C[1]||(C[1]=[v("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:ue,alt:"Escanear"},null,-1)]))]),_:1}),e(xe,{headers:p,items:t(R),style:{height:"465px","max-width":"600px"}},{"item.actions":o(({item:d})=>[e(D,null,{default:o(()=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:B=>i(d),title:"Visualizar Anexo"},[v("img",{style:{width:"30px",height:"30px"},onClick:B=>m(d),src:ve,alt:"Visualizar"},null,8,vt)],8,_t),v("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:B=>s(d),title:"Deletar Pessoa"},[d.excluido?(A(),L("img",gt)):(A(),L("img",yt))],8,ft)]),_:2},1024)]),_:1},8,["items"]),e(K,{onClick:w},{default:o(()=>[e(G,{size:"large",color:"red"},{default:o(()=>C[2]||(C[2]=[W("Voltar")])),_:1})]),_:1})]),_:1})}}};export{jt as _,It as a,Nt as b,Bt as c,Ut as d,Ft as e};
