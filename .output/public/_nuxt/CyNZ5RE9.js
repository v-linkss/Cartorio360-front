import{_ as pe}from"./C-md1_HT.js";import{u as ne,e as le,I as ie,r as n,g as _e,o as m,k as L,w as o,b as t,j as e,V as re,x as ae,d as X,l as B,m as ce,f as U,z as Re,v as me,a as E,c as D,K as Ie,h as Fe,L as Ne,F as Ve,M as Be,N as Ce,t as ve}from"./CFGvv8Yg.js";import{u as v}from"./NvLKEaP_.js";import{V as R}from"./CCx48mrt.js";import{V as N}from"./CKGryIPz.js";import{V as fe}from"./BfUFlISF.js";import{V as ge}from"./XTcrwiEU.js";import{_ as Le,a as Ge,b as He,c as Je}from"./DXTXeRwf.js";import{_ as Ke,a as We,b as Xe,T as Ye,W as Qe,S as Ze,D as qe,c as ea}from"./DihHFEt_.js";import{_ as aa,r as Pe}from"./CzSTQkyw.js";import{_ as $e}from"./D5lTjYlv.js";import{_ as ye}from"./BVz1G1IN.js";import{_ as ta}from"./BNPYplwr.js";import{_ as oa}from"./Dm9xgJf0.js";import{_ as xe,a as we}from"./DJvq3mCv.js";import{V as ze}from"./C20MMPYg.js";import{_ as Ae}from"./BeLSyeuL.js";import{V as sa}from"./DvfTT86a.js";import{c as Te,r as Oe,u as Me}from"./wX0gUeYR.js";import{f as ke}from"./B0IxRygJ.js";import{_ as ra}from"./-zgYk4Vu.js";const Xa={__name:"Dados",props:{item_dados:{type:Array,required:!0},item_situacoes:{type:Array,required:!0}},setup(oe){const _=oe,{$toast:x}=ne(),$=ce(),i=le(),u=ie(),g=`${$.public.managemant}/updateAtos`,C=n(_.item_situacoes),Y=n(u.query.origem==="vizualizar"),A=_e({dt_abertura:_.item_dados[0].dt_abertura||null,status:_.item_dados[0].status||null,mne:_.item_dados[0].mne||null});async function Q(){const{data:I,error:f,status:O}=await v(`${g}/${u.query.ato_id}`,{method:"PUT",body:{status:A.status,mne:A.mne,dt_abertura:A.dt_abertura}},"$EIT5jtTUdX");O.value==="success"&&x.success("Ato Atualizado com sucesso")}const T=()=>{const I=u.query.origem||"criar",f=u.query.id;switch(I){case"atualizar":case"vizualizar":i.push(`/os/atualizar/${f}`);break;case"atualizar-lista":case"vizualizar-lista":i.push("/atos/lista");break;default:i.push("/os/criar-registro");break}};return(I,f)=>{const O=pe;return m(),L(ge,null,{default:o(()=>[t(R,{class:"mt-5"},{default:o(()=>[t(N,{cols:"3"},{default:o(()=>[t(fe,{label:"Situação",modelValue:e(A).status,"onUpdate:modelValue":f[0]||(f[0]=y=>e(A).status=y),items:e(C),"item-title":"descricao","item-value":"descricao",required:""},null,8,["modelValue","items"])]),_:1})]),_:1}),t(R,null,{default:o(()=>[t(N,{cols:"5"},{default:o(()=>[t(re,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:e(A).mne,"onUpdate:modelValue":f[1]||(f[1]=y=>e(A).mne=y)},null,8,["modelValue"])]),_:1})]),_:1}),t(R,null,{default:o(()=>[t(N,{cols:"2"},{default:o(()=>[t(re,{modelValue:e(A).dt_abertura,"onUpdate:modelValue":f[2]||(f[2]=y=>e(A).dt_abertura=y),type:"date",label:"Data Lavratura",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),t(R,{class:"mb-3"},{default:o(()=>[t(O,{onClick:T},{default:o(()=>[t(ae,{size:"large",color:"red"},{default:o(()=>f[3]||(f[3]=[X("Voltar")])),_:1})]),_:1}),e(Y)?B("",!0):(m(),L(ae,{key:0,class:"ml-10",onClick:Q,size:"large",color:"green"},{default:o(()=>f[4]||(f[4]=[X("Atualizar")])),_:1}))]),_:1})]),_:1})}}},na={key:0},la=["onClick"],ia={key:0,style:{width:"30px",height:"30px"},src:$e,alt:"Visualizar"},ca={key:1,style:{width:"30px",height:"30px"},src:ta,alt:"Visualizar"},ua=["onClick"],da=["onClick"],ma={key:0,style:{width:"30px",height:"30px"},src:xe,alt:"Visualizar",title:"Reativar"},pa={key:1,src:we,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},_a=["onClick"],Ya={__name:"Partes",async setup(oe){let _,x;const $=le(),i=ie(),u=ce(),{$toast:g}=ne(),C=`${u.public.managemant}/pesquisarPessoas`,Y=`${u.public.managemant}/listarPapeis`,A=`${u.public.managemant}/createAtosPessoa`,Q=`${u.public.managemant}/updateAtosPessoa`,T=`${u.public.managemant}/getAtosPessoaById`,I=`${u.public.managemant}/download`,f=n(U("user-data").value.cartorio_token),O=n(i.query.origem==="vizualizar"),y=n([]),w=n({}),h=n([]),F=n([]),z=n(!1),G=n(!1),H=n(!1),W=n(!1),J=n(null),k=n(null),V=n(null),K=n(null),r=n(null),l=n(i.query.tipo_ato_token),b=n(null),S=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"400px"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome"},{value:"actions"}],c=_e({papeis:null,nome:null,pessoa:null,documento:null});Re(()=>{var p;return((p=c.pessoa)==null?void 0:p.link_ficha)||!1});const{data:j}=([_,x]=me(()=>v(Y,{method:"POST",body:{tipo_ato_token:i.query.tipo_ato_token}},"$acoiTIUp00")),_=await _,x(),_);F.value=j.value;const a=async()=>{const{data:p}=await v(`${T}/${i.query.ato_id}`,{method:"GET"},"$ypnU9hCpVn"),Z=(de=>de.map(te=>({...te,pessoa:{...te.pessoa,documento:te.pessoa.doc_identificacao},papel:{...te.partes_tipos}})))(p.value);h.value=Z};a();async function s(){try{const{data:p,error:d}=await v(C,{method:"POST",body:{cartorio_token:f.value,documento:c.documento,nome:c.nome}},"$pr30MyPXfY");p.value.length>0?(y.value=p.value,c.pessoa=y.value[0]):y.value=[]}catch(p){console.error("Erro na requisição",p)}}const q=()=>{G.value=!0},P=async()=>{await a()},ee=async()=>{await a()},ue=async()=>{const p={pessoa:c.pessoa,papel:F.value.find(se=>se.id===c.papeis),representante:{nome:null}},d=await v(`${T}/${i.query.ato_id}`,{method:"GET"},"$scHdIvxj2D");for(const se of d.data.value)if(se.pessoa_id===c.pessoa.id&&se.ato_id===Number(i.query.ato_id)&&se.tipo_parte_id===c.papeis){g.error("Pessoa Já Registrada Com Esse Papel!");return}const{data:Z,error:de,status:te}=await v(A,{method:"POST",body:{ato_id:Number(i.query.ato_id),pessoa_id:c.pessoa.id,tipo_parte_id:c.papeis,user_id:U("user-data").value.usuario_id}},"$18isAgOJxG");te.value==="success"?(p.id=Z.value.id,g.success("Pessoa Registrada com Sucesso!"),h.value.push(p)):g.error(de.value.message)},he=async p=>{H.value=!0;const{data:d}=await v(I,{method:"POST",body:{bucket:U("user-data").value.cartorio_token,path:p.pessoa.link_ficha}},"$hmDzSF3F61");b.value=d.value,w.value=p.pessoa},Ee=p=>{const d=h.value.filter(Z=>Z.pessoa.id!==p.pessoa.id).map(Z=>({id:Z.pessoa.id,nome:Z.pessoa.nome}));V.value=p.id,J.value=d,z.value=!0,k.value=p.pessoa.nome,r.value=p.pessoa.id},De=p=>{W.value=!0,K.value=p.id,k.value=p.pessoa.nome};async function Se(p){p.excluido=!p.excluido;try{await v(`${Q}/${p.id}`,{method:"PUT",body:JSON.stringify({excluido:p.excluido})},"$l09I6nLRfk")}catch(d){console.error("Erro ao excluir pessoa:",d)}}const je=()=>{const p=i.query.origem||"criar",d=i.query.id;switch(p){case"atualizar":case"vizualizar":$.push(`/os/atualizar/${d}`);break;case"atualizar-lista":case"vizualizar-lista":$.push("/atos/lista");break;default:$.push("/os/criar-registro");break}};return(p,d)=>{const Z=Le,de=We,te=Xe,se=aa,Ue=pe;return m(),L(ge,null,{default:o(()=>[e(O)?B("",!0):(m(),L(R,{key:0,class:"mt-5"},{default:o(()=>[t(N,{cols:"3"},{default:o(()=>[t(re,{label:"Documento",modelValue:e(c).documento,"onUpdate:modelValue":d[0]||(d[0]=M=>e(c).documento=M)},null,8,["modelValue"])]),_:1}),t(N,{cols:"4"},{default:o(()=>[t(re,{label:"Pessoa",modelValue:e(c).nome,"onUpdate:modelValue":d[1]||(d[1]=M=>e(c).nome=M)},null,8,["modelValue"])]),_:1}),E("div",null,[E("img",{class:"mt-1",src:$e,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:s})]),E("div",null,[E("img",{class:"mt-1 ml-2",src:ye,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:q})])]),_:1})),e(O)?B("",!0):(m(),L(R,{key:1},{default:o(()=>[t(N,{cols:"4"},{default:o(()=>[t(fe,{label:"Selecione a Pessoa",modelValue:e(c).pessoa,"onUpdate:modelValue":d[2]||(d[2]=M=>e(c).pessoa=M),items:e(y),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),t(N,{cols:"3"},{default:o(()=>[t(fe,{label:"Papel",modelValue:e(c).papeis,"onUpdate:modelValue":d[3]||(d[3]=M=>e(c).papeis=M),items:e(F),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),e(O)?B("",!0):(m(),D("div",na,[E("img",{class:"mt-1",src:ye,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:ue})]))]),_:1})),t(R,null,{default:o(()=>[t(N,null,{default:o(()=>[t(ze,{style:{height:"465px"},headers:S,items:e(h)},{"item.actions":o(({item:M})=>[e(O)?B("",!0):(m(),L(R,{key:0},{default:o(()=>[E("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-1",onClick:be=>he(M),title:"Visualizar Ficha"},[M.pessoa.link_ficha?(m(),D("img",ia)):(m(),D("img",ca))],8,la),E("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:be=>De(M),class:"mr-1",title:"Alterar Papel"},d[8]||(d[8]=[E("img",{style:{width:"30px",height:"30px"},src:oa,alt:"Visualizar"},null,-1)]),8,ua),E("div",{class:"mr-1",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:be=>Se(M),title:"Deletar Pessoa"},[M.excluido?(m(),D("img",ma)):(m(),D("img",pa))],8,da),E("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-1",onClick:be=>Ee(M),title:"Selecionar Representante"},d[9]||(d[9]=[E("img",{style:{width:"30px",height:"30px"},src:Ke,alt:"Visualizar"},null,-1)]),8,_a)]),_:2},1024))]),_:1},8,["items"])]),_:1})]),_:1}),t(Z,{show:e(G),onClose:d[4]||(d[4]=M=>G.value=!1)},null,8,["show"]),t(de,{representante_nome:e(k),representantes:e(J),ato_id:e(V),show:e(z),onClose:d[5]||(d[5]=M=>z.value=!1),onUpdateRepresentante:ee},null,8,["representante_nome","representantes","ato_id","show"]),t(te,{representante_nome:e(k),ato_token:e(l),ato_id:e(K),show:e(W),onClose:d[6]||(d[6]=M=>W.value=!1),onUpdatePapel:P},null,8,["representante_nome","ato_token","ato_id","show"]),e(H)?(m(),L(se,{key:2,show:e(H),"link-view":e(b),"pessoa-obj":e(w),"is-view":!0,onClose:d[7]||(d[7]=M=>H.value=!1)},null,8,["show","link-view","pessoa-obj"])):B("",!0),t(R,null,{default:o(()=>[t(Ue,{onClick:je},{default:o(()=>[t(ae,{size:"large",color:"red"},{default:o(()=>d[10]||(d[10]=[X("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},va={key:0,class:"loading-overlay"},fa="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",Qa={__name:"Minuta",emits:["page","doc"],setup(oe,{emit:_}){Ie("DocumentEditorContainer",[Ye,Qe,Ze]);const x=ce(),{$toast:$}=ne(),i=le(),u=ie(),g=_;Pe(`${x.public.docEditor}`);const C=`${x.public.managemant}/download`,Y=`${x.public.managemant}/atos/files`,A=`${x.public.managemant}/subitituirModelo`,Q=`${x.public.managemant}/upload`,T=n(null),I=n(!1),f=n("Ao executar a geração, a minuta atual será substituída e não poderá ser recuperada.Confirma ?"),O=n(u.query.origem==="vizualizar"),y=n(!1),w=async r=>{try{const l=await fetch(r);if(!l.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await l.blob()}catch(l){return console.error(l),null}},h=async()=>{try{const{data:r}=await v(`${Y}/${u.query.ato_token_edit}`,{method:"GET"},"$5jxI4TvFse");return r.value.link_ato}catch(r){console.error("Erro ao carregar o documento:",r),$.error(r)}},F=async()=>{y.value=!0;try{const r=await h(),{data:l,status:b}=await v(C,{method:"POST",body:{bucket:U("user-data").value.cartorio_token,path:r}},"$dvNFfvmIJC"),S=l.value,c=await w(S);if(c){const j=new FileReader;j.onload=()=>{const a=j.result;T.value.ej2Instances.documentEditor.open(a),g("doc",a)},j.readAsText(c)}}catch{console.error("Erro ao carregar o documento.")}finally{y.value=!1}},z=async()=>{const l=await T.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),b=new FileReader;b.onload=()=>{const S=b.result,j=T.value.ej2Instances.documentEditor.pageCount;g("page",j),g("doc",S)},b.readAsText(l)},G=async()=>{y.value=!0;try{const l=await T.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),b=new FormData;b.append("file",l,"anexo.sfdt"),b.append("cartorio_token",U("user-data").value.cartorio_token),b.append("token",u.query.ato_token_edit),b.append("tipo","ato_minuta");const{data:S,status:c}=await v(Q,{method:"POST",body:b},"$xv11VtUdMy");if(c.value==="success"){$.success("Documento enviado!");const a=T.value.ej2Instances.documentEditor.pageCount;z(),g("page",a)}else $.error("Erro ao enviar documento para o sistema.")}catch(r){$.error("Erro ao salvar documento."),console.error(r)}finally{y.value=!1}},H=()=>{I.value=!1,W()},W=async()=>{V(!0);try{await J(),V(!0);const{data:r,status:l}=await v(A,{method:"POST",body:{ato_token:u.query.ato_token_edit}},"$zyzWHTXTBW");r.value&&k(r.value)}catch(r){console.error("Erro ao gerar a minuta:",r),$.error("Ocorreu um erro ao gerar a minuta.")}finally{V(!1)}},J=async()=>{try{const{data:r}=await v(C,{method:"POST",body:{bucket:U("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$KreLE0Ys81"),l=await w(r.value);if(l){const b=new FileReader;b.onload=()=>{const S=b.result;T.value.ej2Instances.documentEditor.open(S),g("doc",S)},b.readAsText(l)}}catch(r){console.error("Erro ao carregar o modelo de minuta:",r)}},k=r=>{const l=T.value.ej2Instances.documentEditor,b=S=>{for(const[c,j]of Object.entries(S))if(/^<<.+>>$/.test(c))try{l.search.findAll(c),l.search.searchResults.length>0&&l.search.searchResults.replaceAll(j)}catch(a){console.error(`Erro ao substituir o marcador ${c}:`,a)}else if(c==="partes"&&Array.isArray(j)&&j.length>0)for(const a of j)typeof a=="object"&&b(a)};b(r)},V=r=>{y.value=r},K=()=>{const r=u.query.origem||"criar",l=u.query.id;switch(r){case"atualizar":case"vizualizar":i.push(`/os/atualizar/${l}`);break;case"atualizar-lista":case"vizualizar-lista":i.push("/atos/lista");break;default:i.push("/os/criar-registro");break}};return Fe(async()=>{await F(),z()}),(r,l)=>{const b=pe,S=Ae;return m(),D(Ve,null,[t(e(qe),{height:"900px",ref_key:"documentEditorContainer",ref:T,serviceUrl:fa,enableToolbar:!0,enableWordExport:!0},null,512),e(y)?(m(),D("div",va,[t(Ne,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):B("",!0),t(R,{class:"ml-4 mt-4 mb-4"},{default:o(()=>[t(b,{class:"mr-4"},{default:o(()=>[t(ae,{size:"large",onClick:K,color:"red"},{default:o(()=>l[2]||(l[2]=[X("Voltar")])),_:1})]),_:1}),e(O)?B("",!0):(m(),L(ae,{key:0,size:"large",color:"green",onClick:G,disabled:e(y)},{default:o(()=>l[3]||(l[3]=[X("Atualizar")])),_:1},8,["disabled"])),e(O)?B("",!0):(m(),L(ae,{key:1,class:"ml-4",size:"large",color:"blue",onClick:l[0]||(l[0]=c=>I.value=!0)},{default:o(()=>l[4]||(l[4]=[X("Gerar Minuta")])),_:1}))]),_:1}),t(S,{onConfirm:H,condMessage:e(f),show:e(I),onClose:l[1]||(l[1]=c=>I.value=!1)},null,8,["condMessage","show"])],64)}}},ya=["innerHTML"],Za={__name:"Livro",props:{pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(oe){let _,x;const $=oe,i=ce();Pe(`${i.public.docEditor}`);const{$toast:u}=ne(),g=le(),C=ie(),Y=`${i.public.managemant}/download`,A=`${i.public.managemant}/atos/files`,Q=`${i.public.managemant}/lavrarAto`,T=`${i.public.managemant}/listarEscrevente`,I=`${i.public.managemant}/ato_calcular`,f=n(U("user-data").value.cartorio_token),O=U("auth_token").value,y=n("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),w=n(!1),h=n(null),F=n(null),z=n(C.query.origem==="vizualizar"),G=n(null),H=n([]),W=n({}),J=_e({escrevente:null}),k=async a=>{try{const s=await fetch(a);if(!s.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await s.blob()}catch(s){return console.error(s),null}},V=async()=>{try{const{data:a}=await v(`${A}/${C.query.ato_token_edit}`,{method:"GET"},"$FnEbAJEARP");return a.value.link_ato}catch(a){console.error("Erro ao carregar o documento:",a),u.error(a)}},K=async()=>{try{const a=await V(),{data:s,status:q}=await v(Y,{method:"POST",body:{bucket:U("user-data").value.cartorio_token,path:a}},"$7ljqltMqa0"),P=s.value,ee=await k(P);if(ee){const ue=new FileReader;ue.onload=()=>{const he=ue.result;G.value.ej2Instances.documentEditor.open(he)},ue.readAsText(ee)}}catch{u.error("Erro ao carregar o documento.")}};K();const r=async()=>{const a=G.value.ej2Instances.documentEditor.pageCount;try{const{data:s,status:q}=await v(Q,{method:"POST",body:{ato_token:C.query.ato_token_edit,qtd_paginas:a,escrevente_token:J.escrevente,usuario_token:O,cartorio_token:f}},"$OWxZSQkyX8");q.value==="success"?(h.value=s.value,F.value=s.value[0].selo,u.success("Ato lavrado com sucesso!")):u.error("Falha ao lavrar o ato.")}catch{u.error("Erro ao conectar com o servidor.")}},l=async()=>{const a=G.value.ej2Instances.documentEditor.pageCount,{data:s,status:q}=await v(I,{method:"POST",body:{ato_token:C.query.ato_token_edit,cartorio_token:f,quantidade:1,usuario_token:O,escrevente_token:J.escrevente,qtd_paginas:a}},"$sMqfUUQcBM");q.value==="success"?W.value=s.value[0]:u.error("Falha ao calcular o ato.")},b=async()=>{w.value=!1,r()},S=async()=>{w.value=!0,await l()},{data:c}=([_,x]=me(()=>v(T,{method:"POST",body:{cartorio_token:f}},"$OVwiKSwcOE")),_=await _,x(),_);H.value=c.value[0].func_json_escreventes;const j=()=>{const a=C.query.origem||"criar",s=C.query.id;switch(a){case"atualizar":case"vizualizar":g.push(`/os/atualizar/${s}`);break;case"atualizar-lista":case"vizualizar-lista":g.push("/atos/lista");break;default:g.push("/os/criar-registro");break}};return Be(()=>$.document,(a,s)=>{K()}),(a,s)=>{const q=Ae;return m(),D(Ve,null,[t(R,null,{default:o(()=>[t(N,null,{default:o(()=>[t(e(qe),{restrictEditing:!0,enableToolbar:!1,ref_key:"documentEditorContainer",ref:G,height:"850px",width:"850px"},null,512)]),_:1}),e(z)?B("",!0):(m(),L(N,{key:0},{default:o(()=>[t(fe,{class:"mt-15",label:"Tabelião/escrevente",modelValue:e(J).escrevente,"onUpdate:modelValue":s[0]||(s[0]=P=>e(J).escrevente=P),items:e(H),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),E("img",{onClick:s[1]||(s[1]=P=>S()),style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:ea}),e(h)?(m(),L(sa,{key:0,width:"360"},{default:o(()=>[t(R,null,{default:o(()=>[t(N,null,{default:o(()=>[t(Ce,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:o(()=>[t(N,null,{default:o(()=>[X(" Livro: "+ve(e(h)[0].livro_numero),1)]),_:1}),t(N,null,{default:o(()=>[X(" Protocolo: "+ve(e(h)[0].protocolo?e(h)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),t(N,null,{default:o(()=>[t(Ce,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:o(()=>[X(" Folhas : "+ve(e(h)[0].pagina_inicial)+" A "+ve(e(h)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),E("div",{style:{"margin-left":"10px","padding-bottom":"20px","margin-top":"-10px"},innerHTML:e(F)},null,8,ya)]),_:1})):B("",!0)]),_:1}))]),_:1}),t(ae,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:j},{default:o(()=>s[3]||(s[3]=[X("Voltar")])),_:1}),t(q,{show:e(w),condMessage:e(y),valor:e(W),onClose:s[2]||(s[2]=P=>w.value=!1),onConfirm:b},null,8,["show","condMessage","valor"])],64)}}},ga=["onClick"],ha={key:0,style:{width:"30px",height:"30px"},src:xe,alt:"Visualizar",title:"Reativar"},ba={key:1,src:we,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},et={__name:"Observacao",props:{ato_id:{type:Number,required:!0}},async setup(oe){let _,x;const $=le(),i=ie(),u=ce(),{$toast:g}=ne(),C=`${u.public.managemant}/listarEscrevente`;`${u.public.managemant}`;const Y=`${u.public.managemant}/atos_observacao`,A=`${u.public.managemant}/atos_observacao`,Q=`${u.public.managemant}/atos_observacao`,T=n(U("user-data").value.cartorio_token),I=n(i.query.origem==="vizualizar"),f=n([]),O=n([]),y=[{title:"Data",align:"start",key:"created"},{title:"Escrevente",align:"start",key:"users.nome"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}],w=_e({observacao:""}),h={observacao:{required:Te.withMessage("O campo é obrigatório",Oe)}},F=Me(h,w),{data:z}=([_,x]=me(()=>v(`${Q}/${i.query.ato_id}`,{method:"GET"},"$HyzoO40swN")),_=await _,x(),_);Array.isArray(z.value)?f.value=z.value.map(k=>({...k,created:ke(k.created,"dd/mm/yyyy hh:mm")})):z.value&&typeof z.value=="object"&&(f.value=[{...z.value,created:ke(z.value.created,"dd/mm/yyyy hh:mm")}]);async function G(){if(w.observacao.trim()===""){g.error("O campo de observação está vazio.");return}if(await F.value.$validate()){const{data:k,error:V,status:K}=await v(Y,{method:"POST",body:{ato_id:Number(i.query.ato_id),observacao:w.observacao,user_id:U("user-data").value.usuario_id}},"$gnHMo4uCXD");K.value==="success"&&(f.value.push({created:ke(k.value.created,"dd/mm/yyyy hh:mm"),observacao:k.value.observacao,id:k.value.id,escrevente:U("user-data").value.nome}),w.observacao="",g.success("Observação registrada com sucesso"))}else g.error("Preencha os campos obrigatórios.")}async function H(k){k.excluido=!k.excluido;try{await v(`${A}/${k.id}`,{method:"PUT",body:JSON.stringify({excluido:k.excluido})},"$sP9AKdd3Ky")}catch(V){console.error("Erro ao excluir observação:",V)}}const{data:W}=([_,x]=me(()=>v(C,{method:"POST",body:{cartorio_token:T}},"$HL9pndqGh0")),_=await _,x(),_);O.value=W.value[0].func_json_escreventes;const J=()=>{const k=i.query.origem||"criar",V=i.query.id;switch(k){case"atualizar":case"vizualizar":$.push(`/os/atualizar/${V}`);break;case"atualizar-lista":case"vizualizar-lista":$.push("/atos/lista");break;default:$.push("/os/criar-registro");break}};return(k,V)=>{const K=pe;return m(),L(ge,null,{default:o(()=>[I.value?B("",!0):(m(),L(R,{key:0,class:"mt-5"},{default:o(()=>[t(re,{label:"Observação",modelValue:w.observacao,"onUpdate:modelValue":V[0]||(V[0]=r=>w.observacao=r),required:"","error-messages":e(F).observacao.$errors.length>0?e(F).observacao.$errors.map(r=>r.$message):[],onBlur:e(F).observacao.$touch,onInput:e(F).observacao.$touch},null,8,["modelValue","error-messages","onBlur","onInput"]),E("div",null,[E("img",{class:"btn-pointer ml-2",src:ye,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:G})])]),_:1})),t(R,null,{default:o(()=>[t(N,null,{default:o(()=>[t(ze,{style:{height:"465px"},headers:y,items:f.value},{"item.actions":o(({item:r})=>[E("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:l=>H(r),title:"Deletar Observação"},[r.excluido?(m(),D("img",ha)):(m(),D("img",ba))],8,ga)]),_:1},8,["items"])]),_:1})]),_:1}),t(R,null,{default:o(()=>[t(K,{onClick:J},{default:o(()=>[t(ae,{size:"large",color:"red"},{default:o(()=>V[1]||(V[1]=[X("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},ka={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:He,alt:"Criar"},$a={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Je,alt:"Criar"},xa={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:ra,alt:"Criar"},wa=["onClick"],za=["onClick"],Ea=["onClick"],Ca={key:0,style:{width:"30px",height:"30px"},src:xe,alt:"Visualizar",title:"Reativar"},Va={key:1,src:we,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},at={__name:"Anexos",async setup(oe){let _,x;const $=ce(),{$toast:i}=ne(),u=le(),g=ie(),C=n(g.query.origem==="vizualizar"),Y=`${$.public.biometria}/run-scanner`,A=`${$.public.managemant}/atos_anexos`,Q=`${$.public.managemant}/atos_anexos`,T=`${$.public.managemant}/download`,I=`${$.public.managemant}/atos_anexos`,f=`${$.public.managemant}/upload`,O=n(!1),y=n(null),w=n([]);U("pessoa_token");const h=_e({descricao:"",fileEvent:null}),F={descricao:{required:Te.withMessage("O campo é obrigatório",Oe)}},z=Me(F,h,{$autoDirty:!0}),G=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}],{data:H}=([_,x]=me(()=>v(`${I}/${g.query.ato_id}`,{method:"GET"},"$AOZpbz65MA")),_=await _,x(),_);w.value=H.value;async function W(){try{await J(),await k()}catch(a){console.error("Erro ao executar scanner ou listar arquivos:",a)}}async function J(){try{const{data:a}=await v(Y,{method:"GET"},"$KttjFhHivJ")}catch(a){i.error("Erro ao acionar o scanner:",a)}}async function k(){try{const{data:a,status:s}=await v("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:g.query.ato_token_edit,cartorio_token:U("user-data").value.cartorio_token}},"$TqQrsgxUkd")}catch(a){console.error("Erro ao enviar o arquivo:",a)}}async function V(){try{const a=document.createElement("input");a.type="file",a.accept="*/*",a.onchange=async s=>{h.fileEvent=s,s.target.files[0]&&(y.value=!0)},a.click()}catch(a){console.error("Erro ao abrir o explorador de arquivos:",a)}}const K=async()=>{O.value=!0};function r(a){return a?!0:(y.value=!1,!1)}const l=async a=>{if(!h.fileEvent||!h.fileEvent.target.files.length){i.error("Nenhum arquivo selecionado.");return}const s=h.fileEvent.target.files[0],q=new FormData;q.append("file",s),q.append("cartorio_token",U("user-data").value.cartorio_token),q.append("token",a),q.append("tipo","ato_anexo");try{const P=await v(f,{method:"POST",body:q},"$KDhIYzGKzM");i.success("Anexo registrado com sucesso!")}catch{i.error("Erro ao enviar o arquivo.")}},b=async()=>{if(z.value.$touch(),!z.value.$invalid&&r(h.fileEvent)){const{data:a,error:s,status:q}=await v(A,{method:"POST",body:{ato_id:g.query.ato_id,descricao:h.descricao,user_id:U("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$cdoFBGO0Ti");q.value==="success"&&(i.success("Anexo registrado com sucesso!"),w.value.push(a.value),l(a.value.token))}};async function S(a){a.excluido=!a.excluido;try{await v(`${Q}/${a.id}`,{method:"PUT",body:JSON.stringify({excluido:a.excluido})},"$WLSrgYRoHq")}catch(s){console.error("Erro ao excluir pessoa:",s)}}async function c(a){try{const s=await v(`${T}`,{method:"POST",body:{bucket:U("user-data").value.cartorio_token,path:a.link}},"$NdgRjioizH"),P=await(await fetch(s.data.value)).blob(),ee=URL.createObjectURL(P);window.open(ee,"_blank")}catch(s){console.error("Erro ao excluir pessoa:",s)}}const j=()=>{const a=g.query.origem||"criar",s=g.query.id;switch(a){case"atualizar":case"vizualizar":u.push(`/os/atualizar/${s}`);break;case"atualizar-lista":case"vizualizar-lista":u.push("/atos/lista");break;default:u.push("/os/criar-registro");break}};return(a,s)=>{const q=pe;return m(),L(ge,null,{default:o(()=>[t(R,null,{default:o(()=>[t(N,{cols:"5",class:"mt-2"},{default:o(()=>[e(C)?B("",!0):(m(),L(re,{key:0,modelValue:e(h).descricao,"onUpdate:modelValue":[s[0]||(s[0]=P=>e(h).descricao=P),e(z).descricao.$touch],"error-messages":e(z).descricao.$errors.map(P=>P.$message),onBlur:e(z).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"]))]),_:1}),e(C)?B("",!0):(m(),D("div",{key:0,onClick:W,title:"Escanear"},s[1]||(s[1]=[E("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ge,alt:"Escanear"},null,-1)]))),e(C)?B("",!0):(m(),D("div",{key:1,onClick:V,title:"Criar"},[e(y)===!1?(m(),D("img",ka)):e(y)===!0?(m(),D("img",$a)):(m(),D("img",xa))])),e(C)?B("",!0):(m(),D("div",{key:2,onClick:b,title:"Criar"},s[2]||(s[2]=[E("img",{class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:ye,alt:"Criar"},null,-1)])))]),_:1}),t(ze,{headers:G,items:e(w),style:{height:"465px","max-width":"600px"}},{"item.actions":o(({item:P})=>[t(R,null,{default:o(()=>[E("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ee=>K(P),title:"Visualizar Anexo"},[E("img",{style:{width:"30px",height:"30px"},onClick:ee=>c(P),src:$e,alt:"Visualizar"},null,8,za)],8,wa),E("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ee=>S(P),title:"Deletar Pessoa"},[P.excluido?(m(),D("img",Ca)):(m(),D("img",Va))],8,Ea)]),_:2},1024)]),_:1},8,["items"]),t(q,{onClick:j},{default:o(()=>[t(ae,{size:"large",color:"red"},{default:o(()=>s[3]||(s[3]=[X("Voltar")])),_:1})]),_:1})]),_:1})}}};export{Xa as _,Ya as a,Qa as b,Za as c,et as d,at as e};
