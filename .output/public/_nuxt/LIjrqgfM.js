import{_ as de}from"./Mi1_ALDO.js";import{_ as me}from"./CA2G8bWf.js";import{c as ce,r as pe,u as _e}from"./Cgd2Xxvy.js";import{r as u,e as g,f as Q,g as ve,o as I,h as ee,w as n,b as a,a as d,t as Y,d as M,i as o,V as G,j as fe,k as te,u as ye,D as be,l as Ve,n as ke,m as ge,s as c,q as R,x as z,v as X,c as Z}from"./BlISDfSb.js";import{u as $}from"./mWFlcp5Z.js";import{V as H,a as xe}from"./DvAazetv.js";import{V as L}from"./B_6EK6CM.js";import{V as D}from"./ChtDxFd5.js";import{V as he}from"./DRNJ0VZh.js";import{V as we}from"./DygU1Jbw.js";import{_ as $e}from"./BVz1G1IN.js";import{_ as Ce}from"./BRCd7B75.js";import{_ as Se}from"./DbGv5jcW.js";import{_ as Oe}from"./DNPLdxAQ.js";import{_ as De,a as Ue}from"./DJvq3mCv.js";import{f as q}from"./B0IxRygJ.js";import{V as m}from"./LUQs29ck.js";import{V as J}from"./I_3Ba-ou.js";import{V as Ae}from"./Cm6TFFUe.js";import"./FRBH2Ime.js";import"./Dwnp2z_G.js";import"./CqegjevL.js";import"./Btu4rr8s.js";import"./CEek3Kft.js";import"./CwDV6drt.js";import"./-h1tCRZ2.js";import"./BqhPpK07.js";import"./D-p0TnDv.js";const Te={style:{color:"red","margin-left":"18px"}},Ne={class:"mb-5",style:{display:"flex","justify-content":"flex-start"}},Re={class:"ml-6"},qe={class:"ml-6"},Ie={__name:"Ordem",props:{show:Boolean,numero_os:Number,ordemserv_token:String},emits:["close"],setup(F,{emit:C}){const V=F,k=u(V.show),S=te();u(g("user-data").value.cartorio_token).value;const P=g("auth_token").value,E=`${S.public.managemant}/analisaCancelamento`,O=`${S.public.managemant}/cancelaOs`,p=Q({motivo:null}),_=u(null),U=C,A={motivo:{required:ce.withMessage("O campo é obrigatorio",pe)}},x=_e(A,p);ve(()=>V.show,v=>{k.value=v});const h=()=>{k.value=!1,U("close")};(async()=>{const{data:v,error:i}=await $(`${E}`,{method:"POST",body:{ordemserv_token:V.ordemserv_token}},"$1fnrIk2fgs");_.value=v.value.mensagem})();const N=async()=>{if(await x.value.$validate()){const{status:v}=await $(`${O}`,{method:"POST",body:{usuario_token:P,motivo:p.motivo,ordemserv_token:V.ordemserv_token}},"$21WlhUNXeM");v.value==="success"&&(window.location.reload(),h())}};return(v,i)=>(I(),ee(we,{persistent:"",modelValue:o(k),"onUpdate:modelValue":i[1]||(i[1]=y=>fe(k)?k.value=y:null),"max-width":"650"},{default:n(()=>[a(H,null,{default:n(()=>[a(L,null,{default:n(()=>[a(D,{class:"mb-5 mt-1 ml-2"},{default:n(()=>[i[2]||(i[2]=d("h1",null,"Cancelamento da OS nº",-1)),d("h1",Te,Y(V.numero_os),1)]),_:1}),a(L,null,{default:n(()=>[a(H,{variant:"outlined",class:"mb-5"},{default:n(()=>[a(xe,null,{default:n(()=>[M(Y(o(_)),1)]),_:1})]),_:1}),a(he,{label:"Motivo",modelValue:o(p).motivo,"onUpdate:modelValue":i[0]||(i[0]=y=>o(p).motivo=y),required:"","error-messages":o(x).motivo.$errors.map(y=>y.$message),onBlur:o(x).motivo.$touch,onInput:o(x).motivo.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1})]),_:1}),d("div",Ne,[d("div",Re,[a(G,{size:"large",color:"red",onClick:h},{default:n(()=>i[3]||(i[3]=[M("Fechar")])),_:1})]),d("div",qe,[a(G,{size:"large",color:"green",onClick:N},{default:n(()=>i[4]||(i[4]=[M("Salvar")])),_:1})])])]),_:1})]),_:1},8,["modelValue"]))}},Pe=["title","onClick"],Ee=["onClick","title"],Be=["disabled","onClick"],Me={key:0,style:{width:"30px",height:"30px"},src:De,alt:"Visualizar",title:"Reativar"},ze={key:1,src:Ue,alt:"Cancelamento",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},ft={__name:"index",setup(F){const C=te(),{$toast:V}=ye(),k=`${C.public.managemant}/listarUsuarios`,S=`${C.public.managemant}/listarOrdensServico`,P=`${C.public.managemant}/tipoAtos`,E=be(),O=u(g("auth_token").value)||null,p=u(g("user-data").value.cartorio_token)||null,_=u([]),U=u([]),A=u([]),x=u(["PENDENTE","EM ANDAMENTO","CONCLUÍDA","LAVRADA"]),h=u(!1),T=u(!1),N=u(null),v=u(null),i=u(null),y=u({}),l=Q({numero:null,data_inicio:B(),data_fim:B(),data_lavratura_inicio:null,data_lavratura_fim:null,protocolo:null,livro:null,folha:null,situacao:null,usuario_token:O.value,selo:null,ato_tipo_token:null,apresentante:null}),ae=[{title:"Data Abertura",value:"dt_abertura",width:"100px"},{title:"Data Recebimento",value:"data",width:"100px"},{title:"Número",value:"numero",width:"10px"},{title:"Situação",value:"situacao",width:"115px"},{title:"CPF",value:"apresentante_cpf",width:"100px"},{title:"Apresentante",value:"apresentante_nome",width:"228px"},{title:"Usuario",value:"usuario_nome",width:"30px"},{title:"Valor",value:"valor",width:"50px"},{title:"A Receber",value:"valor_a_receber",width:"50px"},{value:"actions"}];function B(){const r=new Date,e=r.getFullYear(),s=String(r.getMonth()+1).padStart(2,"0");return`${String(r.getDate()).padStart(2,"0")}-${s}-${e}`}function w(r){if(!r)return null;const[e,s,f]=r.split("/");return`${f}-${s}-${e}`}async function oe(){const{data:r}=await $(k,{method:"POST",body:{cartorio_token:p.value}},"$pAAptWJdb1");U.value=r.value}async function le(){try{sessionStorage.setItem("pesquisaOS",JSON.stringify(l));const{data:r,error:e}=await $(S,{method:"POST",body:{cartorio_token:p.value,numero:l.numero||null,data_inicio:w(l.data_inicio)||null,data_fim:w(l.data_fim)||null,data_lavratura_inicio:w(l.data_lavratura_inicio)||null,data_lavratura_fim:w(l.data_lavratura_fim)||null,protocolo:l.protocolo||null,livro:l.livro||null,folha:l.folha||null,situacao:l.situacao||null,usuario_token:l.usuario_token,selo:l.selo||null,ato_tipo_token:l.ato_tipo_token,apresentante:l.apresentante||null}},"$IO02J210Z9");r.value.length>0?_.value=r.value.map(s=>({...s,data:s.data?q(s.data,"dd/mm/yyyy"):null,dt_abertura:s.dt_abertura?q(s.dt_abertura,"dd/mm/yyyy"):null})):(_.value=[],V.error("Não existe Ordem de Serviço Registrada!"))}catch(r){console.error("Erro na requisição",r)}}async function re(){const{data:r,error:e}=await $(P,{method:"POST",body:{cartorio_token:p.value,usuario_token:O.value}},"$YgUhKRJlsV");A.value=r.value}const j=async()=>{try{const r=B(),e=sessionStorage.getItem("pesquisaOS"),s=JSON.parse(e),{data:f,error:K}=await $(S,{method:"POST",body:{cartorio_token:p.value,usuario_token:s.usuario_token||O.value,data_fim:w(s==null?void 0:s.data_fim)||r,data_inicio:w(s==null?void 0:s.data_inicio)||r}},"$xKnfARCL4G");f.value.length>0?_.value=f.value.map(b=>({...b,data:q(b.data,"dd/mm/yyyy"),dt_abertura:q(b.dt_abertura,"dd/mm/yyyy")})):_.value=[]}catch(r){console.error("Erro ao buscar serviços",r)}};function ne(r){i.value=r.numero,v.value=r.token,T.value=!0}function se(r){const e=g("user-service"),s=_.value.find(f=>f.id===r);e.value=e.value=JSON.stringify({id:s.id,token:s.token}),E.push({path:`/os/atualizar/${r}`})}function ie(r,e){i.value=r,y.value={token:e.token,numero:e.numero,valor:e.valor,valor_pago:e.valor_pago},h.value=!0}const ue=()=>{const r=g("user-service"),e=g("ordem-button");r.value=null,N.value=!0,e.value=N.value};return Ve(()=>{ke(async()=>{const r=sessionStorage.getItem("pesquisaOS");if(r){const e=JSON.parse(r);Object.assign(l,e)}await j()})}),oe(),re(),(r,e)=>{const s=de,f=me,K=Ie,b=ge("mask");return I(),ee(L,{class:"mt-5",style:{width:"100%"}},{default:n(()=>[a(D,{class:"mb-5"},{default:n(()=>[e[16]||(e[16]=d("h1",null,"Ordens de Serviço",-1)),a(s,{to:"/os/criar-registro"},{default:n(()=>[d("img",{style:{width:"60px",height:"60px",cursor:"pointer","margin-left":"70px"},src:$e,alt:"novo",onClick:ue})]),_:1})]),_:1}),a(D,{style:{"margin-bottom":"-35px"}},{default:n(()=>[a(m,null,{default:n(()=>[a(c,{modelValue:o(l).numero,"onUpdate:modelValue":e[0]||(e[0]=t=>o(l).numero=t),label:"Número"},null,8,["modelValue"])]),_:1}),a(m,null,{default:n(()=>[R(a(c,{modelValue:o(l).data_inicio,"onUpdate:modelValue":e[1]||(e[1]=t=>o(l).data_inicio=t),label:"Abertura de",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[b,"##/##/####"]])]),_:1}),a(m,null,{default:n(()=>[R(a(c,{modelValue:o(l).data_fim,"onUpdate:modelValue":e[2]||(e[2]=t=>o(l).data_fim=t),label:"Abertura até",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[b,"##/##/####"]])]),_:1}),a(m,null,{default:n(()=>[R(a(c,{modelValue:o(l).data_lavratura_inicio,"onUpdate:modelValue":e[3]||(e[3]=t=>o(l).data_lavratura_inicio=t),label:"Lavratura de",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[b,"##/##/####"]])]),_:1}),a(m,null,{default:n(()=>[R(a(c,{modelValue:o(l).data_lavratura_fim,"onUpdate:modelValue":e[4]||(e[4]=t=>o(l).data_lavratura_fim=t),label:"Lavratura até",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[b,"##/##/####"]])]),_:1}),a(m,null,{default:n(()=>[a(c,{modelValue:o(l).protocolo,"onUpdate:modelValue":e[5]||(e[5]=t=>o(l).protocolo=t),label:"Protocolo"},null,8,["modelValue"])]),_:1}),a(m,{md:"1"},{default:n(()=>[a(c,{modelValue:o(l).livro,"onUpdate:modelValue":e[6]||(e[6]=t=>o(l).livro=t),label:"Livro"},null,8,["modelValue"])]),_:1}),a(m,{md:"1"},{default:n(()=>[a(c,{modelValue:o(l).folha,"onUpdate:modelValue":e[7]||(e[7]=t=>o(l).folha=t),label:"Folha"},null,8,["modelValue"])]),_:1})]),_:1}),a(D,null,{default:n(()=>[a(m,{md:"3"},{default:n(()=>[a(J,{modelValue:o(l).situacao,"onUpdate:modelValue":e[8]||(e[8]=t=>o(l).situacao=t),items:o(x),label:"Situação"},null,8,["modelValue","items"])]),_:1}),a(m,{md:"2"},{default:n(()=>[a(J,{items:o(U),modelValue:o(l).usuario_token,"onUpdate:modelValue":e[9]||(e[9]=t=>o(l).usuario_token=t),"item-title":"user_nome","item-value":"user_token",label:"Usuario"},null,8,["items","modelValue"])]),_:1}),a(m,{md:"1"},{default:n(()=>[a(c,{modelValue:o(l).selo,"onUpdate:modelValue":e[10]||(e[10]=t=>o(l).selo=t),label:"Selo"},null,8,["modelValue"])]),_:1}),a(m,{md:"3"},{default:n(()=>[a(J,{modelValue:o(l).ato_tipo_token,"onUpdate:modelValue":e[11]||(e[11]=t=>o(l).ato_tipo_token=t),items:o(A),"item-title":"descricao","item-value":"token",label:"Serviço"},null,8,["modelValue","items"])]),_:1}),a(m,{md:"2"},{default:n(()=>[a(c,{modelValue:o(l).apresentante,"onUpdate:modelValue":e[12]||(e[12]=t=>o(l).apresentante=t),label:"Apresentante"},null,8,["modelValue"])]),_:1}),a(m,null,{default:n(()=>[d("div",null,[d("img",{onClick:le,style:{width:"40px",height:"40px",cursor:"pointer"},src:Ce,alt:"Pesquisar"})])]),_:1})]),_:1}),e[17]||(e[17]=d("hr",{class:"mt-5 mb-5"},null,-1)),a(Ae,{headers:ae,style:{"min-width":"1230px","font-size":"12px"},items:o(_),"item-key":"id"},{"item.actions":n(({item:t})=>[a(D,{style:{display:"flex",gap:"2px","margin-top":"-5px"}},{default:n(()=>[d("div",{class:X({disabled:!t.btn_receber}),title:t.btn_receber?"Receber":"Bloqueado",onClick:W=>t.btn_receber?ie(t.numero,t):null},[d("img",{style:z({cursor:t.btn_receber?"pointer":"default",width:"30px",height:"30px"}),src:Se,alt:"Receber"},null,4)],10,Pe),d("div",{class:X({disabled:!t.btn_editar}),onClick:W=>t.btn_editar?se(t.id):null,title:t.btn_editar?"Editar":"Bloqueado"},[d("img",{style:z({cursor:t.btn_editar?"pointer":"default",width:"30px",height:"30px"}),src:Oe,alt:"Editar"},null,4)],10,Ee),d("div",{disabled:!t.btn_cancelar,onClick:W=>t.btn_cancelar?ne(t):null,title:"Cancelamento",style:z({opacity:t.btn_cancelar?1:.5,cursor:t.btn_cancelar?"pointer":"not-allowed"})},[t.excluido?(I(),Z("img",Me)):(I(),Z("img",ze))],12,Be)]),_:2},1024)]),_:1},8,["items"]),a(f,{show:o(h),numero_os:o(i),ordem:o(y),onClose:e[13]||(e[13]=t=>h.value=!1),onRefreshValue:e[14]||(e[14]=t=>j())},null,8,["show","numero_os","ordem"]),a(K,{show:o(T),numero_os:o(i),ordemserv_token:o(v),onClose:e[15]||(e[15]=t=>T.value=!1)},null,8,["show","numero_os","ordemserv_token"])]),_:1})}}};export{ft as default};
