import{_ as N,K as S,r as c,H as w,I as M,c as u,a as l,F as p,D as R,m as L,E as D,x as H,o as d,p as O,d as z,t as B,l as U,n as $}from"./DuCAdtKR.js";const T={class:"chat-container"},j=["onClick"],F={__name:"index",setup(W){const h=U(),k=S(),i=c(""),b=c([{from:"server",text:"Por favor, me informe seu nome"}]),r=c(),g=c("chat_bot_message"),m=c(null),f=c(!1),y=c();let a=null;const v=k.query.cartorio_token;function n(o,s){console.log("from ",o),console.log("userName ",r.value),o!==r.value&&(console.log("addMessage",o),b.value.push({from:o,text:s})),$(()=>{m.value&&(m.value.scrollTop=m.value.scrollHeight)})}function _(){if(r.value||(r.value=i.value,x()),!i.value.trim())return;const o=C(i.value);n("user",o);const s={type:g.value,message:o,cartorio_token:v,isHumanized:f.value};console.log("#######################################",s),console.log("typeMenssage",g.value),i.value="",a.send(JSON.stringify(s))}function x(){a=new WebSocket(`${h.public.chat_bot}?user_name=${r.value}`),a.addEventListener("open",()=>{console.log("âœ… Conectado ao servidor")}),a.addEventListener("message",o=>{var s;console.log("Conectando ao chat:",o);try{const e=JSON.parse(o.data),t=(s=e==null?void 0:e.message)==null?void 0:s.state;switch(t){case"ExibirResposta":console.log("ExibirResposta:",o),console.log("ðŸ“¥ ExibirResposta"),y.value=e.message,n("button",e.message);break;case"Fim":console.log("Fim:",o),console.log("ðŸ“´ Chat encerrado pelo servidor"),a.close(1e3,"Chat encerrado pelo servidor");break;case void 0:if(console.log("undefined:",o),e.type==="connection_info")console.log("ðŸ”— InformaÃ§Ãµes de conexÃ£o recebidas");else{if(e.type==="user_joined"||e.type==="user_left")break;e.username&&e.username!=r.value?n("server",e.message):n(r.value,e.message)}break;case"NotasDevolutivas":console.log("NotasDevolutivas:",e.message),f.value=!0,g.value="chat_message",n("server",e.message);break;default:console.log("default:",o),console.log(`ðŸ“¨ Mensagem com estado "${t}"`),console.log("ðŸ“© Mensagem com estado desconhecido:",e),n("server",e.message);break}}catch(e){console.error("âŒ Erro ao processar mensagem:",e),n("server",o.data)}}),a.addEventListener("close",()=>{console.log("âŒ ConexÃ£o encerrada"),n("system","âš ï¸ Chat encerrado")}),a.addEventListener("error",o=>{console.error("âš ï¸ Erro na conexÃ£o:",o),n("system","âš ï¸ Erro na conexÃ£o")})}function E(o){fetch(o).then(s=>{if(!s.ok)throw new Error("Erro ao baixar o arquivo");return s.blob()}).then(s=>{const e=URL.createObjectURL(s),t=document.createElement("a");t.href=e,t.download="documento.pdf",t.click(),URL.revokeObjectURL(e)})}function C(o){const s=typeof o=="object"?o.message:o,e=/(https?:\/\/[^\s]+)/g;return s.replace(e,t=>`<a href="${t}" target="_blank" class="chat-link">${t}</a>`)}return w(f,o=>{if(console.log("isHumanized:",o),o===!0)if(a&&a.readyState===WebSocket.OPEN){const s={type:"chat_message",message:"O chat foi humanizado.",cartorio_token:v,isHumanized:o};a.send(JSON.stringify(s))}else console.warn("âš ï¸ WebSocket nÃ£o estÃ¡ conectado.")}),M(()=>{a&&a.readyState===WebSocket.OPEN&&a.close()}),(o,s)=>(d(),u("div",T,[s[2]||(s[2]=l("div",{class:"chat-header"},[l("span",{class:"chat-title"},"Chat"),l("button",{class:"chat-close"},"Ã—")],-1)),l("div",{ref_key:"chatHistory",ref:m,class:"chat-history"},[(d(!0),u(p,null,R(b.value,(e,t)=>(d(),u("div",{key:t,class:O(["chat-bubble",e.from==="user"?"user-bubble":e.from==="system"?"system-bubble":"server-bubble"])},[e.from==="button"?(d(),u("button",{key:0,class:"chat-button",onClick:I=>E(e.text.message)}," ðŸ“Ž Baixar documento ",8,j)):(d(),u(p,{key:1},[z(B(e.text.message||e.text),1)],64))],2))),128))],512),l("form",{onSubmit:H(_,["prevent"]),class:"chat-input-area"},[L(l("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>i.value=e),type:"text",placeholder:"Digite sua mensagem...",class:"chat-input"},null,512),[[D,i.value]]),s[1]||(s[1]=l("button",{type:"submit",class:"chat-send-button"},"âž¤",-1))],32)]))}},P=N(F,[["__scopeId","data-v-b72838cf"]]);export{P as default};
