import{_ as se}from"./fiuSTN_D.js";import{c as $e,r as we,u as Ce}from"./D054h1-_.js";import{g as Me,D as Q,K as H,u as re,r as l,e as S,f as ce,y as de,o as V,h as X,w as a,b as e,i as t,s as oe,V as J,d as U,k as ee,A as De,a as v,c as L,p as pe,M as Re,N as je,F as Ve,O as ke,t as ae}from"./DAXHVUaZ.js";import{u as k}from"./7hVpA9Md.js";import{V as O}from"./C1zAWlGE.js";import{V as j}from"./Dff3iLlp.js";import{V as le}from"./C3lof1z9.js";import{V as me}from"./Cwnh_cnW.js";import{_ as Ne,a as Ie,b as Ue}from"./DDQL2I7D.js";import{_ as Be,a as Fe,b as Le,T as We,W as Ke,D as ze,c as Je,d as Ge}from"./BASRY8M3.js";import{_ as Ye,r as Ee}from"./D3b8EIli.js";import{_ as ie}from"./BD_mv71E.js";import{_ as ue}from"./BVz1G1IN.js";import{_ as Xe}from"./DY9t0h-3.js";import{_ as ye,a as he}from"./DJvq3mCv.js";import{V as be}from"./BTmyphrO.js";import{_ as Ze}from"./wk1seclA.js";import{V as Qe}from"./CD_Flf9A.js";import{f as xe}from"./B0IxRygJ.js";import{_ as He}from"./1XTS2bvA.js";const Ut={__name:"Dados",props:{ato_token:{type:String,required:!0},ato_tipo_id:{type:Number}},emits:["saved"],async setup(W,{emit:w}){let y,_;const f=W;Me(()=>f.ato_tipo_id,o=>{x.value={id:o}});const z=w,h=Q(),E=H(),B=ee(),{$toast:F}=re(),K=`${B.public.managemant}/listarSituacoes`,$=`${B.public.managemant}/createAtos`;`${B.public.managemant}`;const C=l(S("user-data").value.cartorio_token),g=l(S("user-service").value.id).value||l(S("user-service").value).value,N=l([]),x=l(f.ato_tipo_id?{id:f.ato_tipo_id}:null),b=ce({dt_abertura:null,status:"EM EDIÇÃO",mne:null}),q={status:{required:$e.withMessage("O campo é obrigatorio",we)}},T=Ce(q,b);async function P(){if(await T.value.$validate()){const{data:o,error:s,status:i}=await k($,{method:"POST",body:{ato_tipo_id:x.value.id,cartorio_id:S("user-data").value.cartorio_id,ordemserv_id:g,status:b.status,dt_abertura:b.dt_abertura,mne:b.mne,user_id:S("user-data").value.usuario_id,user_alteracao_id:S("user-data").value.usuario_id}},"$9ZmTYsLk0K");i.value==="success"&&(F.success("Ato registrado com sucesso!"),z("saved",{id:o.value.id,token:o.value.token}))}else F.error("Preencha os campos obrigatorios.")}const{data:M}=([y,_]=de(()=>k(K,{method:"POST",body:{cartorio_token:C.value}},"$hyq5YcBEjF")),y=await y,_(),y);N.value=M.value;const u=()=>{const o=E.query.origem||"criar",s=E.query.id;switch(o){case"atualizar":case"vizualizar":h.push(`/os/atualizar/${s}`);break;case"atualizar-lista":case"vizualizar-lista":h.push("/atos/lista");break;default:h.push("/os/criar-registro");break}};return(o,s)=>{const i=se;return V(),X(me,null,{default:a(()=>[e(O,{class:"mt-5"},{default:a(()=>[e(j,{cols:"3"},{default:a(()=>[e(le,{label:"Situação",modelValue:t(b).status,"onUpdate:modelValue":s[0]||(s[0]=r=>t(b).status=r),items:t(N),"item-title":"descricao","item-value":"descricao",required:"","error-messages":t(T).status.$errors.map(r=>r.$message),onBlur:t(T).status.$touch,onInput:t(T).status.$touch},null,8,["modelValue","items","error-messages","onBlur","onInput"])]),_:1})]),_:1}),e(O,null,{default:a(()=>[e(j,{cols:"5"},{default:a(()=>[e(oe,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:t(b).mne,"onUpdate:modelValue":s[1]||(s[1]=r=>t(b).mne=r)},null,8,["modelValue"])]),_:1})]),_:1}),e(O,null,{default:a(()=>[e(j,{cols:"2"},{default:a(()=>[e(oe,{modelValue:t(b).dt_abertura,"onUpdate:modelValue":s[2]||(s[2]=r=>t(b).dt_abertura=r),type:"date",label:"Data Lavratura",disabled:"",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(O,{class:"mb-3"},{default:a(()=>[e(i,{onClick:u},{default:a(()=>[e(J,{size:"large",color:"red"},{default:a(()=>s[3]||(s[3]=[U("Voltar")])),_:1})]),_:1}),e(J,{class:"ml-10",onClick:P,size:"large",color:"green"},{default:a(()=>s[4]||(s[4]=[U("Salvar")])),_:1})]),_:1})]),_:1})}}},et=["onClick"],tt=["onClick"],at=["onClick"],ot={key:0,style:{width:"30px",height:"30px"},src:ye,alt:"Visualizar",title:"Reativar"},st={key:1,src:he,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},rt=["onClick"],Bt={__name:"Partes",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},async setup(W){let w,y;const _=W,f=Q(),z=H(),h=ee(),{$toast:E}=re(),B=`${h.public.managemant}/pesquisarPessoas`,F=`${h.public.managemant}/listarPapeis`,K=`${h.public.managemant}/download`,$=`${h.public.managemant}/createAtosPessoa`,C=`${h.public.managemant}/getAtosPessoaById`,g=`${h.public.managemant}/updateAtosPessoa`,N=l(S("user-data").value.cartorio_token),x=l([]),b=l({}),q=l([]),T=l([]),P=l(!1),M=l(!1),u=l(!1),o=l(!1),s=l(null),i=l(null),r=l(null),c=l(null);l(null);const m=l(null),A=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"400px"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome"},{value:"actions"}],d=ce({papeis:null,nome:null,pessoa:null,documento:null});De(()=>{var p;return((p=d.pessoa)==null?void 0:p.link_ficha)||!1});const{data:Y}=([w,y]=de(()=>k(F,{method:"POST",body:{tipo_ato_token:_.ato_token}},"$fFKndZhA4W")),w=await w,y(),w);T.value=Y.value;async function G(){try{const{data:p,error:n}=await k(B,{method:"POST",body:{cartorio_token:N.value,documento:d.documento,nome:d.nome}},"$o3ZL1rvYrY");p.value.length>0?(x.value=p.value,d.pessoa=x.value[0]):x.value=[]}catch(p){console.error("Erro na requisição",p)}}const I=()=>{M.value=!0},te=p=>{q.value=q.value.map(n=>n.id===r.value?{...n,papel:{...n.papel,descricao:p}}:n)},Z=p=>{const n=q.value.find(D=>D.pessoa.id===c.value);n.representante.nome=p},ne=async()=>{const p={pessoa:d.pessoa,papel:T.value.find(D=>D.id===d.papeis),representante:{nome:null}},n=await k(`${C}/${_.ato_id}`,{method:"GET"},"$kXSxUa4grs");for(const D of n.data.value)if(D.pessoa_id===d.pessoa.id&&D.ato_id===_.ato_id&&D.tipo_parte_id===d.papeis){E.error("Pessoa Já Registrada Com Esse Papel!");return}try{const{data:D,error:_e,status:fe}=await k($,{method:"POST",body:{ato_id:Number(_.ato_id),pessoa_id:d.pessoa.id,tipo_parte_id:d.papeis,user_id:Number(S("user-data").value.usuario_id)}},"$So3qnQu7ek");fe.value==="success"?(p.id=D.value.id,E.success("Pessoa Registrada com Sucesso!"),q.value.push(p)):E.error(_e.value.message)}catch{E.error("Erro no servidor. Tente novamente.")}},ve=async p=>{u.value=!0;const{data:n}=await k(K,{method:"POST",body:{bucket:S("user-data").value.cartorio_token,path:p.pessoa.link_ficha}},"$Q3kbIwtd9t");m.value=n.value,b.value=p.pessoa},Pe=p=>{const n=q.value.filter(D=>D.pessoa.id!==p.pessoa.id).map(D=>({id:D.pessoa.id,nome:D.pessoa.nome}));r.value=p.id,s.value=n,P.value=!0,i.value=p.pessoa.nome,c.value=p.pessoa.id},Ae=p=>{r.value=p.id,o.value=!0,i.value=p.pessoa.nome};async function Se(p){p.excluido=!p.excluido;try{await k(`${g}/${r.value}`,{method:"PUT",body:JSON.stringify({excluido:p.excluido})},"$9xStKwGd7o")}catch(n){console.error("Erro ao excluir pessoa:",n)}}const Oe=()=>{const p=z.query.origem||"criar",n=z.query.id;switch(p){case"atualizar":case"vizualizar":f.push(`/os/atualizar/${n}`);break;case"atualizar-lista":case"vizualizar-lista":f.push("/atos/lista");break;default:f.push("/os/criar-registro");break}};return(p,n)=>{const D=Ne,_e=Fe,fe=Le,qe=Ye,Te=se;return V(),X(me,null,{default:a(()=>[e(O,{class:"mt-5"},{default:a(()=>[e(j,{cols:"3"},{default:a(()=>[e(oe,{label:"Documento",modelValue:t(d).documento,"onUpdate:modelValue":n[0]||(n[0]=R=>t(d).documento=R)},null,8,["modelValue"])]),_:1}),e(j,{cols:"4"},{default:a(()=>[e(oe,{label:"Pessoa",modelValue:t(d).nome,"onUpdate:modelValue":n[1]||(n[1]=R=>t(d).nome=R)},null,8,["modelValue"])]),_:1}),v("div",null,[v("img",{class:"mt-3",src:ie,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:G})]),v("div",null,[v("img",{class:"mt-3 ml-2",src:ue,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:I})])]),_:1}),e(O,null,{default:a(()=>[e(j,{cols:"4"},{default:a(()=>[e(le,{label:"Selecione a Pessoa",modelValue:t(d).pessoa,"onUpdate:modelValue":n[2]||(n[2]=R=>t(d).pessoa=R),items:t(x),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),e(j,{cols:"3"},{default:a(()=>[e(le,{label:"Papel",modelValue:t(d).papeis,"onUpdate:modelValue":n[3]||(n[3]=R=>t(d).papeis=R),items:t(T),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),v("div",null,[v("img",{class:"mt-3",src:ue,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:ne})])]),_:1}),e(O,null,{default:a(()=>[e(j,null,{default:a(()=>[e(be,{style:{height:"465px"},headers:A,items:t(q)},{"item.actions":a(({item:R})=>[e(O,null,{default:a(()=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ge=>ve(R),title:"Visualizar Ficha"},n[8]||(n[8]=[v("img",{style:{width:"30px",height:"30px"},src:ie,alt:"Visualizar"},null,-1)]),8,et),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ge=>Ae(R),class:"mr-2",title:"Alterar Papel"},n[9]||(n[9]=[v("img",{style:{width:"30px",height:"30px"},src:Xe,alt:"Visualizar"},null,-1)]),8,tt),v("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ge=>Se(R),title:"Deletar Pessoa"},[R.excluido?(V(),L("img",ot)):(V(),L("img",st))],8,at),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ge=>Pe(R),title:"Selecionar Representante"},n[10]||(n[10]=[v("img",{style:{width:"30px",height:"30px"},src:Be,alt:"Visualizar"},null,-1)]),8,rt)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),e(D,{show:t(M),onClose:n[4]||(n[4]=R=>M.value=!1)},null,8,["show"]),e(_e,{representante_nome:t(i),representantes:t(s),ato_id:t(r),show:t(P),onClose:n[5]||(n[5]=R=>P.value=!1),onUpdateRepresentante:Z},null,8,["representante_nome","representantes","ato_id","show"]),e(fe,{representante_nome:t(i),ato_token:_.ato_token,ato_id:t(r),show:t(o),onClose:n[6]||(n[6]=R=>o.value=!1),onUpdatePapel:te},null,8,["representante_nome","ato_token","ato_id","show"]),t(u)?(V(),X(qe,{key:0,show:t(u),"link-view":t(m),"pessoa-obj":t(b),"is-view":!0,onClose:n[7]||(n[7]=R=>u.value=!1)},null,8,["show","link-view","pessoa-obj"])):pe("",!0),e(O,null,{default:a(()=>[e(Te,{onClick:Oe},{default:a(()=>[e(J,{size:"large",color:"red"},{default:a(()=>n[11]||(n[11]=[U("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},nt={key:0,class:"loading-overlay"},lt="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",Ft={__name:"Minuta",props:{ato_token:{type:String,required:!0}},emits:["page","doc"],setup(W,{emit:w}){const y=W;Re("DocumentEditorContainer",[We,Ke]);const _=ee(),{$toast:f}=re(),z=Q(),h=H(),E=w;Ee(`${_.public.docEditor}`);const B=`${_.public.managemant}/upload`,F=`${_.public.managemant}/subitituirModelo`,K=`${_.public.managemant}/download`,$=l(null),C=l(!1),g=async u=>{try{const o=await fetch(u);if(!o.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await o.blob()}catch(o){return console.error(o),null}},N=async()=>{const o=await $.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),s=new FileReader;s.onload=()=>{const i=s.result;E("doc",i)},s.readAsText(o)},x=async()=>{C.value=!0;try{const o=await $.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),s=new FormData;s.append("file",o,"anexo.docx"),s.append("cartorio_token",S("user-data").value.cartorio_token),s.append("token",y.ato_token),s.append("tipo","ato_minuta");const{data:i,status:r}=await k(B,{method:"POST",body:s},"$071xxdqs20");if(r.value==="success"){f.success("Documento enviado!");const m=$.value.ej2Instances.documentEditor.pageCount;N(),E("page",m)}else f.error("Erro ao enviar documento para o sistema.")}catch(u){f.error("Erro ao salvar documento."),console.error(u)}finally{C.value=!1}},b=async()=>{P(!0);try{await q(),P(!0);const{data:u,status:o}=await k(F,{method:"POST",body:{ato_token:y.ato_token}},"$0ktpWliD4l");u.value&&T(u.value)}catch(u){console.error("Erro ao gerar a minuta:",u),f.error("Ocorreu um erro ao gerar a minuta.")}finally{P(!1)}},q=async()=>{try{const{data:u}=await k(K,{method:"POST",body:{bucket:S("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$jXVvQjEE6u"),o=await g(u.value);if(o){const s=new FileReader;s.onload=()=>{const i=s.result;$.value.ej2Instances.documentEditor.open(i),E("doc",i)},s.readAsText(o)}}catch(u){console.error("Erro ao carregar o modelo de minuta:",u),f.error("Falha ao carregar o modelo de minuta.")}},T=u=>{const o=$.value.ej2Instances.documentEditor,s=i=>{for(const[r,c]of Object.entries(i))if(/^<<.+>>$/.test(r))try{o.search.findAll(r),o.search.searchResults.length>0&&o.search.searchResults.replaceAll(c)}catch(m){console.error(`Erro ao substituir o marcador ${r}:`,m)}else if(r==="partes"&&Array.isArray(c)&&c.length>0)for(const m of c)typeof m=="object"&&s(m)};s(u)},P=u=>{C.value=u},M=()=>{const u=h.query.origem||"criar",o=h.query.id;switch(u){case"atualizar":case"vizualizar":z.push(`/os/atualizar/${o}`);break;case"atualizar-lista":case"vizualizar-lista":z.push("/atos/lista");break;default:z.push("/os/criar-registro");break}};return(u,o)=>{const s=se;return V(),L(Ve,null,[e(t(ze),{height:"900px",ref_key:"documentEditorContainer",ref:$,serviceUrl:lt,enableToolbar:!0,enableWordExport:!0},null,512),t(C)?(V(),L("div",nt,[e(je,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):pe("",!0),e(O,{class:"ml-4 mt-4 mb-4"},{default:a(()=>[e(s,{class:"mr-4"},{default:a(()=>[e(J,{size:"large",onClick:M,color:"red"},{default:a(()=>o[0]||(o[0]=[U("Voltar")])),_:1})]),_:1}),e(J,{size:"large",color:"green",onClick:x,disabled:t(C)},{default:a(()=>o[1]||(o[1]=[U("Salvar")])),_:1},8,["disabled"]),e(J,{class:"ml-4",size:"large",color:"blue",onClick:b},{default:a(()=>o[2]||(o[2]=[U("Gerar Minuta")])),_:1})]),_:1})],64)}}},it=["innerHTML"],Lt={__name:"Livro",props:{ato_token:{type:String,required:!0},pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(W){let w,y;const _=W,f=ee();Ee(`${f.public.docEditor}`);const{$toast:z}=re(),h=Q(),E=H(),B=`${f.public.managemant}/listarEscrevente`,F=`${f.public.managemant}/lavrarAto`,K=`${f.public.managemant}/valida_lavratura`,$=l("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),C=l(!1),g=l(null),N=l(null),x=l(null),b=l(S("user-data").value.cartorio_token),q=S("auth_token").value,T=l([]),P=l({}),M=l(null),u=l(""),o=ce({escrevente:null}),s=async(G=!1)=>{if(!G){const{data:Z}=await k(K,{method:"POST",body:{ato_token:_.ato_token}},"$ZKnVBNYxp9"),ne=Z.value[0].status,ve=Z.value[0].status_mensagem;if(ne!=="OK"){M.value=ne,u.value=ve,P.value=null,C.value=!0,$.value="O ato apresenta inconsistências, deseja prosseguir?";return}}const{data:I,status:te}=await k(F,{method:"POST",body:{ato_token:_.ato_token,qtd_paginas:_.pages,escrevente_token:o.escrevente,usuario_token:q,cartorio_token:b}},"$XouuxOFIWh");te.value==="success"?(g.value=I.value,N.value=I.value[0].selo,z.success("Ato lavrado com sucesso!")):z.error("Falha ao lavrar o ato.")},i=()=>{C.value=!1,M.value=null,u.value="",P.value={}},r=async()=>{const{data:G,status:I}=await k(calculaAto,{method:"POST",body:{ato_token:E.query.ato_token_edit,cartorio_token:b,quantidade:1,usuario_token:q,escrevente_token:o.escrevente,qtd_paginas:_.pages}},"$R51FaaSzOI");I.value==="success"?P.value=G.value[0]:z.error("Falha ao calcular o ato.")},c=async()=>{C.value=!1,M.value&&M.value!=="OK"?(await s(!0),M.value=null,u.value=""):await s()},m=async()=>{C.value=!0,await r()},{data:A}=([w,y]=de(()=>k(B,{method:"POST",body:{cartorio_token:b}},"$JCPnpnnRzP")),w=await w,y(),w);T.value=A.value[0].func_json_escreventes;const d=function(){x.value.ej2Instances.documentEditor.open(_.document)},Y=()=>{const G=E.query.origem||"criar",I=E.query.id;switch(G){case"atualizar":case"vizualizar":h.push(`/os/atualizar/${I}`);break;case"atualizar-lista":case"vizualizar-lista":h.push("/atos/lista");break;default:h.push("/os/criar-registro");break}};return(G,I)=>{const te=Ze;return V(),L(Ve,null,[e(O,null,{default:a(()=>[e(j,null,{default:a(()=>[(V(),X(t(ze),{restrictEditing:!0,enableToolbar:!1,created:_.document?d:null,ref_key:"documentEditorContainer",ref:x,height:"850px",width:"850px",key:_.document},null,8,["created"]))]),_:1}),e(j,null,{default:a(()=>[e(le,{class:"mt-15",label:"Tabelião/escrevente",modelValue:t(o).escrevente,"onUpdate:modelValue":I[0]||(I[0]=Z=>t(o).escrevente=Z),items:t(T),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),v("div",null,[v("div",null,[v("img",{onClick:I[1]||(I[1]=Z=>m()),class:"ml-2",style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:Je}),t(g)?(V(),X(Qe,{key:0,class:"mr-16"},{default:a(()=>[e(O,{"no-gutters":""},{default:a(()=>[e(j,null,{default:a(()=>[e(ke,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:a(()=>[e(j,null,{default:a(()=>[U(" Livro: "+ae(t(g)[0].livro_numero),1)]),_:1}),e(j,null,{default:a(()=>[U(" Protocolo: "+ae(t(g)[0].protocolo?t(g)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),e(j,null,{default:a(()=>[e(ke,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:a(()=>[U(" Folhas : "+ae(t(g)[0].pagina_inicial)+" A "+ae(t(g)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),v("div",{innerHTML:t(N)},null,8,it)]),_:1})):pe("",!0)])])]),_:1})]),_:1}),e(J,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:Y},{default:a(()=>I[2]||(I[2]=[U("Voltar")])),_:1}),e(te,{show:t(C),condMessage:t($),valor:t(P),description:t(u),onClose:i,onConfirm:c},null,8,["show","condMessage","valor","description"])],64)}}},ut=["onClick"],ct=["onClick"],dt={key:0,style:{width:"30px",height:"30px"},src:ye,alt:"Visualizar",title:"Reativar"},pt={key:1,src:he,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Wt={__name:"Observacao",props:{ato_id:{type:Number,required:!0}},async setup(W){let w,y;const _=W,f=Q(),z=H(),h=ee(),E=`${h.public.managemant}/listarEscrevente`,B=`${h.public.managemant}/atos_observacao`,F=`${h.public.managemant}/atos_observacao`,K=l(S("user-data").value.cartorio_token),$=l([]),C=l([]),g=l(!1),N=l(!1),x=l(""),b=[{title:"Data",align:"start",key:"data"},{title:"Escrevente",align:"start",key:"escrevente"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}];function q(i){x.value=i.observacao,N.value=!0,g.value=!0}const T=()=>{N.value=!1,g.value=!0,x.value=""};async function P(i){i.excluido=!i.excluido;try{await k(`${B}/${i.id}`,{method:"PUT",body:JSON.stringify({excluido:i.excluido})},"$aJM1TL1buW")}catch(r){console.error("Erro ao excluir observacao:",r)}}const M=async()=>{g.value=!1,await u()};async function u(){const{data:i}=await k(`${F}/${_.ato_id}`,{method:"GET"},"$dMg99jeUNP");Array.isArray(i.value)?$.value=i.value.map(r=>({...r,created:xe(r.created,"dd/mm/yyyy hh:mm")})):i.value&&typeof i.value=="object"&&($.value=[{...i.value,created:xe(i.value.created,"dd/mm/yyyy hh:mm")}])}const{data:o}=([w,y]=de(()=>k(E,{method:"POST",body:{cartorio_token:K}},"$B6PdRx8Gp4")),w=await w,y(),w);C.value=o.value[0].func_json_escreventes;const s=()=>{const i=z.query.origem||"criar",r=z.query.id;i==="atualizar"?f.push(`/os/atualizar/${r}`):f.push("/os/criar-registro")};return(i,r)=>{const c=Ge,m=se;return V(),X(me,null,{default:a(()=>[e(O,{class:"mt-5"},{default:a(()=>[e(J,{class:"mb-4 ml-8",onClick:T,size:"large",color:"green"},{default:a(()=>r[1]||(r[1]=[U("Novo")])),_:1}),v("div",null,[v("img",{class:"btn-pointer ml-2",src:ue,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:r[0]||(r[0]=(...A)=>i.onSubmit&&i.onSubmit(...A))})])]),_:1}),e(O,null,{default:a(()=>[e(j,null,{default:a(()=>[e(be,{style:{height:"465px"},headers:b,items:t($)},{"item.observacao":a(({item:A})=>[U(ae(A.observacao.length>100?A.observacao.slice(0,100)+"...":A.observacao),1)]),"item.actions":a(({item:A})=>[e(O,null,{default:a(()=>[v("div",{onClick:d=>q(A)},r[2]||(r[2]=[v("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ie,alt:"Visualizar"},null,-1)]),8,ut),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:d=>P(A),title:"Deletar Observação"},[A.excluido?(V(),L("img",dt)):(V(),L("img",pt))],8,ct)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),t(g)?(V(),X(c,{key:0,show:t(g),observacao:t(x),visualizar:t(N),onClose:M},null,8,["show","observacao","visualizar"])):pe("",!0),e(O,null,{default:a(()=>[e(m,{onClick:s},{default:a(()=>[e(J,{size:"large",color:"red"},{default:a(()=>r[3]||(r[3]=[U("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},mt={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ie,alt:"Criar"},vt={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ue,alt:"Criar"},_t={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:He,alt:"Criar"},ft=["onClick"],gt=["onClick"],yt=["onClick"],ht={key:0,style:{width:"30px",height:"30px"},src:ye,alt:"Visualizar",title:"Reativar"},bt={key:1,src:he,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Kt={__name:"Anexos",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},setup(W){const w=W,y=ee(),{$toast:_}=re(),f=Q(),z=H(),h=`${y.public.biometria}/run-scanner`,E=`${y.public.managemant}/atos_anexos`,B=`${y.public.managemant}/atos_anexos`,F=`${y.public.managemant}/download`;`${y.public.managemant}`,`${y.public.managemant}`;const K=l(!1),$=l(null),C=l([]);S("pessoa_token");const g=ce({descricao:"",fileEvent:null}),N={descricao:{required:$e.withMessage("O campo é obrigatório",we)}},x=Ce(N,g,{$autoDirty:!0}),b=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}];async function q(){try{await T(),await P()}catch(c){console.error("Erro ao executar scanner ou listar arquivos:",c)}}async function T(){try{const{data:c}=await k(h,{method:"GET"},"$WazoKp68Tw")}catch(c){_.error("Erro ao acionar o scanner:",c)}}async function P(){try{const{data:c,status:m}=await k("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:z.query.ato_token_edit,cartorio_token:S("user-data").value.cartorio_token}},"$03Wxiia3aI")}catch(c){console.error("Erro ao enviar o arquivo:",c)}}const M=async()=>{K.value=!0};function u(c){return c?!0:(console.error("Erro: Nenhum arquivo foi selecionado!"),$.value=!1,!1)}const o=async()=>{if(x.value.$touch(),!x.value.$invalid&&u(g.fileEvent)){const{data:c,error:m,status:A}=await k(E,{method:"POST",body:{ato_id:w.ato_id,descricao:g.descricao,user_id:S("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$WyW0hasRPI");A.value==="success"&&(_.success("Anexo registrado com sucesso!"),C.value.push(c.value))}};async function s(c){c.excluido=!c.excluido;try{await k(`${B}/${c.id}`,{method:"PUT",body:JSON.stringify({excluido:c.excluido})},"$Y3y6TjqbSV")}catch(m){console.error("Erro ao excluir pessoa:",m)}}async function i(c){try{const m=await k(`${F}`,{method:"POST",body:{bucket:S("user-data").value.cartorio_token,path:c.link}},"$bkXJSi7s76"),d=await(await fetch(m.data.value)).blob(),Y=URL.createObjectURL(d);window.open(Y,"_blank")}catch(m){console.error("Erro ao excluir pessoa:",m)}}const r=()=>{const c=z.query.origem||"criar",m=z.query.id;switch(c){case"atualizar":case"vizualizar":f.push(`/os/atualizar/${m}`);break;case"atualizar-lista":case"vizualizar-lista":f.push("/atos/lista");break;default:f.push("/os/criar-registro");break}};return(c,m)=>{const A=se;return V(),X(me,null,{default:a(()=>[e(O,null,{default:a(()=>[e(j,{cols:"5",class:"mt-2"},{default:a(()=>[e(oe,{modelValue:t(g).descricao,"onUpdate:modelValue":[m[0]||(m[0]=d=>t(g).descricao=d),t(x).descricao.$touch],"error-messages":t(x).descricao.$errors.map(d=>d.$message),onBlur:t(x).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"])]),_:1}),v("div",{onClick:q,title:"Criar",style:{"padding-right":"10px"}},[t($)===!1?(V(),L("img",mt)):t($)===!0?(V(),L("img",vt)):(V(),L("img",_t))]),v("div",{onClick:o,title:"Criar"},m[1]||(m[1]=[v("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:ue,alt:"Escanear"},null,-1)]))]),_:1}),e(be,{headers:b,items:t(C),style:{height:"465px","max-width":"600px"}},{"item.actions":a(({item:d})=>[e(O,null,{default:a(()=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:Y=>M(d),title:"Visualizar Anexo"},[v("img",{style:{width:"30px",height:"30px"},onClick:Y=>i(d),src:ie,alt:"Visualizar"},null,8,gt)],8,ft),v("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:Y=>s(d),title:"Deletar Pessoa"},[d.excluido?(V(),L("img",ht)):(V(),L("img",bt))],8,yt)]),_:2},1024)]),_:1},8,["items"]),e(A,{onClick:r},{default:a(()=>[e(J,{size:"large",color:"red"},{default:a(()=>m[2]||(m[2]=[U("Voltar")])),_:1})]),_:1})]),_:1})}}};export{Ut as _,Bt as a,Ft as b,Lt as c,Wt as d,Kt as e};
