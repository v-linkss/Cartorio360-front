import{_ as te}from"./BQpsr73C.js";import{c as de,r as me,u as pe}from"./BwKMvsgO.js";import{g as ze,m as Q,M as X,u as Z,r as l,n as V,p as oe,E as ee,o as P,y as G,w as o,b as e,x as t,V as K,G as W,d as F,A as H,I as Me,a as v,c as U,z as _e,O as De,P as Re,F as he,Q as ye,t as ae}from"./B3CWS20p.js";import{u as $}from"./LD0J6Q1I.js";import{V as D}from"./Bv9c7jYJ.js";import{V as j}from"./zC0Mf6NK.js";import{V as se}from"./QjMBemGt.js";import{V as ne}from"./BjG_Q5fV.js";import{_ as je}from"./DW9MQV6T.js";import{_ as Ie,a as Be,b as Ne,T as Ue,W as Fe,D as be,c as Le,e as We,f as Ge,d as Je}from"./D5esxNzH.js";import{_ as Ye,r as xe}from"./DbWNCIRT.js";import{_ as ce}from"./CoNu1dlU.js";import{_ as re}from"./BVz1G1IN.js";import{_ as Ke}from"./vrqv6k1J.js";import{_ as ve,a as fe}from"./DJvq3mCv.js";import{V as ge}from"./e3NevvNt.js";import{_ as Qe}from"./CHwA8kQt.js";import{V as Xe}from"./Dmx4dsn4.js";import{f as Ze}from"./B0IxRygJ.js";const jt={__name:"Dados",props:{ato_token:{type:String,required:!0},ato_tipo_id:{type:Number}},emits:["saved"],async setup(L,{emit:y}){let f,b;const x=L;ze(()=>x.ato_tipo_id,g=>{w.value={id:g}});const A=y,k=Q(),E=X(),B=H(),{$toast:T}=Z(),I=`${B.public.managemant}/listarSituacoes`,R=`${B.public.managemant}/createAtos`;`${B.public.managemant}`;const S=l(V("user-data").value.cartorio_token),q=l(V("user-service").value.id).value||l(V("user-service").value).value,N=l([]),w=l(x.ato_tipo_id?{id:x.ato_tipo_id}:null),_=oe({dt_abertura:null,status:"EM EDIÇÃO",mne:null}),O={status:{required:de.withMessage("O campo é obrigatorio",me)}},s=pe(O,_);async function c(){if(await s.value.$validate()){const{data:g,error:r,status:n}=await $(R,{method:"POST",body:{ato_tipo_id:w.value.id,cartorio_id:V("user-data").value.cartorio_id,ordemserv_id:q,status:_.status,dt_abertura:_.dt_abertura,mne:_.mne,user_id:V("user-data").value.usuario_id,user_alteracao_id:V("user-data").value.usuario_id}},"$9ZmTYsLk0K");n.value==="success"&&(T.success("Ato registrado com sucesso!"),A("saved",{id:g.value.id,token:g.value.token}))}else T.error("Preencha os campos obrigatorios.")}const{data:m}=([f,b]=ee(()=>$(I,{method:"POST",body:{cartorio_token:S.value}},"$hyq5YcBEjF")),f=await f,b(),f);N.value=m.value;const C=()=>{const g=E.query.origem||"criar",r=E.query.id;g==="atualizar"?k.push(`/os/atualizar/${r}`):k.push("/os/criar-registro")};return(g,r)=>{const n=te;return P(),G(ne,null,{default:o(()=>[e(D,{class:"mt-5"},{default:o(()=>[e(j,{cols:"3"},{default:o(()=>[e(se,{label:"Situação",modelValue:t(_).status,"onUpdate:modelValue":r[0]||(r[0]=i=>t(_).status=i),items:t(N),"item-title":"descricao","item-value":"descricao",required:"","error-messages":t(s).status.$errors.map(i=>i.$message),onBlur:t(s).status.$touch,onInput:t(s).status.$touch},null,8,["modelValue","items","error-messages","onBlur","onInput"])]),_:1})]),_:1}),e(D,null,{default:o(()=>[e(j,{cols:"5"},{default:o(()=>[e(K,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:t(_).mne,"onUpdate:modelValue":r[1]||(r[1]=i=>t(_).mne=i)},null,8,["modelValue"])]),_:1})]),_:1}),e(D,null,{default:o(()=>[e(j,{cols:"2"},{default:o(()=>[e(K,{modelValue:t(_).dt_abertura,"onUpdate:modelValue":r[2]||(r[2]=i=>t(_).dt_abertura=i),type:"date",label:"Data Lavratura",disabled:"",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(D,{class:"mb-3"},{default:o(()=>[e(n,{onClick:C},{default:o(()=>[e(W,{size:"large",color:"red"},{default:o(()=>r[3]||(r[3]=[F("Voltar")])),_:1})]),_:1}),e(W,{class:"ml-10",onClick:c,size:"large",color:"green"},{default:o(()=>r[4]||(r[4]=[F("Salvar")])),_:1})]),_:1})]),_:1})}}},He=["onClick"],et=["onClick"],tt=["onClick"],ot={key:0,style:{width:"30px",height:"30px"},src:ve,alt:"Visualizar",title:"Reativar"},at={key:1,src:fe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},st=["onClick"],It={__name:"Partes",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},async setup(L){let y,f;const b=L,x=Q(),A=X(),k=H(),{$toast:E}=Z(),B=`${k.public.managemant}/pesquisarPessoas`,T=`${k.public.managemant}/listarPapeis`,I=`${k.public.managemant}/download`,R=`${k.public.managemant}/createAtosPessoa`,S=`${k.public.managemant}/getAtosPessoaById`,q=`${k.public.managemant}/updateAtosPessoa`,N=l(V("user-data").value.cartorio_token),w=l([]),_=l({}),O=l([]),s=l([]),c=l(!1),m=l(!1),C=l(!1),g=l(!1),r=l(null),n=l(null),i=l(null),u=l(null);l(null);const h=l(null),J=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome"},{value:"actions"}],p=oe({papeis:null,nome:null,pessoa:null,documento:null});Me(()=>{var d;return((d=p.pessoa)==null?void 0:d.link_ficha)||!1});const{data:Y}=([y,f]=ee(()=>$(T,{method:"POST",body:{tipo_ato_token:b.ato_token}},"$fFKndZhA4W")),y=await y,f(),y);s.value=Y.value;async function ke(){try{const{data:d,error:a}=await $(B,{method:"POST",body:{cartorio_token:N.value,documento:p.documento,nome:p.nome}},"$o3ZL1rvYrY");d.value.length>0?(w.value=d.value,p.pessoa=w.value[0]):w.value=[]}catch(d){console.error("Erro na requisição",d)}}const $e=()=>{m.value=!0},we=d=>{O.value=O.value.map(a=>a.id===i.value?{...a,papel:{...a.papel,descricao:d}}:a)},Ce=d=>{const a=O.value.find(z=>z.pessoa.id===u.value);a.representante.nome=d},Ve=async()=>{const d={pessoa:p.pessoa,papel:s.value.find(z=>z.id===p.papeis),representante:{nome:null}},a=await $(`${S}/${b.ato_id}`,{method:"GET"},"$kXSxUa4grs");for(const z of a.data.value)if(z.pessoa_id===p.pessoa.id&&z.ato_id===b.ato_id&&z.tipo_parte_id===p.papeis){E.error("Pessoa Já Registrada Com Esse Papel!");return}try{const{data:z,error:le,status:ie}=await $(R,{method:"POST",body:{ato_id:Number(b.ato_id),pessoa_id:p.pessoa.id,tipo_parte_id:p.papeis,user_id:Number(V("user-data").value.usuario_id)}},"$So3qnQu7ek");ie.value==="success"?(d.id=z.value.id,E.success("Pessoa Registrada com Sucesso!"),O.value.push(d)):E.error(le.value.message)}catch{E.error("Erro no servidor. Tente novamente.")}},Ee=async d=>{C.value=!0;const{data:a}=await $(I,{method:"POST",body:{bucket:V("user-data").value.cartorio_token,path:d.pessoa.link_ficha}},"$Q3kbIwtd9t");h.value=a.value,_.value=d.pessoa},Pe=d=>{const a=O.value.filter(z=>z.pessoa.id!==d.pessoa.id).map(z=>({id:z.pessoa.id,nome:z.pessoa.nome}));i.value=d.id,r.value=a,c.value=!0,n.value=d.pessoa.nome,u.value=d.pessoa.id},Ae=d=>{i.value=d.id,g.value=!0,n.value=d.pessoa.nome};async function Se(d){d.excluido=!d.excluido;try{await $(`${q}/${i.value}`,{method:"PUT",body:JSON.stringify({excluido:d.excluido})},"$9xStKwGd7o")}catch(a){console.error("Erro ao excluir pessoa:",a)}}const Te=()=>{const d=A.query.origem||"criar",a=A.query.id;d==="atualizar"?x.push(`/os/atualizar/${a}`):x.push("/os/criar-registro")};return(d,a)=>{const z=je,le=Be,ie=Ne,qe=Ye,Oe=te;return P(),G(ne,null,{default:o(()=>[e(D,{class:"mt-5"},{default:o(()=>[e(j,{cols:"3"},{default:o(()=>[e(K,{label:"Documento",modelValue:t(p).documento,"onUpdate:modelValue":a[0]||(a[0]=M=>t(p).documento=M)},null,8,["modelValue"])]),_:1}),e(j,{cols:"4"},{default:o(()=>[e(K,{label:"Pessoa",modelValue:t(p).nome,"onUpdate:modelValue":a[1]||(a[1]=M=>t(p).nome=M)},null,8,["modelValue"])]),_:1}),v("div",null,[v("img",{class:"mt-3",src:ce,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:ke})]),v("div",null,[v("img",{class:"mt-3 ml-2",src:re,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:$e})])]),_:1}),e(D,null,{default:o(()=>[e(j,{cols:"4"},{default:o(()=>[e(se,{label:"Selecione a Pessoa",modelValue:t(p).pessoa,"onUpdate:modelValue":a[2]||(a[2]=M=>t(p).pessoa=M),items:t(w),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),e(j,{cols:"3"},{default:o(()=>[e(se,{label:"Papel",modelValue:t(p).papeis,"onUpdate:modelValue":a[3]||(a[3]=M=>t(p).papeis=M),items:t(s),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),v("div",null,[v("img",{class:"mt-3",src:re,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:Ve})])]),_:1}),e(D,null,{default:o(()=>[e(j,null,{default:o(()=>[e(ge,{style:{height:"465px"},headers:J,items:t(O)},{"item.actions":o(({item:M})=>[e(D,null,{default:o(()=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ue=>Ee(M),title:"Visualizar Ficha"},a[8]||(a[8]=[v("img",{style:{width:"30px",height:"30px"},src:ce,alt:"Visualizar"},null,-1)]),8,He),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ue=>Ae(M),class:"mr-2",title:"Alterar Papel"},a[9]||(a[9]=[v("img",{style:{width:"30px",height:"30px"},src:Ke,alt:"Visualizar"},null,-1)]),8,et),v("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ue=>Se(M),title:"Deletar Pessoa"},[M.excluido?(P(),U("img",ot)):(P(),U("img",at))],8,tt),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ue=>Pe(M),title:"Selecionar Representante"},a[10]||(a[10]=[v("img",{style:{width:"30px",height:"30px"},src:Ie,alt:"Visualizar"},null,-1)]),8,st)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),e(z,{show:t(m),onClose:a[4]||(a[4]=M=>m.value=!1)},null,8,["show"]),e(le,{representante_nome:t(n),representantes:t(r),ato_id:t(i),show:t(c),onClose:a[5]||(a[5]=M=>c.value=!1),onUpdateRepresentante:Ce},null,8,["representante_nome","representantes","ato_id","show"]),e(ie,{representante_nome:t(n),ato_token:b.ato_token,ato_id:t(i),show:t(g),onClose:a[6]||(a[6]=M=>g.value=!1),onUpdatePapel:we},null,8,["representante_nome","ato_token","ato_id","show"]),t(C)?(P(),G(qe,{key:0,show:t(C),"link-view":t(h),"pessoa-obj":t(_),"is-view":!0,onClose:a[7]||(a[7]=M=>C.value=!1)},null,8,["show","link-view","pessoa-obj"])):_e("",!0),e(D,null,{default:o(()=>[e(Oe,{onClick:Te},{default:o(()=>[e(W,{size:"large",color:"red"},{default:o(()=>a[11]||(a[11]=[F("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},rt={key:0,class:"loading-overlay"},nt="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",Bt={__name:"Minuta",props:{ato_token:{type:String,required:!0}},emits:["page","doc"],setup(L,{emit:y}){const f=L;De("DocumentEditorContainer",[Ue,Fe]);const b=H(),{$toast:x}=Z(),A=Q(),k=X(),E=y;xe(`${b.public.docEditor}`);const B=`${b.public.managemant}/upload`,T=l(null),I=l(!1),R=async()=>{const c=await T.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),m=new FileReader;m.onload=()=>{const C=m.result;E("doc",C)},m.readAsText(c)},S=async()=>{I.value=!0;try{const c=await T.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),m=new FormData;m.append("file",c,"anexo.docx"),m.append("cartorio_token",V("user-data").value.cartorio_token),m.append("token",f.ato_token),m.append("tipo","ato_minuta");const{data:C,status:g}=await $(B,{method:"POST",body:m},"$071xxdqs20");if(g.value==="success"){x.success("Documento enviado!");const n=T.value.ej2Instances.documentEditor.pageCount;R(),E("page",n)}else x.error("Erro ao enviar documento para o sistema.")}catch(s){x.error("Erro ao salvar documento."),console.error(s)}finally{I.value=!1}},q=async()=>{_(!0);try{await N(),_(!0);const{data:s,status:c}=await $(substituirModelo,{method:"POST",body:{ato_token:f.ato_token}},"$0ktpWliD4l");s.value&&w(s.value)}catch(s){console.error("Erro ao gerar a minuta:",s),x.error("Ocorreu um erro ao gerar a minuta.")}finally{_(!1)}},N=async()=>{try{const{data:s}=await $(baixarDocumento,{method:"POST",body:{bucket:V("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$jXVvQjEE6u"),c=await fetchBlobFromMinIO(s.value);if(c){const m=new FileReader;m.onload=()=>{const C=m.result;T.value.ej2Instances.documentEditor.open(C),E("doc",C)},m.readAsText(c)}}catch(s){console.error("Erro ao carregar o modelo de minuta:",s),x.error("Falha ao carregar o modelo de minuta.")}},w=s=>{const c=T.value.ej2Instances.documentEditor,m=C=>{for(const[g,r]of Object.entries(C))if(/^<<.+>>$/.test(g))try{c.search.findAll(g),c.search.searchResults.length>0&&c.search.searchResults.replaceAll(r)}catch(n){console.error(`Erro ao substituir o marcador ${g}:`,n)}else if(g==="partes"&&Array.isArray(r)&&r.length>0)for(const n of r)typeof n=="object"&&m(n)};m(s)},_=s=>{I.value=s},O=()=>{const s=k.query.origem||"criar",c=k.query.id;s==="atualizar"?A.push(`/os/atualizar/${c}`):A.push("/os/criar-registro")};return(s,c)=>{const m=te;return P(),U(he,null,[e(t(be),{height:"900px",ref_key:"documentEditorContainer",ref:T,serviceUrl:nt,enableToolbar:!0,enableWordExport:!0},null,512),t(I)?(P(),U("div",rt,[e(Re,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):_e("",!0),e(D,{class:"ml-4 mt-4 mb-4"},{default:o(()=>[e(m,{class:"mr-4"},{default:o(()=>[e(W,{size:"large",onClick:O,color:"red"},{default:o(()=>c[0]||(c[0]=[F("Voltar")])),_:1})]),_:1}),e(W,{size:"large",color:"green",onClick:S,disabled:t(I)},{default:o(()=>c[1]||(c[1]=[F("Salvar")])),_:1},8,["disabled"]),e(W,{class:"ml-4",size:"large",color:"blue",onClick:q},{default:o(()=>c[2]||(c[2]=[F("Gerar Minuta")])),_:1})]),_:1})],64)}}},lt=["innerHTML"],Nt={__name:"Livro",props:{ato_token:{type:String,required:!0},pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(L){let y,f;const b=L,x=H();xe(`${x.public.docEditor}`);const{$toast:A}=Z(),k=Q(),E=X(),B=`${x.public.managemant}/listarEscrevente`,T=`${x.public.managemant}/lavrarAto`,I=l("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),R=l(!1),S=l(null),q=l(null),N=l(null),w=l(V("user-data").value.cartorio_token),_=V("auth_token").value,O=l([]),s=oe({escrevente:null}),c=async()=>{try{const{data:n,status:i}=await $(T,{method:"POST",body:{ato_token:b.ato_token,qtd_paginas:b.pages,escrevente_token:s.escrevente,usuario_token:_,cartorio_token:w}},"$ZKnVBNYxp9");i.value==="success"?(S.value=n.value,q.value=n.value[0].selo,A.success("Ato lavrado com sucesso!")):A.error("Falha ao lavrar o ato.")}catch{A.error("Erro ao conectar com o servidor.")}},m=()=>{R.value=!1,c()},{data:C}=([y,f]=ee(()=>$(B,{method:"POST",body:{cartorio_token:w}},"$XouuxOFIWh")),y=await y,f(),y);O.value=C.value[0].func_json_escreventes;const g=function(){N.value.ej2Instances.documentEditor.open(b.document)},r=()=>{const n=E.query.origem||"criar",i=E.query.id;n==="atualizar"?k.push(`/os/atualizar/${i}`):k.push("/os/criar-registro")};return(n,i)=>{const u=Qe;return P(),U(he,null,[e(D,null,{default:o(()=>[e(j,null,{default:o(()=>[(P(),G(t(be),{restrictEditing:!0,enableToolbar:!1,created:b.document?g:null,ref_key:"documentEditorContainer",ref:N,height:"850px",width:"850px",key:b.document},null,8,["created"]))]),_:1}),e(j,null,{default:o(()=>[e(se,{class:"mt-15",label:"Tabelião/escrevente",modelValue:t(s).escrevente,"onUpdate:modelValue":i[0]||(i[0]=h=>t(s).escrevente=h),items:t(O),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),v("div",null,[v("div",null,[v("img",{onClick:i[1]||(i[1]=h=>R.value=!0),class:"ml-2",style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:Le}),t(S)?(P(),G(Xe,{key:0,class:"mr-16"},{default:o(()=>[e(D,{"no-gutters":""},{default:o(()=>[e(j,null,{default:o(()=>[e(ye,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:o(()=>[e(j,null,{default:o(()=>[F(" Livro: "+ae(t(S)[0].livro_numero),1)]),_:1}),e(j,null,{default:o(()=>[F(" Protocolo: "+ae(t(S)[0].protocolo?t(S)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),e(j,null,{default:o(()=>[e(ye,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:o(()=>[F(" Folhas : "+ae(t(S)[0].pagina_inicial)+" A "+ae(t(S)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),v("div",{innerHTML:t(q)},null,8,lt)]),_:1})):_e("",!0)])])]),_:1})]),_:1}),e(W,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:r},{default:o(()=>i[3]||(i[3]=[F("Voltar")])),_:1}),e(u,{show:t(R),condMessage:t(I),onClose:i[2]||(i[2]=h=>R.value=!1),onConfirm:m},null,8,["show","condMessage"])],64)}}},it=["onClick"],ut={key:0,style:{width:"30px",height:"30px"},src:ve,alt:"Visualizar",title:"Reativar"},ct={key:1,src:fe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Ut={__name:"Observacao",props:{ato_id:{type:Number,required:!0}},async setup(L){let y,f;const b=L,x=Q(),A=X(),k=H(),{$toast:E}=Z(),B=`${k.public.managemant}/listarEscrevente`,T=`${k.public.managemant}/getAtosTiposByToken`,I=`${k.public.managemant}/atos_observacao`,R=`${k.public.managemant}/atos_observacao`,S=l(V("user-data").value.cartorio_token),q=l([]),N=l([]),w=[{title:"Data",align:"start",key:"data"},{title:"Escrevente",align:"start",key:"escrevente"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}],_=oe({observacao:null}),O={observacao:{required:de.withMessage("O campo é obrigatorio",me)}},s=pe(O,_);[y,f]=ee(()=>$(`${T}/${b.ato_token}`,{method:"GET"},"$aJM1TL1buW")),y=await y,f();async function c(){if(await s.value.$validate()){const{data:r,error:n,status:i}=await $(I,{method:"POST",body:{ato_id:b.ato_id,observacao:_.observacao,user_id:V("user-data").value.usuario_id}},"$dMg99jeUNP");i.value==="success"&&(q.value.push({data:Ze(r.value.created,"dd/mm/yyyy hh:mm"),observacao:r.value.observacao,id:r.value.id,escrevente:V("user-data").value.nome}),E.success("Observação registrada com sucesso"))}else E.error("Preencha os campos obrigatorios.")}async function m(r){r.excluido=!r.excluido;try{await $(`${R}/${r.id}`,{method:"PUT",body:JSON.stringify({excluido:r.excluido})},"$B6PdRx8Gp4")}catch(n){console.error("Erro ao excluir observacao:",n)}}const{data:C}=([y,f]=ee(()=>$(B,{method:"POST",body:{cartorio_token:S}},"$xFHPGua26S")),y=await y,f(),y);N.value=C.value[0].func_json_escreventes;const g=()=>{const r=A.query.origem||"criar",n=A.query.id;r==="atualizar"?x.push(`/os/atualizar/${n}`):x.push("/os/criar-registro")};return(r,n)=>{const i=te;return P(),G(ne,null,{default:o(()=>[e(D,{class:"mt-5"},{default:o(()=>[e(K,{label:"Observação",modelValue:t(_).observacao,"onUpdate:modelValue":n[0]||(n[0]=u=>t(_).observacao=u),required:"","error-messages":t(s).observacao.$errors.map(u=>u.$message),onBlur:t(s).observacao.$touch,onInput:t(s).observacao.$touch},null,8,["modelValue","error-messages","onBlur","onInput"]),v("div",null,[v("img",{class:"btn-pointer ml-2",src:re,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:c})])]),_:1}),e(D,null,{default:o(()=>[e(j,null,{default:o(()=>[e(ge,{style:{height:"465px"},headers:w,items:t(q)},{"item.actions":o(({item:u})=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:h=>m(u),title:"Deletar Observação"},[u.excluido?(P(),U("img",ut)):(P(),U("img",ct))],8,it)]),_:1},8,["items"])]),_:1})]),_:1}),e(D,null,{default:o(()=>[e(i,{onClick:g},{default:o(()=>[e(W,{size:"large",color:"red"},{default:o(()=>n[1]||(n[1]=[F("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},dt={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:We,alt:"Criar"},mt={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ge,alt:"Criar"},pt={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Je,alt:"Criar"},_t=["onClick"],vt=["onClick"],ft=["onClick"],gt={key:0,style:{width:"30px",height:"30px"},src:ve,alt:"Visualizar",title:"Reativar"},yt={key:1,src:fe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Ft={__name:"Anexos",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},setup(L){const y=L,f=H(),{$toast:b}=Z(),x=Q(),A=X(),k=`${f.public.biometria}/run-scanner`,E=`${f.public.managemant}/atos_anexos`,B=`${f.public.managemant}/atos_anexos`,T=`${f.public.managemant}/download`;`${f.public.managemant}`,`${f.public.managemant}`;const I=l(!1),R=l(null),S=l([]);V("pessoa_token");const q=oe({descricao:"",fileEvent:null}),N={descricao:{required:de.withMessage("O campo é obrigatório",me)}},w=pe(N,q,{$autoDirty:!0}),_=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}];async function O(){try{await s(),await c()}catch(u){console.error("Erro ao executar scanner ou listar arquivos:",u)}}async function s(){try{const{data:u}=await $(k,{method:"GET"},"$WazoKp68Tw")}catch(u){b.error("Erro ao acionar o scanner:",u)}}async function c(){try{const{data:u,status:h}=await $("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:A.query.ato_token_edit,cartorio_token:V("user-data").value.cartorio_token}},"$03Wxiia3aI")}catch(u){console.error("Erro ao enviar o arquivo:",u)}}const m=async()=>{I.value=!0};function C(u){return u?!0:(console.error("Erro: Nenhum arquivo foi selecionado!"),R.value=!1,!1)}const g=async()=>{if(w.value.$touch(),!w.value.$invalid&&C(q.fileEvent)){const{data:u,error:h,status:J}=await $(E,{method:"POST",body:{ato_id:y.ato_id,descricao:q.descricao,user_id:V("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$WyW0hasRPI");J.value==="success"&&(b.success("Anexo registrado com sucesso!"),S.value.push(u.value))}};async function r(u){u.excluido=!u.excluido;try{await $(`${B}/${u.id}`,{method:"PUT",body:JSON.stringify({excluido:u.excluido})},"$Y3y6TjqbSV")}catch(h){console.error("Erro ao excluir pessoa:",h)}}async function n(u){try{const h=await $(`${T}`,{method:"POST",body:{bucket:V("user-data").value.cartorio_token,path:u.link}},"$bkXJSi7s76"),p=await(await fetch(h.data.value)).blob(),Y=URL.createObjectURL(p);window.open(Y,"_blank")}catch(h){console.error("Erro ao excluir pessoa:",h)}}const i=()=>{const u=A.query.origem||"criar",h=A.query.id;u==="atualizar"?x.push(`/os/atualizar/${h}`):x.push("/os/criar-registro")};return(u,h)=>{const J=te;return P(),G(ne,null,{default:o(()=>[e(D,null,{default:o(()=>[e(j,{cols:"5",class:"mt-2"},{default:o(()=>[e(K,{modelValue:t(q).descricao,"onUpdate:modelValue":[h[0]||(h[0]=p=>t(q).descricao=p),t(w).descricao.$touch],"error-messages":t(w).descricao.$errors.map(p=>p.$message),onBlur:t(w).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"])]),_:1}),v("div",{onClick:O,title:"Criar",style:{"padding-right":"10px"}},[t(R)===!1?(P(),U("img",dt)):t(R)===!0?(P(),U("img",mt)):(P(),U("img",pt))]),v("div",{onClick:g,title:"Criar"},h[1]||(h[1]=[v("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:re,alt:"Escanear"},null,-1)]))]),_:1}),e(ge,{headers:_,items:t(S),style:{height:"465px","max-width":"600px"}},{"item.actions":o(({item:p})=>[e(D,null,{default:o(()=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:Y=>m(p),title:"Visualizar Anexo"},[v("img",{style:{width:"30px",height:"30px"},onClick:Y=>n(p),src:ce,alt:"Visualizar"},null,8,vt)],8,_t),v("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:Y=>r(p),title:"Deletar Pessoa"},[p.excluido?(P(),U("img",gt)):(P(),U("img",yt))],8,ft)]),_:2},1024)]),_:1},8,["items"]),e(J,{onClick:i},{default:o(()=>[e(W,{size:"large",color:"red"},{default:o(()=>h[2]||(h[2]=[F("Voltar")])),_:1})]),_:1})]),_:1})}}};export{jt as _,It as a,Bt as b,Nt as c,Ut as d,Ft as e};
