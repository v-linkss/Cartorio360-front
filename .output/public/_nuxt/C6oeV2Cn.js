import{_ as ye}from"./Bc8UI8LS.js";import{_ as ke}from"./XCXwcrWM.js";import{c as Ve,r as ge,u as we}from"./C1SJl4Jp.js";import{r as d,e as x,f as ee,g as Q,o as E,h as F,w as n,b as t,a as m,t as X,d as q,i as a,V as j,j as re,k as te,u as se,s as y,p as he,D as xe,l as $e,n as Ce,m as Se,q as z,x as L,v as G,c as ne}from"./-SSA9wwN.js";import{u as D}from"./-Lk0iAJ0.js";import{V as Z,a as Oe,c as Ue}from"./Pd65PDpt.js";import{V as K}from"./B8WE6rJL.js";import{V as R}from"./Cyct-285.js";import{V as De}from"./DrVAU8jc.js";import{V as ie}from"./BMdE7m6-.js";import{V as _}from"./DOl19-M7.js";import{_ as Re}from"./BVz1G1IN.js";import{_ as Ae}from"./CZRayRtq.js";import{_ as Te}from"./DimVg7MJ.js";import{_ as Ne}from"./DR7KP12P.js";import{_ as Ie}from"./B16moC2y.js";import{_ as Ee,a as qe}from"./DJvq3mCv.js";import{f as J}from"./B0IxRygJ.js";import{V as H}from"./DzONfjRh.js";import{V as Be}from"./BQECmj-d.js";import"./9loluw_Q.js";import"./CZZLiK9j.js";import"./HV9ov9Gp.js";import"./Bc9zWQgt.js";import"./Ue3y6evY.js";import"./C8mxn3yT.js";import"./qFtQSOS4.js";import"./BQYLfc-a.js";import"./DWQxq9t8.js";const Me={style:{color:"red","margin-left":"18px"}},Pe={class:"mb-5",style:{display:"flex","justify-content":"flex-start"}},ze={class:"ml-6"},Le={class:"ml-6"},Je={__name:"Ordem",props:{show:Boolean,numero_os:Number,ordemserv_token:String},emits:["close"],setup(S,{emit:$}){const v=S,u=d(v.show),O=te();d(x("user-data").value.cartorio_token).value;const w=x("auth_token").value,A=`${O.public.managemant}/analisaCancelamento`,T=`${O.public.managemant}/cancelaOs`,k=ee({motivo:null}),b=d(null),N=$,f={motivo:{required:Ve.withMessage("O campo é obrigatorio",ge)}},s=we(f,k);Q(()=>v.show,V=>{u.value=V});const c=()=>{u.value=!1,N("close")};(async()=>{const{data:V,error:p}=await D(`${A}`,{method:"POST",body:{ordemserv_token:v.ordemserv_token}},"$1fnrIk2fgs");b.value=V.value.mensagem})();const U=async()=>{if(await s.value.$validate()){const{status:V}=await D(`${T}`,{method:"POST",body:{usuario_token:w,motivo:k.motivo,ordemserv_token:v.ordemserv_token}},"$21WlhUNXeM");V.value==="success"&&(window.location.reload(),c())}};return(V,p)=>(E(),F(ie,{persistent:"",modelValue:a(u),"onUpdate:modelValue":p[1]||(p[1]=g=>re(u)?u.value=g:null),"max-width":"650"},{default:n(()=>[t(Z,null,{default:n(()=>[t(K,null,{default:n(()=>[t(R,{class:"mb-5 mt-1 ml-2"},{default:n(()=>[p[2]||(p[2]=m("h1",null,"Cancelamento da OS nº",-1)),m("h1",Me,X(v.numero_os),1)]),_:1}),t(K,null,{default:n(()=>[t(Z,{variant:"outlined",class:"mb-5"},{default:n(()=>[t(Oe,null,{default:n(()=>[q(X(a(b)),1)]),_:1})]),_:1}),t(De,{label:"Motivo",modelValue:a(k).motivo,"onUpdate:modelValue":p[0]||(p[0]=g=>a(k).motivo=g),required:"","error-messages":a(s).motivo.$errors.map(g=>g.$message),onBlur:a(s).motivo.$touch,onInput:a(s).motivo.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1})]),_:1}),m("div",Pe,[m("div",ze,[t(j,{size:"large",color:"red",onClick:c},{default:n(()=>p[3]||(p[3]=[q("Fechar")])),_:1})]),m("div",Le,[t(j,{size:"large",color:"green",onClick:U},{default:n(()=>p[4]||(p[4]=[q("Salvar")])),_:1})])])]),_:1})]),_:1},8,["modelValue"]))}},Fe={__name:"ImprecaoRecibo",props:{show:Boolean,apresentante_nome:String,apresentante_cpf:String,visualizar:Boolean,token:String},emits:["close"],setup(S,{emit:$}){const v=S,u=ee({apresentante_nome:v.apresentante_nome,apresentante_cpf:v.apresentante_cpf,token:v.token,usuario_token:x("auth_token").value}),O=$,w=d(v.show),{$toast:A}=se(),k=`${te().public.auth}/service/gerencia/emitir_recibo`;Q(()=>v.show,f=>{w.value=f},{immediate:!0}),Q(()=>v,f=>{u.apresentante_nome=f.apresentante_nome,u.apresentante_cpf=f.apresentante_cpf,u.token=f.token},{deep:!0,immediate:!0});const b=()=>{w.value=!1,O("close")};async function N(){var f,s;try{const{data:c,error:C}=await D(k,{method:"POST",body:{nome_recibo:u.apresentante_nome,doc_recibo:u.apresentante_cpf,usuario_token:u.usuario_token,os_token:u.token},headers:{Authorization:`Bearer ${u.usuario_token}`}},"$26dgQHax0q");if(console.log(c),c.value){const U=new Blob([c.value],{type:"text/html"}),V=URL.createObjectURL(U);window.open(V,"_blank")}else A.error(((s=(f=C==null?void 0:C.value)==null?void 0:f.data)==null?void 0:s.details)||"Erro ao emitir recibo");b()}catch{A.error("Erro inesperado")}}return(f,s)=>(E(),F(ie,{persistent:"",modelValue:a(w),"onUpdate:modelValue":s[2]||(s[2]=c=>re(w)?w.value=c:null),"max-width":"600"},{default:n(()=>[t(Z,null,{default:n(()=>[t(K,null,{default:n(()=>[t(R,{class:"mt-1 mb-3",style:{"justify-content":"space-between"}},{default:n(()=>s[3]||(s[3]=[m("h1",{class:"ml-4"}," Emitir Recibo ",-1)])),_:1}),t(R,null,{default:n(()=>[t(_,{cols:"12",md:"6"},{default:n(()=>[t(y,{label:"Destinatário",modelValue:a(u).apresentante_nome,"onUpdate:modelValue":s[0]||(s[0]=c=>a(u).apresentante_nome=c),readonly:S.visualizar},null,8,["modelValue","readonly"])]),_:1}),t(_,{cols:"12",md:"6"},{default:n(()=>[t(y,{label:"Documento",modelValue:a(u).apresentante_cpf,"onUpdate:modelValue":s[1]||(s[1]=c=>a(u).apresentante_cpf=c),readonly:S.visualizar},null,8,["modelValue","readonly"])]),_:1})]),_:1})]),_:1}),t(Ue,null,{default:n(()=>[t(j,{style:{"background-color":"red",color:"white"},onClick:b},{default:n(()=>s[4]||(s[4]=[q(" Voltar ")])),_:1}),S.visualizar?he("",!0):(E(),F(j,{key:0,style:{"background-color":"green",color:"white"},onClick:N},{default:n(()=>s[5]||(s[5]=[q(" Imprimir ")])),_:1}))]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},je=["title","onClick"],Ke=["onClick","title"],We=["onClick","title"],Ye=["disabled","onClick"],Ge={key:0,style:{width:"30px",height:"30px"},src:Ee,alt:"Visualizar",title:"Reativar"},He={key:1,src:qe,alt:"Cancelamento",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Ct={__name:"index",setup(S){const $=te(),{$toast:v}=se(),u=`${$.public.managemant}/listarUsuarios`,O=`${$.public.managemant}/listarOrdensServico`,w=`${$.public.managemant}/tipoAtos`;`${$.public.auth}`;const A=xe(),T=d(x("auth_token").value)||null,k=d(x("user-data").value.cartorio_token)||null,b=d([]),N=d([]),f=d([]),s=d(["PENDENTE","EM ANDAMENTO","CONCLUÍDA","LAVRADA"]),c=d(!1),C=d(!1),U=d(!1),V=d(null),p=d(null),g=d(null),ae=d({}),M=d({});x("auth_token");const l=ee({numero:null,data_inicio:W(),data_fim:W(),data_lavratura_inicio:null,data_lavratura_fim:null,protocolo:null,livro:null,folha:null,situacao:null,usuario_token:T.value,selo:null,ato_tipo_token:null,apresentante:null}),ue=[{title:"Data Abertura",value:"dt_abertura",width:"100px"},{title:"Data Recebimento",value:"data",width:"100px"},{title:"Número",value:"numero",width:"10px"},{title:"Situação",value:"situacao",width:"115px"},{title:"CPF",value:"apresentante_cpf",width:"100px"},{title:"Apresentante",value:"apresentante_nome",width:"228px"},{title:"Usuario",value:"usuario_nome",width:"30px"},{title:"Valor",value:"valor",width:"50px"},{title:"A Receber",value:"valor_a_receber",width:"50px"},{value:"actions"}];function W(){const r=new Date,e=r.getFullYear(),i=String(r.getMonth()+1).padStart(2,"0");return`${String(r.getDate()).padStart(2,"0")}-${i}-${e}`}function I(r){if(!r)return null;const[e,i,h]=r.split("/");return`${h}-${i}-${e}`}async function de(){const{data:r}=await D(u,{method:"POST",body:{cartorio_token:k.value}},"$pAAptWJdb1");N.value=r.value}async function me(){try{sessionStorage.setItem("pesquisaOS",JSON.stringify(l));const{data:r,error:e}=await D(O,{method:"POST",body:{cartorio_token:k.value,numero:l.numero||null,data_inicio:I(l.data_inicio)||null,data_fim:I(l.data_fim)||null,data_lavratura_inicio:I(l.data_lavratura_inicio)||null,data_lavratura_fim:I(l.data_lavratura_fim)||null,protocolo:l.protocolo||null,livro:l.livro||null,folha:l.folha||null,situacao:l.situacao||null,usuario_token:l.usuario_token,selo:l.selo||null,ato_tipo_token:l.ato_tipo_token,apresentante:l.apresentante||null}},"$IO02J210Z9");r.value.length>0?b.value=r.value.map(i=>({...i,data:i.data?J(i.data,"dd/mm/yyyy"):null,dt_abertura:i.dt_abertura?J(i.dt_abertura,"dd/mm/yyyy"):null})):(b.value=[],v.error("Não existe Ordem de Serviço Registrada!"))}catch(r){console.error("Erro na requisição",r)}}async function ce(){const{data:r,error:e}=await D(w,{method:"POST",body:{cartorio_token:k.value,usuario_token:T.value}},"$YgUhKRJlsV");f.value=r.value}const oe=async()=>{try{const r=W(),e=sessionStorage.getItem("pesquisaOS"),i=JSON.parse(e),{data:h,error:le}=await D(O,{method:"POST",body:{cartorio_token:k.value,usuario_token:i.usuario_token||T.value,data_fim:I(i==null?void 0:i.data_fim)||r,data_inicio:I(i==null?void 0:i.data_inicio)||r}},"$xKnfARCL4G");h.value.length>0?b.value=h.value.map(B=>({...B,data:J(B.data,"dd/mm/yyyy"),dt_abertura:J(B.dt_abertura,"dd/mm/yyyy")})):b.value=[]}catch(r){console.error("Erro ao buscar serviços",r)}};function pe(r){g.value=r.numero,p.value=r.token,C.value=!0}function _e(r){p.value=r.token,M.value.apresentante_nome=r.apresentante_nome,M.value.apresentante_cpf=r.apresentante_cpf,U.value=!0}function ve(r){const e=x("user-service"),i=b.value.find(h=>h.id===r);e.value=e.value=JSON.stringify({id:i.id,token:i.token}),A.push({path:`/os/atualizar/${r}`})}function fe(r,e){g.value=r,ae.value={token:e.token,numero:e.numero,valor:e.valor,valor_pago:e.valor_pago},c.value=!0}const be=()=>{const r=x("user-service"),e=x("ordem-button");r.value=null,V.value=!0,e.value=V.value};return $e(()=>{Ce(async()=>{const r=sessionStorage.getItem("pesquisaOS");if(r){const e=JSON.parse(r);Object.assign(l,e)}await oe()})}),de(),ce(),(r,e)=>{const i=ye,h=ke,le=Je,B=Fe,P=Se("mask");return E(),F(K,{class:"mt-5",style:{width:"100%"}},{default:n(()=>[t(R,{class:"mb-5"},{default:n(()=>[e[17]||(e[17]=m("h1",null,"Ordens de Serviço",-1)),q(" "+X(a(p))+" ",1),t(i,{to:"/os/criar-registro"},{default:n(()=>[m("img",{style:{width:"60px",height:"60px",cursor:"pointer","margin-left":"70px"},src:Re,alt:"novo",onClick:be})]),_:1})]),_:1}),t(R,{style:{"margin-bottom":"-35px"}},{default:n(()=>[t(_,null,{default:n(()=>[t(y,{modelValue:a(l).numero,"onUpdate:modelValue":e[0]||(e[0]=o=>a(l).numero=o),label:"Número"},null,8,["modelValue"])]),_:1}),t(_,null,{default:n(()=>[z(t(y,{modelValue:a(l).data_inicio,"onUpdate:modelValue":e[1]||(e[1]=o=>a(l).data_inicio=o),label:"Abertura de",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[P,"##/##/####"]])]),_:1}),t(_,null,{default:n(()=>[z(t(y,{modelValue:a(l).data_fim,"onUpdate:modelValue":e[2]||(e[2]=o=>a(l).data_fim=o),label:"Abertura até",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[P,"##/##/####"]])]),_:1}),t(_,null,{default:n(()=>[z(t(y,{modelValue:a(l).data_lavratura_inicio,"onUpdate:modelValue":e[3]||(e[3]=o=>a(l).data_lavratura_inicio=o),label:"Lavratura de",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[P,"##/##/####"]])]),_:1}),t(_,null,{default:n(()=>[z(t(y,{modelValue:a(l).data_lavratura_fim,"onUpdate:modelValue":e[4]||(e[4]=o=>a(l).data_lavratura_fim=o),label:"Lavratura até",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[P,"##/##/####"]])]),_:1}),t(_,null,{default:n(()=>[t(y,{modelValue:a(l).protocolo,"onUpdate:modelValue":e[5]||(e[5]=o=>a(l).protocolo=o),label:"Protocolo"},null,8,["modelValue"])]),_:1}),t(_,{md:"1"},{default:n(()=>[t(y,{modelValue:a(l).livro,"onUpdate:modelValue":e[6]||(e[6]=o=>a(l).livro=o),label:"Livro"},null,8,["modelValue"])]),_:1}),t(_,{md:"1"},{default:n(()=>[t(y,{modelValue:a(l).folha,"onUpdate:modelValue":e[7]||(e[7]=o=>a(l).folha=o),label:"Folha"},null,8,["modelValue"])]),_:1})]),_:1}),t(R,null,{default:n(()=>[t(_,{md:"3"},{default:n(()=>[t(H,{modelValue:a(l).situacao,"onUpdate:modelValue":e[8]||(e[8]=o=>a(l).situacao=o),items:a(s),label:"Situação"},null,8,["modelValue","items"])]),_:1}),t(_,{md:"2"},{default:n(()=>[t(H,{items:a(N),modelValue:a(l).usuario_token,"onUpdate:modelValue":e[9]||(e[9]=o=>a(l).usuario_token=o),"item-title":"user_nome","item-value":"user_token",label:"Usuario"},null,8,["items","modelValue"])]),_:1}),t(_,{md:"1"},{default:n(()=>[t(y,{modelValue:a(l).selo,"onUpdate:modelValue":e[10]||(e[10]=o=>a(l).selo=o),label:"Selo"},null,8,["modelValue"])]),_:1}),t(_,{md:"3"},{default:n(()=>[t(H,{modelValue:a(l).ato_tipo_token,"onUpdate:modelValue":e[11]||(e[11]=o=>a(l).ato_tipo_token=o),items:a(f),"item-title":"descricao","item-value":"token",label:"Serviço"},null,8,["modelValue","items"])]),_:1}),t(_,{md:"2"},{default:n(()=>[t(y,{modelValue:a(l).apresentante,"onUpdate:modelValue":e[12]||(e[12]=o=>a(l).apresentante=o),label:"Apresentante"},null,8,["modelValue"])]),_:1}),t(_,null,{default:n(()=>[m("div",null,[m("img",{onClick:me,style:{width:"40px",height:"40px",cursor:"pointer"},src:Ae,alt:"Pesquisar"})])]),_:1})]),_:1}),e[18]||(e[18]=m("hr",{class:"mt-5 mb-5"},null,-1)),t(Be,{headers:ue,style:{"min-width":"1230px","font-size":"12px"},items:a(b),"item-key":"id"},{"item.actions":n(({item:o})=>[t(R,{style:{display:"flex",gap:"2px","margin-top":"-5px"}},{default:n(()=>[m("div",{class:G({disabled:!o.btn_receber}),title:o.btn_receber?"Receber":"Bloqueado",onClick:Y=>o.btn_receber?fe(o.numero,o):null},[m("img",{style:L({cursor:o.btn_receber?"pointer":"default",width:"30px",height:"30px"}),src:Te,alt:"Receber"},null,4)],10,je),m("div",{class:G({disabled:!o.btn_editar}),onClick:Y=>o.btn_editar?ve(o.id):null,title:o.btn_editar?"Editar":"Bloqueado"},[m("img",{style:L({cursor:o.btn_editar?"pointer":"default",width:"30px",height:"30px"}),src:Ne,alt:"Editar"},null,4)],10,Ke),m("div",{class:G({disabled:!o.btn_recibo}),onClick:Y=>o.btn_recibo?_e(o):null,title:o.btn_recibo?"Emitir Recibo":"Bloqueado"},[m("img",{style:L({cursor:o.btn_recibo?"pointer":"default",width:"30px",height:"30px"}),src:Ie,alt:"Emitir Recibo"},null,4)],10,We),m("div",{disabled:!o.btn_cancelar,onClick:Y=>o.btn_cancelar?pe(o):null,title:"Cancelamento",style:L({opacity:o.btn_cancelar?1:.5,cursor:o.btn_cancelar?"pointer":"not-allowed"})},[o.excluido?(E(),ne("img",Ge)):(E(),ne("img",He))],12,Ye)]),_:2},1024)]),_:1},8,["items"]),t(h,{show:a(c),numero_os:a(g),ordem:a(ae),onClose:e[13]||(e[13]=o=>c.value=!1),onRefreshValue:e[14]||(e[14]=o=>oe())},null,8,["show","numero_os","ordem"]),t(le,{show:a(C),numero_os:a(g),ordemserv_token:a(p),onClose:e[15]||(e[15]=o=>C.value=!1)},null,8,["show","numero_os","ordemserv_token"]),t(B,{show:a(U),apresentante_nome:a(M).apresentante_nome,apresentante_cpf:a(M).apresentante_cpf,token:a(p),onClose:e[16]||(e[16]=o=>U.value=!1)},null,8,["show","apresentante_nome","apresentante_cpf","token"])]),_:1})}}};export{Ct as default};
