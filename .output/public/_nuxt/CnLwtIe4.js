import{_ as $}from"./D8Y2YL9I.js";import{a as Q,d as ee,V as E}from"./DIvgk8Rv.js";import{V as S}from"./DZ7dwQ-G.js";import{V as C,u as F}from"./CKpRPa9w.js";import{r as A,g as j,o as q,G as J,w as r,b as l,a as i,A as B,d as w,v as m,x as O,u as oe,m as H,D as le,t as h,V as I,s as ae,bx as te}from"./_r0buiq6.js";import{_ as re}from"./BVz1G1IN.js";import{V as se}from"./CAV8IhS3.js";import{V as ne}from"./DZtIdLKj.js";const me={__name:"ModalRecebimentoCond",props:{show:Boolean,faltaReceber:Number},emits:["close","confirmar"],setup(k,{emit:x}){const o=k,v=A(o.show),p=x;j(()=>o.show,V=>{v.value=V});const b=()=>{p("confirmar"),f()},f=()=>{v.value=!1,p("close")};return(V,s)=>(q(),J(E,{persistent:"",modelValue:m(v),"onUpdate:modelValue":s[0]||(s[0]=R=>O(v)?v.value=R:null),"max-width":"650"},{default:r(()=>[l(Q,null,{default:r(()=>[l(S,null,{default:r(()=>[l(C,{class:"mb-5 mt-1 ml-2"},{default:r(()=>s[1]||(s[1]=[i("h1",null,"Confirmação de Recebimento",-1)])),_:1}),l(C,{class:"ml-2"},{default:r(()=>s[2]||(s[2]=[i("p",null," O valor recebido é menor que o valor da OS, confirma o recebimento parcial? ",-1)])),_:1})]),_:1}),l(ee,null,{default:r(()=>[l(B,{style:{"background-color":"#429946",color:"white"},onClick:b},{default:r(()=>s[3]||(s[3]=[w("Confirmar")])),_:1}),l(B,{style:{"background-color":"red",color:"white"},onClick:f},{default:r(()=>s[4]||(s[4]=[w("Cancelar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ie="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAABJhJREFUeJztW81v3EQcfTM73ZU3C1GF4NJAG+UGSKgSjZAgfwCFHnMpiAMSyckHGim2FAl8cSRvFFopApEixIW/APFx48IKCS5wQOKGGpqWAx/SqhslMY6HS1PZg+0de2fsSdN3m/HM6Ofn37zxPI8JNMO27Y5lWcuEkKsAngcwNabLHoBfOOefd7vdm57nhTrjIzoHX1tbOxdF0VcAXqg4xM+Msdd937+jMq4ktBFg23an2+3+gOo3f4yfLMt6SVcmUB2DAoBlWcuY/OYB4OL+/v47CsbJBNM1MCHkjWSZc/41gOV+v79b1G91dXWGEHITwKuJ6jcBfKg+So0ZAOBZoTz25gGg3+/vMsaWhern1IWVhk4CesmCzM0fw/f920LVY0oiyoBOAk4Exq4CjuNcAXANwCWMX8NNwR6AH+M4/mBjY+PLooatoouu664D+AjABQBtZeHpRxvALCHk6sLCwpnBYPBtXsPcDLj/5L/QEV3diOP4Sl4mFGnANU3x1A5K6bt514reA14Uyi8HQfC9mpD0wnGcVwB8l6i6lNe2KANSy9hJuXkACIJgIFTlLqOnfhl8REDTATSNU0+A9G7QcRyuM5CmcOozoIgA6d2b6eCci7vLBygiYAkPAQmc89uU0qW861KeoOM4OwCeOS5HUXRhc3NzR0F8yrCysnKeMXYrUfV7EATnx/WT1YBRssAY6+U1bAqdTkd827sn068SAZRS4wiIokiMaZTZUEAlAo6OjowjIOOhSBEg9R5ACBlxzpPlXAIcx3kNwDYADmApCIJv6mgXx3GPkJSkqcsAzvlIKBdlwMcAzgGY4Zxv19VOfCiEEKVTICUolNIil3YmEcTTNbZLxRTHsToRLJkBjUBrBlBKU4MVaUCDSDnWhJA9mU6yUyA1GOfcOHs8juPUQxGzNg+VpgA0fqmZAKmYtIqgiVNAjOmRCOoUQQiOsQkQH4pSDYjj2HgCIMTUarXUEcAYO3EimPHQMiFFwOHhoSgoxmVAhi6pE8F2u238FBBFMAxDdRkwGo2MJwBCTNPT0+oI2NraOgTwb6Kq7XmeMecFbNvuADiTqAplj9WVscVTjA6HQ2OyoNfrVTJDgBIEiOvqmC1xrQjDUD8B4puVScZohiGqngD83xQxhoAMQ1RqCQQm0ACTjNGqhigwwRQwaUcoegGoQwRN2hFW3QkCD8kqAGEfILsTBCYQQZMzADpE0HBjtJIhCpTLAGON0aqGKDCBBsAsT6CSIQpMQEDBFHhwqKLoZIbKdmIsTYvgEoDdcSczVLabRASlT4lRSlNfiJHjCdz/elv0DU95u6qGKFAiAww3RisZokA5DfhbqJr1PK/xY3aLi4stALPJuiiK/pHtL30DU1NTO0gvhU8dHBxcd133rOwYquG67tm5ubkbAJ5MVN8bDoe3ZMco9eeo4zifAni7TJ8G8EkQBEWimkKpFGaMvQfgr9Ih1Yc/W63W+2U6lCLA9/07hJDLAP4oFVY9uMs5v7y+vl4qtsK/xrIwGAzuzs/Pf8YYCznnTxBCHofGX3DH4ADArwC2CSFvBUHwW9kB/gMs68lWOHHFdwAAAABJRU5ErkJggg==",ue={style:{color:"red","margin-left":"18px"}},de={style:{"max-width":"180px"}},ce=["onClick"],fe={style:{display:"flex","justify-content":"flex-start"}},Be={__name:"Ordem",props:{show:Boolean,ordem:{type:Object,required:!0}},emits:["close"],setup(k,{emit:x}){const o=k,v=x,{$toast:p}=oe(),b=A(o.show),f=A(!1),V=ae(),s=`${V.public.managemant}/listarFormasReceb`,R=`${V.public.managemant}/listar_recebimentos_os`,Y=`${V.public.managemant}/receberOs`,K=H("auth_token").value,y=A([]),T=A(null),g=A([]),M=A([]),u=le({descricao:null,forma:null,valor:""}),W=[{title:"Forma",value:"descricao"},{title:"Valor",value:"valor"},{value:"actions"}],d=A(0),L=()=>{d.value=c(o.ordem.valor-o.ordem.valor_pago)};j(()=>o.show,async a=>{b.value=a;const{data:e}=await F(R,{method:"POST",body:{os_token:o.ordem.token}},"$vhMIR8Sr2p"),n=Array.isArray(e.value)?e.value:[];n&&(g.value=n.map(({forma_recebimento:N,...t})=>({descricao:N,...t}))),a&&L()});const U=()=>{b.value=!1,Object.assign(u,{forma:null,descricao:null,valor:""}),g.value=[],v("close")},z=()=>{T.value=Number(o.ordem.valor),f.value=!0},_=async()=>{try{const a={ordemserv_token:o.ordem.token,usuario_token:K,recebimentos:[M.value]},{data:e}=await F(Y,{method:"POST",body:a},"$eiMzO5y6Bb");e.value[0].status==="OK"?(p.success(`${e.value[0].status}: Valores Recebidos com Sucesso!`),g.value=[],U()):p.error(e.value[0].status_mensagem)}catch(a){p.error(a)}},D=()=>{o.ordem.valor=c(o.ordem.valor),o.ordem.valor_pago=c(o.ordem.valor_pago),d.value=c(d.value)},c=a=>Number(parseFloat(a).toFixed(2)),P=async()=>{try{const e={cartorio_token:H("user-data").value.cartorio_token},{data:n}=await F(s,{method:"POST",body:JSON.stringify(e)},"$7DferZWeQF");y.value=te(n.value)}catch(a){console.error("Erro ao carregar formas de pagamento:",a)}},Z=()=>{const a=y.value.find(n=>n.token===u.forma);if(!a)return p.error("Por favor, selecione uma forma.");const e=G(u.valor);g.value.push({forma:u.forma,descricao:a.descricao,valor:e}),M.value.push({forma_receb_token:u.forma,valor:e}),o.ordem.valor_pago=c(o.ordem.valor_pago+e),o.ordem.valor=c(o.ordem.valor-e),d.value=c(d.value-e),Object.assign(u,{forma:null,valor:"0.00"}),D()},X=a=>{const e=g.value.indexOf(a);if(e!==-1){g.value.splice(e,1),M.value.splice(e,1);const n=G(a.valor);o.ordem.valor_pago=c(o.ordem.valor_pago-n),d.value=c(d.value+n)}D()},G=a=>Number(a.toString().replace(/,/g,""));return P(),(a,e)=>{const n=$,N=me;return q(),J(E,{persistent:"",modelValue:m(b),"onUpdate:modelValue":e[7]||(e[7]=t=>O(b)?b.value=t:null),"max-width":"650"},{default:r(()=>[l(Q,null,{default:r(()=>[l(S,null,{default:r(()=>[l(C,{class:"mb-5 mt-1 ml-2"},{default:r(()=>[e[8]||(e[8]=i("h1",null,"Ordem de Serviço nº",-1)),i("h1",ue,h(o.ordem.numero),1)]),_:1}),l(S,null,{default:r(()=>[l(C,null,{default:r(()=>[l(I,{class:"mr-5",label:"Recebido",modelValue:o.ordem.valor_pago,"onUpdate:modelValue":e[0]||(e[0]=t=>o.ordem.valor_pago=t),readonly:"",style:{"font-weight":"bold",cursor:"default","pointer-events":"none"}},null,8,["modelValue"]),l(I,{label:"Falta Receber",modelValue:m(d),"onUpdate:modelValue":e[1]||(e[1]=t=>O(d)?d.value=t:null),readonly:"",style:{"font-weight":"bold",cursor:"default","pointer-events":"none"}},null,8,["modelValue"])]),_:1}),l(C,null,{default:r(()=>[l(se,{class:"mb-5 mr-5",label:"Forma",modelValue:m(u).forma,"onUpdate:modelValue":e[2]||(e[2]=t=>m(u).forma=t),items:m(y),"item-title":"descricao","item-value":"token"},null,8,["modelValue","items"]),i("div",de,[l(n,{modelValue:m(u).valor,"onUpdate:modelValue":e[3]||(e[3]=t=>m(u).valor=t)},null,8,["modelValue"])]),i("div",null,[i("img",{src:re,class:"ml-5",style:{cursor:"pointer",height:"40px",width:"40px"},onClick:Z})])]),_:1})]),_:1}),e[10]||(e[10]=i("hr",{class:"mb-5"},null,-1)),l(ne,{headers:W,items:m(g),"item-value":"token"},{"item.forma":r(({item:t})=>[w(h(t.descricao),1)]),"item.actions":r(({item:t})=>[i("div",{style:{display:"flex","justify-content":"flex-end"},onClick:Ae=>X(t),title:"Remover"},e[9]||(e[9]=[i("img",{src:ie,style:{width:"30px",height:"30px",cursor:"pointer"},alt:"Remover"},null,-1)]),8,ce)]),_:1},8,["items"])]),_:1}),i("div",fe,[l(B,{class:"ml-8",size:"large",onClick:U,color:"red"},{default:r(()=>e[11]||(e[11]=[w("Voltar")])),_:1}),l(B,{size:"large",class:"ml-6 mb-6",color:"green",onClick:e[4]||(e[4]=t=>o.ordem.valor>0?z():_())},{default:r(()=>e[12]||(e[12]=[w(" Salvar ")])),_:1})])]),_:1}),l(N,{modelValue:m(f),"onUpdate:modelValue":e[5]||(e[5]=t=>O(f)?f.value=t:null),faltaReceber:m(T),onClose:e[6]||(e[6]=t=>f.value=!1),onConfirmar:_},null,8,["modelValue","faltaReceber"])]),_:1},8,["modelValue"])}}};export{Be as _};
