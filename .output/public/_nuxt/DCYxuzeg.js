import{_ as W}from"./DEnbuNJQ.js";import{n as X,r as m,D as s,F as Z,G as ee,o as p,A as f,w as n,x as te,H as ae,b as i,a as l,t as oe,q as a,I as re,s as x,C as B,K as se,L as ne,c as N,J as le}from"./DXq1RCv8.js";import{u as $}from"./CkDNeakM.js";import"./BmnyBvpg.js";import{c as R,r as D,u as ie,_ as ue}from"./BwUQoCJN.js";import{_ as ce,a as de,b as me,c as pe}from"./CBYd86re.js";import{_ as _e}from"./9u6dNgKD.js";import{_ as ve}from"./ToPptOUL.js";import{V as fe}from"./Clrg6PPk.js";import{V as h}from"./HL_xHFx0.js";import{V as b}from"./mZG8unQc.js";import{V as ge}from"./CgIBcZUR.js";const he=l("h1",null,"Ordem de Serviço nº",-1),be={style:{color:"red","margin-left":"30px"}},ke=l("h1",{class:"ml-5"},"Atos",-1),ye=l("img",{style:{width:"45px",height:"45px",cursor:"pointer"},src:de,alt:"novo"},null,-1),Ce=["onClick"],Ve=l("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:_e,alt:"Receber"},null,-1),xe=[Ve],$e=["onClick","title"],we=["disabled","onClick"],Se={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:me,alt:"Visualizar",title:"Reativar"},Oe={key:1,src:pe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px",cursor:"pointer"},title:"Excluir"},ze={__name:"criar-registro",async setup(Ee){var T,A,F,q;let g,w;const{$toast:v}=X(),k=te(),I=`${k.public.managemant}/createOrdensServico`,P=`${k.public.managemant}/validarCpf`,U=`${k.public.managemant}/listarAtos`,L=m(s("user-data").value.cartorio_id),z=m(s("user-data").value.usuario_id),G=m((T=s("user-service").value)==null?void 0:T.token).value||null,H=m(s("user-data").value.cartorio_token).value;let S=m(!!((A=s("user-service").value)!=null&&A.numero)),y=m(s("ordem-button").value),C=!1;const V=m([]),r=Z({nacionalidade:"brasileiro",apresentante_nome:(F=s("user-service").value)==null?void 0:F.apresentante_nome,apresentante_cpf:(q=s("user-service").value)==null?void 0:q.apresentante_cpf,documento:null}),J=[{title:"Protocolo",value:"protocolo"},{title:"Usuario",value:"usuario_nome"},{title:"Situação",value:"situacao"},{title:"Valor",value:"valor"},{title:"Tipo",value:"tipo"},{value:"actions"}],M=[{title:"BRASILEIRO",value:"brasileiro"},{title:"ESTRANGEIRO",value:"estrangeiro"}],j={apresentante_nome:{required:R.withMessage("O campo é obrigatorio",D)},apresentante_cpf:{required:R.withMessage("O campo é obrigatorio",D)}},c=ie(j,r);function O(o){if(o)return o.replace(/[.\-]/g,"");o=null}function K(){const o=s("user-service"),t=s("ordem-button");o.value=null,t.value=null}async function Q(){const o={apresentante_cpf:O(r.apresentante_cpf),apresentante_nome:r.apresentante_nome,user_id:z.value,cartorio_id:L.value};if(await c.value.$validate()){const{data:t,error:_,status:u}=await $(I,{method:"POST",body:o},"$omLGvLxYlw");if(u.value==="error"&&_.value.statusCode===500)v.error("Erro ao cadastrar ordem,erro no sistema.");else{v.success("Ordem registrada com sucesso!"),S.value=!0,y.value=!1;const e=s("ordem-button");e.value=y.value;const d=s("user-service");d.value=d.value=JSON.stringify({numero:t.value.numero,apresentante_cpf:t.value.apresentante_cpf,apresentante_nome:t.value.apresentante_nome,token:t.value.token})}}}async function Y(o){const t=O(o);if(t.length===11&&!C){C=!0;const _={cpf:t};try{const{data:u,error:e,status:d}=await $(P,{method:"POST",body:_},"$e6ybTA3ect");d.value==="error"&&e.value.statusCode===500?v.error("Erro ao cadastrar pessoa, o CPF já está cadastrado."):u.value.cpfValidation===!0?(r.apresentante_nome=u.value.nome,v.success("Cpf autenticado com sucesso!")):u.value.cpfValidation===!1&&v.error("Cpf não cadastrado!")}catch(u){console.error("Erro ao validar CPF:",u)}finally{C=!1}}}const{data:E}=([g,w]=ee(()=>$(U,{method:"POST",body:{cartorio_token:H,ordemserv_token:G}},"$Q1qkHbHde0")),g=await g,w(),g);return E.value.length>0?V.value=E.value:V.value=[],(o,t)=>{const _=W,u=ae("mask");return p(),f(fe,{class:"mt-5"},{default:n(()=>[i(h,{class:"mb-5"},{default:n(()=>{var e;return[he,l("h1",be,oe((e=("useCookie"in o?o.useCookie:a(s))("user-service").value)==null?void 0:e.numero),1)]}),_:1}),i(h,null,{default:n(()=>[i(b,{md:"3"},{default:n(()=>[i(ge,{label:"Nacionalidade",items:M,modelValue:a(r).nacionalidade,"onUpdate:modelValue":t[0]||(t[0]=e=>a(r).nacionalidade=e)},null,8,["modelValue"])]),_:1}),i(b,{md:"2"},{default:n(()=>[a(r).nacionalidade==="brasileiro"?re((p(),f(x,{key:0,autofocus:"",modelValue:a(r).apresentante_cpf,"onUpdate:modelValue":t[1]||(t[1]=e=>a(r).apresentante_cpf=e),label:"CPF",required:"","error-messages":a(c).apresentante_cpf.$errors.map(e=>e.$message),onBlur:a(c).apresentante_cpf.$touch,onInput:t[2]||(t[2]=e=>Y(a(r).apresentante_cpf))},null,8,["modelValue","error-messages","onBlur"])),[[u,"###.###.###-##"]]):(p(),f(x,{key:1,autofocus:"",modelValue:a(r).apresentante_cpf,"onUpdate:modelValue":t[3]||(t[3]=e=>a(r).apresentante_cpf=e),label:"Documento",required:"","error-messages":a(c).apresentante_cpf.$errors.map(e=>e.$message),onBlur:a(c).apresentante_cpf.$touch},null,8,["modelValue","error-messages","onBlur"]))]),_:1}),i(b,{md:"4"},{default:n(()=>[i(x,{modelValue:a(r).apresentante_nome,"onUpdate:modelValue":t[4]||(t[4]=e=>a(r).apresentante_nome=e),label:"Nome Apresentante",required:"","error-messages":a(c).apresentante_nome.$errors.map(e=>e.$message),onInput:a(c).apresentante_nome.$touch},null,8,["modelValue","error-messages","onInput"])]),_:1}),a(y)?(p(),f(b,{key:0},{default:n(()=>[l("div",null,[l("img",{style:{width:"40px",height:"40px",cursor:"pointer"},src:ue,alt:"Salvar",onClick:t[5]||(t[5]=e=>Q())})])]),_:1})):B("",!0)]),_:1}),a(S)?(p(),f(h,{key:0,style:{display:"flex","margin-bottom":"10px",gap:"2rem"}},{default:n(()=>[ke,i(_,{to:{path:"/ordens-servicos/criar-ato",query:{origem:"criar"}}},{default:n(()=>[ye]),_:1}),i(le,{headers:J,items:a(V),"item-key":"id"},{"item.actions":n(({item:e})=>[i(h,{style:{display:"flex",gap:"10px","margin-top":"-5px"}},{default:n(()=>[l("div",{onClick:d=>o.redirectToUpdate(e.id),title:"Receber"},xe,8,Ce),l("div",{class:ne({disabled:!e.btn_editar}),onClick:d=>e.btn_editar?o.redirectToUpdate(e.id):null,title:e.btn_editar?"Editar":"Desabilitado"},[l("img",{style:se({cursor:e.btn_editar?"pointer":"default",width:"30px",height:"30px"}),src:ce,alt:"Editar"},null,4)],10,$e),l("div",{disabled:!e.btn_cancelar,onClick:d=>e.btn_cancelar?o.deleteEndereco(e):null,title:"Excluir"},[e.excluido?(p(),N("img",Se)):(p(),N("img",Oe))],8,we)]),_:2},1024)]),_:1},8,["items"])]),_:1})):B("",!0),i(_,{to:"/ordens-servicos"},{default:n(()=>[l("img",{class:"btn-pointer mt-5",src:ve,alt:"Sair",onClick:K})]),_:1})]),_:1})}}};export{ze as default};
