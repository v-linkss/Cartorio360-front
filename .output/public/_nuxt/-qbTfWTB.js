import{_ as E,L as w,r as i,I as L,c as u,a as c,F as g,D as M,p as C,E as N,y as R,o as d,q as D,d as S,t as B,n as U}from"./CLT_7dC4.js";const O={class:"chat-container"},T=["onClick"],$={__name:"index",setup(j){const f=w(),l=i(""),b=i([{from:"server",text:"Por favor, me informe seu nome"}]),r=i(),v=i("chat_bot_message"),m=i(null),p=i();let a=null;const h=f.query.cartorio_token;function n(o,s){console.log("from ",o),console.log("userName ",r.value),o!==r.value&&(console.log("addMessage",o),b.value.push({from:o,text:s})),U(()=>{m.value&&(m.value.scrollTop=m.value.scrollHeight)})}function k(){if(r.value||(r.value=l.value,y()),!l.value.trim())return;const o=_(l.value);n("user",o);const s={type:v.value,message:o,cartorio_token:h};console.log("typeMenssage",v.value),l.value="",a.send(JSON.stringify(s))}function y(){a=new WebSocket(`ws://157.230.216.74:3452?user_name=${r.value}`),a.addEventListener("open",()=>{console.log("âœ… Conectado ao servidor")}),a.addEventListener("message",o=>{var s;try{const e=JSON.parse(o.data),t=(s=e==null?void 0:e.message)==null?void 0:s.state;switch(t){case"ExibirResposta":console.log("ðŸ“¥ ExibirResposta"),p.value=e.message,n("button",e.message);break;case"user_joined":break;case"Fim":console.log("ðŸ“´ Chat encerrado pelo servidor"),a.close(1e3,"Chat encerrado pelo servidor");break;case void 0:e.type==="connection_info"?console.log("ðŸ”— InformaÃ§Ãµes de conexÃ£o recebidas"):e.username&&e.username!=r.value?n("server",e.message):n(r.value,e.message);break;case"NotasDevolutivas":v.value="chat_message",n("server",e.message);default:console.log(`ðŸ“¨ Mensagem com estado "${t}"`),console.log("ðŸ“© Mensagem com estado desconhecido:",e),n("server",e.message);break}}catch(e){console.error("âŒ Erro ao processar mensagem:",e),n("server",o.data)}}),a.addEventListener("close",()=>{console.log("âŒ ConexÃ£o encerrada"),n("system","âš ï¸ Chat encerrado")}),a.addEventListener("error",o=>{console.error("âš ï¸ Erro na conexÃ£o:",o),n("system","âš ï¸ Erro na conexÃ£o")})}function x(o){fetch(o).then(s=>{if(!s.ok)throw new Error("Erro ao baixar o arquivo");return s.blob()}).then(s=>{const e=URL.createObjectURL(s),t=document.createElement("a");t.href=e,t.download="documento.pdf",t.click(),URL.revokeObjectURL(e)})}function _(o){const s=typeof o=="object"?o.message:o,e=/(https?:\/\/[^\s]+)/g;return s.replace(e,t=>`<a href="${t}" target="_blank" class="chat-link">${t}</a>`)}return L(()=>{a&&a.readyState===WebSocket.OPEN&&a.close()}),(o,s)=>(d(),u("div",O,[s[2]||(s[2]=c("div",{class:"chat-header"},[c("span",{class:"chat-title"},"Chat"),c("button",{class:"chat-close"},"Ã—")],-1)),c("div",{ref_key:"chatHistory",ref:m,class:"chat-history"},[(d(!0),u(g,null,M(b.value,(e,t)=>(d(),u("div",{key:t,class:D(["chat-bubble",e.from==="user"?"user-bubble":e.from==="system"?"system-bubble":"server-bubble"])},[e.from==="button"?(d(),u("button",{key:0,class:"chat-button",onClick:q=>x(e.text.message)}," ðŸ“Ž Baixar documento ",8,T)):(d(),u(g,{key:1},[S(B(e.text.message||e.text),1)],64))],2))),128))],512),c("form",{onSubmit:R(k,["prevent"]),class:"chat-input-area"},[C(c("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>l.value=e),type:"text",placeholder:"Digite sua mensagem...",class:"chat-input"},null,512),[[N,l.value]]),s[1]||(s[1]=c("button",{type:"submit",class:"chat-send-button"},"âž¤",-1))],32)]))}},H=E($,[["__scopeId","data-v-d150a2ec"]]);export{H as default};
