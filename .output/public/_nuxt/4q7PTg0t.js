import{_ as ae}from"./DcjTf39r.js";import{_ as re}from"./DMy2O59r.js";import{_ as ne}from"./ZYYnuXhw.js";import{_ as le}from"./DLVqlEJK.js";import{_ as M}from"./BDSaLaRI.js";import{_ as ie}from"./BVz1G1IN.js";import{a as ue}from"./DJvq3mCv.js";import{D as me,H as ce,u as de,r as l,m as g,E as pe,I as ve,c as fe,b as t,w as r,s,F as _e,A as ke,o as ge,V as q,a as i,z as O,d as R}from"./C_G_8Fxp.js";import{u as y}from"./B_ywhG1t.js";import{V}from"./BSN5yaz8.js";import{V as m}from"./DJTBfr2V.js";import{V as ye}from"./DPqcBUys.js";import{V as z}from"./CHDjh_Jm.js";import"./C_XYYq_H.js";import"./DuhODtxv.js";import"./BsNqhUHK.js";import"./B0IxRygJ.js";import"./DWWBWTux.js";import"./C5-TA1Wf.js";import"./D9wsWdgc.js";import"./BsXE0_DQ.js";import"./DxVgobsx.js";import"./BgRBZG1C.js";import"./BtSw--Vp.js";import"./xbUc42HT.js";import"./iyZdj_V7.js";const Ve=["onClick"],we=["onClick"],Ze={__name:"autencidade",props:{ato_token:{type:String,required:!0}},emits:["ato-created"],async setup(S,{emit:B}){let p,$;const U=S,j=B,P=me(),E=ce(),v=ke(),{$toast:D}=de(),I=`${v.public.managemant}/listarEscrevente`,N=`${v.public.managemant}/pesquisarPessoas`,K=`${v.public.managemant}/atoReconhecimento`,H=`${v.public.managemant}/etiquetaAutenticidade`,f=l(g("user-data").value.cartorio_token),L=l(g("user-service").value.token).value||l(g("user-service").value).value,Q=g("auth_token").value,w=l([]),T=l([]),c=l([]),_=l(!1),h=l(!1),x=l(!1),b=l(null),C=l(""),A=[{title:"Documento",align:"start",key:"documento"},{title:"Pessoa",align:"start",key:"nome"},{value:"actions"}],n=pe({quantidade:1,escrevente:null,nome:null,documento:null}),{data:Z}=([p,$]=ve(()=>y(I,{method:"POST",body:{cartorio_token:f}},"$qpB20nOlUE")),p=await p,$(),p);T.value=Z.value[0].func_json_escreventes;async function W(){try{const{data:o,error:e}=await y(N,{method:"POST",body:{cartorio_token:f.value,documento:n.documento,nome:n.nome}},"$CfpM9wZnUE");o.value.length>0?(j("ato-created"),w.value=o.value):w.value=[]}catch(o){console.error("Erro na requisição",o)}}const G=()=>{h.value=!0};function J(o){c.value.push(o)}const X=o=>{b.value=o,x.value=!0};function Y(o){c.value=c.value.filter(e=>e.token!==o.token)}async function ee(){if(!n.escrevente){D.error("Por favor selecione um Escrevente");return}try{const o=c.value.map(u=>({pessoa_token:u.token})),{data:e,error:k,status:d}=await y(K,{method:"POST",body:{pessoas:o,cartorio_token:f.value,ordemserv_token:L,quantidade:n.quantidade,usuario_token:Q,ato_tipo_token:U.ato_token}},"$LrKAtpxZwH");d.value==="success"&&e.value[0].status==="OK"?(te(e.value[0].token),F()):(_.value=!0,C.value=ato_token.value.status_mensagem||k.value.data.details)}catch(o){_.value=!0,C.value=o,console.error("Erro na requisição",o)}}async function te(o){try{const{data:e,error:k,status:d}=await y(H,{method:"POST",body:{ato_token:o,cartorio_token:f.value,escrevente_token:n.escrevente}},"$EE94jKo1pQ");if(d.value==="success"){const u=window.open("","_blank");u.document.open(),u.document.write(e.value[0].etiqueta),u.document.close()}}catch(e){console.error("Erro na requisição",e)}}const F=()=>{const o=E.query.origem||"criar",e=E.query.id;o==="atualizar"?P.push(`/os/atualizar/${e}`):P.push("/os/criar-registro")};return(o,e)=>{const k=ae,d=re,u=ne,oe=le;return ge(),fe(_e,null,[t(V,{class:"mt-5"},{default:r(()=>[t(m,{cols:"5"},{default:r(()=>[t(ye,{label:"Tabelião/escrevente",modelValue:s(n).escrevente,"onUpdate:modelValue":e[0]||(e[0]=a=>s(n).escrevente=a),items:s(T),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"])]),_:1}),t(m,{cols:"2"},{default:r(()=>[t(q,{label:"Quantidade",type:"number",modelValue:s(n).quantidade,"onUpdate:modelValue":e[1]||(e[1]=a=>s(n).quantidade=a)},null,8,["modelValue"])]),_:1})]),_:1}),t(V,null,{default:r(()=>[t(m,{cols:"3"},{default:r(()=>[t(q,{label:"Documento",modelValue:s(n).documento,"onUpdate:modelValue":e[2]||(e[2]=a=>s(n).documento=a)},null,8,["modelValue"])]),_:1}),t(m,{cols:"4"},{default:r(()=>[t(q,{label:"Pessoa",modelValue:s(n).nome,"onUpdate:modelValue":e[3]||(e[3]=a=>s(n).nome=a)},null,8,["modelValue"])]),_:1}),i("div",null,[i("img",{class:"btn-pointer mt-1",src:M,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:W})]),i("div",null,[i("img",{class:"btn-pointer mt-1 ml-2",src:ie,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:G})])]),_:1}),t(V,null,{default:r(()=>[t(m,{class:"mr-10"},{default:r(()=>[t(z,{style:{height:"465px"},headers:A,items:s(w)},{"item.actions":r(({item:a})=>[i("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:se=>X(a),title:"Visualizar Ficha"},e[8]||(e[8]=[i("img",{style:{width:"30px",height:"30px"},src:M,alt:"Visualizar"},null,-1)]),8,Ve)]),_:1},8,["items"])]),_:1}),t(m,null,{default:r(()=>[t(z,{headers:A,items:s(c),style:{height:"465px"},"item-key":"id"},{"item.actions":r(({item:a})=>[i("div",{style:{display:"flex","justify-content":"flex-end"},onClick:se=>Y(a),title:"Remover"},e[9]||(e[9]=[i("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ue,alt:"Remover"},null,-1)]),8,we)]),_:1},8,["items"])]),_:1})]),_:1}),t(k,{show:s(h),onClose:e[4]||(e[4]=a=>h.value=!1)},null,8,["show"]),t(d,{show:s(x),item:s(b),onConfirmar:e[5]||(e[5]=a=>J(s(b))),onClose:e[6]||(e[6]=a=>x.value=!1)},null,8,["show","item"]),t(u,{show:s(_),errorMessage:s(C),onClose:e[7]||(e[7]=a=>_.value=!1)},null,8,["show","errorMessage"]),t(V,null,{default:r(()=>[t(oe,{onClick:F},{default:r(()=>[t(O,{size:"large",color:"red"},{default:r(()=>e[10]||(e[10]=[R("Voltar")])),_:1})]),_:1}),t(O,{class:"ml-5",onClick:ee,size:"large",color:"green"},{default:r(()=>e[11]||(e[11]=[R("Salvar")])),_:1})]),_:1})],64)}}};export{Ze as default};
