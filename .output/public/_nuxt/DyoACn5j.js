import{_ as Se}from"./JlQkR5Ep.js";import{_ as Ce}from"./DO3dhr9z.js";import{c as Oe,r as De,u as Ue}from"./BkqLXJFV.js";import{r as m,e as V,f as oe,g as Z,o as I,h as K,w as r,b as o,a as d,t as ee,d as $,i as t,V as W,j as ue,k as ae,u as de,s as y,p as Re,D as Te,l as Ae,n as qe,m as Ee,q as J,v as j,x as X,c as ie}from"./DRaUCYIu.js";import{u as g}from"./1zHOOLER.js";import{V as te,a as Ie,c as Be}from"./BfXb2Y63.js";import{V as Y}from"./BP-43IfJ.js";import{V as A}from"./Hg6i5c29.js";import{V as ze}from"./D2IcBJsA.js";import{V as me}from"./s7_nstSd.js";import{V as v}from"./Bgy3z4kd.js";import{_ as Ne}from"./BVz1G1IN.js";import{_ as Me}from"./gq1sqmF6.js";import{_ as Pe}from"./dslGB-Mq.js";import{_ as Fe}from"./LNBvxnia.js";import{_ as Le}from"./B16moC2y.js";import{_ as Je}from"./Dy4DUuno.js";import{_ as je,a as Ge}from"./DJvq3mCv.js";import{f as G}from"./B0IxRygJ.js";import{V as H}from"./QkfWEfKs.js";import{V as He}from"./DMm8xb1-.js";import"./Dvz29TZ2.js";import"./BYaGnJdC.js";import"./3CqgsptR.js";import"./D5DmKkg3.js";import"./BuvYh9EX.js";import"./CZsMlnK8.js";import"./B2RcQ1sK.js";import"./BuXASzVT.js";import"./HxpmNk1j.js";const Ke={style:{color:"red","margin-left":"18px"}},We={class:"mb-5",style:{display:"flex","justify-content":"flex-start"}},Ye={class:"ml-6"},Qe={class:"ml-6"},Xe={__name:"Ordem",props:{show:Boolean,numero_os:Number,ordemserv_token:String},emits:["close"],setup(C,{emit:k}){const c=C,u=m(c.show),O=ae();m(V("user-data").value.cartorio_token).value;const w=V("auth_token").value,q=`${O.public.managemant}/analisaCancelamento`,N=`${O.public.managemant}/cancelaOs`,S=oe({motivo:null}),D=m(null),U=k,p={motivo:{required:Oe.withMessage("O campo é obrigatorio",De)}},s=Ue(p,S);Z(()=>c.show,b=>{u.value=b});const _=()=>{u.value=!1,U("close")};(async()=>{const{data:b,error:f}=await g(`${q}`,{method:"POST",body:{ordemserv_token:c.ordemserv_token}},"$1fnrIk2fgs");D.value=b.value.mensagem})();const T=async()=>{if(await s.value.$validate()){const{status:b}=await g(`${N}`,{method:"POST",body:{usuario_token:w,motivo:S.motivo,ordemserv_token:c.ordemserv_token}},"$21WlhUNXeM");b.value==="success"&&(window.location.reload(),_())}};return(b,f)=>(I(),K(me,{persistent:"",modelValue:t(u),"onUpdate:modelValue":f[1]||(f[1]=h=>ue(u)?u.value=h:null),"max-width":"650"},{default:r(()=>[o(te,null,{default:r(()=>[o(Y,null,{default:r(()=>[o(A,{class:"mb-5 mt-1 ml-2"},{default:r(()=>[f[2]||(f[2]=d("h1",null,"Cancelamento da OS nº",-1)),d("h1",Ke,ee(c.numero_os),1)]),_:1}),o(Y,null,{default:r(()=>[o(te,{variant:"outlined",class:"mb-5"},{default:r(()=>[o(Ie,null,{default:r(()=>[$(ee(t(D)),1)]),_:1})]),_:1}),o(ze,{label:"Motivo",modelValue:t(S).motivo,"onUpdate:modelValue":f[0]||(f[0]=h=>t(S).motivo=h),required:"","error-messages":t(s).motivo.$errors.map(h=>h.$message),onBlur:t(s).motivo.$touch,onInput:t(s).motivo.$touch},null,8,["modelValue","error-messages","onBlur","onInput"])]),_:1})]),_:1}),d("div",We,[d("div",Ye,[o(W,{size:"large",color:"red",onClick:_},{default:r(()=>f[3]||(f[3]=[$("Fechar")])),_:1})]),d("div",Qe,[o(W,{size:"large",color:"green",onClick:T},{default:r(()=>f[4]||(f[4]=[$("Salvar")])),_:1})])])]),_:1})]),_:1},8,["modelValue"]))}},Ze={__name:"ImprecaoRecibo",props:{show:Boolean,apresentante_nome:String,apresentante_cpf:String,visualizar:Boolean,token:String},emits:["close"],setup(C,{emit:k}){const c=C,u=oe({apresentante_nome:c.apresentante_nome,apresentante_cpf:c.apresentante_cpf,token:c.token,usuario_token:V("auth_token").value}),O=k,w=m(c.show),{$toast:q}=de(),S=`${ae().public.auth}/service/gerencia/emitir_recibo`;Z(()=>c.show,p=>{w.value=p},{immediate:!0}),Z(()=>c,p=>{u.apresentante_nome=p.apresentante_nome,u.apresentante_cpf=p.apresentante_cpf,u.token=p.token},{deep:!0,immediate:!0});const D=()=>{w.value=!1,O("close")};async function U(){var p,s;try{const{data:_,error:R}=await g(S,{method:"POST",body:{nome_recibo:u.apresentante_nome,doc_recibo:u.apresentante_cpf,usuario_token:u.usuario_token,os_token:u.token},headers:{Authorization:`Bearer ${u.usuario_token}`}},"$26dgQHax0q");if(console.log(_),_.value){const T=new Blob([_.value],{type:"text/html"}),b=URL.createObjectURL(T);window.open(b,"_blank")}else q.error(((s=(p=R==null?void 0:R.value)==null?void 0:p.data)==null?void 0:s.details)||"Erro ao emitir recibo");D()}catch{q.error("Erro inesperado")}}return(p,s)=>(I(),K(me,{persistent:"",modelValue:t(w),"onUpdate:modelValue":s[2]||(s[2]=_=>ue(w)?w.value=_:null),"max-width":"600"},{default:r(()=>[o(te,null,{default:r(()=>[o(Y,null,{default:r(()=>[o(A,{class:"mt-1 mb-3",style:{"justify-content":"space-between"}},{default:r(()=>s[3]||(s[3]=[d("h1",{class:"ml-4"}," Emitir Recibo ",-1)])),_:1}),o(A,null,{default:r(()=>[o(v,{cols:"12",md:"6"},{default:r(()=>[o(y,{label:"Destinatário",modelValue:t(u).apresentante_nome,"onUpdate:modelValue":s[0]||(s[0]=_=>t(u).apresentante_nome=_),readonly:C.visualizar},null,8,["modelValue","readonly"])]),_:1}),o(v,{cols:"12",md:"6"},{default:r(()=>[o(y,{label:"Documento",modelValue:t(u).apresentante_cpf,"onUpdate:modelValue":s[1]||(s[1]=_=>t(u).apresentante_cpf=_),readonly:C.visualizar},null,8,["modelValue","readonly"])]),_:1})]),_:1})]),_:1}),o(Be,null,{default:r(()=>[o(W,{style:{"background-color":"red",color:"white"},onClick:D},{default:r(()=>s[4]||(s[4]=[$(" Voltar ")])),_:1}),C.visualizar?Re("",!0):(I(),K(W,{key:0,style:{"background-color":"green",color:"white"},onClick:U},{default:r(()=>s[5]||(s[5]=[$(" Imprimir ")])),_:1}))]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},et=["title","onClick"],tt=["onClick","title"],ot=["onClick","title"],at=["onClick"],lt=["disabled","onClick"],nt={key:0,style:{width:"30px",height:"30px"},src:je,alt:"Visualizar",title:"Reativar"},rt={key:1,src:Ge,alt:"Cancelamento",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Bt={__name:"index",setup(C){const k=ae(),{$toast:c}=de(),u=`${k.public.managemant}/listarUsuarios`,O=`${k.public.managemant}/listarOrdensServico`,w=`${k.public.managemant}/tipoAtos`,q=`${k.public.auth}/service/gerencia/lista_sit_atos`;`${k.public.auth}`;const N=`${k.public.biometria}/run-scanner?format=pdf`,S=`${k.public.envioDoc}/upload`,D=Te(),U=m(V("auth_token").value)||null,p=m(V("user-data").value.cartorio_token)||null,s=m([]),_=m([]),R=m([]),T=m([]),b=m(!1),f=m(!1),h=m(!1),le=m(null),B=m(null),M=m(null),ne=m({}),P=m({}),ce=V("auth_token"),n=oe({numero:null,data_inicio:Q(),data_fim:Q(),data_lavratura_inicio:null,data_lavratura_fim:null,protocolo:null,livro:null,folha:null,situacao:null,usuario_token:U.value,selo:null,ato_tipo_token:null,apresentante:null}),pe=[{title:"Data Abertura",value:"dt_abertura",width:"100px"},{title:"Data Recebimento",value:"data",width:"100px"},{title:"Número",value:"numero",width:"10px"},{title:"Situação",value:"situacao",width:"115px"},{title:"CPF",value:"apresentante_cpf",width:"100px"},{title:"Apresentante",value:"apresentante_nome",width:"228px"},{title:"Usuario",value:"usuario_nome",width:"30px"},{title:"Valor",value:"valor",width:"50px"},{title:"A Receber",value:"valor_a_receber",width:"50px"},{value:"actions"}];function Q(){const l=new Date,e=l.getFullYear(),i=String(l.getMonth()+1).padStart(2,"0");return`${String(l.getDate()).padStart(2,"0")}-${i}-${e}`}function E(l){if(!l)return null;const[e,i,x]=l.split("/");return`${x}-${i}-${e}`}async function _e(){const{data:l}=await g(u,{method:"POST",body:{cartorio_token:p.value}},"$pAAptWJdb1");_.value=l.value}async function ve(){try{const{data:l}=await g(N,{method:"GET"},"$IO02J210Z9")}catch(l){c.error("Erro ao acionar o scanner:",l)}}async function fe(l){try{const{status:e,data:i}=await g(S,{method:"POST",body:{tipo:"ato_livro",token:l,cartorio_token:V("user-data").value.cartorio_token}},"$YgUhKRJlsV");e.value==="success"&&c.success("Arquivo enviado com sucesso!")}catch(e){c.error(e),console.error("Erro ao enviar o arquivo:",e)}}const be=async l=>{try{await ve(),await fe(l)}catch(e){console.error("Erro ao executar scanner ou listar arquivos:",e)}};async function ye(){try{sessionStorage.setItem("pesquisaOS",JSON.stringify(n));const{data:l,error:e}=await g(O,{method:"POST",body:{cartorio_token:p.value,numero:n.numero||null,data_inicio:E(n.data_inicio)||null,data_fim:E(n.data_fim)||null,data_lavratura_inicio:E(n.data_lavratura_inicio)||null,data_lavratura_fim:E(n.data_lavratura_fim)||null,protocolo:n.protocolo||null,livro:n.livro||null,folha:n.folha||null,situacao:n.situacao||null,usuario_token:n.usuario_token,selo:n.selo||null,ato_tipo_token:n.ato_tipo_token,apresentante:n.apresentante||null}},"$xKnfARCL4G");l.value.length>0?s.value=l.value.map(i=>({...i,data:i.data?G(i.data,"dd/mm/yyyy"):null,dt_abertura:i.dt_abertura?G(i.dt_abertura,"dd/mm/yyyy"):null})):(s.value=[],c.error("Não existe Ordem de Serviço Registrada!"))}catch(l){console.error("Erro na requisição",l)}}async function ke(){const{data:l,error:e}=await g(w,{method:"POST",body:{cartorio_token:p.value,usuario_token:U.value}},"$u0iMyzSv4b");R.value=l.value}async function Ve(){const{data:l,error:e}=await g(q,{method:"GET",headers:{Authorization:`Bearer ${ce.value}`}},"$F7cqPDSFMb");T.value=l.value}const re=async()=>{try{const l=Q(),e=sessionStorage.getItem("pesquisaOS"),i=JSON.parse(e),{data:x,error:se}=await g(O,{method:"POST",body:{cartorio_token:p.value,usuario_token:i.usuario_token||U.value,data_fim:E(i==null?void 0:i.data_fim)||l,data_inicio:E(i==null?void 0:i.data_inicio)||l}},"$TOn0LSsFMc");x.value.length>0?s.value=x.value.map(z=>({...z,data:G(z.data,"dd/mm/yyyy"),dt_abertura:G(z.dt_abertura,"dd/mm/yyyy")})):s.value=[]}catch(l){console.error("Erro ao buscar serviços",l)}};function ge(l){M.value=l.numero,B.value=l.token,f.value=!0}function we(l){B.value=l.token,P.value.apresentante_nome=l.apresentante_nome,P.value.apresentante_cpf=l.apresentante_cpf,h.value=!0}function he(l){const e=V("user-service"),i=s.value.find(x=>x.id===l);e.value=e.value=JSON.stringify({id:i.id,token:i.token}),D.push({path:`/os/atualizar/${l}`})}function xe(l,e){M.value=l,ne.value={token:e.token,numero:e.numero,valor:e.valor,valor_pago:e.valor_pago},b.value=!0}const $e=()=>{const l=V("user-service"),e=V("ordem-button");l.value=null,le.value=!0,e.value=le.value};return Ae(()=>{qe(async()=>{const l=sessionStorage.getItem("pesquisaOS");if(l){const e=JSON.parse(l);Object.assign(n,e)}await re()})}),_e(),ke(),Ve(),(l,e)=>{const i=Se,x=Ce,se=Xe,z=Ze,F=Ee("mask");return I(),K(Y,{class:"mt-5",style:{width:"100%"}},{default:r(()=>[o(A,{class:"mb-5"},{default:r(()=>[e[18]||(e[18]=d("h1",null,"Ordens de Serviço",-1)),$(" "+ee(t(B))+" ",1),o(i,{to:"/os/criar-registro"},{default:r(()=>[d("img",{style:{width:"60px",height:"60px",cursor:"pointer","margin-left":"70px"},src:Ne,alt:"novo",onClick:$e})]),_:1})]),_:1}),o(A,{style:{"margin-bottom":"-35px"}},{default:r(()=>[o(v,null,{default:r(()=>[o(y,{modelValue:t(n).numero,"onUpdate:modelValue":e[0]||(e[0]=a=>t(n).numero=a),label:"Número"},null,8,["modelValue"])]),_:1}),o(v,null,{default:r(()=>[J(o(y,{modelValue:t(n).data_inicio,"onUpdate:modelValue":e[1]||(e[1]=a=>t(n).data_inicio=a),label:"Abertura de",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[F,"##/##/####"]])]),_:1}),o(v,null,{default:r(()=>[J(o(y,{modelValue:t(n).data_fim,"onUpdate:modelValue":e[2]||(e[2]=a=>t(n).data_fim=a),label:"Abertura até",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[F,"##/##/####"]])]),_:1}),o(v,null,{default:r(()=>[J(o(y,{modelValue:t(n).data_lavratura_inicio,"onUpdate:modelValue":e[3]||(e[3]=a=>t(n).data_lavratura_inicio=a),label:"Lavratura de",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[F,"##/##/####"]])]),_:1}),o(v,null,{default:r(()=>[J(o(y,{modelValue:t(n).data_lavratura_fim,"onUpdate:modelValue":e[4]||(e[4]=a=>t(n).data_lavratura_fim=a),label:"Lavratura até",placeholder:"dd/mm/yyyy",style:{width:"150px"}},null,8,["modelValue"]),[[F,"##/##/####"]])]),_:1}),o(v,null,{default:r(()=>[o(y,{modelValue:t(n).protocolo,"onUpdate:modelValue":e[5]||(e[5]=a=>t(n).protocolo=a),label:"Protocolo"},null,8,["modelValue"])]),_:1}),o(v,{md:"1"},{default:r(()=>[o(y,{modelValue:t(n).livro,"onUpdate:modelValue":e[6]||(e[6]=a=>t(n).livro=a),label:"Livro"},null,8,["modelValue"])]),_:1}),o(v,{md:"1"},{default:r(()=>[o(y,{modelValue:t(n).folha,"onUpdate:modelValue":e[7]||(e[7]=a=>t(n).folha=a),label:"Folha"},null,8,["modelValue"])]),_:1})]),_:1}),o(A,null,{default:r(()=>[o(v,{md:"3"},{default:r(()=>[e[19]||(e[19]=$(" <<<<<<< HEAD ")),o(H,{modelValue:t(n).situacao,"onUpdate:modelValue":e[8]||(e[8]=a=>t(n).situacao=a),items:t(T),label:"Situação"},null,8,["modelValue","items"]),e[20]||(e[20]=$(" ======= ")),o(H,{modelValue:t(n).situacao,"onUpdate:modelValue":e[9]||(e[9]=a=>t(n).situacao=a),items:t(T),"item-title":"descricao","item-value":"descricao",label:"Situação"},null,8,["modelValue","items"]),e[21]||(e[21]=$(" >>>>>>> refact/combolist "))]),_:1}),o(v,{md:"2"},{default:r(()=>[o(H,{items:t(_),modelValue:t(n).usuario_token,"onUpdate:modelValue":e[10]||(e[10]=a=>t(n).usuario_token=a),"item-title":"user_nome","item-value":"user_token",label:"Usuario"},null,8,["items","modelValue"])]),_:1}),o(v,{md:"1"},{default:r(()=>[o(y,{modelValue:t(n).selo,"onUpdate:modelValue":e[11]||(e[11]=a=>t(n).selo=a),label:"Selo"},null,8,["modelValue"])]),_:1}),o(v,{md:"3"},{default:r(()=>[o(H,{modelValue:t(n).ato_tipo_token,"onUpdate:modelValue":e[12]||(e[12]=a=>t(n).ato_tipo_token=a),items:t(R),"item-title":"descricao","item-value":"token",label:"Serviço"},null,8,["modelValue","items"])]),_:1}),o(v,{md:"2"},{default:r(()=>[o(y,{modelValue:t(n).apresentante,"onUpdate:modelValue":e[13]||(e[13]=a=>t(n).apresentante=a),label:"Apresentante"},null,8,["modelValue"])]),_:1}),o(v,null,{default:r(()=>[d("div",null,[d("img",{onClick:ye,style:{width:"40px",height:"40px",cursor:"pointer"},src:Me,alt:"Pesquisar"})])]),_:1})]),_:1}),e[23]||(e[23]=d("hr",{class:"mt-5 mb-5"},null,-1)),o(He,{headers:pe,style:{"min-width":"1230px","font-size":"12px"},items:t(s),"item-key":"id"},{"item.actions":r(({item:a})=>[o(A,{style:{display:"flex",gap:"2px","margin-top":"-5px"}},{default:r(()=>[d("div",{class:X({disabled:!a.btn_receber}),title:a.btn_receber?"Receber":"Bloqueado",onClick:L=>a.btn_receber?xe(a.numero,a):null},[d("img",{style:j({cursor:a.btn_receber?"pointer":"default",width:"30px",height:"30px"}),src:Pe,alt:"Receber"},null,4)],10,et),d("div",{class:X({disabled:!a.btn_editar}),onClick:L=>a.btn_editar?he(a.id):null,title:a.btn_editar?"Editar":"Bloqueado"},[d("img",{style:j({cursor:a.btn_editar?"pointer":"default",width:"30px",height:"30px"}),src:Fe,alt:"Editar"},null,4)],10,tt),d("div",{class:X({disabled:!a.btn_recibo}),onClick:L=>a.btn_recibo?we(a):null,title:a.btn_recibo?"Emitir Recibo":"Bloqueado"},[d("img",{style:j({cursor:a.btn_recibo?"pointer":"default",width:"30px",height:"30px"}),src:Le,alt:"Emitir Recibo"},null,4)],10,ot),d("div",{onClick:L=>be(a.token)},e[22]||(e[22]=[d("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:Je,alt:"escanear",title:"escanear"},null,-1)]),8,at),d("div",{disabled:!a.btn_cancelar,onClick:L=>a.btn_cancelar?ge(a):null,title:"Cancelamento",style:j({opacity:a.btn_cancelar?1:.5,cursor:a.btn_cancelar?"pointer":"not-allowed"})},[a.excluido?(I(),ie("img",nt)):(I(),ie("img",rt))],12,lt)]),_:2},1024)]),_:1},8,["items"]),o(x,{show:t(b),numero_os:t(M),ordem:t(ne),onClose:e[14]||(e[14]=a=>b.value=!1),onRefreshValue:e[15]||(e[15]=a=>re())},null,8,["show","numero_os","ordem"]),o(se,{show:t(f),numero_os:t(M),ordemserv_token:t(B),onClose:e[16]||(e[16]=a=>f.value=!1)},null,8,["show","numero_os","ordemserv_token"]),o(z,{show:t(h),apresentante_nome:t(P).apresentante_nome,apresentante_cpf:t(P).apresentante_cpf,token:t(B),onClose:e[17]||(e[17]=a=>h.value=!1)},null,8,["show","apresentante_nome","apresentante_cpf","token"])]),_:1})}}};export{Bt as default};
