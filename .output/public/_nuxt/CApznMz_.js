import{_ as ge}from"./DL85ciY7.js";import{u as he,L as me,P as pe,r as s,n as be,o as u,p as L,w as a,b as t,q as e,C as fe,V as oe,d as W,A as R,v as _e,m as G,I as Se,G as ye,a as z,c as q,R as je,x as Re,S as Ue,F as qe,g as Fe,T as Pe,t as ve}from"./BY_DW5tW.js";import{u as p}from"./C8Xv-wCf.js";import{V as U}from"./BiP6ifMN.js";import{V as B}from"./DqTtSvJw.js";import{V as ke}from"./B45pF_-_.js";import{V as xe}from"./8M5Fco_J.js";import{_ as Ie}from"./CiH314i2.js";import{_ as Le,a as Ne,b as Be,T as Ge,W as Ke,S as He,D as Oe,c as Je,d as We,e as Xe,f as Ye}from"./BAndWNyC.js";import{_ as Qe,r as Te}from"./4aNj2Fm5.js";import{_ as $e}from"./Dk5mUoax.js";import{_ as ze}from"./BVz1G1IN.js";import{_ as Ze}from"./CSzN70ch.js";import{_ as et}from"./SfOxVqVZ.js";import{_ as Ce,a as Ee}from"./DJvq3mCv.js";import{V as Ve}from"./he8Ovxnd.js";import{_ as Me}from"./CYZC1xuu.js";import{V as tt}from"./CxJhbGSD.js";import{f as Ae}from"./B0IxRygJ.js";import{_ as at}from"./D_9r5wJH.js";import{_ as ot}from"./-zgYk4Vu.js";import{c as st,r as rt,u as nt}from"./DhELuThq.js";const aa={__name:"Dados",props:{item_dados:{type:Array,required:!0},item_situacoes:{type:Array,required:!0}},setup(ce){const _=ce,{$toast:C}=he(),h=_e(),d=me(),m=pe(),x=`${h.public.managemant}/updateAtos`,E=s(_.item_situacoes),Q=s(m.query.origem==="vizualizar"),O=be({dt_abertura:_.item_dados[0].dt_abertura||null,status:_.item_dados[0].status||null,mne:_.item_dados[0].mne||null});async function Z(){const{data:T,error:b,status:V}=await p(`${x}/${m.query.ato_id}`,{method:"PUT",body:{status:O.status,mne:O.mne,dt_abertura:O.dt_abertura}},"$EIT5jtTUdX");V.value==="success"&&C.success("Ato Atualizado com sucesso")}const w=()=>{const T=m.query.origem||"criar",b=m.query.id;switch(T){case"atualizar":case"vizualizar":d.push(`/os/atualizar/${b}`);break;case"atualizar-lista":case"vizualizar-lista":d.push("/atos/lista");break;default:d.push("/os/criar-registro");break}};return(T,b)=>{const V=ge;return u(),L(xe,null,{default:a(()=>[t(U,{class:"mt-5"},{default:a(()=>[t(B,{cols:"3"},{default:a(()=>[t(ke,{label:"Situação",modelValue:e(O).status,"onUpdate:modelValue":b[0]||(b[0]=v=>e(O).status=v),items:e(E),"item-title":"descricao","item-value":"descricao",required:""},null,8,["modelValue","items"])]),_:1})]),_:1}),t(U,null,{default:a(()=>[t(B,{cols:"5"},{default:a(()=>[t(fe,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:e(O).mne,"onUpdate:modelValue":b[1]||(b[1]=v=>e(O).mne=v)},null,8,["modelValue"])]),_:1})]),_:1}),t(U,null,{default:a(()=>[t(B,{cols:"2"},{default:a(()=>[t(fe,{modelValue:e(O).dt_abertura,"onUpdate:modelValue":b[2]||(b[2]=v=>e(O).dt_abertura=v),type:"date",label:"Data Lavratura",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),t(U,{class:"mb-3"},{default:a(()=>[t(V,{onClick:w},{default:a(()=>[t(oe,{size:"large",color:"red"},{default:a(()=>b[3]||(b[3]=[W("Voltar")])),_:1})]),_:1}),e(Q)?R("",!0):(u(),L(oe,{key:0,class:"ml-10",onClick:Z,size:"large",color:"green"},{default:a(()=>b[4]||(b[4]=[W("Atualizar")])),_:1}))]),_:1})]),_:1})}}},lt={key:0},it=["onClick"],ct={key:0,style:{width:"30px",height:"30px"},src:$e,alt:"Visualizar"},ut={key:1,style:{width:"30px",height:"30px"},src:Ze,alt:"Visualizar"},dt=["onClick"],mt=["onClick"],pt={key:0,style:{width:"30px",height:"30px"},src:Ce,alt:"Visualizar",title:"Reativar"},_t={key:1,src:Ee,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},vt=["onClick"],oa={__name:"Partes",async setup(ce){let _,C;const h=me(),d=pe(),m=_e(),{$toast:x}=he(),E=`${m.public.managemant}/pesquisarPessoas`,Q=`${m.public.managemant}/listarPapeis`,O=`${m.public.managemant}/createAtosPessoa`,Z=`${m.public.managemant}/updateAtosPessoa`,w=`${m.public.managemant}/getAtosPessoaById`,T=`${m.public.managemant}/download`,b=s(G("user-data").value.cartorio_token),V=s(d.query.origem==="vizualizar"),v=s([]),K=s({}),$=s([]),J=s([]),A=s(!1),M=s(!1),X=s(!1),ee=s(!1),Y=s(null),f=s(null),k=s(null),te=s(null),n=s(null),r=s(d.query.tipo_ato_token),y=s(null),D=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"320px"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome",width:"320px"},{value:"actions"}],i=be({papeis:null,nome:null,pessoa:null,documento:null});Se(()=>{var l;return((l=i.pessoa)==null?void 0:l.link_ficha)||!1});const{data:F}=([_,C]=ye(()=>p(Q,{method:"POST",body:{tipo_ato_token:d.query.tipo_ato_token}},"$acoiTIUp00")),_=await _,C(),_);J.value=F.value;const o=async()=>{const{data:l}=await p(`${w}/${d.query.ato_id}`,{method:"GET"},"$ypnU9hCpVn"),I=(re=>re.map(ie=>({...ie,pessoa:{...ie.pessoa,documento:ie.pessoa.doc_identificacao},papel:{...ie.partes_tipos}})))(l.value);$.value=I};o();async function g(){try{const{data:l,error:c}=await p(E,{method:"POST",body:{cartorio_token:b.value,documento:i.documento,nome:i.nome}},"$pr30MyPXfY");l.value.length>0?(v.value=l.value,i.pessoa=v.value[0]):v.value=[]}catch(l){console.error("Erro na requisição",l)}}const H=()=>{M.value=!0},N=async()=>{await o()},ne=async()=>{await o()},S=async()=>{const l={pessoa:i.pessoa,papel:J.value.find(ue=>ue.id===i.papeis),representante:{nome:null}},c=await p(`${w}/${d.query.ato_id}`,{method:"GET"},"$scHdIvxj2D");for(const ue of c.data.value)if(ue.pessoa_id===i.pessoa.id&&ue.ato_id===Number(d.query.ato_id)&&ue.tipo_parte_id===i.papeis){x.error("Pessoa Já Registrada Com Esse Papel!");return}const{data:I,error:re,status:ie}=await p(O,{method:"POST",body:{ato_id:Number(d.query.ato_id),pessoa_id:i.pessoa.id,tipo_parte_id:i.papeis,user_id:G("user-data").value.usuario_id}},"$18isAgOJxG");ie.value==="success"?(l.id=I.value.id,x.success("Pessoa Registrada com Sucesso!"),$.value.push(l)):x.error(re.value.message)},P=async l=>{X.value=!0;const{data:c}=await p(T,{method:"POST",body:{bucket:G("user-data").value.cartorio_token,path:l.pessoa.link_ficha}},"$hmDzSF3F61");y.value=c.value,K.value=l.pessoa},se=l=>{const c=$.value.filter(I=>I.pessoa.id!==l.pessoa.id&&!I.excluido).map(I=>({id:I.pessoa.id,nome:I.pessoa.nome,token:I.pessoa.token}));k.value=l.id,Y.value=c,A.value=!0,f.value=l.pessoa.nome,n.value=l.pessoa.id},le=l=>{ee.value=!0,te.value=l.id,f.value=l.pessoa.nome};async function de(l){l.excluido=!l.excluido;try{await p(`${Z}/${l.id}`,{method:"PUT",body:JSON.stringify({excluido:l.excluido})},"$l09I6nLRfk")}catch(c){console.error("Erro ao excluir pessoa:",c)}}const ae=()=>{const l=d.query.origem||"criar",c=d.query.id;switch(l){case"atualizar":case"vizualizar":h.push(`/os/atualizar/${c}`);break;case"atualizar-lista":case"vizualizar-lista":h.push("/atos/lista");break;default:h.push("/os/criar-registro");break}};return(l,c)=>{const I=Ie,re=Ne,ie=Be,ue=Qe,De=ge;return u(),L(xe,null,{default:a(()=>[e(V)?R("",!0):(u(),L(U,{key:0,class:"mt-5"},{default:a(()=>[t(B,{cols:"3"},{default:a(()=>[t(fe,{label:"Documento",modelValue:e(i).documento,"onUpdate:modelValue":c[0]||(c[0]=j=>e(i).documento=j)},null,8,["modelValue"])]),_:1}),t(B,{cols:"4"},{default:a(()=>[t(fe,{label:"Pessoa",modelValue:e(i).nome,"onUpdate:modelValue":c[1]||(c[1]=j=>e(i).nome=j)},null,8,["modelValue"])]),_:1}),z("div",null,[z("img",{class:"mt-1",src:$e,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:g})]),z("div",null,[z("img",{class:"mt-1 ml-2",src:ze,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:H})])]),_:1})),e(V)?R("",!0):(u(),L(U,{key:1},{default:a(()=>[t(B,{cols:"4"},{default:a(()=>[t(ke,{label:"Selecione a Pessoa",modelValue:e(i).pessoa,"onUpdate:modelValue":c[2]||(c[2]=j=>e(i).pessoa=j),items:e(v),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),t(B,{cols:"3"},{default:a(()=>[t(ke,{label:"Papel",modelValue:e(i).papeis,"onUpdate:modelValue":c[3]||(c[3]=j=>e(i).papeis=j),items:e(J),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),e(V)?R("",!0):(u(),q("div",lt,[z("img",{class:"mt-1",src:ze,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:S})]))]),_:1})),t(U,null,{default:a(()=>[t(B,null,{default:a(()=>[t(Ve,{style:{height:"465px"},headers:D,items:e($)},{"item.actions":a(({item:j})=>[e(V)?R("",!0):(u(),L(U,{key:0},{default:a(()=>[z("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-1",onClick:we=>P(j),title:"Visualizar Ficha"},[j.pessoa.link_ficha?(u(),q("img",ct)):(u(),q("img",ut))],8,it),z("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:we=>le(j),class:"mr-1",title:"Alterar Papel"},c[8]||(c[8]=[z("img",{style:{width:"30px",height:"30px"},src:et,alt:"Visualizar"},null,-1)]),8,dt),z("div",{class:"mr-1",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:we=>de(j),title:"Deletar Pessoa"},[j.excluido?(u(),q("img",pt)):(u(),q("img",_t))],8,mt),z("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-1",onClick:we=>se(j),title:"Selecionar Representante"},c[9]||(c[9]=[z("img",{style:{width:"30px",height:"30px"},src:Le,alt:"Visualizar"},null,-1)]),8,vt)]),_:2},1024))]),_:1},8,["items"])]),_:1})]),_:1}),t(I,{show:e(M),onClose:c[4]||(c[4]=j=>M.value=!1)},null,8,["show"]),t(re,{representante_nome:e(f),representantes:e(Y),ato_id:e(k),show:e(A),onClose:c[5]||(c[5]=j=>A.value=!1),onUpdateRepresentante:ne},null,8,["representante_nome","representantes","ato_id","show"]),t(ie,{representante_nome:e(f),ato_token:e(r),ato_id:e(te),show:e(ee),onClose:c[6]||(c[6]=j=>ee.value=!1),onUpdatePapel:N},null,8,["representante_nome","ato_token","ato_id","show"]),e(X)?(u(),L(ue,{key:2,show:e(X),"link-view":e(y),"pessoa-obj":e(K),"is-view":!0,onClose:c[7]||(c[7]=j=>X.value=!1)},null,8,["show","link-view","pessoa-obj"])):R("",!0),t(U,null,{default:a(()=>[t(De,{onClick:ae},{default:a(()=>[t(oe,{size:"large",color:"red"},{default:a(()=>c[10]||(c[10]=[W("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},ft={key:0,class:"loading-overlay"},yt="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",sa={__name:"Minuta",emits:["page","doc"],setup(ce,{emit:_}){je("DocumentEditorContainer",[Ge,Ke,He]);const C=_e(),{$toast:h}=he(),d=me(),m=pe(),x=_;Te(`${C.public.docEditor}`);const E=`${C.public.managemant}/download`,Q=`${C.public.managemant}/atos/files`,O=`${C.public.managemant}/subitituirModelo`,Z=`${C.public.managemant}/upload`,w=s(null),T=s(!1),b=s("Ao executar a geração, a minuta atual será substituída e não poderá ser recuperada.Confirma ?"),V=s(m.query.origem==="vizualizar"),v=s(!1),K=async n=>{try{const r=await fetch(n);if(!r.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await r.blob()}catch(r){return console.error(r),null}},$=async()=>{try{const{data:n}=await p(`${Q}/${m.query.ato_token_edit}`,{method:"GET"},"$5jxI4TvFse");return n.value.link_ato}catch(n){console.error("Erro ao carregar o documento:",n),h.error(n)}},J=async()=>{v.value=!0;try{const n=await $(),{data:r,status:y}=await p(E,{method:"POST",body:{bucket:G("user-data").value.cartorio_token,path:n}},"$dvNFfvmIJC"),D=r.value,i=await K(D);if(i){const F=new FileReader;F.onload=()=>{const o=F.result;w.value.ej2Instances.documentEditor.open(o),x("doc",o)},F.readAsText(i)}}catch{console.error("Erro ao carregar o documento.")}finally{v.value=!1}},A=async()=>{const r=await w.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),y=new FileReader;y.onload=()=>{const D=y.result,F=w.value.ej2Instances.documentEditor.pageCount;x("page",F),x("doc",D)},y.readAsText(r)},M=async()=>{v.value=!0;try{const r=await w.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),y=new FormData;y.append("file",r,"anexo.sfdt"),y.append("cartorio_token",G("user-data").value.cartorio_token),y.append("token",m.query.ato_token_edit),y.append("tipo","ato_minuta");const{data:D,status:i}=await p(Z,{method:"POST",body:y},"$xv11VtUdMy");if(i.value==="success"){h.success("Documento enviado!");const o=w.value.ej2Instances.documentEditor.pageCount;A(),x("page",o)}else h.error("Erro ao enviar documento para o sistema.")}catch(n){h.error("Erro ao salvar documento."),console.error(n)}finally{v.value=!1}},X=()=>{T.value=!1,ee()},ee=async()=>{k(!0);try{await Y(),k(!0);const{data:n,status:r}=await p(O,{method:"POST",body:{ato_token:m.query.ato_token_edit}},"$zyzWHTXTBW");n.value&&f(n.value)}catch(n){console.error("Erro ao gerar a minuta:",n),h.error("Ocorreu um erro ao gerar a minuta.")}finally{k(!1)}},Y=async()=>{try{const{data:n}=await p(E,{method:"POST",body:{bucket:G("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$KreLE0Ys81"),r=await K(n.value);if(r){const y=new FileReader;y.onload=()=>{const D=y.result;w.value.ej2Instances.documentEditor.open(D),x("doc",D)},y.readAsText(r)}}catch(n){console.error("Erro ao carregar o modelo de minuta:",n)}},f=n=>{const r=w.value.ej2Instances.documentEditor,y=D=>{for(const[i,F]of Object.entries(D))if(/^<<.+>>$/.test(i))try{r.search.findAll(i),r.search.searchResults.length>0&&r.search.searchResults.replaceAll(F)}catch(o){console.error(`Erro ao substituir o marcador ${i}:`,o)}else if(i==="partes"&&Array.isArray(F)&&F.length>0)for(const o of F)typeof o=="object"&&y(o)};y(n)},k=n=>{v.value=n},te=()=>{const n=m.query.origem||"criar",r=m.query.id;switch(n){case"atualizar":case"vizualizar":d.push(`/os/atualizar/${r}`);break;case"atualizar-lista":case"vizualizar-lista":d.push("/atos/lista");break;default:d.push("/os/criar-registro");break}};return Re(async()=>{await J(),A()}),(n,r)=>{const y=ge,D=Me;return u(),q(qe,null,[t(e(Oe),{height:"900px",ref_key:"documentEditorContainer",ref:w,serviceUrl:yt,enableToolbar:!0,enableWordExport:!0},null,512),e(v)?(u(),q("div",ft,[t(Ue,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):R("",!0),t(U,{class:"ml-4 mt-4 mb-4"},{default:a(()=>[t(y,{class:"mr-4"},{default:a(()=>[t(oe,{size:"large",onClick:te,color:"red"},{default:a(()=>r[2]||(r[2]=[W("Voltar")])),_:1})]),_:1}),e(V)?R("",!0):(u(),L(oe,{key:0,size:"large",color:"green",onClick:M,disabled:e(v)},{default:a(()=>r[3]||(r[3]=[W("Atualizar")])),_:1},8,["disabled"])),e(V)?R("",!0):(u(),L(oe,{key:1,class:"ml-4",size:"large",color:"blue",onClick:r[0]||(r[0]=i=>T.value=!0)},{default:a(()=>r[4]||(r[4]=[W("Gerar Minuta")])),_:1}))]),_:1}),t(D,{onConfirm:X,condMessage:e(b),show:e(T),onClose:r[1]||(r[1]=i=>T.value=!1)},null,8,["condMessage","show"])],64)}}},gt={key:0},ht=["src"],kt={key:1},bt=["innerHTML"],ra={__name:"Livro",props:{pages:{type:Number,required:!0},document:{type:String,required:!0},linkLivro:{type:String||null}},async setup(ce){let _,C;const h=ce,d=_e();Te(`${d.public.docEditor}`);const{$toast:m}=he(),x=me(),E=pe(),Q=`${d.public.managemant}/download`,O=`${d.public.managemant}/atos/files`,Z=`${d.public.managemant}/lavrarAto`,w=`${d.public.managemant}/valida_lavratura`,T=`${d.public.managemant}/listarEscrevente`,b=`${d.public.managemant}/ato_calcular`,V=s(G("user-data").value.cartorio_token),v=G("auth_token").value,K=s("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),$=s(null),J=s(""),A=s(!1),M=s(null),X=s(null),ee=s(E.query.origem==="vizualizar"),Y=s(null),f=s([]),k=s({}),te=s(null),n=be({escrevente:null}),r=async S=>{try{const P=await fetch(S);if(!P.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await P.blob()}catch(P){return console.error(P),null}},y=async()=>{try{const{data:S}=await p(`${O}/${E.query.ato_token_edit}`,{method:"GET"},"$FnEbAJEARP");return S.value.link_ato}catch(S){console.error("Erro ao carregar o documento:",S),m.error(S)}},D=async()=>{try{if(h.linkLivro){const{data:ae}=await p(Q,{method:"POST",body:{bucket:G("user-data").value.cartorio_token,path:h.linkLivro}},"$7ljqltMqa0");te.value=ae.value;return}const S=await y(),{data:P,status:se}=await p(Q,{method:"POST",body:{bucket:G("user-data").value.cartorio_token,path:S}},"$OWxZSQkyX8"),le=P.value,de=await r(le);if(de){const ae=new FileReader;ae.onload=()=>{const l=ae.result;Y.value.ej2Instances.documentEditor.open(l)},ae.readAsText(de)}}catch{m.error("Erro ao carregar o documento.")}};D();const i=async(S=!1)=>{const P=Y.value.ej2Instances.documentEditor.pageCount;if(!S){const{data:ae,error:l,status:c}=await p(w,{method:"POST",body:{ato_token:E.query.ato_token_edit}},"$sMqfUUQcBM");let I,re;if(c.value==="success"&&ae.value?(I=ae.value[0].status,re=ae.value[0].status_mensagem):l.value&&l.value.data&&(I=l.value.data[0].status,re=l.value.data[0].status_mensagem),I!=="OK"){$.value=I,J.value=re,k.value=null,A.value=!0,K.value=" O ato apresenta inconsistências, deseja prosseguir?";return}}const{data:se,status:le,error:de}=await p(Z,{method:"POST",body:{ato_token:E.query.ato_token_edit,qtd_paginas:P,escrevente_token:n.escrevente,usuario_token:v,cartorio_token:V}},"$OVwiKSwcOE");le.value==="success"?(M.value=se.value,X.value=se.value[0].selo,m.success("Ato lavrado com sucesso!")):m.error(de.value.data[0].status_mensagem||"Falha ao lavrar o ato.")},F=()=>{A.value=!1,$.value=null,J.value="",k.value={}},o=async()=>{const S=Y.value.ej2Instances.documentEditor.pageCount,{data:P,status:se}=await p(b,{method:"POST",body:{ato_token:E.query.ato_token_edit,cartorio_token:V,quantidade:1,usuario_token:v,escrevente_token:n.escrevente,qtd_paginas:S}},"$iv1N3XD6We");se.value==="success"?k.value=P.value[0]:m.error("Falha ao calcular o ato.")},g=async()=>{A.value=!1,$.value&&$.value!=="OK"?(await i(!0),$.value=null,J.value=""):await i()},H=async()=>{A.value=!0,K.value="Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?",await o()},{data:N}=([_,C]=ye(()=>p(T,{method:"POST",body:{cartorio_token:V}},"$Kj765fCvMC")),_=await _,C(),_);f.value=N.value[0].func_json_escreventes;const ne=()=>{const S=E.query.origem||"criar",P=E.query.id;switch(S){case"atualizar":case"vizualizar":x.push(`/os/atualizar/${P}`);break;case"atualizar-lista":case"vizualizar-lista":x.push("/atos/lista");break;default:x.push("/os/criar-registro");break}};return Fe(()=>h.document,()=>{D()}),(S,P)=>{const se=Me;return u(),q(qe,null,[t(U,null,{default:a(()=>[t(B,null,{default:a(()=>[h.linkLivro?(u(),q("div",gt,[z("iframe",{src:e(te),type:"application/pdf",width:"100%",height:"850px"},null,8,ht)])):(u(),q("div",kt,[t(e(Oe),{restrictEditing:!0,enableToolbar:!1,ref_key:"documentEditorContainer",ref:Y,height:"850px",width:"850px"},null,512)]))]),_:1}),e(ee)?R("",!0):(u(),L(B,{key:0},{default:a(()=>[t(ke,{class:"mt-15",label:"Tabelião/escrevente",modelValue:e(n).escrevente,"onUpdate:modelValue":P[0]||(P[0]=le=>e(n).escrevente=le),items:e(f),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),z("img",{onClick:P[1]||(P[1]=le=>H()),style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:Je}),e(M)?(u(),L(tt,{key:0,width:"360"},{default:a(()=>[t(U,null,{default:a(()=>[t(B,null,{default:a(()=>[t(Pe,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:a(()=>[t(B,null,{default:a(()=>[W(" Livro: "+ve(e(M)[0].livro_numero),1)]),_:1}),t(B,null,{default:a(()=>[W(" Protocolo: "+ve(e(M)[0].protocolo?e(M)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),t(B,null,{default:a(()=>[t(Pe,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:a(()=>[W(" Folhas : "+ve(e(M)[0].pagina_inicial)+" A "+ve(e(M)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),z("div",{style:{"margin-left":"10px","padding-bottom":"20px","margin-top":"-10px"},innerHTML:e(X)},null,8,bt)]),_:1})):R("",!0)]),_:1}))]),_:1}),t(oe,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:ne},{default:a(()=>P[2]||(P[2]=[W("Voltar")])),_:1}),t(se,{show:e(A),condMessage:e(K),description:e(J),valor:e(k),onClose:F,onConfirm:g},null,8,["show","condMessage","description","valor"])],64)}}},xt=["onClick"],$t=["onClick"],wt={key:0,style:{width:"30px",height:"30px"},src:Ce,alt:"Visualizar",title:"Reativar"},zt={key:1,src:Ee,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},na={__name:"Observacao",async setup(ce){let _,C;const h=me(),d=pe(),m=_e(),x=`${m.public.managemant}/listarEscrevente`,E=`${m.public.managemant}/atos_observacao`,Q=`${m.public.managemant}/atos_observacao`,O=s(G("user-data").value.cartorio_token),Z=s(d.query.origem==="vizualizar"),w=s(!1),T=s(!1),b=s(""),V=s([]),v=s([]);function K(f){b.value=f.observacao,T.value=!0,w.value=!0}const $=()=>{T.value=!1,w.value=!0,b.value=""},J=[{title:"Data",align:"start",key:"created"},{title:"Escrevente",align:"start",key:"users.nome"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}],A=async()=>{w.value=!1,await M()};async function M(){const{data:f}=await p(`${Q}/${d.query.ato_id}`,{method:"GET"},"$HyzoO40swN");Array.isArray(f.value)?V.value=f.value.map(k=>({...k,created:Ae(k.created,"dd/mm/yyyy hh:mm")})):f.value&&typeof f.value=="object"&&(V.value=[{...f.value,created:Ae(f.value.created,"dd/mm/yyyy hh:mm")}])}[_,C]=ye(()=>M()),await _,C();async function X(f){f.excluido=!f.excluido;try{await p(`${E}/${f.id}`,{method:"PUT",body:JSON.stringify({excluido:f.excluido})},"$gnHMo4uCXD")}catch(k){console.error("Erro ao excluir observação:",k)}}const{data:ee}=([_,C]=ye(()=>p(x,{method:"POST",body:{cartorio_token:O}},"$sP9AKdd3Ky")),_=await _,C(),_);v.value=ee.value[0].func_json_escreventes;const Y=()=>{const f=d.query.origem||"criar",k=d.query.id;switch(f){case"atualizar":case"vizualizar":h.push(`/os/atualizar/${k}`);break;case"atualizar-lista":case"vizualizar-lista":h.push("/atos/lista");break;default:h.push("/os/criar-registro");break}};return(f,k)=>{const te=We,n=ge;return u(),L(xe,null,{default:a(()=>[e(Z)?R("",!0):(u(),L(U,{key:0,class:"mt-5"},{default:a(()=>[e(Z)?R("",!0):(u(),L(oe,{key:0,class:"mb-4 ml-8",onClick:$,size:"large",color:"green"},{default:a(()=>k[0]||(k[0]=[W("Novo")])),_:1}))]),_:1})),t(U,null,{default:a(()=>[t(B,null,{default:a(()=>[t(Ve,{style:{height:"465px"},headers:J,items:e(V)},{"item.observacao":a(({item:r})=>[W(ve(r.observacao.length>100?r.observacao.slice(0,100)+"...":r.observacao),1)]),"item.actions":a(({item:r})=>[t(U,null,{default:a(()=>[z("div",{onClick:y=>K(r)},k[1]||(k[1]=[z("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:$e,alt:"Visualizar"},null,-1)]),8,xt),z("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end","margin-left":"5px"},onClick:y=>X(r),title:"Deletar Observação"},[r.excluido?(u(),q("img",wt)):(u(),q("img",zt))],8,$t)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),e(w)?(u(),L(te,{key:1,show:e(w),observacao:e(b),visualizar:e(T),onClose:A},null,8,["show","observacao","visualizar"])):R("",!0),t(U,null,{default:a(()=>[t(n,{onClick:Y},{default:a(()=>[t(oe,{size:"large",color:"red"},{default:a(()=>k[2]||(k[2]=[W("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},Ct={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Xe,alt:"Criar"},Et={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ye,alt:"Criar"},Vt={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:ot,alt:"Criar"},Pt=["onClick"],At=["onClick"],qt=["onClick"],Ot={key:0,style:{width:"30px",height:"30px"},src:Ce,alt:"Visualizar",title:"Reativar"},Tt={key:1,src:Ee,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},la={__name:"Anexos",async setup(ce){let _,C;const h=_e(),{$toast:d}=he(),m=me(),x=pe(),E=s(x.query.origem==="vizualizar"),Q=`${h.public.biometria}/run-scanner`,O=`${h.public.managemant}/atos_anexos`,Z=`${h.public.managemant}/atos_anexos`,w=`${h.public.managemant}/download`,T=`${h.public.managemant}/atos_anexos`,b=`${h.public.managemant}/upload`,V=s(!1),v=s(null),K=s([]);G("pessoa_token");const $=be({descricao:"",fileEvent:null}),J={descricao:{required:st.withMessage("O campo é obrigatório",rt)}},A=nt(J,$,{$autoDirty:!0}),M=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}],{data:X}=([_,C]=ye(()=>p(`${T}/${x.query.ato_id}`,{method:"GET"},"$AOZpbz65MA")),_=await _,C(),_);K.value=X.value;async function ee(){try{await Y(),await f()}catch(o){console.error("Erro ao executar scanner ou listar arquivos:",o)}}async function Y(){try{const{data:o}=await p(Q,{method:"GET"},"$KttjFhHivJ")}catch(o){d.error("Erro ao acionar o scanner:",o)}}async function f(){try{const{data:o,status:g}=await p("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:x.query.ato_token_edit,cartorio_token:G("user-data").value.cartorio_token}},"$TqQrsgxUkd")}catch(o){console.error("Erro ao enviar o arquivo:",o)}}async function k(){try{const o=document.createElement("input");o.type="file",o.accept="*/*",o.onchange=async g=>{$.fileEvent=g,g.target.files[0]&&(v.value=!0)},o.click()}catch(o){console.error("Erro ao abrir o explorador de arquivos:",o)}}const te=async()=>{V.value=!0};function n(o){return o?!0:(v.value=!1,!1)}const r=async o=>{if(!$.fileEvent||!$.fileEvent.target.files.length){d.error("Nenhum arquivo selecionado.");return}const g=$.fileEvent.target.files[0],H=new FormData;H.append("file",g),H.append("cartorio_token",G("user-data").value.cartorio_token),H.append("token",o),H.append("tipo","ato_anexo");try{const N=await p(b,{method:"POST",body:H},"$KDhIYzGKzM");d.success("Anexo registrado com sucesso!")}catch{d.error("Erro ao enviar o arquivo.")}},y=async()=>{if(A.value.$touch(),!A.value.$invalid&&n($.fileEvent)){const{data:o,error:g,status:H}=await p(O,{method:"POST",body:{ato_id:x.query.ato_id,descricao:$.descricao,user_id:G("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$cdoFBGO0Ti");H.value==="success"&&(d.success("Anexo registrado com sucesso!"),K.value.push(o.value),r(o.value.token))}};async function D(o){o.excluido=!o.excluido;try{await p(`${Z}/${o.id}`,{method:"PUT",body:JSON.stringify({excluido:o.excluido})},"$WLSrgYRoHq")}catch(g){console.error("Erro ao excluir pessoa:",g)}}async function i(o){try{const g=await p(`${w}`,{method:"POST",body:{bucket:G("user-data").value.cartorio_token,path:o.link}},"$NdgRjioizH"),N=await(await fetch(g.data.value)).blob(),ne=URL.createObjectURL(N);window.open(ne,"_blank")}catch(g){console.error("Erro ao excluir pessoa:",g)}}const F=()=>{const o=x.query.origem||"criar",g=x.query.id;switch(o){case"atualizar":case"vizualizar":m.push(`/os/atualizar/${g}`);break;case"atualizar-lista":case"vizualizar-lista":m.push("/atos/lista");break;default:m.push("/os/criar-registro");break}};return(o,g)=>{const H=ge;return u(),L(xe,null,{default:a(()=>[t(U,null,{default:a(()=>[t(B,{cols:"5",class:"mt-2"},{default:a(()=>[e(E)?R("",!0):(u(),L(fe,{key:0,modelValue:e($).descricao,"onUpdate:modelValue":[g[0]||(g[0]=N=>e($).descricao=N),e(A).descricao.$touch],"error-messages":e(A).descricao.$errors.map(N=>N.$message),onBlur:e(A).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"]))]),_:1}),e(E)?R("",!0):(u(),q("div",{key:0,onClick:ee,title:"Escanear"},g[1]||(g[1]=[z("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:at,alt:"Escanear"},null,-1)]))),e(E)?R("",!0):(u(),q("div",{key:1,onClick:k,title:"Criar"},[e(v)===!1?(u(),q("img",Ct)):e(v)===!0?(u(),q("img",Et)):(u(),q("img",Vt))])),e(E)?R("",!0):(u(),q("div",{key:2,onClick:y,title:"Criar"},g[2]||(g[2]=[z("img",{class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:ze,alt:"Criar"},null,-1)])))]),_:1}),t(Ve,{headers:M,items:e(K),style:{height:"465px","max-width":"600px"}},{"item.actions":a(({item:N})=>[t(U,null,{default:a(()=>[z("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:ne=>te(N),title:"Visualizar Anexo"},[z("img",{style:{width:"30px",height:"30px"},onClick:ne=>i(N),src:$e,alt:"Visualizar"},null,8,At)],8,Pt),z("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ne=>D(N),title:"Deletar Pessoa"},[N.excluido?(u(),q("img",Ot)):(u(),q("img",Tt))],8,qt)]),_:2},1024)]),_:1},8,["items"]),t(H,{onClick:F},{default:a(()=>[t(oe,{size:"large",color:"red"},{default:a(()=>g[3]||(g[3]=[W("Voltar")])),_:1})]),_:1})]),_:1})}}};export{aa as _,oa as a,sa as b,ra as c,na as d,la as e};
