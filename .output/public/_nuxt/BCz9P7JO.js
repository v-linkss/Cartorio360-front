import{_ as P}from"./DPSw-VpV.js";import{_ as R}from"./OsaHXbyH.js";import{_ as D}from"./CMOoCs5U.js";import{c as F,r as K,u as L}from"./BlZ2gKk2.js";import{_ as U,D as W,K as j,r as i,e as p,f as J,y as Q,h as X,w as u,k as Z,o as G,b as a,a as h,i as t,s as H,V as Y,d as $}from"./CJCWj7KA.js";import{f as k}from"./Bd9ZfPaH.js";import{u as ee}from"./FRt9fJ3-.js";import{V as te}from"./CpUxg3O1.js";import{V as oe}from"./C4RgyTQw.js";import{V as ae}from"./cv3oliht.js";import{V as se}from"./B8q3QhLm.js";import"./CS37ATUy.js";import"./DgtUKctJ.js";import"./BTmYb_yU.js";import"./DUF9hLAZ.js";import"./DvybOB9S.js";import"./DaoRTHsy.js";import"./CDD_ornJ.js";import"./5KhuJDLv.js";import"./CUfe1w2D.js";const re={style:{width:"600px","margin-top":"10px"}},ne={style:{width:"180px","margin-top":"20px"}},ie={__name:"autenticacao",props:{ato_token:{type:String,required:!0}},async setup(y){let l,g;const x=y,V=W(),b=j(),m=Z(),S=`${m.public.auth}/service/gerencia/listarEscrevente`,v=i(p("user-data").value.cartorio_token).value,B=i(p("user-service").value.token).value||i(p("user-service").value).value,C=p("auth_token").value,z=`${m.public.auth}/service/gerencia/atoAutentica`,A=`${m.public.auth}/service/gerencia/etiquetaAutentica`,T=`${m.public.envioDoc}/print`,_=i(!1),q=i(""),s=J({escrevente:null,quantidade:1}),w=i([]),{data:M}=([l,g]=Q(()=>k(S,{method:"POST",body:{cartorio_token:v}})),l=await l,g(),l);w.value=M.value[0].func_json_escreventes;const N={escrevente:{required:F.withMessage("O campo é obrigatorio",K)}},d=L(N,s),O=async()=>{if(await d.value.$validate()){const{data:o,status:e,error:c}=await k(z,{method:"POST",body:{usuario_token:C,cartorio_token:v,quantidade:Number(s.quantidade),ordemserv_token:B,ato_tipo_token:x.ato_token}});e.value==="success"&&o.value.status==="OK"?I(o.value.token):(_.value=!0,q.value=o.value.status_mensagem||c.value.data.details)}},I=async o=>{const{data:e,status:c}=await k(A,{method:"POST",body:{escrevente_token:s.escrevente,cartorio_token:v,ato_token:o}});if(c.value==="success"){if($toast.success("Ato autenticado com sucesso!"),e.value.tipo_etiqueta==="html"){const r=window.open("","_blank");r.document.open(),r.document.write(e.value.etiqueta),r.document.close()}else if(e.value.tipo_etiqueta==="zpl"){const{status:r}=await ee(`${T}`,{method:"POST",body:{zpl:atob(e.value.etiqueta)}},"$nXL9eJBhI7");if(r.value!=="success"){f(),$toast.error("Não foi possivel fazer a impressao da etiqueta");return}}f()}},f=()=>{const o=b.query.origem||"criar",e=b.query.id;o==="atualizar"?V.push(`/os/atualizar/${e}`):V.push("/os/criar-registro")};return(o,e)=>{const c=P,r=R,E=D;return G(),X(te,{class:"mt-10"},{default:u(()=>[a(se,null,{default:u(()=>[h("div",re,[a(oe,{label:"Tabelião/escrivão",modelValue:t(s).escrevente,"onUpdate:modelValue":e[0]||(e[0]=n=>t(s).escrevente=n),items:t(w),"item-title":"nome","item-value":"token",required:"","error-messages":t(d).escrevente.$errors.map(n=>n.$message),onBlur:t(d).escrevente.$touch,onInput:t(d).escrevente.$touch},null,8,["modelValue","items","error-messages","onBlur","onInput"])]),h("div",ne,[a(H,{type:"number",label:"Quantidade",modelValue:t(s).quantidade,"onUpdate:modelValue":e[1]||(e[1]=n=>t(s).quantidade=n)},null,8,["modelValue"])]),a(ae,{class:"mb-3 mt-2"},{default:u(()=>[a(c,{onClick:f},{default:u(()=>[a(Y,{class:"ml-4",size:"large",color:"red"},{default:u(()=>e[3]||(e[3]=[$("Voltar")])),_:1})]),_:1}),a(r,{class:"ml-4",size:"large",color:"green",onSave:O},{default:u(()=>e[4]||(e[4]=[$("Salvar")])),_:1})]),_:1})]),_:1}),a(E,{show:t(_),errorMessage:t(q),onClose:e[2]||(e[2]=n=>_.value=!1)},null,8,["show","errorMessage"])]),_:1})}}},Be=U(ie,[["__scopeId","data-v-3fcbb415"]]);export{Be as default};
