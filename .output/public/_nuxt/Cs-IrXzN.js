import{_ as F}from"./B4lj0H09.js";import{_ as K}from"./BtxvgTpr.js";import{_ as L}from"./DcMOlz0M.js";import{c as U,r as W,u as j}from"./CX89do9r.js";import{_ as J,D as Q,K as X,u as Z,r as u,e as v,f as G,y as H,h as Y,w as i,k as ee,o as te,b as a,a as y,i as t,s as oe,V as ae,d as x}from"./D7fmYdMW.js";import{f as V}from"./CFqiSm7C.js";import{u as se}from"./CSAuF1pc.js";import{V as re}from"./XrDdW6cD.js";import{V as ne}from"./GgbjH2-d.js";import{V as ue}from"./xP-MEgnK.js";import{V as ie}from"./DOskrr6j.js";import"./BjdXgUk-.js";import"./DXwAjUZW.js";import"./ENtLSbV7.js";import"./Dzg5W5CI.js";import"./BGB1f2eI.js";import"./CXWVFV7j.js";import"./DR4EW3VF.js";import"./DMDLc3Zv.js";import"./CnBVGyc0.js";const ce={style:{width:"600px","margin-top":"10px"}},le={style:{width:"180px","margin-top":"20px"}},me={__name:"autenticacao",props:{ato_token:{type:String,required:!0}},async setup(S){let l,b;const A=S,h=Q(),w=X(),m=ee(),B=`${m.public.auth}/service/gerencia/listarEscrevente`,{$toast:C}=Z(),_=u(v("user-data").value.cartorio_token).value,T=u(v("user-service").value.token).value||u(v("user-service").value).value,z=v("auth_token").value,M=`${m.public.auth}/service/gerencia/atoAutentica`,N=`${m.public.auth}/service/gerencia/etiquetaAutentica`,O=`${m.public.envioDoc}/print`,d=u(!1),f=u(""),k=u(!1),s=G({escrevente:null,quantidade:1}),q=u([]),{data:P}=([l,b]=H(()=>V(B,{method:"POST",body:{cartorio_token:_}})),l=await l,b(),l);q.value=P.value[0].func_json_escreventes;const I={escrevente:{required:U.withMessage("O campo é obrigatorio",W)}},p=j(I,s),E=async()=>{if(await p.value.$validate()){if(k.value)return;k.value=!0;const{data:o,status:e,error:c}=await V(M,{method:"POST",body:{usuario_token:z,cartorio_token:_,quantidade:Number(s.quantidade),ordemserv_token:T,ato_tipo_token:A.ato_token}});e.value==="success"&&o.value.status==="OK"?await R(o.value.token):(d.value=!0,f.value=o.value.status_mensagem||c.value.data.details)}},R=async o=>{const{data:e,status:c,error:$}=await V(N,{method:"POST",body:{escrevente_token:s.escrevente,cartorio_token:_,ato_token:o}});if(c.value==="success"){if(C.success("Ato autenticado com sucesso!"),e.value.tipo_etiqueta==="html"){const r=window.open("","_blank");r.document.open(),r.document.write(e.value.etiqueta),r.document.close()}else if(e.value.tipo_etiqueta==="zpl"){const{status:r,error:n}=await se(`${O}`,{method:"POST",body:{zpl:atob(e.value.etiqueta)}},"$nXL9eJBhI7");if(r.value!=="success"){d.value=!0,f.value=n.value.data.message;return}}g()}},D=()=>{d.value=!1,g()},g=()=>{const o=w.query.origem||"criar",e=w.query.id;o==="atualizar"?h.push(`/os/atualizar/${e}`):h.push("/os/criar-registro")};return(o,e)=>{const c=F,$=K,r=L;return te(),Y(re,{class:"mt-10"},{default:i(()=>[a(ie,null,{default:i(()=>[y("div",ce,[a(ne,{label:"Tabelião/escrivão",modelValue:t(s).escrevente,"onUpdate:modelValue":e[0]||(e[0]=n=>t(s).escrevente=n),items:t(q),"item-title":"nome","item-value":"token",required:"","error-messages":t(p).escrevente.$errors.map(n=>n.$message),onBlur:t(p).escrevente.$touch,onInput:t(p).escrevente.$touch},null,8,["modelValue","items","error-messages","onBlur","onInput"])]),y("div",le,[a(oe,{type:"number",label:"Quantidade",modelValue:t(s).quantidade,"onUpdate:modelValue":e[1]||(e[1]=n=>t(s).quantidade=n)},null,8,["modelValue"])]),a(ue,{class:"mb-3 mt-2"},{default:i(()=>[a(c,{onClick:g},{default:i(()=>[a(ae,{class:"ml-4",size:"large",color:"red"},{default:i(()=>e[2]||(e[2]=[x("Voltar")])),_:1})]),_:1}),a($,{class:"ml-4",size:"large",color:"green",onSave:E,disabled:t(k)},{default:i(()=>e[3]||(e[3]=[x("Salvar")])),_:1},8,["disabled"])]),_:1})]),_:1}),a(r,{show:t(d),errorMessage:t(f),onClose:D},null,8,["show","errorMessage"])]),_:1})}}},ze=J(me,[["__scopeId","data-v-7fca19df"]]);export{ze as default};
