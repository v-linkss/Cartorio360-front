import{_ as le}from"./BvZIN2Wr.js";import{c as Ve,r as ze,u as Ee}from"./BhlBd7NT.js";import{g as Me,D as ee,K as ae,u as ie,r as l,e as O,f as pe,y as me,o as V,h as Z,w as t,b as e,i as a,s as ne,V as J,d as U,k as te,A as De,a as v,c as L,p as ve,M as Re,N as je,F as Pe,O as we,t as re}from"./e9m4pRp4.js";import{u as h}from"./C3pLvR9c.js";import{V as T}from"./UvBdiLcZ.js";import{V as N}from"./Bw2hFddl.js";import{V as ue}from"./BDoiNl-z.js";import{V as _e}from"./D36jnKeO.js";import{_ as Ne,a as Ie,b as Ue}from"./Fk4Bchw6.js";import{_ as Be,a as Fe,b as Le,T as We,W as Ke,D as Ae,c as Je,d as Ge}from"./d8LHTz4d.js";import{_ as Ye,r as Se}from"./pzBgev4z.js";import{_ as ce}from"./hG-K1y3K.js";import{_ as de}from"./BVz1G1IN.js";import{_ as Xe}from"./ZwJvTeKC.js";import{_ as ke,a as xe}from"./DJvq3mCv.js";import{V as $e}from"./DREQUmCm.js";import{_ as Ze}from"./CNC13NEF.js";import{V as Qe}from"./CVPrFjsy.js";import{f as Ce}from"./B0IxRygJ.js";import{_ as He}from"./BkGaRnUY.js";const Ua={__name:"Dados",props:{ato_token:{type:String,required:!0},ato_tipo_id:{type:Number}},emits:["saved"],async setup(W,{emit:$}){let g,_;const f=W;Me(()=>f.ato_tipo_id,o=>{k.value={id:o}});const z=$,y=ee(),E=ae(),B=te(),{$toast:F}=ie(),K=`${B.public.managemant}/listarSituacoes`,w=`${B.public.managemant}/createAtos`;`${B.public.managemant}`;const P=l(O("user-data").value.cartorio_token),b=l(O("user-service").value.id).value||l(O("user-service").value).value,C=l([]),k=l(f.ato_tipo_id?{id:f.ato_tipo_id}:null),x=pe({dt_abertura:null,status:"EM EDIÇÃO",mne:null}),A={status:{required:Ve.withMessage("O campo é obrigatorio",ze)}},q=Ee(A,x);async function R(){if(await q.value.$validate()){const{data:o,error:s,status:i}=await h(w,{method:"POST",body:{ato_tipo_id:k.value.id,cartorio_id:O("user-data").value.cartorio_id,ordemserv_id:b,status:x.status,dt_abertura:x.dt_abertura,mne:x.mne,user_id:O("user-data").value.usuario_id,user_alteracao_id:O("user-data").value.usuario_id}},"$9ZmTYsLk0K");i.value==="success"&&(F.success("Ato registrado com sucesso!"),z("saved",{id:o.value.id,token:o.value.token}))}else F.error("Preencha os campos obrigatorios.")}const{data:j}=([g,_]=me(()=>h(K,{method:"POST",body:{cartorio_token:P.value}},"$hyq5YcBEjF")),g=await g,_(),g);C.value=j.value;const u=()=>{const o=E.query.origem||"criar",s=E.query.id;switch(o){case"atualizar":case"vizualizar":y.push(`/os/atualizar/${s}`);break;case"atualizar-lista":case"vizualizar-lista":y.push("/atos/lista");break;default:y.push("/os/criar-registro");break}};return(o,s)=>{const i=le;return V(),Z(_e,null,{default:t(()=>[e(T,{class:"mt-5"},{default:t(()=>[e(N,{cols:"3"},{default:t(()=>[e(ue,{label:"Situação",modelValue:a(x).status,"onUpdate:modelValue":s[0]||(s[0]=r=>a(x).status=r),items:a(C),"item-title":"descricao","item-value":"descricao",required:"","error-messages":a(q).status.$errors.map(r=>r.$message),onBlur:a(q).status.$touch,onInput:a(q).status.$touch},null,8,["modelValue","items","error-messages","onBlur","onInput"])]),_:1})]),_:1}),e(T,null,{default:t(()=>[e(N,{cols:"5"},{default:t(()=>[e(ne,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:a(x).mne,"onUpdate:modelValue":s[1]||(s[1]=r=>a(x).mne=r)},null,8,["modelValue"])]),_:1})]),_:1}),e(T,null,{default:t(()=>[e(N,{cols:"2"},{default:t(()=>[e(ne,{modelValue:a(x).dt_abertura,"onUpdate:modelValue":s[2]||(s[2]=r=>a(x).dt_abertura=r),type:"date",label:"Data Lavratura",disabled:"",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(T,{class:"mb-3"},{default:t(()=>[e(i,{onClick:u},{default:t(()=>[e(J,{size:"large",color:"red"},{default:t(()=>s[3]||(s[3]=[U("Voltar")])),_:1})]),_:1}),e(J,{class:"ml-10",onClick:R,size:"large",color:"green"},{default:t(()=>s[4]||(s[4]=[U("Salvar")])),_:1})]),_:1})]),_:1})}}},ea=["onClick"],aa=["onClick"],ta=["onClick"],oa={key:0,style:{width:"30px",height:"30px"},src:ke,alt:"Visualizar",title:"Reativar"},sa={key:1,src:xe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},ra=["onClick"],Ba={__name:"Partes",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},async setup(W){let $,g;const _=W,f=ee(),z=ae(),y=te(),{$toast:E}=ie(),B=`${y.public.managemant}/pesquisarPessoas`,F=`${y.public.managemant}/listarPapeis`,K=`${y.public.managemant}/download`,w=`${y.public.managemant}/createAtosPessoa`,P=`${y.public.managemant}/getAtosPessoaById`,b=`${y.public.managemant}/updateAtosPessoa`,C=l(O("user-data").value.cartorio_token),k=l([]),x=l({}),A=l([]),q=l([]),R=l(!1),j=l(!1),u=l(!1),o=l(!1),s=l(null),i=l(null),r=l(null),c=l(null);l(null);const m=l(null),S=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"400px"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome"},{value:"actions"}],d=pe({papeis:null,nome:null,pessoa:null,documento:null});De(()=>{var p;return((p=d.pessoa)==null?void 0:p.link_ficha)||!1});const{data:Y}=([$,g]=me(()=>h(F,{method:"POST",body:{tipo_ato_token:_.ato_token}},"$fFKndZhA4W")),$=await $,g(),$);q.value=Y.value;async function fe(){try{const{data:p,error:n}=await h(B,{method:"POST",body:{cartorio_token:C.value,documento:d.documento,nome:d.nome}},"$o3ZL1rvYrY");p.value.length>0?(k.value=p.value,d.pessoa=k.value[0]):k.value=[]}catch(p){console.error("Erro na requisição",p)}}const G=()=>{j.value=!0},I=p=>{A.value=A.value.map(n=>n.id===r.value?{...n,papel:{...n.papel,descricao:p}}:n)},oe=p=>{const n=A.value.find(M=>M.pessoa.id===c.value);n.representante.nome=p},X=async()=>{const p={pessoa:d.pessoa,papel:q.value.find(M=>M.id===d.papeis),representante:{nome:null}},n=await h(`${P}/${_.ato_id}`,{method:"GET"},"$kXSxUa4grs");for(const M of n.data.value)if(M.pessoa_id===d.pessoa.id&&M.ato_id===_.ato_id&&M.tipo_parte_id===d.papeis){E.error("Pessoa Já Registrada Com Esse Papel!");return}try{const{data:M,error:ye,status:be}=await h(w,{method:"POST",body:{ato_id:Number(_.ato_id),pessoa_id:d.pessoa.id,tipo_parte_id:d.papeis,user_id:Number(O("user-data").value.usuario_id)}},"$So3qnQu7ek");be.value==="success"?(p.id=M.value.id,E.success("Pessoa Registrada com Sucesso!"),A.value.push(p)):E.error(ye.value.message)}catch{E.error("Erro no servidor. Tente novamente.")}},Q=async p=>{u.value=!0;const{data:n}=await h(K,{method:"POST",body:{bucket:O("user-data").value.cartorio_token,path:p.pessoa.link_ficha}},"$Q3kbIwtd9t");m.value=n.value,x.value=p.pessoa},ge=p=>{const n=A.value.filter(M=>M.pessoa.id!==p.pessoa.id).map(M=>({id:M.pessoa.id,nome:M.pessoa.nome}));r.value=p.id,s.value=n,R.value=!0,i.value=p.pessoa.nome,c.value=p.pessoa.id},H=p=>{r.value=p.id,o.value=!0,i.value=p.pessoa.nome};async function se(p){p.excluido=!p.excluido;try{await h(`${b}/${r.value}`,{method:"PUT",body:JSON.stringify({excluido:p.excluido})},"$9xStKwGd7o")}catch(n){console.error("Erro ao excluir pessoa:",n)}}const Oe=()=>{const p=z.query.origem||"criar",n=z.query.id;switch(p){case"atualizar":case"vizualizar":f.push(`/os/atualizar/${n}`);break;case"atualizar-lista":case"vizualizar-lista":f.push("/atos/lista");break;default:f.push("/os/criar-registro");break}};return(p,n)=>{const M=Ne,ye=Fe,be=Le,Te=Ye,qe=le;return V(),Z(_e,null,{default:t(()=>[e(T,{class:"mt-5"},{default:t(()=>[e(N,{cols:"3"},{default:t(()=>[e(ne,{label:"Documento",modelValue:a(d).documento,"onUpdate:modelValue":n[0]||(n[0]=D=>a(d).documento=D)},null,8,["modelValue"])]),_:1}),e(N,{cols:"4"},{default:t(()=>[e(ne,{label:"Pessoa",modelValue:a(d).nome,"onUpdate:modelValue":n[1]||(n[1]=D=>a(d).nome=D)},null,8,["modelValue"])]),_:1}),v("div",null,[v("img",{class:"mt-3",src:ce,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:fe})]),v("div",null,[v("img",{class:"mt-3 ml-2",src:de,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:G})])]),_:1}),e(T,null,{default:t(()=>[e(N,{cols:"4"},{default:t(()=>[e(ue,{label:"Selecione a Pessoa",modelValue:a(d).pessoa,"onUpdate:modelValue":n[2]||(n[2]=D=>a(d).pessoa=D),items:a(k),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),e(N,{cols:"3"},{default:t(()=>[e(ue,{label:"Papel",modelValue:a(d).papeis,"onUpdate:modelValue":n[3]||(n[3]=D=>a(d).papeis=D),items:a(q),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),v("div",null,[v("img",{class:"mt-3",src:de,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:X})])]),_:1}),e(T,null,{default:t(()=>[e(N,null,{default:t(()=>[e($e,{style:{height:"465px"},headers:S,items:a(A)},{"item.actions":t(({item:D})=>[e(T,null,{default:t(()=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:he=>Q(D),title:"Visualizar Ficha"},n[8]||(n[8]=[v("img",{style:{width:"30px",height:"30px"},src:ce,alt:"Visualizar"},null,-1)]),8,ea),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:he=>H(D),class:"mr-2",title:"Alterar Papel"},n[9]||(n[9]=[v("img",{style:{width:"30px",height:"30px"},src:Xe,alt:"Visualizar"},null,-1)]),8,aa),v("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:he=>se(D),title:"Deletar Pessoa"},[D.excluido?(V(),L("img",oa)):(V(),L("img",sa))],8,ta),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:he=>ge(D),title:"Selecionar Representante"},n[10]||(n[10]=[v("img",{style:{width:"30px",height:"30px"},src:Be,alt:"Visualizar"},null,-1)]),8,ra)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),e(M,{show:a(j),onClose:n[4]||(n[4]=D=>j.value=!1)},null,8,["show"]),e(ye,{representante_nome:a(i),representantes:a(s),ato_id:a(r),show:a(R),onClose:n[5]||(n[5]=D=>R.value=!1),onUpdateRepresentante:oe},null,8,["representante_nome","representantes","ato_id","show"]),e(be,{representante_nome:a(i),ato_token:_.ato_token,ato_id:a(r),show:a(o),onClose:n[6]||(n[6]=D=>o.value=!1),onUpdatePapel:I},null,8,["representante_nome","ato_token","ato_id","show"]),a(u)?(V(),Z(Te,{key:0,show:a(u),"link-view":a(m),"pessoa-obj":a(x),"is-view":!0,onClose:n[7]||(n[7]=D=>u.value=!1)},null,8,["show","link-view","pessoa-obj"])):ve("",!0),e(T,null,{default:t(()=>[e(qe,{onClick:Oe},{default:t(()=>[e(J,{size:"large",color:"red"},{default:t(()=>n[11]||(n[11]=[U("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},na={key:0,class:"loading-overlay"},la="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",Fa={__name:"Minuta",props:{ato_token:{type:String,required:!0}},emits:["page","doc"],setup(W,{emit:$}){const g=W;Re("DocumentEditorContainer",[We,Ke]);const _=te(),{$toast:f}=ie(),z=ee(),y=ae(),E=$;Se(`${_.public.docEditor}`);const B=`${_.public.managemant}/upload`,F=`${_.public.managemant}/subitituirModelo`,K=`${_.public.managemant}/download`,w=l(null),P=l(!1),b=async u=>{try{const o=await fetch(u);if(!o.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await o.blob()}catch(o){return console.error(o),null}},C=async()=>{const o=await w.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),s=new FileReader;s.onload=()=>{const i=s.result;E("doc",i)},s.readAsText(o)},k=async()=>{P.value=!0;try{const o=await w.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),s=new FormData;s.append("file",o,"anexo.docx"),s.append("cartorio_token",O("user-data").value.cartorio_token),s.append("token",g.ato_token),s.append("tipo","ato_minuta");const{data:i,status:r}=await h(B,{method:"POST",body:s},"$071xxdqs20");if(r.value==="success"){f.success("Documento enviado!");const m=w.value.ej2Instances.documentEditor.pageCount;C(),E("page",m)}else f.error("Erro ao enviar documento para o sistema.")}catch(u){f.error("Erro ao salvar documento."),console.error(u)}finally{P.value=!1}},x=async()=>{R(!0);try{await A(),R(!0);const{data:u,status:o}=await h(F,{method:"POST",body:{ato_token:g.ato_token}},"$0ktpWliD4l");u.value&&q(u.value)}catch(u){console.error("Erro ao gerar a minuta:",u),f.error("Ocorreu um erro ao gerar a minuta.")}finally{R(!1)}},A=async()=>{try{const{data:u}=await h(K,{method:"POST",body:{bucket:O("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$jXVvQjEE6u"),o=await b(u.value);if(o){const s=new FileReader;s.onload=()=>{const i=s.result;w.value.ej2Instances.documentEditor.open(i),E("doc",i)},s.readAsText(o)}}catch(u){console.error("Erro ao carregar o modelo de minuta:",u),f.error("Falha ao carregar o modelo de minuta.")}},q=u=>{const o=w.value.ej2Instances.documentEditor,s=i=>{for(const[r,c]of Object.entries(i))if(/^<<.+>>$/.test(r))try{o.search.findAll(r),o.search.searchResults.length>0&&o.search.searchResults.replaceAll(c)}catch(m){console.error(`Erro ao substituir o marcador ${r}:`,m)}else if(r==="partes"&&Array.isArray(c)&&c.length>0)for(const m of c)typeof m=="object"&&s(m)};s(u)},R=u=>{P.value=u},j=()=>{const u=y.query.origem||"criar",o=y.query.id;switch(u){case"atualizar":case"vizualizar":z.push(`/os/atualizar/${o}`);break;case"atualizar-lista":case"vizualizar-lista":z.push("/atos/lista");break;default:z.push("/os/criar-registro");break}};return(u,o)=>{const s=le;return V(),L(Pe,null,[e(a(Ae),{height:"900px",ref_key:"documentEditorContainer",ref:w,serviceUrl:la,enableToolbar:!0,enableWordExport:!0},null,512),a(P)?(V(),L("div",na,[e(je,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):ve("",!0),e(T,{class:"ml-4 mt-4 mb-4"},{default:t(()=>[e(s,{class:"mr-4"},{default:t(()=>[e(J,{size:"large",onClick:j,color:"red"},{default:t(()=>o[0]||(o[0]=[U("Voltar")])),_:1})]),_:1}),e(J,{size:"large",color:"green",onClick:k,disabled:a(P)},{default:t(()=>o[1]||(o[1]=[U("Salvar")])),_:1},8,["disabled"]),e(J,{class:"ml-4",size:"large",color:"blue",onClick:x},{default:t(()=>o[2]||(o[2]=[U("Gerar Minuta")])),_:1})]),_:1})],64)}}},ia=["innerHTML"],La={__name:"Livro",props:{ato_token:{type:String,required:!0},pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(W){let $,g;const _=W,f=te();Se(`${f.public.docEditor}`);const{$toast:z}=ie(),y=ee(),E=ae(),B=`${f.public.managemant}/listarEscrevente`,F=`${f.public.managemant}/lavrarAto`,K=`${f.public.managemant}/valida_lavratura`,w=`${f.public.managemant}/ato_calcular`,P=l("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),b=l(!1),C=l(null),k=l(null),x=l(null),A=l(O("user-data").value.cartorio_token),q=O("auth_token").value,R=l([]),j=l({}),u=l(null),o=l(""),s=pe({escrevente:null}),i=async(G=!1)=>{if(!G){const{data:X,error:Q,status:ge}=await h(K,{method:"POST",body:{ato_token:_.ato_token}},"$ZKnVBNYxp9");let H,se;if(ge.value==="success"&&X.value?(H=X.value[0].status,se=X.value[0].status_mensagem):Q.value&&Q.value.data&&(H=Q.value.data[0].status,se=Q.value.data[0].status_mensagem),H!=="OK"){u.value=H,o.value=se,j.value=null,b.value=!0,P.value=" O ato apresenta inconsistências, deseja prosseguir?";return}}const{data:I,status:oe}=await h(F,{method:"POST",body:{ato_token:_.ato_token,qtd_paginas:_.pages,escrevente_token:s.escrevente,usuario_token:q,cartorio_token:A}},"$XouuxOFIWh");oe.value==="success"?(C.value=I.value,k.value=I.value[0].selo,z.success("Ato lavrado com sucesso!")):z.error("Falha ao lavrar o ato.")},r=()=>{b.value=!1,u.value=null,o.value="",j.value={}},c=async()=>{const{data:G,status:I}=await h(w,{method:"POST",body:{ato_token:_.ato_token,cartorio_token:A,quantidade:1,usuario_token:q,escrevente_token:s.escrevente,qtd_paginas:_.pages}},"$R51FaaSzOI");I.value==="success"?j.value=G.value[0]:z.error("Falha ao calcular o ato.")},m=async()=>{b.value=!1,u.value&&u.value!=="OK"?(await i(!0),u.value=null,o.value=""):await i()},S=async()=>{b.value=!0,P.value="Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?",await c()},{data:d}=([$,g]=me(()=>h(B,{method:"POST",body:{cartorio_token:A}},"$JCPnpnnRzP")),$=await $,g(),$);R.value=d.value[0].func_json_escreventes;const Y=function(){x.value.ej2Instances.documentEditor.open(_.document)},fe=()=>{const G=E.query.origem||"criar",I=E.query.id;switch(G){case"atualizar":case"vizualizar":y.push(`/os/atualizar/${I}`);break;case"atualizar-lista":case"vizualizar-lista":y.push("/atos/lista");break;default:y.push("/os/criar-registro");break}};return(G,I)=>{const oe=Ze;return V(),L(Pe,null,[e(T,null,{default:t(()=>[e(N,null,{default:t(()=>[(V(),Z(a(Ae),{restrictEditing:!0,enableToolbar:!1,created:_.document?Y:null,ref_key:"documentEditorContainer",ref:x,height:"850px",width:"850px",key:_.document},null,8,["created"]))]),_:1}),e(N,null,{default:t(()=>[e(ue,{class:"mt-15",label:"Tabelião/escrevente",modelValue:a(s).escrevente,"onUpdate:modelValue":I[0]||(I[0]=X=>a(s).escrevente=X),items:a(R),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),v("div",null,[v("div",null,[v("img",{onClick:I[1]||(I[1]=X=>S()),class:"ml-2",style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:Je}),a(C)?(V(),Z(Qe,{key:0,class:"mr-16"},{default:t(()=>[e(T,{"no-gutters":""},{default:t(()=>[e(N,null,{default:t(()=>[e(we,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:t(()=>[e(N,null,{default:t(()=>[U(" Livro: "+re(a(C)[0].livro_numero),1)]),_:1}),e(N,null,{default:t(()=>[U(" Protocolo: "+re(a(C)[0].protocolo?a(C)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),e(N,null,{default:t(()=>[e(we,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:t(()=>[U(" Folhas : "+re(a(C)[0].pagina_inicial)+" A "+re(a(C)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),v("div",{innerHTML:a(k)},null,8,ia)]),_:1})):ve("",!0)])])]),_:1})]),_:1}),e(J,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:fe},{default:t(()=>I[2]||(I[2]=[U("Voltar")])),_:1}),e(oe,{show:a(b),condMessage:a(P),valor:a(j),description:a(o),onClose:r,onConfirm:m},null,8,["show","condMessage","valor","description"])],64)}}},ua=["onClick"],ca=["onClick"],da={key:0,style:{width:"30px",height:"30px"},src:ke,alt:"Visualizar",title:"Reativar"},pa={key:1,src:xe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Wa={__name:"Observacao",props:{ato_id:{type:Number,required:!0}},async setup(W){let $,g;const _=W,f=ee(),z=ae(),y=te(),E=`${y.public.managemant}/listarEscrevente`,B=`${y.public.managemant}/atos_observacao`,F=`${y.public.managemant}/atos_observacao`,K=l(O("user-data").value.cartorio_token),w=l([]),P=l([]),b=l(!1),C=l(!1),k=l(""),x=[{title:"Data",align:"start",key:"data"},{title:"Escrevente",align:"start",key:"escrevente"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}];function A(i){k.value=i.observacao,C.value=!0,b.value=!0}const q=()=>{C.value=!1,b.value=!0,k.value=""};async function R(i){i.excluido=!i.excluido;try{await h(`${B}/${i.id}`,{method:"PUT",body:JSON.stringify({excluido:i.excluido})},"$aJM1TL1buW")}catch(r){console.error("Erro ao excluir observacao:",r)}}const j=async()=>{b.value=!1,await u()};async function u(){const{data:i}=await h(`${F}/${_.ato_id}`,{method:"GET"},"$dMg99jeUNP");Array.isArray(i.value)?w.value=i.value.map(r=>({...r,created:Ce(r.created,"dd/mm/yyyy hh:mm")})):i.value&&typeof i.value=="object"&&(w.value=[{...i.value,created:Ce(i.value.created,"dd/mm/yyyy hh:mm")}])}const{data:o}=([$,g]=me(()=>h(E,{method:"POST",body:{cartorio_token:K}},"$B6PdRx8Gp4")),$=await $,g(),$);P.value=o.value[0].func_json_escreventes;const s=()=>{const i=z.query.origem||"criar",r=z.query.id;i==="atualizar"?f.push(`/os/atualizar/${r}`):f.push("/os/criar-registro")};return(i,r)=>{const c=Ge,m=le;return V(),Z(_e,null,{default:t(()=>[e(T,{class:"mt-5"},{default:t(()=>[e(J,{class:"mb-4 ml-8",onClick:q,size:"large",color:"green"},{default:t(()=>r[1]||(r[1]=[U("Novo")])),_:1}),v("div",null,[v("img",{class:"btn-pointer ml-2",src:de,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:r[0]||(r[0]=(...S)=>i.onSubmit&&i.onSubmit(...S))})])]),_:1}),e(T,null,{default:t(()=>[e(N,null,{default:t(()=>[e($e,{style:{height:"465px"},headers:x,items:a(w)},{"item.observacao":t(({item:S})=>[U(re(S.observacao.length>100?S.observacao.slice(0,100)+"...":S.observacao),1)]),"item.actions":t(({item:S})=>[e(T,null,{default:t(()=>[v("div",{onClick:d=>A(S)},r[2]||(r[2]=[v("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:ce,alt:"Visualizar"},null,-1)]),8,ua),v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:d=>R(S),title:"Deletar Observação"},[S.excluido?(V(),L("img",da)):(V(),L("img",pa))],8,ca)]),_:2},1024)]),_:1},8,["items"])]),_:1})]),_:1}),a(b)?(V(),Z(c,{key:0,show:a(b),observacao:a(k),visualizar:a(C),onClose:j},null,8,["show","observacao","visualizar"])):ve("",!0),e(T,null,{default:t(()=>[e(m,{onClick:s},{default:t(()=>[e(J,{size:"large",color:"red"},{default:t(()=>r[3]||(r[3]=[U("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},ma={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ie,alt:"Criar"},va={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ue,alt:"Criar"},_a={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:He,alt:"Criar"},fa=["onClick"],ga=["onClick"],ya=["onClick"],ba={key:0,style:{width:"30px",height:"30px"},src:ke,alt:"Visualizar",title:"Reativar"},ha={key:1,src:xe,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Ka={__name:"Anexos",props:{ato_token:{type:String,required:!0},ato_id:{type:Number,required:!0}},setup(W){const $=W,g=te(),{$toast:_}=ie(),f=ee(),z=ae(),y=`${g.public.biometria}/run-scanner`,E=`${g.public.managemant}/atos_anexos`,B=`${g.public.managemant}/atos_anexos`,F=`${g.public.managemant}/download`;`${g.public.managemant}`,`${g.public.managemant}`;const K=l(!1),w=l(null),P=l([]);O("pessoa_token");const b=pe({descricao:"",fileEvent:null}),C={descricao:{required:Ve.withMessage("O campo é obrigatório",ze)}},k=Ee(C,b,{$autoDirty:!0}),x=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}];async function A(){try{await q(),await R()}catch(c){console.error("Erro ao executar scanner ou listar arquivos:",c)}}async function q(){try{const{data:c}=await h(y,{method:"GET"},"$WazoKp68Tw")}catch(c){_.error("Erro ao acionar o scanner:",c)}}async function R(){try{const{data:c,status:m}=await h("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:z.query.ato_token_edit,cartorio_token:O("user-data").value.cartorio_token}},"$03Wxiia3aI")}catch(c){console.error("Erro ao enviar o arquivo:",c)}}const j=async()=>{K.value=!0};function u(c){return c?!0:(console.error("Erro: Nenhum arquivo foi selecionado!"),w.value=!1,!1)}const o=async()=>{if(k.value.$touch(),!k.value.$invalid&&u(b.fileEvent)){const{data:c,error:m,status:S}=await h(E,{method:"POST",body:{ato_id:$.ato_id,descricao:b.descricao,user_id:O("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$WyW0hasRPI");S.value==="success"&&(_.success("Anexo registrado com sucesso!"),P.value.push(c.value))}};async function s(c){c.excluido=!c.excluido;try{await h(`${B}/${c.id}`,{method:"PUT",body:JSON.stringify({excluido:c.excluido})},"$Y3y6TjqbSV")}catch(m){console.error("Erro ao excluir pessoa:",m)}}async function i(c){try{const m=await h(`${F}`,{method:"POST",body:{bucket:O("user-data").value.cartorio_token,path:c.link}},"$bkXJSi7s76"),d=await(await fetch(m.data.value)).blob(),Y=URL.createObjectURL(d);window.open(Y,"_blank")}catch(m){console.error("Erro ao excluir pessoa:",m)}}const r=()=>{const c=z.query.origem||"criar",m=z.query.id;switch(c){case"atualizar":case"vizualizar":f.push(`/os/atualizar/${m}`);break;case"atualizar-lista":case"vizualizar-lista":f.push("/atos/lista");break;default:f.push("/os/criar-registro");break}};return(c,m)=>{const S=le;return V(),Z(_e,null,{default:t(()=>[e(T,null,{default:t(()=>[e(N,{cols:"5",class:"mt-2"},{default:t(()=>[e(ne,{modelValue:a(b).descricao,"onUpdate:modelValue":[m[0]||(m[0]=d=>a(b).descricao=d),a(k).descricao.$touch],"error-messages":a(k).descricao.$errors.map(d=>d.$message),onBlur:a(k).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"])]),_:1}),v("div",{onClick:A,title:"Criar",style:{"padding-right":"10px"}},[a(w)===!1?(V(),L("img",ma)):a(w)===!0?(V(),L("img",va)):(V(),L("img",_a))]),v("div",{onClick:o,title:"Criar"},m[1]||(m[1]=[v("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:de,alt:"Escanear"},null,-1)]))]),_:1}),e($e,{headers:x,items:a(P),style:{height:"465px","max-width":"600px"}},{"item.actions":t(({item:d})=>[e(T,null,{default:t(()=>[v("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:Y=>j(d),title:"Visualizar Anexo"},[v("img",{style:{width:"30px",height:"30px"},onClick:Y=>i(d),src:ce,alt:"Visualizar"},null,8,ga)],8,fa),v("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:Y=>s(d),title:"Deletar Pessoa"},[d.excluido?(V(),L("img",ba)):(V(),L("img",ha))],8,ya)]),_:2},1024)]),_:1},8,["items"]),e(S,{onClick:r},{default:t(()=>[e(J,{size:"large",color:"red"},{default:t(()=>m[2]||(m[2]=[U("Voltar")])),_:1})]),_:1})]),_:1})}}};export{Ua as _,Ba as a,Fa as b,La as c,Wa as d,Ka as e};
