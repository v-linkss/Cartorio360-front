import{_ as ie}from"./n_7M5jOh.js";import{_ as X}from"./CRDGeEdh.js";import{f as de}from"./B0IxRygJ.js";import{_ as me}from"./CFIwj2y8.js";import{_ as pe}from"./D7JLK9ew.js";import{u as ee,m as g,r as l,n as ae,p as oe,q as N,o as E,c as F,b as a,w as t,a as f,d as k,t as Y,s as n,V as B,v as w,x as Z,y as ve,z as te,F as se,A as re,B as ne,C as fe}from"./CwU4kxTo.js";import{u as le}from"./BEW0F98I.js";import{V}from"./BiBFcqle.js";import{V as R}from"./CAOrvGLN.js";import{V as _e}from"./C3Aa7Isn.js";import{V as ce}from"./cjTZzF5E.js";import{V as H}from"./DD38bONR.js";import{_ as xe,a as be}from"./DJvq3mCv.js";import{V as J,a as ge,b as K,c as Ce}from"./CkWLIuSq.js";import"./DnOkufP8.js";import"./bQGkuzEm.js";import"./C7M4mhBN.js";import"./C429a16G.js";import"./CXW17CEK.js";import"./BVz1G1IN.js";import"./DeRk1mpv.js";import"./BQgWKnO7.js";const ye={style:{color:"red"}},Ve=["title","onClick"],we=["onClick"],$e={__name:"Os",setup(Q){const i=re(),{$toast:u}=ee(),d=`${i.public.managemant}/listarOSCaixas`,_=`${i.public.managemant}/lista_sit_ordemserv`,T=`${i.public.managemant}/updateOrdensServico`,$=g("caixa-service").value.usuario_nome,h=g("caixa-service").value.data,P=l([]),D=l([]),S=l(""),A=l(""),x=l({}),U=l(null),z=l("O encerramento de OS não poderá ser revertido. Confirma o encerramento?"),O=l(!1),b=l(!1),q=()=>{ne("/caixas/lista")},W=[{title:"Número",value:"numero"},{title:"Situação",value:"situacao"},{title:"CPF",value:"apresentante_cpf"},{title:"Apresentante",value:"apresentante_nome"},{title:"Usuário",value:"usuario_nome"},{title:"Valor",value:"valor"},{title:"A Receber",value:"valor_a_receber"},{title:"Ações",value:"actions"}],C=l("");async function s(){try{const o=await $fetch(d,{method:"POST",body:{caixa_token:g("caixa-service").value.caixa_token}});o&&Array.isArray(o)?P.value=o:u.error("Erro ao buscar dados da API.")}catch(o){const e=o.message||"Erro ao buscar dados da API. Tente novamente.";u.error(e)}}function r(){const o=new Date,e=o.getFullYear(),p=String(o.getMonth()+1).padStart(2,"0"),y=String(o.getDate()).padStart(2,"0");return`${e}-${p}-${y}`}const v=o=>{x.value=o,b.value=!0};async function L(){try{const{data:o,error:e}=await le(_,{method:"GET"},"$nTZq0SR2Wg");o.value&&Array.isArray(o.value)?D.value=o.value.map(p=>({title:p.descricao,value:p.descricao})):(u.error("Erro ao buscar dados da API de situação."),e.value&&console.error("Erro detalhado:",e.value))}catch(o){const e=o.message||"Erro ao buscar dados da API. Tente novamente.";u.error(e),console.error("Erro na requisição:",o)}}L();async function M(o){try{await $fetch(`${T}/${o}`,{method:"PUT",body:{dt_pagto:r()}})?(u.success("Ordem de Serviço encerrada com sucesso!"),b.value=!1,s()):u.error("Erro ao encerrar OS. Tente novamente.")}catch(e){const p=e.message||"Erro ao buscar dados da API. Tente novamente.";u.error(p)}}ae(()=>{s()});const m=oe(()=>P.value.filter(o=>{const e=o.numero?o.numero.toString().toLowerCase():"",p=o.apresentante_nome?o.apresentante_nome.toLowerCase():"",y=o.situacao?o.situacao.toUpperCase():"",j=e.includes(S.value.toLowerCase()),G=p.includes(A.value.toLowerCase()),c=C.value?y===C.value:!0;return j&&G&&c}));function I(o,e){U.value=o,x.value={token:e.token,numero:e.numero,valor:e.valor,valor_pago:e.valor_pago},O.value=!0}return(o,e)=>{const p=ie,y=X,j=N("v-cols"),G=N("v-rows");return E(),F(se,null,[a(H,{class:"mt-5"},{default:t(()=>[a(V,{class:"mb-5"},{default:t(()=>[f("h1",null,[e[6]||(e[6]=k(" Recebimento de Ordens de Serviço - ")),f("span",ye,"Caixa "+Y(("formatDate"in o?o.formatDate:n(de))(n(h))),1),k(" - "+Y(n($)),1)])]),_:1}),a(V,null,{default:t(()=>[a(R,{cols:"2"},{default:t(()=>[a(B,{modelValue:n(S),"onUpdate:modelValue":e[0]||(e[0]=c=>w(S)?S.value=c:null),type:"text",label:"Número"},null,8,["modelValue"])]),_:1}),a(R,{md:"3"},{default:t(()=>[a(B,{modelValue:n(A),"onUpdate:modelValue":e[1]||(e[1]=c=>w(A)?A.value=c:null),label:"Apresentante"},null,8,["modelValue"])]),_:1})]),_:1}),a(V,null,{default:t(()=>[a(R,{md:"3"},{default:t(()=>[a(_e,{modelValue:n(C),"onUpdate:modelValue":e[2]||(e[2]=c=>w(C)?C.value=c:null),items:n(D),label:"Situação",clearable:""},null,8,["modelValue","items"])]),_:1})]),_:1}),e[8]||(e[8]=f("hr",{class:"mt-5 mb-5"},null,-1)),a(ce,{headers:W,items:n(m),"item-key":"id"},{"item.actions":t(({item:c})=>[a(V,{style:{display:"flex",gap:"4px","margin-top":"-5px"}},{default:t(()=>[f("div",{class:Z({disabled:!c.btn_receber}),title:c.btn_receber?"Receber":"Bloqueado",onClick:ue=>c.btn_receber?I(c.numero,c):null},[f("img",{style:ve({cursor:c.btn_receber?"pointer":"default",width:"30px",height:"30px"}),src:me,alt:"Receber"},null,4)],10,Ve),f("div",{class:Z({disabled:!c.btn_encerrar}),onClick:ue=>c.btn_encerrar?v(c.id):!1,title:"Cancelamento"},e[7]||(e[7]=[f("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:pe,alt:"Encerrar",title:"Encerrar"},null,-1)]),10,we)]),_:2},1024)]),_:1},8,["items"]),a(p,{show:n(O),numero_os:n(U),ordem:n(x),onClose:e[3]||(e[3]=c=>O.value=!1)},null,8,["show","numero_os","ordem"]),a(y,{onConfirm:e[4]||(e[4]=c=>M(n(x))),condMessage:n(z),show:n(b),onClose:e[5]||(e[5]=c=>b.value=!1)},null,8,["condMessage","show"])]),_:1}),a(G,null,{default:t(()=>[a(j,null,{default:t(()=>[a(te,{class:"ml-8",size:"large",onClick:q,color:"red"},{default:t(()=>e[9]||(e[9]=[k("Voltar ")])),_:1})]),_:1})]),_:1})],64)}}},he=["onClick"],Se={key:0,style:{width:"30px",height:"30px"},src:xe,alt:"Visualizar",title:"Reativar"},Ae={key:1,src:be,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},Oe={__name:"Lançamentos",setup(Q){const i=re(),{$toast:u}=ee(),d=`${i.public.managemant}/lista_lanctos_caixa`,_=`${i.public.managemant}/caixasLanctos`;g("caixa-service").value.usuario_nome,g("caixa-service").value.data;const T=l([]),$=l(""),h=l(""),P=l(""),D=l(""),S=l({});l(null);const A=l("O encerramento de OS não poderá ser revertido. Confirma o encerramento?");l(!1);const x=l(!1),U=()=>{ne("/caixas/lista")},z=[{title:"Forma recebimento",value:"forma_receb"},{title:"Valor",value:"valor"},{title:"Descrição",value:"descricao"},{title:"O.S",value:"ordemserv_numero"},{title:"Apresentatante",value:"apresentante_nome"},{title:"Usuário",value:"usuario_nome"},{title:"Ações",value:"actions"}],O=l("");async function b(){try{const s=await $fetch(d,{method:"POST",body:{caixa_token:g("caixa-service").value.caixa_token}});s&&Array.isArray(s)?(T.value=s,console.log("lancamentoCaixa:",T.value)):u.error("Erro ao buscar dados da API.")}catch(s){const r=s.message||"Erro ao buscar dados da API. Tente novamente.";u.error(r)}}async function q(s){try{s.excluido=!s.excluido;const{data:r,error:v}=await le(`${_}/${s.id}`,{method:"PUT",body:{excluido:s.excluido},headers:{"Content-Type":"application/json"}},"$LFu4iQCu2T");if(v.value)throw v.value;u.success("Lançamento excluído com sucesso!"),await b()}catch(r){console.error("Erro ao excluir lançamento:",r),u.error("Erro ao excluir lançamento")}}async function W(s){try{await $fetch(`${_}/${s}`,{method:"PUT",body:{excluido:!0}})?(u.success("Lançamento do caixa encerrada com sucesso!"),x.value=!1,b()):u.error("Erro ao encerrar o Lançamento do caixa. Tente novamente.")}catch(r){const v=r.message||"Erro ao buscar dados da API. Tente novamente.";u.error(v)}}ae(()=>{b()});const C=oe(()=>T.value.filter(s=>{const r=s.numero?s.numero.toString().toLowerCase():"",v=s.apresentante_nome?s.apresentante_nome.toLowerCase():"",L=s.situacao?s.situacao.toUpperCase():"",M=s.descricao?s.descricao.toLowerCase():"",m=s.forma_receb?s.forma_receb.toLowerCase():"",I=r.includes(P.value.toLowerCase()),o=v.includes(D.value.toLowerCase()),e=O.value?L===O.value:!0,p=M.includes($.value.toLowerCase()),y=m.includes(h.value.toLowerCase());return I&&o&&e&&p&&y}));return(s,r)=>{const v=X,L=N("v-cols"),M=N("v-rows");return E(),F(se,null,[a(H,{class:"mt-5"},{default:t(()=>[a(V,{class:"mb-5"},{default:t(()=>r[4]||(r[4]=[f("h1",null," Lançamentos do caixa ",-1)])),_:1}),a(V,null,{default:t(()=>[a(R,{cols:"3"},{default:t(()=>[a(B,{modelValue:n($),"onUpdate:modelValue":r[0]||(r[0]=m=>w($)?$.value=m:null),label:"Descrição"},null,8,["modelValue"])]),_:1}),a(R,{cols:"3"},{default:t(()=>[a(B,{modelValue:n(h),"onUpdate:modelValue":r[1]||(r[1]=m=>w(h)?h.value=m:null),label:"Forma de Recebimento"},null,8,["modelValue"])]),_:1})]),_:1}),r[5]||(r[5]=f("hr",{class:"mt-5 mb-5"},null,-1)),a(ce,{headers:z,items:n(C),"item-key":"id"},{"item.actions":t(({item:m})=>[a(V,{style:{display:"flex",gap:"4px","margin-top":"-5px"}},{default:t(()=>[f("div",{style:{cursor:"pointer"},onClick:I=>q(m),title:"Cancelamento"},[m.excluido?(E(),F("img",Se)):(E(),F("img",Ae))],8,he)]),_:2},1024)]),_:1},8,["items"]),a(v,{onConfirm:r[2]||(r[2]=m=>W(n(S))),condMessage:n(A),show:n(x),onClose:r[3]||(r[3]=m=>x.value=!1)},null,8,["condMessage","show"])]),_:1}),a(M,null,{default:t(()=>[a(L,null,{default:t(()=>[a(te,{class:"ml-8",size:"large",onClick:U,color:"red"},{default:t(()=>r[6]||(r[6]=[k("Voltar ")])),_:1})]),_:1})]),_:1})],64)}}},Je={__name:"index",setup(Q){const i=l("ordens");return g("caixa-service").value.data,g("caixa-service").value.usuario_nome,(u,d)=>(E(),fe(H,{class:"mt-5"},{default:t(()=>[a(ge,{modelValue:n(i),"onUpdate:modelValue":d[0]||(d[0]=_=>w(i)?i.value=_:null)},{default:t(()=>[a(J,{value:"ordens"},{default:t(()=>d[2]||(d[2]=[k("Ordens de Serviço")])),_:1}),a(J,{value:"lancamentos"},{default:t(()=>d[3]||(d[3]=[k("Lançamentos")])),_:1})]),_:1},8,["modelValue"]),a(Ce,{modelValue:n(i),"onUpdate:modelValue":d[1]||(d[1]=_=>w(i)?i.value=_:null)},{default:t(()=>[a(K,{value:"ordens"},{default:t(()=>[a($e)]),_:1}),a(K,{value:"lancamentos"},{default:t(()=>[a(Oe)]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Je as default};
