import{_ as Ve}from"./58s6n9i_.js";import{_ as be}from"./DmeNNsmF.js";import{_ as xe}from"./-Zi1QEUX.js";import{_ as Ce,r as n,g as $e,o as x,p as ne,w as a,b as o,a as c,t as te,q as t,C as D,s as ae,a9 as Pe,c as j,A as le,V as G,d as U,L as qe,P as Ae,u as Me,m as A,n as Se,G as Te,F as Ee,v as Fe}from"./B_NXxiaT.js";import{V as Oe,a as Re,c as Ne}from"./QIEMt-Xh.js";import{V as ze}from"./2WL2eGqA.js";import{_ as Be}from"./CsSZZE79.js";import{_ as De}from"./FXkQFTcF.js";import{_ as re}from"./JFK6Yy74.js";import{_ as je}from"./BVz1G1IN.js";import{_ as Ue}from"./C5PkuxRd.js";import{a as Ie}from"./DJvq3mCv.js";import{u as V}from"./DwEV1K6e.js";import{V as B}from"./BiZ3SqW-.js";import{V as b}from"./lragAxGj.js";import{V as Ke}from"./D1V_30y6.js";import{V as se}from"./D0mfybKA.js";import"./BzYazyM5.js";import"./DlAcTI2j.js";import"./eKdVga1U.js";import"./DwEV9lWC.js";import"./B0IxRygJ.js";import"./_zEaRmtx.js";import"./BPpVQQKp.js";import"./BTnSlVn4.js";import"./BEgNaSyZ.js";import"./C4jFREnp.js";import"./Cg5cdxFc.js";import"./gHG_rrWG.js";import"./yHvA_nqw.js";import"./Dvx0f4K4.js";import"./DLskup_7.js";const Ze={class:"random-numbers"},Le={key:0,class:"error-message"},We={__name:"ValidadorAutencidade",props:{show:Boolean},emits:["close","confirm"],setup(I,{emit:K}){const k=I,C=K,d=n(k.show),h=n([]),p=n(""),v=n("");function f(){h.value=[];for(let _=0;_<4;_++)h.value.push(Math.floor(Math.random()*10))}$e(()=>k.show,_=>{d.value=_,_&&(f(),p.value="",v.value="")});const Z=()=>{d.value=!1,C("close")},M=()=>{p.value===h.value.join("")?(v.value="",d.value=!1,C("confirm")):v.value="Números digitados incorretos. Tente novamente."};return(_,u)=>(x(),ne(ze,{persistent:"",modelValue:t(d),"onUpdate:modelValue":u[1]||(u[1]=$=>ae(d)?d.value=$:null),"max-width":"500"},{default:a(()=>[o(Oe,null,{default:a(()=>[o(Re,null,{default:a(()=>[c("div",null,[u[2]||(u[2]=c("p",null," Digite o código de validação para confirmar o ato de reconhecimento por autenticidade: ",-1)),c("div",Ze,[c("span",null,te(t(h).join(" ")),1)]),o(D,{modelValue:t(p),"onUpdate:modelValue":u[0]||(u[0]=$=>ae(p)?p.value=$:null),label:"Digite os números",maxlength:"4",outlined:"",dense:"",onKeyup:Pe(M,["enter"])},null,8,["modelValue"]),t(v)?(x(),j("div",Le,te(t(v)),1)):le("",!0)])]),_:1}),o(Ne,null,{default:a(()=>[o(G,{style:{"background-color":"red",color:"white"},onClick:Z},{default:a(()=>u[3]||(u[3]=[U("Cancelar")])),_:1}),o(G,{style:{"background-color":"green",color:"white"},onClick:M},{default:a(()=>u[4]||(u[4]=[U("Validar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},He=Ce(We,[["__scopeId","data-v-c978e7cc"]]),Qe=["onClick"],Ge={key:0,style:{width:"30px",height:"30px",cursor:"pointer"},src:re,alt:"Possui Ficha",title:"Possui Ficha"},Ye={key:1,style:{width:"30px",height:"30px",cursor:"pointer"},src:Ue,alt:"Visualizar",title:"Não Possui Ficha"},Je=["onClick"],To={__name:"autencidade",props:{ato_token:{type:String,required:!0}},emits:["ato-created"],async setup(I,{emit:K}){var oe;let k,C;const d=I,h=K,p=qe(),v=Ae(),f=Fe(),{$toast:Z}=Me(),M=`${f.public.managemant}/listarEscrevente`,_=`${f.public.managemant}/pesquisarPessoas`,u=`${f.public.managemant}/atoReconhecimento`,$=`${f.public.managemant}/etiquetaAutenticidade`,ie=`${f.public.managemant}/download`,ue=`${f.public.envioDoc}/print`,S=n(A("user-data").value.cartorio_token),ce=n(A("user-service").value.token).value||n(A("user-service").value).value,me=A("auth_token").value,L=n(!1),W=n([]),Y=n([]),P=n([]),T=n(!1),H=n(!1),E=n(!1),F=n(null),J=n(null),O=n(""),R=n(null),N=n(!1),X=[{title:"Documento",align:"start",key:"documento"},{title:"Pessoa",align:"start",key:"nome"},{value:"actions"}],r=Se({quantidade:1,escrevente:null,nome:null,documento:null}),{data:ee}=([k,C]=Te(()=>V(M,{method:"POST",body:{cartorio_token:S}},"$qpB20nOlUE")),k=await k,C(),k);Y.value=Array.isArray(ee.value)&&((oe=ee.value[0])==null?void 0:oe.func_json_escreventes)||[];async function de(){try{const{data:s,error:e}=await V(_,{method:"POST",body:{cartorio_token:S.value,documento:r.documento,nome:r.nome}},"$CfpM9wZnUE");s.value.length>0?(h("ato-created"),W.value=s.value):W.value=[]}catch(s){console.error("Erro na requisição",s)}}const pe=()=>{H.value=!0};function ve(s){P.value.push(s)}const fe=async s=>{F.value=s,E.value=!0;const{data:e}=await V(ie,{method:"POST",body:{bucket:A("user-data").value.cartorio_token,path:s.link_ficha}},"$LrKAtpxZwH");J.value=e.value};function _e(s){P.value=P.value.filter(e=>e.token!==s.token)}function ke(){return new Promise(s=>{R.value=s,N.value=!0})}async function ge(){N.value=!1;try{await ye()}finally{R.value&&(R.value(),R.value=null)}}async function ye(){var g,y,m;if(!r.escrevente)throw Z.error("Por favor selecione um Escrevente"),new Error("Escrevente não selecionado");if(L.value)return;L.value=!0;const s=P.value.map(i=>({pessoa_token:i.token})),{data:e,error:w,status:q}=await V(u,{method:"POST",body:{pessoas:s,cartorio_token:S.value,ordemserv_token:ce,quantidade:r.quantidade,usuario_token:me,ato_tipo_token:d.ato_token}},"$EE94jKo1pQ");if(q.value==="success"&&e.value[0].status==="OK"){if(e.value[0].livro&&e.value[0].livro!==null){const i=window.open("","_blank");i.document.open(),i.document.write(e.value[0].livro),i.document.close()}he(e.value[0].token)}else T.value=!0,O.value=Array.isArray(e.value)&&((g=e.value[0])==null?void 0:g.status_mensagem)||((m=(y=w==null?void 0:w.value)==null?void 0:y.data)==null?void 0:m.details)||"Não foi possível concluir o reconhecimento"}async function he(s){var g,y;const{data:e,error:w,status:q}=await V($,{method:"POST",body:{ato_token:s,cartorio_token:S.value,escrevente_token:r.escrevente}},"$KyoIzBxZyr");if(q.value==="success"){const m=Array.isArray(e.value)?e.value[0]:null;if(!m)return;if(m.tipo_etiqueta==="html"){const i=window.open("","_blank");i.document.open(),i.document.write(m.etiqueta),i.document.close()}else if(m.tipo_etiqueta==="zpl"){const{status:i,error:l}=await V(`${ue}`,{method:"POST",body:{zpl:atob(e.value[0].etiqueta)},timeout:3e4},"$Vem9mHWYqw");if(i.value!=="success"){T.value=!0;const z=(y=(g=l.value)==null?void 0:g.data)==null?void 0:y.message;z?O.value=z:O.value="O sistema demorou demais para responder e a impressão não foi feita.";return}}Q()}}const we=()=>{T.value=!1,Q()},Q=()=>{const s=v.query.origem||"criar",e=v.query.id;s==="atualizar"?p.push(`/os/atualizar/${e}`):p.push("/os/criar-registro")};return(s,e)=>{const w=Ve,q=be,g=xe,y=He,m=Be,i=De;return x(),j(Ee,null,[o(B,{class:"mt-5"},{default:a(()=>[o(b,{cols:"5"},{default:a(()=>[o(Ke,{label:"Tabelião/escrevente",modelValue:t(r).escrevente,"onUpdate:modelValue":e[0]||(e[0]=l=>t(r).escrevente=l),items:t(Y),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"])]),_:1}),o(b,{cols:"2"},{default:a(()=>[o(D,{label:"Quantidade",type:"number",modelValue:t(r).quantidade,"onUpdate:modelValue":e[1]||(e[1]=l=>t(r).quantidade=l)},null,8,["modelValue"])]),_:1})]),_:1}),o(B,null,{default:a(()=>[o(b,{cols:"3"},{default:a(()=>[o(D,{label:"Documento",modelValue:t(r).documento,"onUpdate:modelValue":e[2]||(e[2]=l=>t(r).documento=l)},null,8,["modelValue"])]),_:1}),o(b,{cols:"4"},{default:a(()=>[o(D,{label:"Pessoa",modelValue:t(r).nome,"onUpdate:modelValue":e[3]||(e[3]=l=>t(r).nome=l)},null,8,["modelValue"])]),_:1}),c("div",null,[c("img",{class:"btn-pointer mt-1",src:re,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:de})]),c("div",null,[c("img",{class:"btn-pointer mt-1 ml-2",src:je,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:pe})])]),_:1}),o(B,null,{default:a(()=>[o(b,{class:"mr-10"},{default:a(()=>[o(se,{style:{height:"465px"},headers:X,items:t(W)},{"item.actions":a(({item:l})=>[c("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:z=>fe(l),title:"Visualizar Ficha"},[l.link_ficha?(x(),j("img",Ge)):(x(),j("img",Ye))],8,Qe)]),_:1},8,["items"])]),_:1}),o(b,null,{default:a(()=>[o(se,{headers:X,items:t(P),style:{height:"465px"},"item-key":"id"},{"item.actions":a(({item:l})=>[c("div",{style:{display:"flex","justify-content":"flex-end"},onClick:z=>_e(l),title:"Remover"},e[8]||(e[8]=[c("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:Ie,alt:"Remover"},null,-1)]),8,Je)]),_:1},8,["items"])]),_:1})]),_:1}),o(w,{show:t(H),onClose:e[4]||(e[4]=l=>H.value=!1)},null,8,["show"]),t(E)?(x(),ne(q,{key:0,show:t(E),item:t(F),"pessoa-obj":t(F),"link-view":t(J),onConfirmar:e[5]||(e[5]=l=>ve(t(F))),onClose:e[6]||(e[6]=l=>E.value=!1)},null,8,["show","item","pessoa-obj","link-view"])):le("",!0),o(g,{show:t(T),errorMessage:t(O),onClose:we},null,8,["show","errorMessage"]),o(y,{show:t(N),onClose:e[7]||(e[7]=l=>N.value=!1),onConfirm:ge},null,8,["show"]),o(B,null,{default:a(()=>[o(m,{onClick:Q},{default:a(()=>[o(G,{size:"large",color:"red"},{default:a(()=>e[9]||(e[9]=[U("Voltar")])),_:1})]),_:1}),o(i,{onSave:ke,disabled:t(L),class:"ml-5",size:"large",color:"green"},{default:a(()=>e[10]||(e[10]=[U("Salvar")])),_:1},8,["disabled"])]),_:1})],64)}}};export{To as default};
