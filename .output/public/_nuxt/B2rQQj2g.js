import{_ as pe}from"./DsnLBlyM.js";import{u as ne,C as le,J as ie,r as n,f as _e,o as p,j as G,w as t,b as a,i as e,V as re,v as ae,d as W,k as B,l as ce,e as R,y as Re,s as me,a as V,c as S,M as Ie,g as Fe,N as Ne,F as qe,H as Be,O as Ve,t as fe}from"./CC1fXFig.js";import{u as f}from"./B3h4Ol7V.js";import{V as I}from"./Deq4BsE7.js";import{V as N}from"./Ct8PT_32.js";import{V as ye}from"./CkMxGJcA.js";import{V as he}from"./BHtegVa1.js";import{_ as Le,a as Ge,b as He,c as Je}from"./U95-pPuY.js";import{_ as Ke,a as We,b as Xe,T as Ye,W as Qe,S as Ze,D as Pe,c as ea}from"./uhNAfa88.js";import{_ as aa,r as Ae}from"./VdWrgUCS.js";import{_ as xe}from"./L8lhCgyo.js";import{_ as ge}from"./BVz1G1IN.js";import{_ as ta}from"./dxzls0hJ.js";import{_ as oa}from"./CZ6s2hnK.js";import{_ as we,a as ze}from"./DJvq3mCv.js";import{V as Ce}from"./C4rhmkio.js";import{_ as Te}from"./Izd2_WoZ.js";import{V as sa}from"./BWvSmk39.js";import{c as Oe,r as Me,u as De}from"./D-rG0GiJ.js";import{f as $e}from"./B0IxRygJ.js";import{_ as ra}from"./-zgYk4Vu.js";const Xa={__name:"Dados",props:{item_dados:{type:Array,required:!0},item_situacoes:{type:Array,required:!0}},setup(oe){const v=oe,{$toast:C}=ne(),$=ce(),i=le(),d=ie(),h=`${$.public.managemant}/updateAtos`,q=n(v.item_situacoes),X=n(d.query.origem==="vizualizar"),A=_e({dt_abertura:v.item_dados[0].dt_abertura||null,status:v.item_dados[0].status||null,mne:v.item_dados[0].mne||null});async function Y(){const{data:F,error:b,status:O}=await f(`${h}/${d.query.ato_id}`,{method:"PUT",body:{status:A.status,mne:A.mne,dt_abertura:A.dt_abertura}},"$EIT5jtTUdX");O.value==="success"&&C.success("Ato Atualizado com sucesso")}const T=()=>{const F=d.query.origem||"criar",b=d.query.id;switch(F){case"atualizar":case"vizualizar":i.push(`/os/atualizar/${b}`);break;case"atualizar-lista":case"vizualizar-lista":i.push("/atos/lista");break;default:i.push("/os/criar-registro");break}};return(F,b)=>{const O=pe;return p(),G(he,null,{default:t(()=>[a(I,{class:"mt-5"},{default:t(()=>[a(N,{cols:"3"},{default:t(()=>[a(ye,{label:"Situação",modelValue:e(A).status,"onUpdate:modelValue":b[0]||(b[0]=y=>e(A).status=y),items:e(q),"item-title":"descricao","item-value":"descricao",required:""},null,8,["modelValue","items"])]),_:1})]),_:1}),a(I,null,{default:t(()=>[a(N,{cols:"5"},{default:t(()=>[a(re,{label:"MNE - Matrícula Notoria Eletrônica",modelValue:e(A).mne,"onUpdate:modelValue":b[1]||(b[1]=y=>e(A).mne=y)},null,8,["modelValue"])]),_:1})]),_:1}),a(I,null,{default:t(()=>[a(N,{cols:"2"},{default:t(()=>[a(re,{modelValue:e(A).dt_abertura,"onUpdate:modelValue":b[2]||(b[2]=y=>e(A).dt_abertura=y),type:"date",label:"Data Lavratura",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),a(I,{class:"mb-3"},{default:t(()=>[a(O,{onClick:T},{default:t(()=>[a(ae,{size:"large",color:"red"},{default:t(()=>b[3]||(b[3]=[W("Voltar")])),_:1})]),_:1}),e(X)?B("",!0):(p(),G(ae,{key:0,class:"ml-10",onClick:Y,size:"large",color:"green"},{default:t(()=>b[4]||(b[4]=[W("Atualizar")])),_:1}))]),_:1})]),_:1})}}},na={key:0},la=["onClick"],ia={key:0,style:{width:"30px",height:"30px"},src:xe,alt:"Visualizar"},ca={key:1,style:{width:"30px",height:"30px"},src:ta,alt:"Visualizar"},ua=["onClick"],da=["onClick"],ma={key:0,style:{width:"30px",height:"30px"},src:we,alt:"Visualizar",title:"Reativar"},pa={key:1,src:ze,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},_a=["onClick"],Ya={__name:"Partes",async setup(oe){let v,C;const $=le(),i=ie(),d=ce(),{$toast:h}=ne(),q=`${d.public.managemant}/pesquisarPessoas`,X=`${d.public.managemant}/listarPapeis`,A=`${d.public.managemant}/createAtosPessoa`,Y=`${d.public.managemant}/updateAtosPessoa`,T=`${d.public.managemant}/getAtosPessoaById`,F=`${d.public.managemant}/download`,b=n(R("user-data").value.cartorio_token),O=n(i.query.origem==="vizualizar"),y=n([]),M=n({}),x=n([]),E=n([]),w=n(!1),Q=n(!1),L=n(!1),J=n(!1),Z=n(null),g=n(null),P=n(null),K=n(null),r=n(null),l=n(i.query.tipo_ato_token),k=n(null),j=[{title:"Documento",align:"start",key:"pessoa.documento"},{title:"Pessoa",align:"start",key:"pessoa.nome",width:"320px"},{title:"Papel",align:"start",key:"papel.descricao"},{title:"Representante",align:"start",key:"representante.nome",width:"320px"},{value:"actions"}],u=_e({papeis:null,nome:null,pessoa:null,documento:null});Re(()=>{var _;return((_=u.pessoa)==null?void 0:_.link_ficha)||!1});const{data:U}=([v,C]=me(()=>f(X,{method:"POST",body:{tipo_ato_token:i.query.tipo_ato_token}},"$acoiTIUp00")),v=await v,C(),v);E.value=U.value;const o=async()=>{const{data:_}=await f(`${T}/${i.query.ato_id}`,{method:"GET"},"$ypnU9hCpVn"),ee=(de=>de.map(te=>({...te,pessoa:{...te.pessoa,documento:te.pessoa.doc_identificacao},papel:{...te.partes_tipos}})))(_.value);x.value=ee};o();async function s(){try{const{data:_,error:m}=await f(q,{method:"POST",body:{cartorio_token:b.value,documento:u.documento,nome:u.nome}},"$pr30MyPXfY");_.value.length>0?(y.value=_.value,u.pessoa=y.value[0]):y.value=[]}catch(_){console.error("Erro na requisição",_)}}const c=()=>{Q.value=!0},z=async()=>{await o()},H=async()=>{await o()},ve=async()=>{const _={pessoa:u.pessoa,papel:E.value.find(se=>se.id===u.papeis),representante:{nome:null}},m=await f(`${T}/${i.query.ato_id}`,{method:"GET"},"$scHdIvxj2D");for(const se of m.data.value)if(se.pessoa_id===u.pessoa.id&&se.ato_id===Number(i.query.ato_id)&&se.tipo_parte_id===u.papeis){h.error("Pessoa Já Registrada Com Esse Papel!");return}const{data:ee,error:de,status:te}=await f(A,{method:"POST",body:{ato_id:Number(i.query.ato_id),pessoa_id:u.pessoa.id,tipo_parte_id:u.papeis,user_id:R("user-data").value.usuario_id}},"$18isAgOJxG");te.value==="success"?(_.id=ee.value.id,h.success("Pessoa Registrada com Sucesso!"),x.value.push(_)):h.error(de.value.message)},ue=async _=>{L.value=!0;const{data:m}=await f(F,{method:"POST",body:{bucket:R("user-data").value.cartorio_token,path:_.pessoa.link_ficha}},"$hmDzSF3F61");k.value=m.value,M.value=_.pessoa},be=_=>{const m=x.value.filter(ee=>ee.pessoa.id!==_.pessoa.id&&!ee.excluido).map(ee=>({id:ee.pessoa.id,nome:ee.pessoa.nome}));P.value=_.id,Z.value=m,w.value=!0,g.value=_.pessoa.nome,r.value=_.pessoa.id},Ee=_=>{J.value=!0,K.value=_.id,g.value=_.pessoa.nome};async function Se(_){_.excluido=!_.excluido;try{await f(`${Y}/${_.id}`,{method:"PUT",body:JSON.stringify({excluido:_.excluido})},"$l09I6nLRfk")}catch(m){console.error("Erro ao excluir pessoa:",m)}}const je=()=>{const _=i.query.origem||"criar",m=i.query.id;switch(_){case"atualizar":case"vizualizar":$.push(`/os/atualizar/${m}`);break;case"atualizar-lista":case"vizualizar-lista":$.push("/atos/lista");break;default:$.push("/os/criar-registro");break}};return(_,m)=>{const ee=Le,de=We,te=Xe,se=aa,Ue=pe;return p(),G(he,null,{default:t(()=>[e(O)?B("",!0):(p(),G(I,{key:0,class:"mt-5"},{default:t(()=>[a(N,{cols:"3"},{default:t(()=>[a(re,{label:"Documento",modelValue:e(u).documento,"onUpdate:modelValue":m[0]||(m[0]=D=>e(u).documento=D)},null,8,["modelValue"])]),_:1}),a(N,{cols:"4"},{default:t(()=>[a(re,{label:"Pessoa",modelValue:e(u).nome,"onUpdate:modelValue":m[1]||(m[1]=D=>e(u).nome=D)},null,8,["modelValue"])]),_:1}),V("div",null,[V("img",{class:"mt-1",src:xe,style:{width:"40px",cursor:"pointer"},title:"Pesquisar Pessoa",onClick:s})]),V("div",null,[V("img",{class:"mt-1 ml-2",src:ge,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:c})])]),_:1})),e(O)?B("",!0):(p(),G(I,{key:1},{default:t(()=>[a(N,{cols:"4"},{default:t(()=>[a(ye,{label:"Selecione a Pessoa",modelValue:e(u).pessoa,"onUpdate:modelValue":m[2]||(m[2]=D=>e(u).pessoa=D),items:e(y),"item-title":"nome","item-value":"id","return-object":"",required:""},null,8,["modelValue","items"])]),_:1}),a(N,{cols:"3"},{default:t(()=>[a(ye,{label:"Papel",modelValue:e(u).papeis,"onUpdate:modelValue":m[3]||(m[3]=D=>e(u).papeis=D),items:e(E),"item-title":"descricao","item-value":"id",required:""},null,8,["modelValue","items"])]),_:1}),e(O)?B("",!0):(p(),S("div",na,[V("img",{class:"mt-1",src:ge,style:{width:"40px",cursor:"pointer"},title:"Criar Representante",onClick:ve})]))]),_:1})),a(I,null,{default:t(()=>[a(N,null,{default:t(()=>[a(Ce,{style:{height:"465px"},headers:j,items:e(x)},{"item.actions":t(({item:D})=>[e(O)?B("",!0):(p(),G(I,{key:0},{default:t(()=>[V("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-1",onClick:ke=>ue(D),title:"Visualizar Ficha"},[D.pessoa.link_ficha?(p(),S("img",ia)):(p(),S("img",ca))],8,la),V("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ke=>Ee(D),class:"mr-1",title:"Alterar Papel"},m[8]||(m[8]=[V("img",{style:{width:"30px",height:"30px"},src:oa,alt:"Visualizar"},null,-1)]),8,ua),V("div",{class:"mr-1",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:ke=>Se(D),title:"Deletar Pessoa"},[D.excluido?(p(),S("img",ma)):(p(),S("img",pa))],8,da),V("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-1",onClick:ke=>be(D),title:"Selecionar Representante"},m[9]||(m[9]=[V("img",{style:{width:"30px",height:"30px"},src:Ke,alt:"Visualizar"},null,-1)]),8,_a)]),_:2},1024))]),_:1},8,["items"])]),_:1})]),_:1}),a(ee,{show:e(Q),onClose:m[4]||(m[4]=D=>Q.value=!1)},null,8,["show"]),a(de,{representante_nome:e(g),representantes:e(Z),ato_id:e(P),show:e(w),onClose:m[5]||(m[5]=D=>w.value=!1),onUpdateRepresentante:H},null,8,["representante_nome","representantes","ato_id","show"]),a(te,{representante_nome:e(g),ato_token:e(l),ato_id:e(K),show:e(J),onClose:m[6]||(m[6]=D=>J.value=!1),onUpdatePapel:z},null,8,["representante_nome","ato_token","ato_id","show"]),e(L)?(p(),G(se,{key:2,show:e(L),"link-view":e(k),"pessoa-obj":e(M),"is-view":!0,onClose:m[7]||(m[7]=D=>L.value=!1)},null,8,["show","link-view","pessoa-obj"])):B("",!0),a(I,null,{default:t(()=>[a(Ue,{onClick:je},{default:t(()=>[a(ae,{size:"large",color:"red"},{default:t(()=>m[10]||(m[10]=[W("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},va={key:0,class:"loading-overlay"},fa="https://ej2services.syncfusion.com/production/web-services/api/documenteditor/",Qa={__name:"Minuta",emits:["page","doc"],setup(oe,{emit:v}){Ie("DocumentEditorContainer",[Ye,Qe,Ze]);const C=ce(),{$toast:$}=ne(),i=le(),d=ie(),h=v;Ae(`${C.public.docEditor}`);const q=`${C.public.managemant}/download`,X=`${C.public.managemant}/atos/files`,A=`${C.public.managemant}/subitituirModelo`,Y=`${C.public.managemant}/upload`,T=n(null),F=n(!1),b=n("Ao executar a geração, a minuta atual será substituída e não poderá ser recuperada.Confirma ?"),O=n(d.query.origem==="vizualizar"),y=n(!1),M=async r=>{try{const l=await fetch(r);if(!l.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await l.blob()}catch(l){return console.error(l),null}},x=async()=>{try{const{data:r}=await f(`${X}/${d.query.ato_token_edit}`,{method:"GET"},"$5jxI4TvFse");return r.value.link_ato}catch(r){console.error("Erro ao carregar o documento:",r),$.error(r)}},E=async()=>{y.value=!0;try{const r=await x(),{data:l,status:k}=await f(q,{method:"POST",body:{bucket:R("user-data").value.cartorio_token,path:r}},"$dvNFfvmIJC"),j=l.value,u=await M(j);if(u){const U=new FileReader;U.onload=()=>{const o=U.result;T.value.ej2Instances.documentEditor.open(o),h("doc",o)},U.readAsText(u)}}catch{console.error("Erro ao carregar o documento.")}finally{y.value=!1}},w=async()=>{const l=await T.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),k=new FileReader;k.onload=()=>{const j=k.result,U=T.value.ej2Instances.documentEditor.pageCount;h("page",U),h("doc",j)},k.readAsText(l)},Q=async()=>{y.value=!0;try{const l=await T.value.ej2Instances.documentEditor.saveAsBlob("Sfdt"),k=new FormData;k.append("file",l,"anexo.sfdt"),k.append("cartorio_token",R("user-data").value.cartorio_token),k.append("token",d.query.ato_token_edit),k.append("tipo","ato_minuta");const{data:j,status:u}=await f(Y,{method:"POST",body:k},"$xv11VtUdMy");if(u.value==="success"){$.success("Documento enviado!");const o=T.value.ej2Instances.documentEditor.pageCount;w(),h("page",o)}else $.error("Erro ao enviar documento para o sistema.")}catch(r){$.error("Erro ao salvar documento."),console.error(r)}finally{y.value=!1}},L=()=>{F.value=!1,J()},J=async()=>{P(!0);try{await Z(),P(!0);const{data:r,status:l}=await f(A,{method:"POST",body:{ato_token:d.query.ato_token_edit}},"$zyzWHTXTBW");r.value&&g(r.value)}catch(r){console.error("Erro ao gerar a minuta:",r),$.error("Ocorreu um erro ao gerar a minuta.")}finally{P(!1)}},Z=async()=>{try{const{data:r}=await f(q,{method:"POST",body:{bucket:R("user-data").value.cartorio_token,path:"provider/modeloAto.sfdt"}},"$KreLE0Ys81"),l=await M(r.value);if(l){const k=new FileReader;k.onload=()=>{const j=k.result;T.value.ej2Instances.documentEditor.open(j),h("doc",j)},k.readAsText(l)}}catch(r){console.error("Erro ao carregar o modelo de minuta:",r)}},g=r=>{const l=T.value.ej2Instances.documentEditor,k=j=>{for(const[u,U]of Object.entries(j))if(/^<<.+>>$/.test(u))try{l.search.findAll(u),l.search.searchResults.length>0&&l.search.searchResults.replaceAll(U)}catch(o){console.error(`Erro ao substituir o marcador ${u}:`,o)}else if(u==="partes"&&Array.isArray(U)&&U.length>0)for(const o of U)typeof o=="object"&&k(o)};k(r)},P=r=>{y.value=r},K=()=>{const r=d.query.origem||"criar",l=d.query.id;switch(r){case"atualizar":case"vizualizar":i.push(`/os/atualizar/${l}`);break;case"atualizar-lista":case"vizualizar-lista":i.push("/atos/lista");break;default:i.push("/os/criar-registro");break}};return Fe(async()=>{await E(),w()}),(r,l)=>{const k=pe,j=Te;return p(),S(qe,null,[a(e(Pe),{height:"900px",ref_key:"documentEditorContainer",ref:T,serviceUrl:fa,enableToolbar:!0,enableWordExport:!0},null,512),e(y)?(p(),S("div",va,[a(Ne,{indeterminate:"",color:"white",size:"60",class:"loading-spinner"})])):B("",!0),a(I,{class:"ml-4 mt-4 mb-4"},{default:t(()=>[a(k,{class:"mr-4"},{default:t(()=>[a(ae,{size:"large",onClick:K,color:"red"},{default:t(()=>l[2]||(l[2]=[W("Voltar")])),_:1})]),_:1}),e(O)?B("",!0):(p(),G(ae,{key:0,size:"large",color:"green",onClick:Q,disabled:e(y)},{default:t(()=>l[3]||(l[3]=[W("Atualizar")])),_:1},8,["disabled"])),e(O)?B("",!0):(p(),G(ae,{key:1,class:"ml-4",size:"large",color:"blue",onClick:l[0]||(l[0]=u=>F.value=!0)},{default:t(()=>l[4]||(l[4]=[W("Gerar Minuta")])),_:1}))]),_:1}),a(j,{onConfirm:L,condMessage:e(b),show:e(F),onClose:l[1]||(l[1]=u=>F.value=!1)},null,8,["condMessage","show"])],64)}}},ya=["innerHTML"],Za={__name:"Livro",props:{pages:{type:Number,required:!0},document:{type:String,required:!0}},async setup(oe){let v,C;const $=oe,i=ce();Ae(`${i.public.docEditor}`);const{$toast:d}=ne(),h=le(),q=ie(),X=`${i.public.managemant}/download`,A=`${i.public.managemant}/atos/files`,Y=`${i.public.managemant}/lavrarAto`,T=`${i.public.managemant}/valida_lavratura`,F=`${i.public.managemant}/listarEscrevente`,b=`${i.public.managemant}/ato_calcular`,O=n(R("user-data").value.cartorio_token),y=R("auth_token").value,M=n("Ao lavrar esse ato, a operação não poderá ser desfeita. Confirma ?"),x=n(!1),E=n(null),w=n(null),Q=n(q.query.origem==="vizualizar"),L=n(null),J=n([]),Z=n({}),g=_e({escrevente:null}),P=async s=>{try{const c=await fetch(s);if(!c.ok)throw new Error("Erro ao baixar o arquivo do MinIO.");return await c.blob()}catch(c){return console.error(c),null}},K=async()=>{try{const{data:s}=await f(`${A}/${q.query.ato_token_edit}`,{method:"GET"},"$FnEbAJEARP");return s.value.link_ato}catch(s){console.error("Erro ao carregar o documento:",s),d.error(s)}},r=async()=>{try{const s=await K(),{data:c,status:z}=await f(X,{method:"POST",body:{bucket:R("user-data").value.cartorio_token,path:s}},"$7ljqltMqa0"),H=c.value,ve=await P(H);if(ve){const ue=new FileReader;ue.onload=()=>{const be=ue.result;L.value.ej2Instances.documentEditor.open(be)},ue.readAsText(ve)}}catch{d.error("Erro ao carregar o documento.")}};r();const l=async()=>{const s=L.value.ej2Instances.documentEditor.pageCount;try{const{data:c}=await f(T,{method:"POST"},"$OWxZSQkyX8");if(c.value.status==="OK"){const{data:z,status:H}=await f(Y,{method:"POST",body:{ato_token:q.query.ato_token_edit,qtd_paginas:s,escrevente_token:g.escrevente,usuario_token:y,cartorio_token:O}},"$sMqfUUQcBM");H.value==="success"?(E.value=z.value,w.value=z.value[0].selo,d.success("Ato lavrado com sucesso!")):d.error("Falha ao lavrar o ato.")}else x.value=!0,M.value="O ato apresenta inconsistências, deseja prosseguir?"}catch{d.error("Erro ao conectar com o servidor.")}},k=async()=>{const s=L.value.ej2Instances.documentEditor.pageCount,{data:c,status:z}=await f(b,{method:"POST",body:{ato_token:q.query.ato_token_edit,cartorio_token:O,quantidade:1,usuario_token:y,escrevente_token:g.escrevente,qtd_paginas:s}},"$OVwiKSwcOE");z.value==="success"?Z.value=c.value[0]:d.error("Falha ao calcular o ato.")},j=async()=>{x.value=!1,l()},u=async()=>{x.value=!0,await k()},{data:U}=([v,C]=me(()=>f(F,{method:"POST",body:{cartorio_token:O}},"$iv1N3XD6We")),v=await v,C(),v);J.value=U.value[0].func_json_escreventes;const o=()=>{const s=q.query.origem||"criar",c=q.query.id;switch(s){case"atualizar":case"vizualizar":h.push(`/os/atualizar/${c}`);break;case"atualizar-lista":case"vizualizar-lista":h.push("/atos/lista");break;default:h.push("/os/criar-registro");break}};return Be(()=>$.document,(s,c)=>{r()}),(s,c)=>{const z=Te;return p(),S(qe,null,[a(I,null,{default:t(()=>[a(N,null,{default:t(()=>[a(e(Pe),{restrictEditing:!0,enableToolbar:!1,ref_key:"documentEditorContainer",ref:L,height:"850px",width:"850px"},null,512)]),_:1}),e(Q)?B("",!0):(p(),G(N,{key:0},{default:t(()=>[a(ye,{class:"mt-15",label:"Tabelião/escrevente",modelValue:e(g).escrevente,"onUpdate:modelValue":c[0]||(c[0]=H=>e(g).escrevente=H),items:e(J),"item-title":"nome","item-value":"token",required:""},null,8,["modelValue","items"]),V("img",{onClick:c[1]||(c[1]=H=>u()),style:{height:"80px",width:"80px",cursor:"pointer","margin-top":"40px"},src:ea}),e(E)?(p(),G(sa,{key:0,width:"360"},{default:t(()=>[a(I,null,{default:t(()=>[a(N,null,{default:t(()=>[a(Ve,{style:{"font-weight":"bold"},class:"pa-2 ma-2"},{default:t(()=>[a(N,null,{default:t(()=>[W(" Livro: "+fe(e(E)[0].livro_numero),1)]),_:1}),a(N,null,{default:t(()=>[W(" Protocolo: "+fe(e(E)[0].protocolo?e(E)[0].protocolo:null),1)]),_:1})]),_:1})]),_:1}),a(N,null,{default:t(()=>[a(Ve,{style:{"font-weight":"bold"},class:"pa-2 ma-2 mt-3"},{default:t(()=>[W(" Folhas : "+fe(e(E)[0].pagina_inicial)+" A "+fe(e(E)[0].pagina_final),1)]),_:1})]),_:1})]),_:1}),V("div",{style:{"margin-left":"10px","padding-bottom":"20px","margin-top":"-10px"},innerHTML:e(w)},null,8,ya)]),_:1})):B("",!0)]),_:1}))]),_:1}),a(ae,{class:"mt-5 ml-7 mb-5",color:"red",size:"large",onClick:o},{default:t(()=>c[3]||(c[3]=[W("Voltar")])),_:1}),a(z,{show:e(x),condMessage:e(M),valor:e(Z),onClose:c[2]||(c[2]=H=>x.value=!1),onConfirm:j},null,8,["show","condMessage","valor"])],64)}}},ga=["onClick"],ha={key:0,style:{width:"30px",height:"30px"},src:we,alt:"Visualizar",title:"Reativar"},ba={key:1,src:ze,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},et={__name:"Observacao",props:{ato_id:{type:Number,required:!0}},async setup(oe){let v,C;const $=le(),i=ie(),d=ce(),{$toast:h}=ne(),q=`${d.public.managemant}/listarEscrevente`;`${d.public.managemant}`;const X=`${d.public.managemant}/atos_observacao`,A=`${d.public.managemant}/atos_observacao`,Y=`${d.public.managemant}/atos_observacao`,T=n(R("user-data").value.cartorio_token),F=n(i.query.origem==="vizualizar"),b=n([]),O=n([]),y=[{title:"Data",align:"start",key:"created"},{title:"Escrevente",align:"start",key:"users.nome"},{title:"Observação",align:"start",key:"observacao"},{value:"actions"}],M=_e({observacao:""}),x={observacao:{required:Oe.withMessage("O campo é obrigatório",Me)}},E=De(x,M),{data:w}=([v,C]=me(()=>f(`${Y}/${i.query.ato_id}`,{method:"GET"},"$HyzoO40swN")),v=await v,C(),v);Array.isArray(w.value)?b.value=w.value.map(g=>({...g,created:$e(g.created,"dd/mm/yyyy hh:mm")})):w.value&&typeof w.value=="object"&&(b.value=[{...w.value,created:$e(w.value.created,"dd/mm/yyyy hh:mm")}]);async function Q(){if(M.observacao.trim()===""){h.error("O campo de observação está vazio.");return}if(await E.value.$validate()){const{data:g,error:P,status:K}=await f(X,{method:"POST",body:{ato_id:Number(i.query.ato_id),observacao:M.observacao,user_id:R("user-data").value.usuario_id}},"$gnHMo4uCXD");K.value==="success"&&(b.value.push({created:$e(g.value.created,"dd/mm/yyyy hh:mm"),observacao:g.value.observacao,id:g.value.id,escrevente:R("user-data").value.nome}),M.observacao="",h.success("Observação registrada com sucesso"))}else h.error("Preencha os campos obrigatórios.")}async function L(g){g.excluido=!g.excluido;try{await f(`${A}/${g.id}`,{method:"PUT",body:JSON.stringify({excluido:g.excluido})},"$sP9AKdd3Ky")}catch(P){console.error("Erro ao excluir observação:",P)}}const{data:J}=([v,C]=me(()=>f(q,{method:"POST",body:{cartorio_token:T}},"$HL9pndqGh0")),v=await v,C(),v);O.value=J.value[0].func_json_escreventes;const Z=()=>{const g=i.query.origem||"criar",P=i.query.id;switch(g){case"atualizar":case"vizualizar":$.push(`/os/atualizar/${P}`);break;case"atualizar-lista":case"vizualizar-lista":$.push("/atos/lista");break;default:$.push("/os/criar-registro");break}};return(g,P)=>{const K=pe;return p(),G(he,null,{default:t(()=>[F.value?B("",!0):(p(),G(I,{key:0,class:"mt-5"},{default:t(()=>[a(re,{label:"Observação",modelValue:M.observacao,"onUpdate:modelValue":P[0]||(P[0]=r=>M.observacao=r),required:"","error-messages":e(E).observacao.$errors.length>0?e(E).observacao.$errors.map(r=>r.$message):[],onBlur:e(E).observacao.$touch,onInput:e(E).observacao.$touch},null,8,["modelValue","error-messages","onBlur","onInput"]),V("div",null,[V("img",{class:"btn-pointer ml-2",src:ge,style:{width:"40px",cursor:"pointer"},title:"Criar Pessoa",onClick:Q})])]),_:1})),a(I,null,{default:t(()=>[a(N,null,{default:t(()=>[a(Ce,{style:{height:"465px"},headers:y,items:b.value},{"item.actions":t(({item:r})=>[V("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:l=>L(r),title:"Deletar Observação"},[r.excluido?(p(),S("img",ha)):(p(),S("img",ba))],8,ga)]),_:1},8,["items"])]),_:1})]),_:1}),a(I,null,{default:t(()=>[a(K,{onClick:Z},{default:t(()=>[a(ae,{size:"large",color:"red"},{default:t(()=>P[1]||(P[1]=[W("Voltar")])),_:1})]),_:1})]),_:1})]),_:1})}}},ka={key:0,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:He,alt:"Criar"},$a={key:1,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:Je,alt:"Criar"},xa={key:2,class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:ra,alt:"Criar"},wa=["onClick"],za=["onClick"],Ca=["onClick"],Ea={key:0,style:{width:"30px",height:"30px"},src:we,alt:"Visualizar",title:"Reativar"},Va={key:1,src:ze,alt:"Excluir",class:"trash-icon",style:{width:"30px",height:"30px"},title:"Excluir"},at={__name:"Anexos",async setup(oe){let v,C;const $=ce(),{$toast:i}=ne(),d=le(),h=ie(),q=n(h.query.origem==="vizualizar"),X=`${$.public.biometria}/run-scanner`,A=`${$.public.managemant}/atos_anexos`,Y=`${$.public.managemant}/atos_anexos`,T=`${$.public.managemant}/download`,F=`${$.public.managemant}/atos_anexos`,b=`${$.public.managemant}/upload`,O=n(!1),y=n(null),M=n([]);R("pessoa_token");const x=_e({descricao:"",fileEvent:null}),E={descricao:{required:Oe.withMessage("O campo é obrigatório",Me)}},w=De(E,x,{$autoDirty:!0}),Q=[{title:"Documento",key:"descricao"},{text:"Ações",value:"actions"}],{data:L}=([v,C]=me(()=>f(`${F}/${h.query.ato_id}`,{method:"GET"},"$AOZpbz65MA")),v=await v,C(),v);M.value=L.value;async function J(){try{await Z(),await g()}catch(o){console.error("Erro ao executar scanner ou listar arquivos:",o)}}async function Z(){try{const{data:o}=await f(X,{method:"GET"},"$KttjFhHivJ")}catch(o){i.error("Erro ao acionar o scanner:",o)}}async function g(){try{const{data:o,status:s}=await f("http://localhost:3500/uploadAnexo",{method:"POST",body:{tipo:"ato_translado",token:h.query.ato_token_edit,cartorio_token:R("user-data").value.cartorio_token}},"$TqQrsgxUkd")}catch(o){console.error("Erro ao enviar o arquivo:",o)}}async function P(){try{const o=document.createElement("input");o.type="file",o.accept="*/*",o.onchange=async s=>{x.fileEvent=s,s.target.files[0]&&(y.value=!0)},o.click()}catch(o){console.error("Erro ao abrir o explorador de arquivos:",o)}}const K=async()=>{O.value=!0};function r(o){return o?!0:(y.value=!1,!1)}const l=async o=>{if(!x.fileEvent||!x.fileEvent.target.files.length){i.error("Nenhum arquivo selecionado.");return}const s=x.fileEvent.target.files[0],c=new FormData;c.append("file",s),c.append("cartorio_token",R("user-data").value.cartorio_token),c.append("token",o),c.append("tipo","ato_anexo");try{const z=await f(b,{method:"POST",body:c},"$KDhIYzGKzM");i.success("Anexo registrado com sucesso!")}catch{i.error("Erro ao enviar o arquivo.")}},k=async()=>{if(w.value.$touch(),!w.value.$invalid&&r(x.fileEvent)){const{data:o,error:s,status:c}=await f(A,{method:"POST",body:{ato_id:h.query.ato_id,descricao:x.descricao,user_id:R("user-data").value.usuario_id,link:"sdfsdfsdf"}},"$cdoFBGO0Ti");c.value==="success"&&(i.success("Anexo registrado com sucesso!"),M.value.push(o.value),l(o.value.token))}};async function j(o){o.excluido=!o.excluido;try{await f(`${Y}/${o.id}`,{method:"PUT",body:JSON.stringify({excluido:o.excluido})},"$WLSrgYRoHq")}catch(s){console.error("Erro ao excluir pessoa:",s)}}async function u(o){try{const s=await f(`${T}`,{method:"POST",body:{bucket:R("user-data").value.cartorio_token,path:o.link}},"$NdgRjioizH"),z=await(await fetch(s.data.value)).blob(),H=URL.createObjectURL(z);window.open(H,"_blank")}catch(s){console.error("Erro ao excluir pessoa:",s)}}const U=()=>{const o=h.query.origem||"criar",s=h.query.id;switch(o){case"atualizar":case"vizualizar":d.push(`/os/atualizar/${s}`);break;case"atualizar-lista":case"vizualizar-lista":d.push("/atos/lista");break;default:d.push("/os/criar-registro");break}};return(o,s)=>{const c=pe;return p(),G(he,null,{default:t(()=>[a(I,null,{default:t(()=>[a(N,{cols:"5",class:"mt-2"},{default:t(()=>[e(q)?B("",!0):(p(),G(re,{key:0,modelValue:e(x).descricao,"onUpdate:modelValue":[s[0]||(s[0]=z=>e(x).descricao=z),e(w).descricao.$touch],"error-messages":e(w).descricao.$errors.map(z=>z.$message),onBlur:e(w).descricao.$touch,required:"",label:"Descrição"},null,8,["modelValue","error-messages","onBlur","onUpdate:modelValue"]))]),_:1}),e(q)?B("",!0):(p(),S("div",{key:0,onClick:J,title:"Escanear"},s[1]||(s[1]=[V("img",{class:"mt-3",style:{width:"40px",height:"40px",cursor:"pointer"},src:Ge,alt:"Escanear"},null,-1)]))),e(q)?B("",!0):(p(),S("div",{key:1,onClick:P,title:"Criar"},[e(y)===!1?(p(),S("img",ka)):e(y)===!0?(p(),S("img",$a)):(p(),S("img",xa))])),e(q)?B("",!0):(p(),S("div",{key:2,onClick:k,title:"Criar"},s[2]||(s[2]=[V("img",{class:"mt-3 ml-2",style:{width:"40px",height:"40px",cursor:"pointer"},src:ge,alt:"Criar"},null,-1)])))]),_:1}),a(Ce,{headers:Q,items:e(M),style:{height:"465px","max-width":"600px"}},{"item.actions":t(({item:z})=>[a(I,null,{default:t(()=>[V("div",{style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},class:"mr-2",onClick:H=>K(z),title:"Visualizar Anexo"},[V("img",{style:{width:"30px",height:"30px"},onClick:H=>u(z),src:xe,alt:"Visualizar"},null,8,za)],8,wa),V("div",{class:"mr-2",style:{display:"flex",cursor:"pointer","justify-content":"flex-end"},onClick:H=>j(z),title:"Deletar Pessoa"},[z.excluido?(p(),S("img",Ea)):(p(),S("img",Va))],8,Ca)]),_:2},1024)]),_:1},8,["items"]),a(c,{onClick:U},{default:t(()=>[a(ae,{size:"large",color:"red"},{default:t(()=>s[3]||(s[3]=[W("Voltar")])),_:1})]),_:1})]),_:1})}}};export{Xa as _,Ya as a,Qa as b,Za as c,et as d,at as e};
