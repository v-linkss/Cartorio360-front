import{_ as Y}from"./qe6vceTN.js";import{_ as j}from"./l72S9bRF.js";import{_ as G}from"./CVilXGDu.js";import{_ as H}from"./CZn6u3-d.js";import{_ as J}from"./lPOm6OJR.js";import{u as K,m as b,r as s,n as Q,p as W,q as O,c as X,b as t,w as n,F as Z,s as ee,o as oe,a as i,d as g,t as S,v as r,V as $,x as k,y as ae,z as A,A as te,B as re}from"./C425wbvn.js";import{V as ne}from"./Bs-vdEfO.js";import{V as C}from"./CeKHLuuc.js";import{V as M}from"./C2H1TUsa.js";import{V as se}from"./BLO-DDqN.js";import"./B3p_Kpj7.js";import"./C46yucZP.js";import"./DRCBCKc4.js";import"./BzEQw_SE.js";import"./DczCJH86.js";import"./BP1uhy__.js";import"./_PNInefe.js";import"./qrzK70Ju.js";import"./Cx6sorAv.js";import"./D_CXFcAR.js";const le={style:{color:"red"}},ie=["title","onClick"],ue=["onClick"],Re={__name:"index",setup(ce){const x=ee(),{$toast:u}=K(),h=`${x.public.managemant}/listarOSCaixas`,R=`${x.public.managemant}/updateOrdensServico`,D=b("caixa-service").value.usuario_nome,T=b("caixa-service").value.data,y=s([]),m=s(""),d=s(""),p=s({}),V=s(null),N=s("O encerramento de OS não poderá ser revertido. Confirma o encerramento?"),f=s(!1),v=s(!1),B=()=>{re("/caixas/lista")},E=[{title:"Data Recebimento",value:"data"},{title:"Número",value:"numero"},{title:"Situação",value:"situacao"},{title:"CPF",value:"apresentante_cpf"},{title:"Apresentante",value:"apresentante_nome"},{title:"Usuário",value:"usuario_nome"},{title:"Valor",value:"valor"},{title:"A Receber",value:"valor_a_receber"},{title:"Ações",value:"actions"}];async function w(){try{const o=await $fetch(h,{method:"POST",body:{caixa_token:b("caixa-service").value.caixa_token}});o&&Array.isArray(o)?y.value=o:u.error("Erro ao buscar dados da API.")}catch(o){const e=o.message||"Erro ao buscar dados da API. Tente novamente.";u.error(e)}}function P(){const o=new Date,e=o.getFullYear(),l=String(o.getMonth()+1).padStart(2,"0"),c=String(o.getDate()).padStart(2,"0");return`${e}-${l}-${c}`}const F=o=>{p.value=o,v.value=!0};async function I(o){try{await $fetch(`${R}/${o}`,{method:"PUT",body:{dt_pagto:P()}})?(u.success("Ordem de Serviço encerrada com sucesso!"),v.value=!1,w()):u.error("Erro ao encerrar OS. Tente novamente.")}catch(e){const l=e.message||"Erro ao buscar dados da API. Tente novamente.";u.error(l)}}Q(()=>{w()});const z=W(()=>y.value.filter(o=>{const e=o.numero?o.numero.toString().toLowerCase():"",l=o.apresentante_nome?o.apresentante_nome.toLowerCase():"",c=e.includes(m.value.toLowerCase()),_=l.includes(d.value.toLowerCase());return c&&_}));function L(o,e){V.value=o,p.value={token:e.token,numero:e.numero,valor:e.valor,valor_pago:e.valor_pago},f.value=!0}return(o,e)=>{const l=Y,c=j,_=O("v-cols"),U=O("v-rows");return oe(),X(Z,null,[t(ne,{class:"mt-5"},{default:n(()=>[t(C,{class:"mb-5"},{default:n(()=>[i("h1",null,[e[5]||(e[5]=g(" Recebimento de Ordens de Serviço - ")),i("span",le,"Caixa "+S(("formatDate"in o?o.formatDate:r(G))(r(T))),1),g(" - "+S(r(D)),1)])]),_:1}),t(C,null,{default:n(()=>[t(M,{cols:"2"},{default:n(()=>[t($,{modelValue:r(m),"onUpdate:modelValue":e[0]||(e[0]=a=>k(m)?m.value=a:null),type:"text",label:"Número"},null,8,["modelValue"])]),_:1}),t(M,{md:"3"},{default:n(()=>[t($,{modelValue:r(d),"onUpdate:modelValue":e[1]||(e[1]=a=>k(d)?d.value=a:null),label:"Apresentante"},null,8,["modelValue"])]),_:1})]),_:1}),e[7]||(e[7]=i("hr",{class:"mt-5 mb-5"},null,-1)),t(se,{headers:E,items:r(z),"item-key":"id"},{"item.actions":n(({item:a})=>[t(C,{style:{display:"flex",gap:"4px","margin-top":"-5px"}},{default:n(()=>[i("div",{class:A({disabled:!a.btn_receber}),title:a.btn_receber?"Receber":"Bloqueado",onClick:q=>a.btn_receber?L(a.numero,a):null},[i("img",{style:ae({cursor:a.btn_receber?"pointer":"default",width:"30px",height:"30px"}),src:H,alt:"Receber"},null,4)],10,ie),i("div",{class:A({disabled:!a.btn_encerrar}),onClick:q=>a.btn_encerrar?F(a.id):!1,title:"Cancelamento"},e[6]||(e[6]=[i("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:J,alt:"Encerrar",title:"Encerrar"},null,-1)]),10,ue)]),_:2},1024)]),_:1},8,["items"]),t(l,{show:r(f),numero_os:r(V),ordem:r(p),onClose:e[2]||(e[2]=a=>f.value=!1)},null,8,["show","numero_os","ordem"]),t(c,{onConfirm:e[3]||(e[3]=a=>I(r(p))),condMessage:r(N),show:r(v),onClose:e[4]||(e[4]=a=>v.value=!1)},null,8,["condMessage","show"])]),_:1}),t(U,null,{default:n(()=>[t(_,null,{default:n(()=>[t(te,{class:"ml-8",size:"large",onClick:B,color:"red"},{default:n(()=>e[8]||(e[8]=[g("Voltar ")])),_:1})]),_:1})]),_:1})],64)}}};export{Re as default};
