import{_ as ae}from"./BO_HpNxQ.js";import{V as q,c as le}from"./Cx6sOUF6.js";import{V as U}from"./DKpmRXTa.js";import{V as y}from"./DiLw1nzM.js";import{r as b,H as L,o as C,k as H,w as t,b as r,a as c,x as R,d as k,j as u,B as O,u as re,f as A,g as te,t as P,V as z,c as I,l as E,m as se,U as ne}from"./C7ECBHmP.js";import{V as J}from"./ve9biJof.js";import{_ as ue}from"./BVz1G1IN.js";import{a as me,_ as ie}from"./DJvq3mCv.js";import{u as w}from"./6IKVrln_.js";import{V as ce}from"./DaR3gjBM.js";import{V as de}from"./BZBSWf0L.js";const fe={__name:"ModalRecebimentoCond",props:{show:Boolean,faltaReceber:Number},emits:["close","confirmar"],setup(h,{emit:$}){const o=h,p=b(o.show),d=$;L(()=>o.show,V=>{p.value=V});const _=()=>{d("confirmar"),v()},v=()=>{p.value=!1,d("close")};return(V,n)=>(C(),H(J,{persistent:"",modelValue:u(p),"onUpdate:modelValue":n[0]||(n[0]=F=>O(p)?p.value=F:null),"max-width":"650"},{default:t(()=>[r(q,null,{default:t(()=>[r(U,null,{default:t(()=>[r(y,{class:"mb-5 mt-1 ml-2"},{default:t(()=>n[1]||(n[1]=[c("h1",null,"Confirmação de Recebimento",-1)])),_:1}),r(y,{class:"ml-2"},{default:t(()=>n[2]||(n[2]=[c("p",null," O valor recebido é menor que o valor da OS, confirma o recebimento parcial? ",-1)])),_:1})]),_:1}),r(le,null,{default:t(()=>[r(R,{style:{"background-color":"#429946",color:"white"},onClick:_},{default:t(()=>n[3]||(n[3]=[k("Confirmar")])),_:1}),r(R,{style:{"background-color":"red",color:"white"},onClick:v},{default:t(()=>n[4]||(n[4]=[k("Cancelar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},pe={style:{color:"red","margin-left":"18px"}},ve={style:{"max-width":"180px"}},be={style:{display:"flex","justify-content":"flex-end"}},_e=["onClick"],Ve={key:1,src:ie,style:{width:"30px",height:"30px",cursor:"not-allowed"},alt:"Remover"},ge={style:{display:"flex","justify-content":"flex-start"}},Ue={__name:"Ordem",props:{show:Boolean,ordem:{type:Object,required:!0}},emits:["close","refresh-value"],setup(h,{emit:$}){const o=h,p=$,{$toast:d}=re(),_=b(o.show),v=b(!1),V=se(),n=`${V.public.managemant}/listarFormasReceb`,F=`${V.public.managemant}/listar_recebimentos_os`,K=`${V.public.managemant}/receberOs`,Q=`${V.public.managemant}/caixasLanctos`,W=A("auth_token").value,S=b([]),B=b(null),g=b([]),x=b([]),m=te({descricao:null,forma:null,valor:""}),Z=[{title:"Forma",value:"descricao"},{title:"Valor",value:"valor"},{value:"actions"}],i=b(0),G=()=>{i.value=f(o.ordem.valor-o.ordem.valor_pago)};L(()=>o.show,async a=>{_.value=a;const{data:e}=await w(F,{method:"POST",body:{os_token:o.ordem.token}},"$vhMIR8Sr2p"),s=Array.isArray(e.value)?e.value:[];s&&(g.value=s.map(({forma_recebimento:N,...l})=>({descricao:N,...l}))),a&&G()});const M=()=>{_.value=!1,Object.assign(m,{forma:null,descricao:null,valor:""}),x.value=[],g.value=[],p("close")},X=()=>{B.value=Number(o.ordem.valor),v.value=!0},T=async()=>{try{const a={ordemserv_token:o.ordem.token,usuario_token:W,recebimentos:[x.value],caixa_token:o.ordem.caixa_token?o.ordem.caixa_token:null},{data:e}=await w(K,{method:"POST",body:a},"$eiMzO5y6Bb");e.value[0].status==="OK"?(d.success(`${e.value[0].status}: Valores Recebidos com Sucesso!`),g.value=[],p("refresh-value"),M()):d.error(e.value[0].status_mensagem)}catch(a){d.error(a)}},D=()=>{o.ordem.valor=f(o.ordem.valor),o.ordem.valor_pago=f(o.ordem.valor_pago),i.value=f(i.value)},f=a=>Number(parseFloat(a).toFixed(2)),Y=async()=>{try{const e={cartorio_token:A("user-data").value.cartorio_token},{data:s}=await w(n,{method:"POST",body:JSON.stringify(e)},"$7DferZWeQF");S.value=ne(s.value)}catch(a){console.error("Erro ao carregar formas de pagamento:",a)}},ee=()=>{const a=S.value.find(s=>s.token===m.forma);if(!a)return d.error("Por favor, selecione uma forma.");const e=j(m.valor);g.value.push({forma:m.forma,descricao:a.descricao,valor:e,btn_cancelar:!0}),x.value.push({forma_receb_token:m.forma,valor:e}),o.ordem.valor_pago=f(o.ordem.valor_pago+e),o.ordem.valor=f(o.ordem.valor-e),i.value=f(i.value-e),Object.assign(m,{forma:null,valor:"0.00"}),D()},oe=async a=>{const e=g.value.indexOf(a);if(a.id&&a.id!==null){a.btn_cancelar=!a.btn_cancelar;const{status:s}=await w(`${Q}/${a.id}`,{method:"PUT",body:{excluido:!0}},"$yTL1AnUqrk");s.value==="success"?d.success("Item marcado para remoção."):d.error("Erro ao marcar o item para remoção.")}else{g.value.splice(e,1),x.value.splice(e,1);const s=j(a.valor);o.ordem.valor_pago=f(o.ordem.valor_pago-s),i.value=f(i.value+s)}D()},j=a=>Number(a.toString().replace(/,/g,""));return Y(),(a,e)=>{const s=ae,N=fe;return C(),H(J,{persistent:"",modelValue:u(_),"onUpdate:modelValue":e[7]||(e[7]=l=>O(_)?_.value=l:null),"max-width":"650"},{default:t(()=>[r(q,null,{default:t(()=>[r(U,null,{default:t(()=>[r(y,{class:"mb-5 mt-1 ml-2"},{default:t(()=>[e[8]||(e[8]=c("h1",null,"Ordem de Serviço nº",-1)),c("h1",pe,P(o.ordem.numero),1)]),_:1}),r(U,null,{default:t(()=>[r(y,null,{default:t(()=>[r(z,{class:"mr-5",label:"Recebido",modelValue:o.ordem.valor_pago,"onUpdate:modelValue":e[0]||(e[0]=l=>o.ordem.valor_pago=l),readonly:"",style:{"font-weight":"bold",cursor:"default","pointer-events":"none"}},null,8,["modelValue"]),r(z,{label:"Falta Receber",modelValue:u(i),"onUpdate:modelValue":e[1]||(e[1]=l=>O(i)?i.value=l:null),readonly:"",style:{"font-weight":"bold",cursor:"default","pointer-events":"none"}},null,8,["modelValue"])]),_:1}),r(y,null,{default:t(()=>[r(ce,{class:"mb-5 mr-5",label:"Forma",modelValue:u(m).forma,"onUpdate:modelValue":e[2]||(e[2]=l=>u(m).forma=l),items:u(S),"item-title":"descricao","item-value":"token"},null,8,["modelValue","items"]),c("div",ve,[r(s,{modelValue:u(m).valor,"onUpdate:modelValue":e[3]||(e[3]=l=>u(m).valor=l)},null,8,["modelValue"])]),c("div",null,[c("img",{src:ue,class:"ml-5",style:{cursor:"pointer",height:"40px",width:"40px"},onClick:ee})])]),_:1})]),_:1}),e[9]||(e[9]=c("hr",{class:"mb-5"},null,-1)),r(de,{headers:Z,items:u(g),"item-value":"token"},{"item.forma":t(({item:l})=>[k(P(l.descricao),1)]),"item.actions":t(({item:l})=>[c("div",be,[l.btn_cancelar===!0?(C(),I("img",{key:0,src:me,style:{width:"30px",height:"30px",cursor:"pointer"},onClick:ye=>oe(l),alt:"Mudar Status"},null,8,_e)):E("",!0),l.btn_cancelar===!1?(C(),I("img",Ve)):E("",!0)])]),_:1},8,["items"])]),_:1}),c("div",ge,[r(R,{class:"ml-8",size:"large",onClick:M,color:"red"},{default:t(()=>e[10]||(e[10]=[k("Voltar")])),_:1}),r(R,{size:"large",class:"ml-6 mb-6",color:"green",onClick:e[4]||(e[4]=l=>o.ordem.valor>0?X():T())},{default:t(()=>e[11]||(e[11]=[k(" Salvar ")])),_:1})])]),_:1}),r(N,{modelValue:u(v),"onUpdate:modelValue":e[5]||(e[5]=l=>O(v)?v.value=l:null),faltaReceber:u(B),onClose:e[6]||(e[6]=l=>v.value=!1),onConfirmar:T},null,8,["modelValue","faltaReceber"])]),_:1},8,["modelValue"])}}};export{Ue as _};
