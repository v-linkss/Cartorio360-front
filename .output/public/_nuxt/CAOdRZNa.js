import{_ as N}from"./CDIkAxpZ.js";import{_ as O}from"./JFK6Yy74.js";import{_ as D}from"./6_ay4D6j.js";import{_ as L,u as R,r as t,m as g,n as T,c as B,b as o,w as n,q as i,F as E,v as I,o as H,a as l,C as U}from"./B_NXxiaT.js";import{u as h}from"./DwEV1K6e.js";import{f as C}from"./B0IxRygJ.js";import{V as j}from"./yHvA_nqw.js";import{V as k}from"./BiZ3SqW-.js";import{V as b}from"./lragAxGj.js";import{V as z}from"./D0mfybKA.js";import"./QIEMt-Xh.js";import"./BTnSlVn4.js";import"./BEgNaSyZ.js";import"./C4jFREnp.js";import"./2WL2eGqA.js";import"./eKdVga1U.js";import"./_zEaRmtx.js";import"./BPpVQQKp.js";import"./Cg5cdxFc.js";import"./gHG_rrWG.js";const J={style:{display:"flex",gap:"4px","justify-content":"center"}},K=["onClick"],X={__name:"index",setup(Y){const p=I(),{$toast:f}=R(),V=`${p.public.managemant}/cancela_lavratura`,w=`${p.public.managemant}/pesquisaAtos`,$=t(g("auth_token").value)||null,A=t(g("user-data").value.cartorio_token)||null,c=t([]),r=t(!1),v=t(""),_=t(null),m=t(!1),y=t(""),u=T({id:null}),S=[{title:"Protocolo",value:"protocolo"},{title:"Data lavratura/Parte",value:"dt_lavratura"},{title:"Situação/Serviço",key:"situacaoServico",value:e=>e.situacao?`${e.situacao}
${e.ato_servico}`:`${e.ato_servico}`,cellProps:{style:{whiteSpace:"pre-line",lineHeight:"2"}}},{title:"Livro",value:"livro_numero"},{title:"Folha",value:"folha"},{title:"Valor",value:"valor"},{title:"Ações",value:"actions"}];async function P(){try{sessionStorage.setItem("pesquisaAto",JSON.stringify(u));const{data:e}=await h(w,{method:"POST",body:{cartorio_token:A.value,ato_id:Number(u.id)||null}},"$xahYxgiURx");e.value.length>0?c.value=e.value.map(a=>({...a,dt_lavratura:a.dt_lavratura?C(a.dt_lavratura,"dd/mm/yyyy hh:mm"):null,dt_abertura:a.dt_abertura?C(a.dt_abertura,"dd/mm/yyyy"):null})):(c.value=[],f.error("Não existe ato Registrado!"))}catch(e){console.error("Erro na requisição",e)}}const q=e=>{_.value=e,v.value="O cancelamento de lavratura é definitivo e não poderá ser revertido. Confirma o cancelamento da lavratura deste ato?",m.value=!1,r.value=!0},F=async()=>{if(m.value){await x(!0);return}await x(!1)},x=async e=>{r.value=!1;const{data:a,status:d,error:s}=await h(V,{method:"POST",body:{ato_token:_.value,user_token:$.value,forcar_cancelamento:e}},"$0XhtmZH7s8");r.value=!1,d.value==="success"&&a.value&&a.value[0]?a.value[0].status==="OK"&&(f.success("Lavratura cancelada com sucesso!"),c.value=[],u.id=null,m.value=!1):d.value==="error"&&s.value&&(y.value=`${s.value.data[0].status_mensagem} Confirma o cancelamento?`,v.value=y.value,m.value=!0,r.value=!0)};return(e,a)=>{const d=N;return H(),B(E,null,[o(j,null,{default:n(()=>[o(k,{class:"mb-5"},{default:n(()=>a[2]||(a[2]=[l("h1",null,"Cancelamento de Lavratura",-1)])),_:1}),o(k,null,{default:n(()=>[o(b,{cols:"2"},{default:n(()=>[o(U,{modelValue:i(u).id,"onUpdate:modelValue":a[0]||(a[0]=s=>i(u).id=s),label:"ID"},null,8,["modelValue"])]),_:1}),o(b,null,{default:n(()=>[l("div",null,[l("img",{onClick:P,style:{width:"40px",height:"40px",cursor:"pointer"},src:O,alt:"Pesquisar"})])]),_:1})]),_:1}),l("div",null,[a[4]||(a[4]=l("hr",{class:"mt-5 mb-5"},null,-1)),o(z,{headers:S,items:i(c),style:{"font-size":"12px"},"item-key":"id"},{"item.actions":n(({item:s})=>[l("div",J,[l("div",{onClick:M=>q(s.token),title:"Excluir"},a[3]||(a[3]=[l("img",{style:{width:"30px",height:"30px",cursor:"pointer"},src:D,alt:"Cancelar",title:"Cancelar"},null,-1)]),8,K)])]),_:1},8,["items"])])]),_:1}),o(d,{show:i(r),condMessage:i(v),onClose:a[1]||(a[1]=s=>r.value=!1),onConfirm:F},null,8,["show","condMessage"])],64)}}},_a=L(X,[["__scopeId","data-v-e8785c0b"]]);export{_a as default};
