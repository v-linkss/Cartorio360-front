import{_ as D}from"./BRvIf8n8.js";import{_ as F}from"./G649sGvS.js";import{_ as K}from"./40_iMjYg.js";import{c as L,r as U,u as W}from"./Bkxv2Vrw.js";import{_ as j,D as J,K as Q,u as X,r as u,e as v,f as Z,y as G,h as H,w as i,k as Y,o as ee,b as a,a as $,i as t,s as te,V as oe,d as y}from"./B3qHAfY2.js";import{f as g}from"./BTdgIE5n.js";import{u as ae}from"./AbqtXxaM.js";import{V as se}from"./M6uHpD5D.js";import{V as re}from"./CP6hhYYs.js";import{V as ne}from"./C-gLg2rw.js";import{V as ue}from"./BDkFPGjG.js";import"./BB_xEO0D.js";import"./CVDpgRqx.js";import"./C4qHYQYW.js";import"./Cl68E8m0.js";import"./DeW-NlDP.js";import"./BRhLhDx8.js";import"./yElaiGuO.js";import"./BWhwLF6L.js";import"./vWFD-yVi.js";const ie={style:{width:"600px","margin-top":"10px"}},ce={style:{width:"180px","margin-top":"20px"}},le={__name:"autenticacao",props:{ato_token:{type:String,required:!0}},async setup(x){let l,V;const S=x,h=J(),w=Q(),m=Y(),A=`${m.public.auth}/service/gerencia/listarEscrevente`,{$toast:B}=X(),_=u(v("user-data").value.cartorio_token).value,C=u(v("user-service").value.token).value||u(v("user-service").value).value,T=v("auth_token").value,z=`${m.public.auth}/service/gerencia/atoAutentica`,M=`${m.public.auth}/service/gerencia/etiquetaAutentica`,N=`${m.public.envioDoc}/print`,d=u(!1),f=u(""),s=Z({escrevente:null,quantidade:1}),b=u([]),{data:O}=([l,V]=G(()=>g(A,{method:"POST",body:{cartorio_token:_}})),l=await l,V(),l);b.value=O.value[0].func_json_escreventes;const P={escrevente:{required:L.withMessage("O campo é obrigatorio",U)}},p=W(P,s),I=async()=>{if(await p.value.$validate()){const{data:o,status:e,error:c}=await g(z,{method:"POST",body:{usuario_token:T,cartorio_token:_,quantidade:Number(s.quantidade),ordemserv_token:C,ato_tipo_token:S.ato_token}});e.value==="success"&&o.value.status==="OK"?await E(o.value.token):(d.value=!0,f.value=o.value.status_mensagem||c.value.data.details)}},E=async o=>{const{data:e,status:c,error:q}=await g(M,{method:"POST",body:{escrevente_token:s.escrevente,cartorio_token:_,ato_token:o}});if(c.value==="success"){if(B.success("Ato autenticado com sucesso!"),e.value.tipo_etiqueta==="html"){const r=window.open("","_blank");r.document.open(),r.document.write(e.value.etiqueta),r.document.close()}else if(e.value.tipo_etiqueta==="zpl"){const{status:r,error:n}=await ae(`${N}`,{method:"POST",body:{zpl:atob(e.value.etiqueta)}},"$nXL9eJBhI7");if(r.value!=="success"){d.value=!0,f.value=n.value.data.message;return}}k()}},R=()=>{d.value=!1,k()},k=()=>{const o=w.query.origem||"criar",e=w.query.id;o==="atualizar"?h.push(`/os/atualizar/${e}`):h.push("/os/criar-registro")};return(o,e)=>{const c=D,q=F,r=K;return ee(),H(se,{class:"mt-10"},{default:i(()=>[a(ue,null,{default:i(()=>[$("div",ie,[a(re,{label:"Tabelião/escrivão",modelValue:t(s).escrevente,"onUpdate:modelValue":e[0]||(e[0]=n=>t(s).escrevente=n),items:t(b),"item-title":"nome","item-value":"token",required:"","error-messages":t(p).escrevente.$errors.map(n=>n.$message),onBlur:t(p).escrevente.$touch,onInput:t(p).escrevente.$touch},null,8,["modelValue","items","error-messages","onBlur","onInput"])]),$("div",ce,[a(te,{type:"number",label:"Quantidade",modelValue:t(s).quantidade,"onUpdate:modelValue":e[1]||(e[1]=n=>t(s).quantidade=n)},null,8,["modelValue"])]),a(ne,{class:"mb-3 mt-2"},{default:i(()=>[a(c,{onClick:k},{default:i(()=>[a(oe,{class:"ml-4",size:"large",color:"red"},{default:i(()=>e[2]||(e[2]=[y("Voltar")])),_:1})]),_:1}),a(q,{class:"ml-4",size:"large",color:"green",onSave:I},{default:i(()=>e[3]||(e[3]=[y("Salvar")])),_:1})]),_:1})]),_:1}),a(r,{show:t(d),errorMessage:t(f),onClose:R},null,8,["show","errorMessage"])]),_:1})}}},Te=j(le,[["__scopeId","data-v-29f931c8"]]);export{Te as default};
