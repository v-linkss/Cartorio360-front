import{_ as $}from"./Cyz6X0xX.js";import{a as Q,d as ee,V as E}from"./B8OA6nhl.js";import{V as F}from"./MCc7yMEd.js";import{V as C,u as N}from"./BUjeIWJl.js";import{r as A,g as j,o as q,G as J,w as r,b as a,a as i,A as B,d as w,v as m,x as O,u as oe,m as G,D as le,t as H,V as I,y as ae,s as te,bx as re}from"./DYqshA0e.js";import{_ as se}from"./BVz1G1IN.js";import{V as ne}from"./BxJoEmSj.js";import{V as me}from"./BFSRGeGF.js";const ie={__name:"ModalRecebimentoCond",props:{show:Boolean,faltaReceber:Number},emits:["close","confirmar"],setup(k,{emit:x}){const o=k,v=A(o.show),p=x;j(()=>o.show,V=>{v.value=V});const b=()=>{p("confirmar"),f()},f=()=>{v.value=!1,p("close")};return(V,s)=>(q(),J(E,{persistent:"",modelValue:m(v),"onUpdate:modelValue":s[0]||(s[0]=y=>O(v)?v.value=y:null),"max-width":"650"},{default:r(()=>[a(Q,null,{default:r(()=>[a(F,null,{default:r(()=>[a(C,{class:"mb-5 mt-1 ml-2"},{default:r(()=>s[1]||(s[1]=[i("h1",null,"Confirmação de Recebimento",-1)])),_:1}),a(C,{class:"ml-2"},{default:r(()=>s[2]||(s[2]=[i("p",null," O valor recebido é menor que o valor da OS, confirma o recebimento parcial? ",-1)])),_:1})]),_:1}),a(ee,null,{default:r(()=>[a(B,{style:{"background-color":"#429946",color:"white"},onClick:b},{default:r(()=>s[3]||(s[3]=[w("Confirmar")])),_:1}),a(B,{style:{"background-color":"red",color:"white"},onClick:f},{default:r(()=>s[4]||(s[4]=[w("Cancelar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ue="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAABJhJREFUeJztW81v3EQcfTM73ZU3C1GF4NJAG+UGSKgSjZAgfwCFHnMpiAMSyckHGim2FAl8cSRvFFopApEixIW/APFx48IKCS5wQOKGGpqWAx/SqhslMY6HS1PZg+0de2fsSdN3m/HM6Ofn37zxPI8JNMO27Y5lWcuEkKsAngcwNabLHoBfOOefd7vdm57nhTrjIzoHX1tbOxdF0VcAXqg4xM+Msdd937+jMq4ktBFg23an2+3+gOo3f4yfLMt6SVcmUB2DAoBlWcuY/OYB4OL+/v47CsbJBNM1MCHkjWSZc/41gOV+v79b1G91dXWGEHITwKuJ6jcBfKg+So0ZAOBZoTz25gGg3+/vMsaWhern1IWVhk4CesmCzM0fw/f920LVY0oiyoBOAk4Exq4CjuNcAXANwCWMX8NNwR6AH+M4/mBjY+PLooatoouu664D+AjABQBtZeHpRxvALCHk6sLCwpnBYPBtXsPcDLj/5L/QEV3diOP4Sl4mFGnANU3x1A5K6bt514reA14Uyi8HQfC9mpD0wnGcVwB8l6i6lNe2KANSy9hJuXkACIJgIFTlLqOnfhl8REDTATSNU0+A9G7QcRyuM5CmcOozoIgA6d2b6eCci7vLBygiYAkPAQmc89uU0qW861KeoOM4OwCeOS5HUXRhc3NzR0F8yrCysnKeMXYrUfV7EATnx/WT1YBRssAY6+U1bAqdTkd827sn068SAZRS4wiIokiMaZTZUEAlAo6OjowjIOOhSBEg9R5ACBlxzpPlXAIcx3kNwDYADmApCIJv6mgXx3GPkJSkqcsAzvlIKBdlwMcAzgGY4Zxv19VOfCiEEKVTICUolNIil3YmEcTTNbZLxRTHsToRLJkBjUBrBlBKU4MVaUCDSDnWhJA9mU6yUyA1GOfcOHs8juPUQxGzNg+VpgA0fqmZAKmYtIqgiVNAjOmRCOoUQQiOsQkQH4pSDYjj2HgCIMTUarXUEcAYO3EimPHQMiFFwOHhoSgoxmVAhi6pE8F2u238FBBFMAxDdRkwGo2MJwBCTNPT0+oI2NraOgTwb6Kq7XmeMecFbNvuADiTqAplj9WVscVTjA6HQ2OyoNfrVTJDgBIEiOvqmC1xrQjDUD8B4puVScZohiGqngD83xQxhoAMQ1RqCQQm0ACTjNGqhigwwRQwaUcoegGoQwRN2hFW3QkCD8kqAGEfILsTBCYQQZMzADpE0HBjtJIhCpTLAGON0aqGKDCBBsAsT6CSIQpMQEDBFHhwqKLoZIbKdmIsTYvgEoDdcSczVLabRASlT4lRSlNfiJHjCdz/elv0DU95u6qGKFAiAww3RisZokA5DfhbqJr1PK/xY3aLi4stALPJuiiK/pHtL30DU1NTO0gvhU8dHBxcd133rOwYquG67tm5ubkbAJ5MVN8bDoe3ZMco9eeo4zifAni7TJ8G8EkQBEWimkKpFGaMvQfgr9Ih1Yc/W63W+2U6lCLA9/07hJDLAP4oFVY9uMs5v7y+vl4qtsK/xrIwGAzuzs/Pf8YYCznnTxBCHofGX3DH4ADArwC2CSFvBUHwW9kB/gMs68lWOHHFdwAAAABJRU5ErkJggg==",ce={style:{color:"red","margin-left":"18px"}},de={style:{"max-width":"180px"}},fe=["onClick","title"],Ae={style:{display:"flex","justify-content":"flex-start"}},ke={__name:"Ordem",props:{show:Boolean,ordem:{type:Object,required:!0}},emits:["close"],setup(k,{emit:x}){const o=k,v=x,{$toast:p}=oe(),b=A(o.show),f=A(!1),V=te(),s=`${V.public.managemant}/listarFormasReceb`,y=`${V.public.managemant}/listar_recebimentos_os`,Y=`${V.public.managemant}/receberOs`,K=G("auth_token").value,R=A([]),S=A(null),g=A([]),M=A([]),u=le({descricao:null,forma:null,valor:""}),W=[{title:"Forma",value:"descricao"},{title:"Valor",value:"valor"},{value:"actions"}],c=A(0),z=()=>{c.value=d(o.ordem.valor-o.ordem.valor_pago)};j(()=>o.show,async t=>{b.value=t;const{data:e}=await N(y,{method:"POST",body:{os_token:o.ordem.token}},"$vhMIR8Sr2p"),n=Array.isArray(e.value)?e.value:[];n&&(g.value=n.map(({forma_recebimento:_,...l})=>({descricao:_,...l}))),t&&z()});const T=()=>{b.value=!1,Object.assign(u,{forma:null,descricao:null,valor:""}),g.value=[],v("close")},L=()=>{S.value=Number(o.ordem.valor),f.value=!0},U=async()=>{try{const t={ordemserv_token:o.ordem.token,usuario_token:K,recebimentos:[M.value]},{data:e}=await N(Y,{method:"POST",body:t},"$eiMzO5y6Bb");e.value[0].status==="OK"?(p.success(`${e.value[0].status}: Valores Recebidos com Sucesso!`),g.value=[],T()):p.error(e.value[0].status_mensagem)}catch(t){p.error(t)}},D=()=>{o.ordem.valor=d(o.ordem.valor),o.ordem.valor_pago=d(o.ordem.valor_pago),c.value=d(c.value)},d=t=>Number(parseFloat(t).toFixed(2)),P=async()=>{try{const e={cartorio_token:G("user-data").value.cartorio_token},{data:n}=await N(s,{method:"POST",body:JSON.stringify(e)},"$7DferZWeQF");R.value=re(n.value)}catch(t){console.error("Erro ao carregar formas de pagamento:",t)}},Z=()=>{const t=R.value.find(n=>n.token===u.forma);if(!t)return p.error("Por favor, selecione uma forma.");const e=h(u.valor);g.value.push({forma:u.forma,descricao:t.descricao,valor:e}),M.value.push({forma_receb_token:u.forma,valor:e}),o.ordem.valor_pago=d(o.ordem.valor_pago+e),o.ordem.valor=d(o.ordem.valor-e),c.value=d(c.value-e),Object.assign(u,{forma:null,valor:"0.00"}),D()},X=t=>{const e=g.value.indexOf(t);if(e!==-1){g.value.splice(e,1),M.value.splice(e,1);const n=h(t.valor);o.ordem.valor_pago=d(o.ordem.valor_pago-n),c.value=d(c.value+n)}D()},h=t=>Number(t.toString().replace(/,/g,""));return P(),(t,e)=>{const n=$,_=ie;return q(),J(E,{persistent:"",modelValue:m(b),"onUpdate:modelValue":e[7]||(e[7]=l=>O(b)?b.value=l:null),"max-width":"650"},{default:r(()=>[a(Q,null,{default:r(()=>[a(F,null,{default:r(()=>[a(C,{class:"mb-5 mt-1 ml-2"},{default:r(()=>[e[8]||(e[8]=i("h1",null,"Ordem de Serviço nº",-1)),i("h1",ce,H(o.ordem.numero),1)]),_:1}),a(F,null,{default:r(()=>[a(C,null,{default:r(()=>[a(I,{class:"mr-5",label:"Recebido",modelValue:o.ordem.valor_pago,"onUpdate:modelValue":e[0]||(e[0]=l=>o.ordem.valor_pago=l),readonly:"",style:{"font-weight":"bold",cursor:"default","pointer-events":"none"}},null,8,["modelValue"]),a(I,{label:"Falta Receber",modelValue:m(c),"onUpdate:modelValue":e[1]||(e[1]=l=>O(c)?c.value=l:null),readonly:"",style:{"font-weight":"bold",cursor:"default","pointer-events":"none"}},null,8,["modelValue"])]),_:1}),a(C,null,{default:r(()=>[a(ne,{class:"mb-5 mr-5",label:"Forma",modelValue:m(u).forma,"onUpdate:modelValue":e[2]||(e[2]=l=>m(u).forma=l),items:m(R),"item-title":"descricao","item-value":"token"},null,8,["modelValue","items"]),i("div",de,[a(n,{modelValue:m(u).valor,"onUpdate:modelValue":e[3]||(e[3]=l=>m(u).valor=l)},null,8,["modelValue"])]),i("div",null,[i("img",{src:se,class:"ml-5",style:{cursor:"pointer",height:"40px",width:"40px"},onClick:Z})])]),_:1})]),_:1}),e[9]||(e[9]=i("hr",{class:"mb-5"},null,-1)),a(me,{headers:W,items:m(g),"item-value":"token"},{"item.forma":r(({item:l})=>[w(H(l.descricao),1)]),"item.actions":r(({item:l})=>[i("div",{style:{display:"flex","justify-content":"flex-end"},onClick:ve=>l.btn_cancelar?X(l):null,title:l.btn_cancelar?"Remover":""},[i("img",{src:ue,style:ae([{width:"30px",height:"30px"},{cursor:l.btn_cancelar?"pointer":"default",opacity:l.btn_cancelar?1:.5}]),alt:"Remover"},null,4)],8,fe)]),_:1},8,["items"])]),_:1}),i("div",Ae,[a(B,{class:"ml-8",size:"large",onClick:T,color:"red"},{default:r(()=>e[10]||(e[10]=[w("Voltar")])),_:1}),a(B,{size:"large",class:"ml-6 mb-6",color:"green",onClick:e[4]||(e[4]=l=>o.ordem.valor>0?L():U())},{default:r(()=>e[11]||(e[11]=[w(" Salvar ")])),_:1})])]),_:1}),a(_,{modelValue:m(f),"onUpdate:modelValue":e[5]||(e[5]=l=>O(f)?f.value=l:null),faltaReceber:m(S),onClose:e[6]||(e[6]=l=>f.value=!1),onConfirmar:U},null,8,["modelValue","faltaReceber"])]),_:1},8,["modelValue"])}}};export{ke as _};
